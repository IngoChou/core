var BitmapImage2D = require("awayjs-core/lib/image/BitmapImage2D");
var Matrix = require("awayjs-core/lib/geom/Matrix");
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
var URLLoader = require("awayjs-core/lib/net/URLLoader");
var URLLoaderDataFormat = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var URLLoaderEvent = require("awayjs-core/lib/events/URLLoaderEvent");
var ParserUtils = require("awayjs-core/lib/parsers/ParserUtils");
var ImageUtils = require("awayjs-core/lib/utils/ImageUtils");
var MipMapTest = (function () {
    function MipMapTest() {
        //---------------------------------------
        // Load a PNG
        var _this = this;
        this._rect = new Rectangle();
        this._matrix = new Matrix();
        var mipUrlRequest = new URLRequest('assets/1024x1024.png');
        this.mipLoader = new URLLoader();
        this.mipLoader.dataFormat = URLLoaderDataFormat.BLOB;
        this.mipLoader.load(mipUrlRequest);
        this.mipLoader.addEventListener(URLLoaderEvent.LOAD_COMPLETE, function (event) { return _this.mipImgLoaded(event); });
        document.onmousedown = function (e) { return _this.onMouseDown(e); };
    }
    MipMapTest.prototype.mipImgLoaded = function (event) {
        var _this = this;
        var loader = event.target;
        var image = ParserUtils.blobToImage(loader.data);
        image.onload = function (event) { return _this.onImageLoad(event); };
    };
    MipMapTest.prototype.onImageLoad = function (event) {
        var image = event.target;
        alert('Each click will generate a level of MipMap');
        this.sourceBitmap = new BitmapImage2D(1024, 1024, true, 0xff0000);
        this.sourceBitmap.draw(image);
        this.sourceBitmap.getCanvas().style.position = 'absolute';
        this.sourceBitmap.getCanvas().style.left = '0px';
        this.sourceBitmap.getCanvas().style.top = '1030px';
        //document.body.appendChild( this.sourceBitmap.canvas );
        this.mipMap = new BitmapImage2D(1024, 1024, true, 0xff0000);
        this.mipMap.getCanvas().style.position = 'absolute';
        this.mipMap.getCanvas().style.left = '0px';
        this.mipMap.getCanvas().style.top = '0px';
        document.body.appendChild(this.mipMap.getCanvas());
        this._rect.width = this.sourceBitmap.width;
        this._rect.height = this.sourceBitmap.height;
        this.w = this.sourceBitmap.width;
        this.h = this.sourceBitmap.height;
    };
    MipMapTest.prototype.onMouseDown = function (e) {
        this.generateMipMap(this.sourceBitmap, this.mipMap);
    };
    MipMapTest.prototype.generateMipMap = function (source, mipmap, alpha, side) {
        if (mipmap === void 0) { mipmap = null; }
        if (alpha === void 0) { alpha = false; }
        if (side === void 0) { side = -1; }
        var c = this.w;
        var i;
        console['time']('MipMap' + c);
        if ((this.w >= 1) || (this.h >= 1)) {
            if (alpha)
                mipmap.fillRect(this._rect, 0);
            this._matrix.a = this._rect.width / source.width;
            this._matrix.d = this._rect.height / source.height;
            mipmap.width = this.w;
            mipmap.height = this.h;
            mipmap.copyPixels(source, source.rect, new Rectangle(0, 0, this.w, this.h));
            this.w >>= 1;
            this.h >>= 1;
            this._rect.width = this.w > 1 ? this.w : 1;
            this._rect.height = this.h > 1 ? this.h : 1;
        }
        console.log('ImageUtils.isBitmapImage2DValid: ', ImageUtils.isImage2DValid(mipmap));
        console['timeEnd']('MipMap' + c);
    };
    return MipMapTest;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzL01pcE1hcFRlc3QudHMiXSwibmFtZXMiOlsiTWlwTWFwVGVzdCIsIk1pcE1hcFRlc3QuY29uc3RydWN0b3IiLCJNaXBNYXBUZXN0Lm1pcEltZ0xvYWRlZCIsIk1pcE1hcFRlc3Qub25JbWFnZUxvYWQiLCJNaXBNYXBUZXN0Lm9uTW91c2VEb3duIiwiTWlwTWFwVGVzdC5nZW5lcmF0ZU1pcE1hcCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxhQUFhLFdBQVkscUNBQXFDLENBQUMsQ0FBQztBQUN2RSxJQUFPLE1BQU0sV0FBYyw2QkFBNkIsQ0FBQyxDQUFDO0FBQzFELElBQU8sU0FBUyxXQUFhLGdDQUFnQyxDQUFDLENBQUM7QUFDL0QsSUFBTyxTQUFTLFdBQWEsK0JBQStCLENBQUMsQ0FBQztBQUM5RCxJQUFPLG1CQUFtQixXQUFXLHlDQUF5QyxDQUFDLENBQUM7QUFDaEYsSUFBTyxVQUFVLFdBQWEsZ0NBQWdDLENBQUMsQ0FBQztBQUNoRSxJQUFPLGNBQWMsV0FBWSx1Q0FBdUMsQ0FBQyxDQUFDO0FBQzFFLElBQU8sV0FBVyxXQUFhLHFDQUFxQyxDQUFDLENBQUM7QUFDdEUsSUFBTyxVQUFVLFdBQWEsa0NBQWtDLENBQUMsQ0FBQztBQUVsRSxJQUFNLFVBQVU7SUFXZkEsU0FYS0EsVUFBVUE7UUFhZEMseUNBQXlDQTtRQUN6Q0EsYUFBYUE7UUFkZkEsaUJBZ0dDQTtRQTFGUUEsVUFBS0EsR0FBeUJBLElBQUlBLFNBQVNBLEVBQUVBLENBQUNBO1FBQzlDQSxZQUFPQSxHQUFvQkEsSUFBSUEsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFTL0NBLElBQUlBLGFBQWFBLEdBQUdBLElBQUlBLFVBQVVBLENBQUVBLHNCQUFzQkEsQ0FBQ0EsQ0FBQ0E7UUFDNURBLElBQUlBLENBQUNBLFNBQVNBLEdBQUlBLElBQUlBLFNBQVNBLEVBQUVBLENBQUNBO1FBQ2xDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxVQUFVQSxHQUFHQSxtQkFBbUJBLENBQUNBLElBQUlBLENBQUNBO1FBQ3JEQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFFQSxhQUFhQSxDQUFFQSxDQUFDQTtRQUNyQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsZ0JBQWdCQSxDQUFFQSxjQUFjQSxDQUFDQSxhQUFhQSxFQUFHQSxVQUFDQSxLQUFvQkEsSUFBS0EsT0FBQUEsS0FBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBeEJBLENBQXdCQSxDQUFFQSxDQUFDQTtRQUVySEEsUUFBUUEsQ0FBQ0EsV0FBV0EsR0FBR0EsVUFBRUEsQ0FBQ0EsSUFBTUEsT0FBQUEsS0FBSUEsQ0FBQ0EsV0FBV0EsQ0FBRUEsQ0FBQ0EsQ0FBRUEsRUFBckJBLENBQXFCQSxDQUFDQTtJQUN2REEsQ0FBQ0E7SUFFT0QsaUNBQVlBLEdBQXBCQSxVQUFxQkEsS0FBb0JBO1FBQXpDRSxpQkFLQ0E7UUFIQUEsSUFBSUEsTUFBTUEsR0FBb0NBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBO1FBQzNEQSxJQUFJQSxLQUFLQSxHQUFzQkEsV0FBV0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDcEVBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLFVBQUVBLEtBQUtBLElBQU1BLE9BQUFBLEtBQUlBLENBQUNBLFdBQVdBLENBQUVBLEtBQUtBLENBQUVBLEVBQXpCQSxDQUF5QkEsQ0FBQ0E7SUFDdkRBLENBQUNBO0lBRU9GLGdDQUFXQSxHQUFuQkEsVUFBcUJBLEtBQUtBO1FBRXpCRyxJQUFJQSxLQUFLQSxHQUF5Q0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDL0RBLEtBQUtBLENBQUVBLDRDQUE0Q0EsQ0FBQ0EsQ0FBQ0E7UUFFckRBLElBQUlBLENBQUNBLFlBQVlBLEdBQTBCQSxJQUFJQSxhQUFhQSxDQUFFQSxJQUFJQSxFQUFHQSxJQUFJQSxFQUFHQSxJQUFJQSxFQUFHQSxRQUFRQSxDQUFFQSxDQUFDQTtRQUM5RkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDOUJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBLEtBQUtBLENBQUNBLFFBQVFBLEdBQUlBLFVBQVVBLENBQUNBO1FBQzNEQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFRQSxLQUFLQSxDQUFDQTtRQUN0REEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsR0FBU0EsUUFBUUEsQ0FBQ0E7UUFFekRBLEFBRUFBLHdEQUZ3REE7UUFFeERBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLGFBQWFBLENBQUVBLElBQUlBLEVBQUdBLElBQUlBLEVBQUdBLElBQUlBLEVBQUdBLFFBQVFBLENBQUVBLENBQUNBO1FBQ2pFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxHQUFJQSxVQUFVQSxDQUFDQTtRQUNyREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBUUEsS0FBS0EsQ0FBQ0E7UUFDaERBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEdBQVNBLEtBQUtBLENBQUNBO1FBRWhEQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFFQSxDQUFDQTtRQUVyREEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBTUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDOUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUtBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLE1BQU1BLENBQUNBO1FBRS9DQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUNqQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFFbkNBLENBQUNBO0lBRU9ILGdDQUFXQSxHQUFuQkEsVUFBcUJBLENBQUNBO1FBRXJCSSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFFQSxJQUFJQSxDQUFDQSxZQUFZQSxFQUFJQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFFQSxDQUFDQTtJQUN6REEsQ0FBQ0E7SUFFTUosbUNBQWNBLEdBQXJCQSxVQUF1QkEsTUFBc0JBLEVBQUdBLE1BQTZCQSxFQUFFQSxLQUFxQkEsRUFBRUEsSUFBZ0JBO1FBQXRFSyxzQkFBNkJBLEdBQTdCQSxhQUE2QkE7UUFBRUEscUJBQXFCQSxHQUFyQkEsYUFBcUJBO1FBQUVBLG9CQUFnQkEsR0FBaEJBLFFBQWVBLENBQUNBO1FBRXJIQSxJQUFJQSxDQUFDQSxHQUFVQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0QkEsSUFBSUEsQ0FBUUEsQ0FBQ0E7UUFFYkEsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFOUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRXJDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQTtnQkFDVEEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFaENBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO1lBQ2pEQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUVuREEsTUFBTUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLE1BQU1BLENBQUNBLE1BQU1BLEdBQUVBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFFQSxNQUFNQSxFQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxFQUFHQSxJQUFJQSxTQUFTQSxDQUFFQSxDQUFDQSxFQUFHQSxDQUFDQSxFQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxFQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFFQSxDQUFFQSxDQUFDQTtZQUVyRkEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDYkEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFFYkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDMUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUVBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzVDQSxDQUFDQTtRQUVEQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSxtQ0FBbUNBLEVBQUdBLFVBQVVBLENBQUNBLGNBQWNBLENBQUVBLE1BQU1BLENBQUVBLENBQUNBLENBQUNBO1FBRXhGQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUVsQ0EsQ0FBQ0E7SUFDRkwsaUJBQUNBO0FBQURBLENBaEdBLEFBZ0dDQSxJQUFBIiwiZmlsZSI6InV0aWxzL01pcE1hcFRlc3QuanMiLCJzb3VyY2VSb290IjoiLi90ZXN0cyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCaXRtYXBJbWFnZTJEXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9pbWFnZS9CaXRtYXBJbWFnZTJEXCIpO1xuaW1wb3J0IE1hdHJpeFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4XCIpO1xuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1JlY3RhbmdsZVwiKTtcbmltcG9ydCBVUkxMb2FkZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlclwiKTtcbmltcG9ydCBVUkxMb2FkZXJEYXRhRm9ybWF0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlckRhdGFGb3JtYXRcIik7XG5pbXBvcnQgVVJMUmVxdWVzdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdFwiKTtcbmltcG9ydCBVUkxMb2FkZXJFdmVudFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1VSTExvYWRlckV2ZW50XCIpO1xuaW1wb3J0IFBhcnNlclV0aWxzXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyVXRpbHNcIik7XG5pbXBvcnQgSW1hZ2VVdGlsc1x0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9JbWFnZVV0aWxzXCIpO1xuXG5jbGFzcyBNaXBNYXBUZXN0XG57XG5cblx0cHJpdmF0ZSBtaXBMb2FkZXIgICAgICAgOiBVUkxMb2FkZXI7XG5cdHByaXZhdGUgc291cmNlQml0bWFwICAgIDogQml0bWFwSW1hZ2UyRDtcblx0cHJpdmF0ZSBtaXBNYXAgICAgICAgICAgOiBCaXRtYXBJbWFnZTJEO1xuXHRwcml2YXRlIF9yZWN0ICAgICAgICAgICA6IFJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoKTtcblx0cHJpdmF0ZSBfbWF0cml4ICAgICAgICAgOiBNYXRyaXggPSBuZXcgTWF0cml4KCk7XG5cdHByaXZhdGUgdyAgICAgICAgICAgICAgIDogbnVtYmVyO1xuXHRwcml2YXRlIGggICAgICAgICAgICAgICA6IG51bWJlcjtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIExvYWQgYSBQTkdcblxuXHRcdHZhciBtaXBVcmxSZXF1ZXN0ID0gbmV3IFVSTFJlcXVlc3QoICdhc3NldHMvMTAyNHgxMDI0LnBuZycpO1xuXHRcdHRoaXMubWlwTG9hZGVyICA9IG5ldyBVUkxMb2FkZXIoKTtcblx0XHR0aGlzLm1pcExvYWRlci5kYXRhRm9ybWF0ID0gVVJMTG9hZGVyRGF0YUZvcm1hdC5CTE9CO1xuXHRcdHRoaXMubWlwTG9hZGVyLmxvYWQoIG1pcFVybFJlcXVlc3QgKTtcblx0XHR0aGlzLm1pcExvYWRlci5hZGRFdmVudExpc3RlbmVyKCBVUkxMb2FkZXJFdmVudC5MT0FEX0NPTVBMRVRFICwgKGV2ZW50OlVSTExvYWRlckV2ZW50KSA9PiB0aGlzLm1pcEltZ0xvYWRlZChldmVudCkgKTtcblxuXHRcdGRvY3VtZW50Lm9ubW91c2Vkb3duID0gKCBlICkgPT4gdGhpcy5vbk1vdXNlRG93biggZSApO1xuXHR9XG5cblx0cHJpdmF0ZSBtaXBJbWdMb2FkZWQoZXZlbnQ6VVJMTG9hZGVyRXZlbnQpXG5cdHtcblx0XHR2YXIgbG9hZGVyICA6IFVSTExvYWRlciAgICAgICAgPSA8VVJMTG9hZGVyID4gZXZlbnQudGFyZ2V0O1xuXHRcdHZhciBpbWFnZSA6IEhUTUxJbWFnZUVsZW1lbnQgPSBQYXJzZXJVdGlscy5ibG9iVG9JbWFnZShsb2FkZXIuZGF0YSk7XG5cdFx0aW1hZ2Uub25sb2FkID0gKCBldmVudCApID0+IHRoaXMub25JbWFnZUxvYWQoIGV2ZW50ICk7XG5cdH1cblxuXHRwcml2YXRlIG9uSW1hZ2VMb2FkIChldmVudClcblx0e1xuXHRcdHZhciBpbWFnZSA6IEhUTUxJbWFnZUVsZW1lbnQgPSA8SFRNTEltYWdlRWxlbWVudD4gZXZlbnQudGFyZ2V0O1xuXHRcdGFsZXJ0KCAnRWFjaCBjbGljayB3aWxsIGdlbmVyYXRlIGEgbGV2ZWwgb2YgTWlwTWFwJyk7XG5cblx0XHR0aGlzLnNvdXJjZUJpdG1hcCAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEJpdG1hcEltYWdlMkQoIDEwMjQgLCAxMDI0ICwgdHJ1ZSAsIDB4ZmYwMDAwICk7XG5cdFx0dGhpcy5zb3VyY2VCaXRtYXAuZHJhdyhpbWFnZSk7XG5cdFx0dGhpcy5zb3VyY2VCaXRtYXAuZ2V0Q2FudmFzKCkuc3R5bGUucG9zaXRpb24gID0gJ2Fic29sdXRlJztcblx0XHR0aGlzLnNvdXJjZUJpdG1hcC5nZXRDYW52YXMoKS5zdHlsZS5sZWZ0ICAgICAgPSAnMHB4Jztcblx0XHR0aGlzLnNvdXJjZUJpdG1hcC5nZXRDYW52YXMoKS5zdHlsZS50b3AgICAgICAgPSAnMTAzMHB4JztcblxuXHRcdC8vZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggdGhpcy5zb3VyY2VCaXRtYXAuY2FudmFzICk7XG5cblx0XHR0aGlzLm1pcE1hcCA9IG5ldyBCaXRtYXBJbWFnZTJEKCAxMDI0ICwgMTAyNCAsIHRydWUgLCAweGZmMDAwMCApO1xuXHRcdHRoaXMubWlwTWFwLmdldENhbnZhcygpLnN0eWxlLnBvc2l0aW9uICA9ICdhYnNvbHV0ZSc7XG5cdFx0dGhpcy5taXBNYXAuZ2V0Q2FudmFzKCkuc3R5bGUubGVmdCAgICAgID0gJzBweCc7XG5cdFx0dGhpcy5taXBNYXAuZ2V0Q2FudmFzKCkuc3R5bGUudG9wICAgICAgID0gJzBweCc7XG5cblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCB0aGlzLm1pcE1hcC5nZXRDYW52YXMoKSApO1xuXG5cdFx0dGhpcy5fcmVjdC53aWR0aCAgICA9IHRoaXMuc291cmNlQml0bWFwLndpZHRoO1xuXHRcdHRoaXMuX3JlY3QuaGVpZ2h0ICAgPSB0aGlzLnNvdXJjZUJpdG1hcC5oZWlnaHQ7XG5cblx0XHR0aGlzLncgPSB0aGlzLnNvdXJjZUJpdG1hcC53aWR0aDtcblx0XHR0aGlzLmggPSB0aGlzLnNvdXJjZUJpdG1hcC5oZWlnaHQ7XG5cblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZURvd24oIGUgKVxuXHR7XG5cdFx0dGhpcy5nZW5lcmF0ZU1pcE1hcCggdGhpcy5zb3VyY2VCaXRtYXAgLCAgdGhpcy5taXBNYXAgKTtcblx0fVxuXHRcblx0cHVibGljIGdlbmVyYXRlTWlwTWFwKCBzb3VyY2UgOiBCaXRtYXBJbWFnZTJEICwgbWlwbWFwIDogQml0bWFwSW1hZ2UyRCA9IG51bGwsIGFscGhhOmJvb2xlYW4gPSBmYWxzZSwgc2lkZTpudW1iZXIgPSAtMSlcblx0e1xuXHRcdHZhciBjOm51bWJlciA9IHRoaXMudztcblx0XHR2YXIgaTpudW1iZXI7XG5cblx0XHRjb25zb2xlWyd0aW1lJ10oJ01pcE1hcCcgKyBjKTtcblx0XHRcblx0XHRpZiAoKHRoaXMudyA+PSAxICkgfHwgKHRoaXMuaCA+PSAxKSkge1xuXG5cdFx0XHRpZiAoYWxwaGEpXG5cdFx0XHRcdG1pcG1hcC5maWxsUmVjdCh0aGlzLl9yZWN0LCAwKTtcblxuXHRcdFx0dGhpcy5fbWF0cml4LmEgPSB0aGlzLl9yZWN0LndpZHRoIC8gc291cmNlLndpZHRoO1xuXHRcdFx0dGhpcy5fbWF0cml4LmQgPSB0aGlzLl9yZWN0LmhlaWdodCAvIHNvdXJjZS5oZWlnaHQ7XG5cblx0XHRcdG1pcG1hcC53aWR0aCA9IHRoaXMudztcblx0XHRcdG1pcG1hcC5oZWlnaHQ9IHRoaXMuaDtcblx0XHRcdG1pcG1hcC5jb3B5UGl4ZWxzKCBzb3VyY2UgLCBzb3VyY2UucmVjdCAsIG5ldyBSZWN0YW5nbGUoIDAgLCAwICwgdGhpcy53ICwgdGhpcy5oICkgKTtcblxuXHRcdFx0dGhpcy53ID4+PSAxO1xuXHRcdFx0dGhpcy5oID4+PSAxO1xuXG5cdFx0XHR0aGlzLl9yZWN0LndpZHRoID0gdGhpcy53ID4gMT8gdGhpcy53IDogMTtcblx0XHRcdHRoaXMuX3JlY3QuaGVpZ2h0ID0gdGhpcy5oID4gMT8gdGhpcy5oIDogMTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyggJ0ltYWdlVXRpbHMuaXNCaXRtYXBJbWFnZTJEVmFsaWQ6ICcgLCBJbWFnZVV0aWxzLmlzSW1hZ2UyRFZhbGlkKCBtaXBtYXAgKSk7XG5cblx0XHRjb25zb2xlWyd0aW1lRW5kJ10oJ01pcE1hcCcgKyBjKTtcblxuXHR9XG59Il19