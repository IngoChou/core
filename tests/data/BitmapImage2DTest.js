var BitmapImage2D = require("awayjs-core/lib/data/BitmapImage2D");
var Matrix = require("awayjs-core/lib/geom/Matrix");
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
var URLLoader = require("awayjs-core/lib/net/URLLoader");
var URLLoaderDataFormat = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var AwayEvent = require("awayjs-core/lib/events/Event");
var IOErrorEvent = require("awayjs-core/lib/events/IOErrorEvent");
var ParserUtils = require("awayjs-core/lib/parsers/ParserUtils");
var ColorUtils = require("awayjs-core/lib/utils/ColorUtils");
var BitmapImage2DTest = (function () {
    function BitmapImage2DTest() {
        var _this = this;
        var transparent = true;
        var initcolour = 0xffffffff;
        //---------------------------------------
        // Load a PNG
        this.urlRequest = new URLRequest('assets/256x256.png');
        this.urlLoader = new URLLoader();
        this.urlLoader.dataFormat = URLLoaderDataFormat.BLOB;
        this.urlLoader.load(this.urlRequest);
        this.urlLoader.addEventListener(AwayEvent.COMPLETE, function (event) { return _this.imgLoaded(event); });
        this.urlLoader.addEventListener(IOErrorEvent.IO_ERROR, function (event) { return _this.imgLoadedError(event); });
        //---------------------------------------
        // BitmapImage2D Object - 1
        this.bitmapData = new BitmapImage2D(256, 256, transparent, initcolour);
        document.body.appendChild(this.bitmapData.getCanvas());
        //---------------------------------------
        // BitmapImage2D Object - 2
        this.bitmapDataB = new BitmapImage2D(256, 256, transparent, initcolour);
        this.bitmapDataB.getCanvas().style.position = 'absolute';
        this.bitmapDataB.getCanvas().style.left = '540px';
        document.body.appendChild(this.bitmapDataB.getCanvas());
        //---------------------------------------
        // BitmapImage2D - setPixel test
        console['time']("bitmapdata"); // start setPixel operation benchmark ( TypeScript does not support console.time - so hacking it in ) .
        this.bitmapDataB.lock();
        for (var i = 0; i < 10000; i++) {
            var x = Math.random() * this.bitmapDataB.width | 0; // |0 to truncate to Int32
            var y = Math.random() * this.bitmapDataB.height | 0;
            this.bitmapDataB.setPixel(x, y, Math.random() * 0xffFFFFFF); // 255 opaque
        }
        this.bitmapDataB.unlock();
        console['timeEnd']("bitmapdata"); // benchmark the setPixel operation
        document.onmousedown = function (event) { return _this.onMouseDown(event); };
    }
    BitmapImage2DTest.prototype.onMouseDown = function (event) {
        if (this.bitmapData.width === 512) {
            if (this.image.complete) {
                this.bitmapDataB.lock(); // Lock bitmap - speeds up setPixelOperations
                //---------------------------------------
                // Resize BitmapImage2D
                this.bitmapData.width = 256;
                this.bitmapData.height = 256;
                //---------------------------------------
                // copy loaded image to first BitmapImage2D
                var rect = new Rectangle(0, 0, this.image.width, this.image.height);
                this.bitmapData.draw(this.image);
                //---------------------------------------
                // copy image into second bitmap data ( and scale it up 2X )
                rect.width = rect.width * 2;
                rect.height = rect.height * 2;
                this.bitmapDataB.copyPixels(this.bitmapData, this.bitmapData.rect, rect);
                for (var d = 0; d < 1000; d++) {
                    var x = Math.random() * this.bitmapDataB.width | 0; // |0 to truncate to Int32
                    var y = Math.random() * this.bitmapDataB.height | 0;
                    this.bitmapDataB.setPixel(x, y, Math.random() * 0xFFFFFFFF); // 255 opaque
                }
                this.bitmapDataB.unlock(); // Unlock bitmapdata
            }
            else {
                //---------------------------------------
                // image is not loaded - fill bitmapdata with red
                this.bitmapData.width = 256;
                this.bitmapData.height = 256;
                this.bitmapData.fillRect(this.bitmapData.rect, 0xffff0000);
            }
        }
        else {
            //---------------------------------------
            // resize bitmapdata;
            this.bitmapData.lock();
            this.bitmapData.width = 512;
            this.bitmapData.height = 512;
            this.bitmapData.fillRect(this.bitmapData.rect, 0xffff0000); // fill it RED
            for (var d = 0; d < 1000; d++) {
                var x = Math.random() * this.bitmapData.width | 0; // |0 to truncate to Int32
                var y = Math.random() * this.bitmapData.height | 0;
                this.bitmapData.setPixel(x, y, Math.random() * 0xFFFFFFFF);
            }
            this.bitmapData.unlock();
            //---------------------------------------
            // copy bitmapdata
            var targetRect = this.bitmapDataB.rect.clone();
            targetRect.width = targetRect.width / 2;
            targetRect.height = targetRect.height / 2;
            this.bitmapDataB.copyPixels(this.bitmapData, this.bitmapDataB.rect, targetRect); // copy first bitmapdata object into the second one
        }
        var m = new Matrix(.5, .08, .08, .5, this.image.width / 2, this.image.height / 2);
        this.bitmapData.draw(this.bitmapData, m);
        this.bitmapData.setPixel32(0, 0, 0xccff0000);
        this.bitmapData.setPixel32(1, 0, 0xcc00ff00);
        this.bitmapData.setPixel32(2, 0, 0xcc0000ff);
        this.bitmapDataB.draw(this.bitmapData, m);
        console.log('GetPixel 0,0: ', ColorUtils.ARGBToHexString(ColorUtils.float32ColorToARGB(this.bitmapData.getPixel(0, 0))));
        console.log('GetPixel 1,0: ', ColorUtils.ARGBToHexString(ColorUtils.float32ColorToARGB(this.bitmapData.getPixel(1, 0))));
        console.log('GetPixel 2,0: ', ColorUtils.ARGBToHexString(ColorUtils.float32ColorToARGB(this.bitmapData.getPixel(2, 0))));
    };
    BitmapImage2DTest.prototype.imgLoadedError = function (event) {
        console.log('error');
    };
    BitmapImage2DTest.prototype.imgLoaded = function (event) {
        var _this = this;
        var loader = event.target;
        this.image = ParserUtils.blobToImage(loader.data);
        this.image.onload = function (event) { return _this.onImageLoad(event); };
    };
    BitmapImage2DTest.prototype.onImageLoad = function (event) {
        this.bitmapData.draw(this.image, null, null, null, new Rectangle(0, 0, this.image.width / 2, this.image.height / 2));
        this.bitmapData.draw(this.bitmapData, new Matrix(.5, .08, .08, .5, this.image.width / 2, this.image.height / 2));
    };
    return BitmapImage2DTest;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGEvQml0bWFwSW1hZ2UyRFRlc3QudHMiXSwibmFtZXMiOlsiQml0bWFwSW1hZ2UyRFRlc3QiLCJCaXRtYXBJbWFnZTJEVGVzdC5jb25zdHJ1Y3RvciIsIkJpdG1hcEltYWdlMkRUZXN0Lm9uTW91c2VEb3duIiwiQml0bWFwSW1hZ2UyRFRlc3QuaW1nTG9hZGVkRXJyb3IiLCJCaXRtYXBJbWFnZTJEVGVzdC5pbWdMb2FkZWQiLCJCaXRtYXBJbWFnZTJEVGVzdC5vbkltYWdlTG9hZCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxhQUFhLFdBQWEsb0NBQW9DLENBQUMsQ0FBQztBQUN2RSxJQUFPLE1BQU0sV0FBZSw2QkFBNkIsQ0FBQyxDQUFDO0FBQzNELElBQU8sU0FBUyxXQUFjLGdDQUFnQyxDQUFDLENBQUM7QUFDaEUsSUFBTyxTQUFTLFdBQWMsK0JBQStCLENBQUMsQ0FBQztBQUMvRCxJQUFPLG1CQUFtQixXQUFZLHlDQUF5QyxDQUFDLENBQUM7QUFDakYsSUFBTyxVQUFVLFdBQWMsZ0NBQWdDLENBQUMsQ0FBQztBQUNqRSxJQUFPLFNBQVMsV0FBYyw4QkFBOEIsQ0FBQyxDQUFDO0FBQzlELElBQU8sWUFBWSxXQUFjLHFDQUFxQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxXQUFXLFdBQWMscUNBQXFDLENBQUMsQ0FBQztBQUN2RSxJQUFPLFVBQVUsV0FBYyxrQ0FBa0MsQ0FBQyxDQUFDO0FBRW5FLElBQU0saUJBQWlCO0lBUXRCQSxTQVJLQSxpQkFBaUJBO1FBQXZCQyxpQkE4SkNBO1FBcEpDQSxJQUFJQSxXQUFXQSxHQUFXQSxJQUFJQSxDQUFDQTtRQUMvQkEsSUFBSUEsVUFBVUEsR0FBVUEsVUFBVUEsQ0FBQ0E7UUFFbkNBLEFBR0FBLHlDQUh5Q0E7UUFDekNBLGFBQWFBO1FBRWJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLFVBQVVBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0E7UUFDdkRBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLElB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QSxDQUFDQTtZQUMxREEsQ0FBQ0E7WUFFREEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7WUFDekJBLEFBR0FBLHlDQUh5Q0E7WUFDekNBLGtCQUFrQkE7Z0JBRWRBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1lBQzlDQSxVQUFVQSxDQUFDQSxLQUFLQSxHQUFHQSxVQUFVQSxDQUFDQSxLQUFLQSxHQUFDQSxDQUFDQSxDQUFDQTtZQUN0Q0EsVUFBVUEsQ0FBQ0EsTUFBTUEsR0FBR0EsVUFBVUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFekNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLFVBQVVBLENBQUNBLEVBQUVBLG1EQUFtREE7UUFDcklBLENBQUNBLEdBRGdGQTtRQUdqRkEsSUFBSUEsQ0FBQ0EsR0FBWUEsSUFBSUEsTUFBTUEsQ0FBQ0EsRUFBRUEsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdkZBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRXpDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxDQUFFQTtRQUM5Q0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBRUE7UUFDOUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLENBQUVBO1FBRTlDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUUxQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsZ0JBQWdCQSxFQUFFQSxVQUFVQSxDQUFDQSxlQUFlQSxDQUFDQSxVQUFVQSxDQUFDQSxrQkFBa0JBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3pIQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLFVBQVVBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDekhBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsRUFBRUEsVUFBVUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsVUFBVUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUkxSEEsQ0FBQ0E7SUFFT0YsMENBQWNBLEdBQXRCQSxVQUF1QkEsS0FBa0JBO1FBRXhDRyxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtJQUN0QkEsQ0FBQ0E7SUFFT0gscUNBQVNBLEdBQWpCQSxVQUFrQkEsS0FBZUE7UUFBakNJLGlCQUtDQTtRQUhBQSxJQUFJQSxNQUFNQSxHQUEwQkEsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDakRBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLFdBQVdBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ2xEQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxVQUFDQSxLQUFXQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUF2QkEsQ0FBdUJBLENBQUNBO0lBQzlEQSxDQUFDQTtJQUVPSix1Q0FBV0EsR0FBbkJBLFVBQW9CQSxLQUFXQTtRQUU5QkssSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsSUFBSUEsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFakhBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLE1BQU1BLENBQUNBLEVBQUVBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLEVBQUVBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO0lBQzlHQSxDQUFDQTtJQUNGTCx3QkFBQ0E7QUFBREEsQ0E5SkEsQUE4SkNBLElBQUEiLCJmaWxlIjoiZGF0YS9CaXRtYXBJbWFnZTJEVGVzdC5qcyIsInNvdXJjZVJvb3QiOiIuL3Rlc3RzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJpdG1hcEltYWdlMkRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZGF0YS9CaXRtYXBJbWFnZTJEXCIpO1xuaW1wb3J0IE1hdHJpeFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXhcIik7XG5pbXBvcnQgUmVjdGFuZ2xlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XG5pbXBvcnQgVVJMTG9hZGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlclwiKTtcbmltcG9ydCBVUkxMb2FkZXJEYXRhRm9ybWF0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMTG9hZGVyRGF0YUZvcm1hdFwiKTtcbmltcG9ydCBVUkxSZXF1ZXN0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIik7XG5pbXBvcnQgQXdheUV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuaW1wb3J0IElPRXJyb3JFdmVudFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9JT0Vycm9yRXZlbnRcIik7XG5pbXBvcnQgUGFyc2VyVXRpbHNcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL1BhcnNlclV0aWxzXCIpO1xuaW1wb3J0IENvbG9yVXRpbHNcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9Db2xvclV0aWxzXCIpO1xuXG5jbGFzcyBCaXRtYXBJbWFnZTJEVGVzdFxue1xuXHRwcml2YXRlIGJpdG1hcERhdGE6Qml0bWFwSW1hZ2UyRDtcblx0cHJpdmF0ZSBiaXRtYXBEYXRhQjpCaXRtYXBJbWFnZTJEO1xuXHRwcml2YXRlIHVybExvYWRlcjpVUkxMb2FkZXI7XG5cdHByaXZhdGUgdXJsUmVxdWVzdDpVUkxSZXF1ZXN0O1xuXHRwcml2YXRlIGltYWdlOkhUTUxJbWFnZUVsZW1lbnQ7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0dmFyIHRyYW5zcGFyZW50OmJvb2xlYW4gPSB0cnVlO1xuXHRcdHZhciBpbml0Y29sb3VyOm51bWJlciA9IDB4ZmZmZmZmZmY7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIExvYWQgYSBQTkdcblxuXHRcdHRoaXMudXJsUmVxdWVzdCA9IG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvMjU2eDI1Ni5wbmcnKTtcblx0XHR0aGlzLnVybExvYWRlciA9IG5ldyBVUkxMb2FkZXIoKTtcblx0XHR0aGlzLnVybExvYWRlci5kYXRhRm9ybWF0ID0gVVJMTG9hZGVyRGF0YUZvcm1hdC5CTE9CO1xuXG5cdFx0dGhpcy51cmxMb2FkZXIubG9hZCh0aGlzLnVybFJlcXVlc3QpO1xuXHRcdHRoaXMudXJsTG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoQXdheUV2ZW50LkNPTVBMRVRFLCAoZXZlbnQ6QXdheUV2ZW50KSA9PiB0aGlzLmltZ0xvYWRlZChldmVudCkpO1xuXHRcdHRoaXMudXJsTG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoSU9FcnJvckV2ZW50LklPX0VSUk9SLCAoZXZlbnQ6SU9FcnJvckV2ZW50KSA9PiB0aGlzLmltZ0xvYWRlZEVycm9yKGV2ZW50KSk7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIEJpdG1hcEltYWdlMkQgT2JqZWN0IC0gMVxuXHRcdHRoaXMuYml0bWFwRGF0YSA9IG5ldyBCaXRtYXBJbWFnZTJEKDI1NiwgIDI1NiwgdHJhbnNwYXJlbnQsIGluaXRjb2xvdXIpO1xuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5iaXRtYXBEYXRhLmdldENhbnZhcygpKTtcblxuXHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0Ly8gQml0bWFwSW1hZ2UyRCBPYmplY3QgLSAyXG5cdFx0dGhpcy5iaXRtYXBEYXRhQiA9IG5ldyBCaXRtYXBJbWFnZTJEKDI1NiwgMjU2LCB0cmFuc3BhcmVudCwgaW5pdGNvbG91cik7XG5cdFx0dGhpcy5iaXRtYXBEYXRhQi5nZXRDYW52YXMoKS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG5cdFx0dGhpcy5iaXRtYXBEYXRhQi5nZXRDYW52YXMoKS5zdHlsZS5sZWZ0ID0gJzU0MHB4Jztcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYml0bWFwRGF0YUIuZ2V0Q2FudmFzKCkpO1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBCaXRtYXBJbWFnZTJEIC0gc2V0UGl4ZWwgdGVzdFxuXHRcdGNvbnNvbGVbJ3RpbWUnXShcImJpdG1hcGRhdGFcIik7IC8vIHN0YXJ0IHNldFBpeGVsIG9wZXJhdGlvbiBiZW5jaG1hcmsgKCBUeXBlU2NyaXB0IGRvZXMgbm90IHN1cHBvcnQgY29uc29sZS50aW1lIC0gc28gaGFja2luZyBpdCBpbiApIC5cblxuXHRcdHRoaXMuYml0bWFwRGF0YUIubG9jaygpO1xuXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxMDAwMDsgaSsrKSB7XG5cdFx0XHR2YXIgeCA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLmJpdG1hcERhdGFCLndpZHRoIHwgMDsgLy8gfDAgdG8gdHJ1bmNhdGUgdG8gSW50MzJcblx0XHRcdHZhciB5ID0gTWF0aC5yYW5kb20oKSAqIHRoaXMuYml0bWFwRGF0YUIuaGVpZ2h0IHwgMDtcblx0XHRcdHRoaXMuYml0bWFwRGF0YUIuc2V0UGl4ZWwoeCwgeSwgTWF0aC5yYW5kb20oKSAqIDB4ZmZGRkZGRkYgKTsgLy8gMjU1IG9wYXF1ZVxuXHRcdH1cblxuXHRcdHRoaXMuYml0bWFwRGF0YUIudW5sb2NrKCk7XG5cdFx0Y29uc29sZVsndGltZUVuZCddKFwiYml0bWFwZGF0YVwiKTsgLy8gYmVuY2htYXJrIHRoZSBzZXRQaXhlbCBvcGVyYXRpb25cblxuXHRcdGRvY3VtZW50Lm9ubW91c2Vkb3duID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZURvd24oZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBvbk1vdXNlRG93bihldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0aWYgKCB0aGlzLmJpdG1hcERhdGEud2lkdGggPT09IDUxMiApIHsvLyBUZXN0IHRvIHRvZ2dsZSByZXNpemUgb2YgYml0bWFwRGF0YVxuXHRcdFx0aWYgKCB0aGlzLmltYWdlLmNvbXBsZXRlICkgey8vIElmIGltYWdlIGlzIGxvYWRlZCBjb3B5IHRoYXQgdG8gdGhlIEJpdG1hcEltYWdlMkQgb2JqZWN0XG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YUIubG9jaygpOyAvLyBMb2NrIGJpdG1hcCAtIHNwZWVkcyB1cCBzZXRQaXhlbE9wZXJhdGlvbnNcblx0XHRcdFx0XG5cdFx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHRcdC8vIFJlc2l6ZSBCaXRtYXBJbWFnZTJEXG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS53aWR0aCAgPSAyNTY7XG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS5oZWlnaHQgPSAyNTY7XG5cblx0XHRcdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdFx0Ly8gY29weSBsb2FkZWQgaW1hZ2UgdG8gZmlyc3QgQml0bWFwSW1hZ2UyRFxuXG5cdFx0XHRcdHZhciByZWN0OlJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgdGhpcy5pbWFnZS53aWR0aCwgdGhpcy5pbWFnZS5oZWlnaHQpO1xuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGEuZHJhdyh0aGlzLmltYWdlKTtcblxuXHRcdFx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0XHQvLyBjb3B5IGltYWdlIGludG8gc2Vjb25kIGJpdG1hcCBkYXRhICggYW5kIHNjYWxlIGl0IHVwIDJYIClcblx0XHRcdFx0cmVjdC53aWR0aCA9IHJlY3Qud2lkdGggKiAyO1xuXHRcdFx0XHRyZWN0LmhlaWdodCA9IHJlY3QuaGVpZ2h0ICogMjtcblxuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGFCLmNvcHlQaXhlbHModGhpcy5iaXRtYXBEYXRhLCB0aGlzLmJpdG1hcERhdGEucmVjdCwgcmVjdCk7XG5cblx0XHRcdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdFx0Ly8gZHJhdyByYW5kb20gcGl4ZWxzXG5cblx0XHRcdFx0Zm9yICh2YXIgZCA9IDA7IGQgPCAxMDAwOyBkKyspIHtcblx0XHRcdFx0XHR2YXIgeCA9IE1hdGgucmFuZG9tKCkqdGhpcy5iaXRtYXBEYXRhQi53aWR0aCB8IDA7IC8vIHwwIHRvIHRydW5jYXRlIHRvIEludDMyXG5cdFx0XHRcdFx0dmFyIHkgPSBNYXRoLnJhbmRvbSgpKnRoaXMuYml0bWFwRGF0YUIuaGVpZ2h0IHwgMDtcblx0XHRcdFx0XHR0aGlzLmJpdG1hcERhdGFCLnNldFBpeGVsKHgsIHksIE1hdGgucmFuZG9tKCkqMHhGRkZGRkZGRik7IC8vIDI1NSBvcGFxdWVcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YUIudW5sb2NrKCk7IC8vIFVubG9jayBiaXRtYXBkYXRhXG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHRcdC8vIGltYWdlIGlzIG5vdCBsb2FkZWQgLSBmaWxsIGJpdG1hcGRhdGEgd2l0aCByZWRcblx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhLndpZHRoICA9IDI1Njtcblx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhLmhlaWdodCA9IDI1Njtcblx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhLmZpbGxSZWN0KHRoaXMuYml0bWFwRGF0YS5yZWN0LCAweGZmZmYwMDAwKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdC8vIHJlc2l6ZSBiaXRtYXBkYXRhO1xuXG5cdFx0XHR0aGlzLmJpdG1hcERhdGEubG9jaygpO1xuXG5cdFx0XHR0aGlzLmJpdG1hcERhdGEud2lkdGggID0gNTEyO1xuXHRcdFx0dGhpcy5iaXRtYXBEYXRhLmhlaWdodCA9IDUxMjtcblx0XHRcdHRoaXMuYml0bWFwRGF0YS5maWxsUmVjdCh0aGlzLmJpdG1hcERhdGEucmVjdCwgMHhmZmZmMDAwMCk7IC8vIGZpbGwgaXQgUkVEXG5cblx0XHRcdGZvciAodmFyIGQgPSAwOyBkIDwgMTAwMDsgZCsrKSB7XG5cdFx0XHRcdHZhciB4ID0gTWF0aC5yYW5kb20oKSp0aGlzLmJpdG1hcERhdGEud2lkdGggfCAwOyAvLyB8MCB0byB0cnVuY2F0ZSB0byBJbnQzMlxuXHRcdFx0XHR2YXIgeSA9IE1hdGgucmFuZG9tKCkqdGhpcy5iaXRtYXBEYXRhLmhlaWdodCB8IDA7XG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS5zZXRQaXhlbCh4LCB5LCBNYXRoLnJhbmRvbSgpKjB4RkZGRkZGRkYpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmJpdG1hcERhdGEudW5sb2NrKCk7XG5cdFx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0Ly8gY29weSBiaXRtYXBkYXRhXG5cblx0XHRcdHZhciB0YXJnZXRSZWN0ID0gdGhpcy5iaXRtYXBEYXRhQi5yZWN0LmNsb25lKCk7XG5cdFx0XHRcdHRhcmdldFJlY3Qud2lkdGggPSB0YXJnZXRSZWN0LndpZHRoLzI7XG5cdFx0XHRcdHRhcmdldFJlY3QuaGVpZ2h0ID0gdGFyZ2V0UmVjdC5oZWlnaHQvMjtcblxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhQi5jb3B5UGl4ZWxzKHRoaXMuYml0bWFwRGF0YSwgdGhpcy5iaXRtYXBEYXRhQi5yZWN0LCB0YXJnZXRSZWN0KTsgLy8gY29weSBmaXJzdCBiaXRtYXBkYXRhIG9iamVjdCBpbnRvIHRoZSBzZWNvbmQgb25lXG5cdFx0fVxuXG5cdFx0dmFyIG0gOiBNYXRyaXggPSBuZXcgTWF0cml4KC41LCAuMDgsIC4wOCwgLjUsIHRoaXMuaW1hZ2Uud2lkdGgvMiwgdGhpcy5pbWFnZS5oZWlnaHQvMik7XG5cdFx0dGhpcy5iaXRtYXBEYXRhLmRyYXcodGhpcy5iaXRtYXBEYXRhLCBtKTtcblxuXHRcdHRoaXMuYml0bWFwRGF0YS5zZXRQaXhlbDMyKDAsIDAsIDB4Y2NmZjAwMDApIDtcblx0XHR0aGlzLmJpdG1hcERhdGEuc2V0UGl4ZWwzMigxLCAwLCAweGNjMDBmZjAwKSA7XG5cdFx0dGhpcy5iaXRtYXBEYXRhLnNldFBpeGVsMzIoMiwgMCwgMHhjYzAwMDBmZikgO1xuXG5cdFx0dGhpcy5iaXRtYXBEYXRhQi5kcmF3KHRoaXMuYml0bWFwRGF0YSwgbSk7XG5cblx0XHRjb25zb2xlLmxvZygnR2V0UGl4ZWwgMCwwOiAnLCBDb2xvclV0aWxzLkFSR0JUb0hleFN0cmluZyhDb2xvclV0aWxzLmZsb2F0MzJDb2xvclRvQVJHQih0aGlzLmJpdG1hcERhdGEuZ2V0UGl4ZWwoMCwgMCkpKSk7XG5cdFx0Y29uc29sZS5sb2coJ0dldFBpeGVsIDEsMDogJywgQ29sb3JVdGlscy5BUkdCVG9IZXhTdHJpbmcoQ29sb3JVdGlscy5mbG9hdDMyQ29sb3JUb0FSR0IodGhpcy5iaXRtYXBEYXRhLmdldFBpeGVsKDEsIDApKSkpO1xuXHRcdGNvbnNvbGUubG9nKCdHZXRQaXhlbCAyLDA6ICcsIENvbG9yVXRpbHMuQVJHQlRvSGV4U3RyaW5nKENvbG9yVXRpbHMuZmxvYXQzMkNvbG9yVG9BUkdCKHRoaXMuYml0bWFwRGF0YS5nZXRQaXhlbCgyLCAwKSkpKTtcblxuXG5cblx0fVxuXG5cdHByaXZhdGUgaW1nTG9hZGVkRXJyb3IoZXZlbnQ6SU9FcnJvckV2ZW50KVxuXHR7XG5cdFx0Y29uc29sZS5sb2coJ2Vycm9yJyk7XG5cdH1cblxuXHRwcml2YXRlIGltZ0xvYWRlZChldmVudDpBd2F5RXZlbnQpXG5cdHtcblx0XHR2YXIgbG9hZGVyIDpVUkxMb2FkZXIgPSA8VVJMTG9hZGVyPiBldmVudC50YXJnZXQ7XG5cdFx0dGhpcy5pbWFnZSA9IFBhcnNlclV0aWxzLmJsb2JUb0ltYWdlKGxvYWRlci5kYXRhKTtcblx0XHR0aGlzLmltYWdlLm9ubG9hZCA9IChldmVudDpFdmVudCkgPT4gdGhpcy5vbkltYWdlTG9hZChldmVudCk7XG5cdH1cblxuXHRwcml2YXRlIG9uSW1hZ2VMb2FkKGV2ZW50OkV2ZW50KVxuXHR7XG5cdFx0dGhpcy5iaXRtYXBEYXRhLmRyYXcodGhpcy5pbWFnZSwgbnVsbCwgbnVsbCwgbnVsbCwgbmV3IFJlY3RhbmdsZSgwLCAwLCB0aGlzLmltYWdlLndpZHRoLzIsIHRoaXMuaW1hZ2UuaGVpZ2h0LzIpKTtcblxuXHRcdHRoaXMuYml0bWFwRGF0YS5kcmF3KHRoaXMuYml0bWFwRGF0YSwgbmV3IE1hdHJpeCguNSwgLjA4LCAuMDgsIC41LCB0aGlzLmltYWdlLndpZHRoLzIsIHRoaXMuaW1hZ2UuaGVpZ2h0LzIpKTtcblx0fVxufSJdfQ==