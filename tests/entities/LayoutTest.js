var View = require("awayjs-core/lib/containers/View");
var HoverController = require("awayjs-core/lib/controllers/HoverController");

var AssetLibrary = require("awayjs-core/lib/core/library/AssetLibrary");

var URLRequest = require("awayjs-core/lib/core/net/URLRequest");
var CSSDefaultRenderer = require("awayjs-core/lib/core/render/CSSDefaultRenderer");
var Billboard = require("awayjs-core/lib/entities/Billboard");
var LoaderEvent = require("awayjs-core/lib/events/LoaderEvent");
var AwayMouseEvent = require("awayjs-core/lib/events/MouseEvent");
var CSSMaterialBase = require("awayjs-core/lib/materials/CSSMaterialBase");
var CoordinateSystem = require("awayjs-core/lib/projections/CoordinateSystem");

var RequestAnimationFrame = require("awayjs-core/lib/utils/RequestAnimationFrame");

var LayoutTest = (function () {
    function LayoutTest() {
        var _this = this;
        this._move = false;
        this._billboards = new Array();
        //load an image
        AssetLibrary.load(new URLRequest('assets/256x256.png'));

        //listen for a resource complete event
        AssetLibrary.addEventListener(LoaderEvent.RESOURCE_COMPLETE, function (event) {
            return _this.onResourceComplete(event);
        });
    }
    /**
    * Listener for resource complete event
    *
    * @param event
    */
    LayoutTest.prototype.onResourceComplete = function (event) {
        var _this = this;
        //get the image texture
        this._imageTexture = event.assets[0];

        //create the view
        this._view = new View(new CSSDefaultRenderer());

        this._projection = this._view.camera.projection;

        this._projection.coordinateSystem = CoordinateSystem.RIGHT_HANDED;
        this._projection.focalLength = 1000;
        this._projection.preserveFocalLength = true;
        this._projection.originX = 0;
        this._projection.originY = 0;

        //create a bitmap material
        this._bitmapMaterial = new CSSMaterialBase(this._imageTexture);

        var billboard;
        var numHBillboards = 2;
        var numVBillboards = 2;
        for (var i = 0; i < numHBillboards; i++) {
            for (var j = 0; j < numVBillboards; j++) {
                billboard = new Billboard(this._bitmapMaterial);

                //billboard.width = 50;
                //billboard.height = 50;
                //billboard.pivot = new Vector3D(billboard.billboardWidth/2, billboard.billboardHeight/2, 0);
                billboard.x = j * 300;
                billboard.y = i * 300;
                billboard.z = 0;
                billboard.addEventListener(AwayMouseEvent.MOUSE_MOVE, this.onMouseEvent);

                //billboard.orientationMode = require("awayjs-core/lib/base.OrientationMode.CAMERA_PLANE;
                //billboard.alignmentMode = require("awayjs-core/lib/base.AlignmentMode.PIVOT_POINT;
                this._billboards.push(billboard);

                //add billboard to the scene
                this._view.scene.addChild(billboard);
            }
        }

        this._hoverControl = new HoverController(this._view.camera, null, 180, 0, 1000);

        document.onmousedown = function (event) {
            return _this.onMouseDownHandler(event);
        };
        document.onmouseup = function (event) {
            return _this.onMouseUpHandler(event);
        };
        document.onmousemove = function (event) {
            return _this.onMouseMove(event);
        };

        window.onresize = function (event) {
            return _this.onResize(event);
        };

        //trigger an initial resize for the view
        this.onResize(null);

        //setup the RAF for a render listener
        this._timer = new RequestAnimationFrame(this.render, this);
        this._timer.start();
    };

    LayoutTest.prototype.onMouseEvent = function (event) {
        console.log(event);
    };

    LayoutTest.prototype.onResize = function (event) {
        this._view.x = 0;
        this._view.y = 0;
        this._view.width = window.innerWidth;
        this._view.height = window.innerHeight;
    };

    LayoutTest.prototype.render = function (dt) {
        for (var i = 0; i < this._billboards.length; i++) {
            //this._billboards[i].rotationZ +=2;
        }

        this._view.render();
    };

    LayoutTest.prototype.onMouseUpHandler = function (event) {
        this._move = false;
    };

    LayoutTest.prototype.onMouseMove = function (event) {
        if (this._move) {
            this._hoverControl.panAngle = 0.3 * (event.clientX - this._lastMouseX) + this._lastPanAngle;
            this._hoverControl.tiltAngle = -0.3 * (event.clientY - this._lastMouseY) + this._lastTiltAngle;
        }
    };

    LayoutTest.prototype.onMouseDownHandler = function (event) {
        this._lastPanAngle = this._hoverControl.panAngle;
        this._lastTiltAngle = this._hoverControl.tiltAngle;
        this._lastMouseX = event.clientX;
        this._lastMouseY = event.clientY;
        this._move = true;
    };
    return LayoutTest;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVudGl0aWVzL0xheW91dFRlc3QudHMiXSwibmFtZXMiOlsiTGF5b3V0VGVzdCIsIkxheW91dFRlc3QuY29uc3RydWN0b3IiLCJMYXlvdXRUZXN0Lm9uUmVzb3VyY2VDb21wbGV0ZSIsIkxheW91dFRlc3Qub25Nb3VzZUV2ZW50IiwiTGF5b3V0VGVzdC5vblJlc2l6ZSIsIkxheW91dFRlc3QucmVuZGVyIiwiTGF5b3V0VGVzdC5vbk1vdXNlVXBIYW5kbGVyIiwiTGF5b3V0VGVzdC5vbk1vdXNlTW92ZSIsIkxheW91dFRlc3Qub25Nb3VzZURvd25IYW5kbGVyIl0sIm1hcHBpbmdzIjoiQUFBQSxxREFBOEQ7QUFDOUQsNEVBQWtGOztBQUVsRix1RUFBOEU7O0FBRTlFLCtEQUFzRTtBQUN0RSxrRkFBdUY7QUFDdkYsNkRBQW9FO0FBQ3BFLCtEQUFzRTtBQUN0RSxpRUFBdUU7QUFDdkUsMEVBQWdGO0FBQ2hGLDhFQUFvRjs7QUFHcEYsa0ZBQXNGOztBQUV0RjtJQWlCQ0E7UUFBQUMsaUJBT0NBO1FBakJEQSxLQUFRQSxLQUFLQSxHQUFXQSxLQUFLQSxDQUFDQTtRQVE5QkEsS0FBUUEsV0FBV0EsR0FBb0JBLElBQUlBLEtBQUtBLENBQVlBLENBQUNBLENBQUNBO1FBSTdEQSxlQUFlQTtRQUNmQSxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxVQUFVQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUVBOztRQUV4REEsc0NBQXNDQTtRQUN0Q0EsWUFBWUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxXQUFXQSxDQUFDQSxpQkFBaUJBLEVBQUdBLFVBQUNBLEtBQWlCQTttQkFBS0EsS0FBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUE5QkEsQ0FBOEJBLENBQUNBO0lBQ3JIQSxDQUFDQTtJQU9ERDs7OztNQURHQTs4Q0FDSEEsVUFBbUJBLEtBQWlCQTtRQUFwQ0UsaUJBdURDQTtRQXJEQUEsdUJBQXVCQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsYUFBYUEs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SUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsS0FBS0E7SUFDbkJBLENBQUNBOztJQUVETixtQ0FBQUEsVUFBb0JBLEtBQWdCQTtRQUVuQ08sSUFBSUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBRUE7WUFDZkEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsUUFBUUEsR0FBR0EsR0FBR0EsR0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUE7WUFDekZBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUNBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBO1NBQzVGQTtJQUNGQSxDQUFDQTs7SUFFRFAsMENBQUFBLFVBQTJCQSxLQUFnQkE7UUFFMUNRLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLFFBQVFBO1FBQ2hEQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxTQUFTQTtRQUNsREEsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsS0FBS0EsQ0FBQ0EsT0FBT0E7UUFDaENBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLEtBQUtBLENBQUNBLE9BQU9BO1FBQ2hDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQTtJQUNsQkEsQ0FBQ0E7SUFDRlIsa0JBQUNBO0FBQURBLENBQUNBLElBQUE7QUFBQSIsImZpbGUiOiJlbnRpdGllcy9MYXlvdXRUZXN0LmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9yb2JiYXRlbWFuL1dlYnN0b3JtUHJvamVjdHMvYXdheWpzLWNvcmUvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZpZXdcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29udGFpbmVycy9WaWV3XCIpO1xuaW1wb3J0IEhvdmVyQ29udHJvbGxlclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb250cm9sbGVycy9Ib3ZlckNvbnRyb2xsZXJcIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBBc3NldExpYnJhcnlcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2xpYnJhcnkvQXNzZXRMaWJyYXJ5XCIpO1xuaW1wb3J0IFVSTExvYWRlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvbmV0L1VSTExvYWRlclwiKTtcbmltcG9ydCBVUkxSZXF1ZXN0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9uZXQvVVJMUmVxdWVzdFwiKTtcbmltcG9ydCBDU1NEZWZhdWx0UmVuZGVyZXJcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvcmVuZGVyL0NTU0RlZmF1bHRSZW5kZXJlclwiKTtcbmltcG9ydCBCaWxsYm9hcmRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lbnRpdGllcy9CaWxsYm9hcmRcIik7XG5pbXBvcnQgTG9hZGVyRXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvTG9hZGVyRXZlbnRcIik7XG5pbXBvcnQgQXdheU1vdXNlRXZlbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL01vdXNlRXZlbnRcIik7XG5pbXBvcnQgQ1NTTWF0ZXJpYWxCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL21hdGVyaWFscy9DU1NNYXRlcmlhbEJhc2VcIik7XG5pbXBvcnQgQ29vcmRpbmF0ZVN5c3RlbVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9Db29yZGluYXRlU3lzdGVtXCIpO1xuaW1wb3J0IFBlcnNwZWN0aXZlUHJvamVjdGlvblx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL1BlcnNwZWN0aXZlUHJvamVjdGlvblwiKTtcbmltcG9ydCBJbWFnZVRleHR1cmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9JbWFnZVRleHR1cmVcIik7XG5pbXBvcnQgUmVxdWVzdEFuaW1hdGlvbkZyYW1lXHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCIpO1xuXG5jbGFzcyBMYXlvdXRUZXN0XG57XG5cdHByaXZhdGUgX3ZpZXc6Vmlldztcblx0cHJpdmF0ZSBfcHJvamVjdGlvbjpQZXJzcGVjdGl2ZVByb2plY3Rpb247XG5cdHByaXZhdGUgX3RpbWVyOlJlcXVlc3RBbmltYXRpb25GcmFtZTtcblx0cHJpdmF0ZSBfaG92ZXJDb250cm9sOkhvdmVyQ29udHJvbGxlcjtcblxuXHRwcml2YXRlIF9tb3ZlOmJvb2xlYW4gPSBmYWxzZTtcblx0cHJpdmF0ZSBfbGFzdFBhbkFuZ2xlOm51bWJlcjtcblx0cHJpdmF0ZSBfbGFzdFRpbHRBbmdsZTpudW1iZXI7XG5cdHByaXZhdGUgX2xhc3RNb3VzZVg6bnVtYmVyO1xuXHRwcml2YXRlIF9sYXN0TW91c2VZOm51bWJlcjtcblxuXHRwcml2YXRlIF9pbWFnZVRleHR1cmU6SW1hZ2VUZXh0dXJlO1xuXHRwcml2YXRlIF9iaXRtYXBNYXRlcmlhbDpDU1NNYXRlcmlhbEJhc2U7XG5cdHByaXZhdGUgX2JpbGxib2FyZHM6QXJyYXk8QmlsbGJvYXJkPiA9IG5ldyBBcnJheTxCaWxsYm9hcmQ+KCk7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0Ly9sb2FkIGFuIGltYWdlXG5cdFx0QXNzZXRMaWJyYXJ5LmxvYWQobmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy8yNTZ4MjU2LnBuZycpICk7XG5cblx0XHQvL2xpc3RlbiBmb3IgYSByZXNvdXJjZSBjb21wbGV0ZSBldmVudFxuXHRcdEFzc2V0TGlicmFyeS5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LlJFU09VUkNFX0NPTVBMRVRFICwgKGV2ZW50OkxvYWRlckV2ZW50KSA9PiB0aGlzLm9uUmVzb3VyY2VDb21wbGV0ZShldmVudCkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIExpc3RlbmVyIGZvciByZXNvdXJjZSBjb21wbGV0ZSBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gZXZlbnRcblx0ICovXG5cdG9uUmVzb3VyY2VDb21wbGV0ZShldmVudDpMb2FkZXJFdmVudClcblx0e1xuXHRcdC8vZ2V0IHRoZSBpbWFnZSB0ZXh0dXJlXG5cdFx0dGhpcy5faW1hZ2VUZXh0dXJlID0gPEltYWdlVGV4dHVyZT4gZXZlbnQuYXNzZXRzWzBdO1xuXG5cdFx0Ly9jcmVhdGUgdGhlIHZpZXdcblx0XHR0aGlzLl92aWV3ID0gbmV3IFZpZXcobmV3IENTU0RlZmF1bHRSZW5kZXJlcigpKTtcblxuXHRcdHRoaXMuX3Byb2plY3Rpb24gPSA8UGVyc3BlY3RpdmVQcm9qZWN0aW9uPiB0aGlzLl92aWV3LmNhbWVyYS5wcm9qZWN0aW9uO1xuXG5cblx0XHR0aGlzLl9wcm9qZWN0aW9uLmNvb3JkaW5hdGVTeXN0ZW0gPSBDb29yZGluYXRlU3lzdGVtLlJJR0hUX0hBTkRFRDtcblx0XHR0aGlzLl9wcm9qZWN0aW9uLmZvY2FsTGVuZ3RoID0gMTAwMDtcblx0XHR0aGlzLl9wcm9qZWN0aW9uLnByZXNlcnZlRm9jYWxMZW5ndGggPSB0cnVlO1xuXHRcdHRoaXMuX3Byb2plY3Rpb24ub3JpZ2luWCA9IDA7XG5cdFx0dGhpcy5fcHJvamVjdGlvbi5vcmlnaW5ZID0gMDtcblxuXHRcdC8vY3JlYXRlIGEgYml0bWFwIG1hdGVyaWFsXG5cdFx0dGhpcy5fYml0bWFwTWF0ZXJpYWwgPSBuZXcgQ1NTTWF0ZXJpYWxCYXNlKHRoaXMuX2ltYWdlVGV4dHVyZSk7XG5cblx0XHR2YXIgYmlsbGJvYXJkOkJpbGxib2FyZDtcblx0XHR2YXIgbnVtSEJpbGxib2FyZHM6bnVtYmVyID0gMjtcblx0XHR2YXIgbnVtVkJpbGxib2FyZHM6bnVtYmVyID0gMjtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBudW1IQmlsbGJvYXJkczsgaSsrKSB7XG5cdFx0XHRmb3IgKHZhciBqOm51bWJlciA9IDA7IGogPCBudW1WQmlsbGJvYXJkczsgaisrKSB7XG5cdFx0XHRcdGJpbGxib2FyZCA9IG5ldyBCaWxsYm9hcmQodGhpcy5fYml0bWFwTWF0ZXJpYWwpO1xuXHRcdFx0XHQvL2JpbGxib2FyZC53aWR0aCA9IDUwO1xuXHRcdFx0XHQvL2JpbGxib2FyZC5oZWlnaHQgPSA1MDtcblx0XHRcdFx0Ly9iaWxsYm9hcmQucGl2b3QgPSBuZXcgVmVjdG9yM0QoYmlsbGJvYXJkLmJpbGxib2FyZFdpZHRoLzIsIGJpbGxib2FyZC5iaWxsYm9hcmRIZWlnaHQvMiwgMCk7XG5cdFx0XHRcdGJpbGxib2FyZC54ID0gaiozMDA7XG5cdFx0XHRcdGJpbGxib2FyZC55ID0gaSozMDA7XG5cdFx0XHRcdGJpbGxib2FyZC56ID0gMDtcblx0XHRcdFx0YmlsbGJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoQXdheU1vdXNlRXZlbnQuTU9VU0VfTU9WRSwgdGhpcy5vbk1vdXNlRXZlbnQpXG5cdFx0XHRcdC8vYmlsbGJvYXJkLm9yaWVudGF0aW9uTW9kZSA9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvYmFzZS5PcmllbnRhdGlvbk1vZGUuQ0FNRVJBX1BMQU5FO1xuXHRcdFx0XHQvL2JpbGxib2FyZC5hbGlnbm1lbnRNb2RlID0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9iYXNlLkFsaWdubWVudE1vZGUuUElWT1RfUE9JTlQ7XG5cdFx0XHRcdHRoaXMuX2JpbGxib2FyZHMucHVzaChiaWxsYm9hcmQpO1xuXHRcdFx0XHQvL2FkZCBiaWxsYm9hcmQgdG8gdGhlIHNjZW5lXG5cdFx0XHRcdHRoaXMuX3ZpZXcuc2NlbmUuYWRkQ2hpbGQoYmlsbGJvYXJkKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLl9ob3ZlckNvbnRyb2wgPSBuZXcgSG92ZXJDb250cm9sbGVyKHRoaXMuX3ZpZXcuY2FtZXJhLCBudWxsLCAxODAsIDAsIDEwMDApO1xuXG5cdFx0ZG9jdW1lbnQub25tb3VzZWRvd24gPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlRG93bkhhbmRsZXIoZXZlbnQpO1xuXHRcdGRvY3VtZW50Lm9ubW91c2V1cCA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VVcEhhbmRsZXIoZXZlbnQpO1xuXHRcdGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZU1vdmUoZXZlbnQpO1xuXG5cdFx0d2luZG93Lm9ucmVzaXplICA9IChldmVudDpVSUV2ZW50KSA9PiB0aGlzLm9uUmVzaXplKGV2ZW50KTtcblxuXHRcdC8vdHJpZ2dlciBhbiBpbml0aWFsIHJlc2l6ZSBmb3IgdGhlIHZpZXdcblx0XHR0aGlzLm9uUmVzaXplKG51bGwpO1xuXG5cdFx0Ly9zZXR1cCB0aGUgUkFGIGZvciBhIHJlbmRlciBsaXN0ZW5lclxuXHRcdHRoaXMuX3RpbWVyID0gbmV3IFJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlciwgdGhpcyk7XG5cdFx0dGhpcy5fdGltZXIuc3RhcnQoKTtcblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZUV2ZW50KGV2ZW50OkF3YXlNb3VzZUV2ZW50KVxuXHR7XG5cdFx0Y29uc29sZS5sb2coZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBvblJlc2l6ZShldmVudDpVSUV2ZW50KVxuXHR7XG5cdFx0dGhpcy5fdmlldy54ID0gMDtcblx0XHR0aGlzLl92aWV3LnkgPSAwO1xuXHRcdHRoaXMuX3ZpZXcud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcblx0XHR0aGlzLl92aWV3LmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblx0fVxuXG5cdHByaXZhdGUgcmVuZGVyKGR0Om51bWJlcilcblx0e1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IHRoaXMuX2JpbGxib2FyZHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdC8vdGhpcy5fYmlsbGJvYXJkc1tpXS5yb3RhdGlvblogKz0yO1xuXHRcdH1cblxuXHRcdHRoaXMuX3ZpZXcucmVuZGVyKCk7XG5cblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZVVwSGFuZGxlcihldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0dGhpcy5fbW92ZSA9IGZhbHNlO1xuXHR9XG5cblx0cHJpdmF0ZSBvbk1vdXNlTW92ZShldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0aWYgKHRoaXMuX21vdmUpIHtcblx0XHRcdHRoaXMuX2hvdmVyQ29udHJvbC5wYW5BbmdsZSA9IDAuMyooZXZlbnQuY2xpZW50WCAtIHRoaXMuX2xhc3RNb3VzZVgpICsgdGhpcy5fbGFzdFBhbkFuZ2xlO1xuXHRcdFx0dGhpcy5faG92ZXJDb250cm9sLnRpbHRBbmdsZSA9IC0wLjMqKGV2ZW50LmNsaWVudFkgLSB0aGlzLl9sYXN0TW91c2VZKSArIHRoaXMuX2xhc3RUaWx0QW5nbGU7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBvbk1vdXNlRG93bkhhbmRsZXIoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdHRoaXMuX2xhc3RQYW5BbmdsZSA9IHRoaXMuX2hvdmVyQ29udHJvbC5wYW5BbmdsZTtcblx0XHR0aGlzLl9sYXN0VGlsdEFuZ2xlID0gdGhpcy5faG92ZXJDb250cm9sLnRpbHRBbmdsZTtcblx0XHR0aGlzLl9sYXN0TW91c2VYID0gZXZlbnQuY2xpZW50WDtcblx0XHR0aGlzLl9sYXN0TW91c2VZID0gZXZlbnQuY2xpZW50WTtcblx0XHR0aGlzLl9tb3ZlID0gdHJ1ZTtcblx0fVxufSJdfQ==