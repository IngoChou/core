var View = require("awayjs-core/lib/containers/View");
var HoverController = require("awayjs-core/lib/controllers/HoverController");
var AlignmentMode = require("awayjs-core/lib/core/base/AlignmentMode");
var Vector3D = require("awayjs-core/lib/core/geom/Vector3D");
var AssetLibrary = require("awayjs-core/lib/core/library/AssetLibrary");

var URLRequest = require("awayjs-core/lib/core/net/URLRequest");
var CSSDefaultRenderer = require("awayjs-core/lib/core/render/CSSDefaultRenderer");
var Billboard = require("awayjs-core/lib/entities/Billboard");
var LoaderEvent = require("awayjs-core/lib/events/LoaderEvent");
var CSSMaterialBase = require("awayjs-core/lib/materials/CSSMaterialBase");

var RequestAnimationFrame = require("awayjs-core/lib/utils/RequestAnimationFrame");

var BillboardEntityTest = (function () {
    function BillboardEntityTest() {
        var _this = this;
        this._time = 0;
        this._move = false;
        this._billboards = new Array();
        //load an image
        AssetLibrary.load(new URLRequest('assets/256x256.png'));

        //listen for a resource complete event
        AssetLibrary.addEventListener(LoaderEvent.RESOURCE_COMPLETE, function (event) {
            return _this.onResourceComplete(event);
        });
    }
    /**
    * Listener for resource complete event
    *
    * @param event
    */
    BillboardEntityTest.prototype.onResourceComplete = function (event) {
        var _this = this;
        //get the image texture
        this._imageTexture = event.assets[0];

        //create the view
        this._view = new View(new CSSDefaultRenderer());

        //create a bitmap material
        this._bitmapMaterial = new CSSMaterialBase(this._imageTexture);

        var billboard;
        var numBillboards = 500;
        for (var i = 0; i < numBillboards; i++) {
            billboard = new Billboard(this._bitmapMaterial);
            billboard.width = 50;
            billboard.height = 50;
            billboard.pivot = new Vector3D(25, 25, 0);
            billboard.x = Math.cos(i * 32 * Math.PI / numBillboards) * 400 * Math.sin(i * Math.PI / numBillboards);
            billboard.y = Math.sin(i * 32 * Math.PI / numBillboards) * 400 * Math.sin(i * Math.PI / numBillboards);
            billboard.z = Math.cos(i * Math.PI / numBillboards) * 400;

            //billboard.orientationMode = away.base.OrientationMode.CAMERA_PLANE;
            billboard.alignmentMode = AlignmentMode.PIVOT_POINT;
            this._billboards.push(billboard);

            //add billboard to the scene
            this._view.scene.addChild(billboard);
        }

        this._hoverControl = new HoverController(this._view.camera, null, 150, 10);

        document.onmousedown = function (event) {
            return _this.onMouseDownHandler(event);
        };
        document.onmouseup = function (event) {
            return _this.onMouseUpHandler(event);
        };
        document.onmousemove = function (event) {
            return _this.onMouseMove(event);
        };

        window.onresize = function (event) {
            return _this.onResize(event);
        };

        //trigger an initial resize for the view
        this.onResize(null);

        //setup the RAF for a render listener
        this._timer = new RequestAnimationFrame(this.render, this);
        this._timer.start();
    };

    BillboardEntityTest.prototype.onResize = function (event) {
        this._view.x = 0;
        this._view.y = 0;
        this._view.width = window.innerWidth;
        this._view.height = window.innerHeight;
    };

    BillboardEntityTest.prototype.render = function (dt) {
        this._time += dt;
        for (var i = 0; i < this._billboards.length; i++) {
            this._billboards[i].rotationZ = i + this._time / 10;
            this._billboards[i].rotationX = i + this._time / 10;
        }

        this._view.render();
    };

    BillboardEntityTest.prototype.onMouseUpHandler = function (event) {
        this._move = false;
    };

    BillboardEntityTest.prototype.onMouseMove = function (event) {
        if (this._move) {
            this._hoverControl.panAngle = 0.3 * (event.clientX - this._lastMouseX) + this._lastPanAngle;
            this._hoverControl.tiltAngle = 0.3 * (event.clientY - this._lastMouseY) + this._lastTiltAngle;
        }
    };

    BillboardEntityTest.prototype.onMouseDownHandler = function (event) {
        this._lastPanAngle = this._hoverControl.panAngle;
        this._lastTiltAngle = this._hoverControl.tiltAngle;
        this._lastMouseX = event.clientX;
        this._lastMouseY = event.clientY;
        this._move = true;
    };
    return BillboardEntityTest;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVudGl0aWVzL0JpbGxib2FyZEVudGl0eVRlc3QudHMiXSwibmFtZXMiOlsiQmlsbGJvYXJkRW50aXR5VGVzdCIsIkJpbGxib2FyZEVudGl0eVRlc3QuY29uc3RydWN0b3IiLCJCaWxsYm9hcmRFbnRpdHlUZXN0Lm9uUmVzb3VyY2VDb21wbGV0ZSIsIkJpbGxib2FyZEVudGl0eVRlc3Qub25SZXNpemUiLCJCaWxsYm9hcmRFbnRpdHlUZXN0LnJlbmRlciIsIkJpbGxib2FyZEVudGl0eVRlc3Qub25Nb3VzZVVwSGFuZGxlciIsIkJpbGxib2FyZEVudGl0eVRlc3Qub25Nb3VzZU1vdmUiLCJCaWxsYm9hcmRFbnRpdHlUZXN0Lm9uTW91c2VEb3duSGFuZGxlciJdLCJtYXBwaW5ncyI6IkFBQUEscURBQThEO0FBQzlELDRFQUFrRjtBQUNsRixzRUFBNEU7QUFDNUUsNERBQW9FO0FBQ3BFLHVFQUE4RTs7QUFFOUUsK0RBQXNFO0FBQ3RFLGtGQUF1RjtBQUN2Riw2REFBb0U7QUFDcEUsK0RBQXNFO0FBQ3RFLDBFQUFnRjs7QUFFaEYsa0ZBQXNGOztBQUV0RjtJQWlCQ0E7UUFBQUMsaUJBT0NBO1FBcEJEQSxLQUFRQSxLQUFLQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUd6QkEsS0FBUUEsS0FBS0EsR0FBV0EsS0FBS0EsQ0FBQ0E7UUFROUJBLEtBQVFBLFdBQVdBLEdBQW9CQSxJQUFJQSxLQUFLQSxDQUFZQSxDQUFDQSxDQUFDQTtRQUk3REEsZUFBZUE7UUFDZkEsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsVUFBVUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQTs7UUFFdkRBLHNDQUFzQ0E7UUFDdENBLFlBQVlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxVQUFDQSxLQUFpQkE7bUJBQUtBLEtBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFBOUJBLENBQThCQSxDQUFDQTtJQUNwSEEsQ0FBQ0E7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UCwyQkFBQ0E7QUFBREEsQ0FBQ0EsSUFBQTtBQUFBIiwiZmlsZSI6ImVudGl0aWVzL0JpbGxib2FyZEVudGl0eVRlc3QuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtY29yZS8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmlld1x0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb250YWluZXJzL1ZpZXdcIik7XG5pbXBvcnQgSG92ZXJDb250cm9sbGVyXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvbnRyb2xsZXJzL0hvdmVyQ29udHJvbGxlclwiKTtcbmltcG9ydCBBbGlnbm1lbnRNb2RlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvYmFzZS9BbGlnbm1lbnRNb2RlXCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vVmVjdG9yM0RcIik7XG5pbXBvcnQgQXNzZXRMaWJyYXJ5XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9saWJyYXJ5L0Fzc2V0TGlicmFyeVwiKTtcbmltcG9ydCBVUkxMb2FkZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL25ldC9VUkxMb2FkZXJcIik7XG5pbXBvcnQgVVJMUmVxdWVzdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvbmV0L1VSTFJlcXVlc3RcIik7XG5pbXBvcnQgQ1NTRGVmYXVsdFJlbmRlcmVyXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL3JlbmRlci9DU1NEZWZhdWx0UmVuZGVyZXJcIik7XG5pbXBvcnQgQmlsbGJvYXJkXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZW50aXRpZXMvQmlsbGJvYXJkXCIpO1xuaW1wb3J0IExvYWRlckV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0xvYWRlckV2ZW50XCIpO1xuaW1wb3J0IENTU01hdGVyaWFsQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9tYXRlcmlhbHMvQ1NTTWF0ZXJpYWxCYXNlXCIpO1xuaW1wb3J0IEltYWdlVGV4dHVyZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL0ltYWdlVGV4dHVyZVwiKTtcbmltcG9ydCBSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9SZXF1ZXN0QW5pbWF0aW9uRnJhbWVcIik7XG5cbmNsYXNzIEJpbGxib2FyZEVudGl0eVRlc3Rcbntcblx0cHJpdmF0ZSBfdmlldzpWaWV3O1xuXHRwcml2YXRlIF90aW1lcjpSZXF1ZXN0QW5pbWF0aW9uRnJhbWU7XG5cdHByaXZhdGUgX3RpbWU6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfaG92ZXJDb250cm9sOkhvdmVyQ29udHJvbGxlcjtcblxuXHRwcml2YXRlIF9tb3ZlOmJvb2xlYW4gPSBmYWxzZTtcblx0cHJpdmF0ZSBfbGFzdFBhbkFuZ2xlOm51bWJlcjtcblx0cHJpdmF0ZSBfbGFzdFRpbHRBbmdsZTpudW1iZXI7XG5cdHByaXZhdGUgX2xhc3RNb3VzZVg6bnVtYmVyO1xuXHRwcml2YXRlIF9sYXN0TW91c2VZOm51bWJlcjtcblxuXHRwcml2YXRlIF9pbWFnZVRleHR1cmU6SW1hZ2VUZXh0dXJlO1xuXHRwcml2YXRlIF9iaXRtYXBNYXRlcmlhbDpDU1NNYXRlcmlhbEJhc2U7XG5cdHByaXZhdGUgX2JpbGxib2FyZHM6QXJyYXk8QmlsbGJvYXJkPiA9IG5ldyBBcnJheTxCaWxsYm9hcmQ+KCk7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0Ly9sb2FkIGFuIGltYWdlXG5cdFx0QXNzZXRMaWJyYXJ5LmxvYWQobmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy8yNTZ4MjU2LnBuZycpKTtcblxuXHRcdC8vbGlzdGVuIGZvciBhIHJlc291cmNlIGNvbXBsZXRlIGV2ZW50XG5cdFx0QXNzZXRMaWJyYXJ5LmFkZEV2ZW50TGlzdGVuZXIoTG9hZGVyRXZlbnQuUkVTT1VSQ0VfQ09NUExFVEUsIChldmVudDpMb2FkZXJFdmVudCkgPT4gdGhpcy5vblJlc291cmNlQ29tcGxldGUoZXZlbnQpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBMaXN0ZW5lciBmb3IgcmVzb3VyY2UgY29tcGxldGUgZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGV2ZW50XG5cdCAqL1xuXHRvblJlc291cmNlQ29tcGxldGUoZXZlbnQ6TG9hZGVyRXZlbnQpXG5cdHtcblx0XHQvL2dldCB0aGUgaW1hZ2UgdGV4dHVyZVxuXHRcdHRoaXMuX2ltYWdlVGV4dHVyZSA9IDxJbWFnZVRleHR1cmU+IGV2ZW50LmFzc2V0c1swXTtcblxuXHRcdC8vY3JlYXRlIHRoZSB2aWV3XG5cdFx0dGhpcy5fdmlldyA9IG5ldyBWaWV3KG5ldyBDU1NEZWZhdWx0UmVuZGVyZXIoKSk7XG5cblx0XHQvL2NyZWF0ZSBhIGJpdG1hcCBtYXRlcmlhbFxuXHRcdHRoaXMuX2JpdG1hcE1hdGVyaWFsID0gbmV3IENTU01hdGVyaWFsQmFzZSh0aGlzLl9pbWFnZVRleHR1cmUpO1xuXG5cdFx0dmFyIGJpbGxib2FyZDpCaWxsYm9hcmQ7XG5cdFx0dmFyIG51bUJpbGxib2FyZHM6bnVtYmVyID0gNTAwO1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IG51bUJpbGxib2FyZHM7IGkrKykge1xuXHRcdFx0YmlsbGJvYXJkID0gbmV3IEJpbGxib2FyZCh0aGlzLl9iaXRtYXBNYXRlcmlhbCk7XG5cdFx0XHRiaWxsYm9hcmQud2lkdGggPSA1MDtcblx0XHRcdGJpbGxib2FyZC5oZWlnaHQgPSA1MDtcblx0XHRcdGJpbGxib2FyZC5waXZvdCA9IG5ldyBWZWN0b3IzRCgyNSwgMjUsIDApO1xuXHRcdFx0YmlsbGJvYXJkLnggPSBNYXRoLmNvcyhpKjMyKk1hdGguUEkvbnVtQmlsbGJvYXJkcykqNDAwKk1hdGguc2luKGkqTWF0aC5QSS9udW1CaWxsYm9hcmRzKTtcblx0XHRcdGJpbGxib2FyZC55ID0gTWF0aC5zaW4oaSozMipNYXRoLlBJL251bUJpbGxib2FyZHMpKjQwMCpNYXRoLnNpbihpKk1hdGguUEkvbnVtQmlsbGJvYXJkcyk7XG5cdFx0XHRiaWxsYm9hcmQueiA9IE1hdGguY29zKGkqTWF0aC5QSS9udW1CaWxsYm9hcmRzKSo0MDA7XG5cdFx0XHQvL2JpbGxib2FyZC5vcmllbnRhdGlvbk1vZGUgPSBhd2F5LmJhc2UuT3JpZW50YXRpb25Nb2RlLkNBTUVSQV9QTEFORTtcblx0XHRcdGJpbGxib2FyZC5hbGlnbm1lbnRNb2RlID0gQWxpZ25tZW50TW9kZS5QSVZPVF9QT0lOVDtcblx0XHRcdHRoaXMuX2JpbGxib2FyZHMucHVzaChiaWxsYm9hcmQpO1xuXHRcdFx0Ly9hZGQgYmlsbGJvYXJkIHRvIHRoZSBzY2VuZVxuXHRcdFx0dGhpcy5fdmlldy5zY2VuZS5hZGRDaGlsZChiaWxsYm9hcmQpO1xuXHRcdH1cblxuXHRcdHRoaXMuX2hvdmVyQ29udHJvbCA9IG5ldyBIb3ZlckNvbnRyb2xsZXIodGhpcy5fdmlldy5jYW1lcmEsIG51bGwsIDE1MCwgMTApO1xuXG5cdFx0ZG9jdW1lbnQub25tb3VzZWRvd24gPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlRG93bkhhbmRsZXIoZXZlbnQpO1xuXHRcdGRvY3VtZW50Lm9ubW91c2V1cCA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VVcEhhbmRsZXIoZXZlbnQpO1xuXHRcdGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZU1vdmUoZXZlbnQpO1xuXG5cdFx0d2luZG93Lm9ucmVzaXplICA9IChldmVudDpVSUV2ZW50KSA9PiB0aGlzLm9uUmVzaXplKGV2ZW50KTtcblxuXHRcdC8vdHJpZ2dlciBhbiBpbml0aWFsIHJlc2l6ZSBmb3IgdGhlIHZpZXdcblx0XHR0aGlzLm9uUmVzaXplKG51bGwpO1xuXG5cdFx0Ly9zZXR1cCB0aGUgUkFGIGZvciBhIHJlbmRlciBsaXN0ZW5lclxuXHRcdHRoaXMuX3RpbWVyID0gbmV3IFJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlciwgdGhpcyk7XG5cdFx0dGhpcy5fdGltZXIuc3RhcnQoKTtcblx0fVxuXG5cdHByaXZhdGUgb25SZXNpemUoZXZlbnQ6VUlFdmVudClcblx0e1xuXHRcdHRoaXMuX3ZpZXcueCA9IDA7XG5cdFx0dGhpcy5fdmlldy55ID0gMDtcblx0XHR0aGlzLl92aWV3LndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG5cdFx0dGhpcy5fdmlldy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdH1cblxuXHRwcml2YXRlIHJlbmRlcihkdDpudW1iZXIpXG5cdHtcblx0XHR0aGlzLl90aW1lICs9IGR0O1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IHRoaXMuX2JpbGxib2FyZHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRoaXMuX2JpbGxib2FyZHNbaV0ucm90YXRpb25aID0gaSArIHRoaXMuX3RpbWUvMTA7XG5cdFx0XHR0aGlzLl9iaWxsYm9hcmRzW2ldLnJvdGF0aW9uWCA9IGkgKyB0aGlzLl90aW1lLzEwO1xuXHRcdH1cblxuXHRcdHRoaXMuX3ZpZXcucmVuZGVyKCk7XG5cblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZVVwSGFuZGxlcihldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0dGhpcy5fbW92ZSA9IGZhbHNlO1xuXHR9XG5cblx0cHJpdmF0ZSBvbk1vdXNlTW92ZShldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0aWYgKHRoaXMuX21vdmUpIHtcblx0XHRcdHRoaXMuX2hvdmVyQ29udHJvbC5wYW5BbmdsZSA9IDAuMyooZXZlbnQuY2xpZW50WCAtIHRoaXMuX2xhc3RNb3VzZVgpICsgdGhpcy5fbGFzdFBhbkFuZ2xlO1xuXHRcdFx0dGhpcy5faG92ZXJDb250cm9sLnRpbHRBbmdsZSA9IDAuMyooZXZlbnQuY2xpZW50WSAtIHRoaXMuX2xhc3RNb3VzZVkpICsgdGhpcy5fbGFzdFRpbHRBbmdsZTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIG9uTW91c2VEb3duSGFuZGxlcihldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0dGhpcy5fbGFzdFBhbkFuZ2xlID0gdGhpcy5faG92ZXJDb250cm9sLnBhbkFuZ2xlO1xuXHRcdHRoaXMuX2xhc3RUaWx0QW5nbGUgPSB0aGlzLl9ob3ZlckNvbnRyb2wudGlsdEFuZ2xlO1xuXHRcdHRoaXMuX2xhc3RNb3VzZVggPSBldmVudC5jbGllbnRYO1xuXHRcdHRoaXMuX2xhc3RNb3VzZVkgPSBldmVudC5jbGllbnRZO1xuXHRcdHRoaXMuX21vdmUgPSB0cnVlO1xuXHR9XG59Il19