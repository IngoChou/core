var BitmapData = require("awayjs-core/lib/core/base/BitmapData");
var Matrix = require("awayjs-core/lib/core/geom/Matrix");
var Rectangle = require("awayjs-core/lib/core/geom/Rectangle");
var URLLoader = require("awayjs-core/lib/core/net/URLLoader");
var URLLoaderDataFormat = require("awayjs-core/lib/core/net/URLLoaderDataFormat");
var URLRequest = require("awayjs-core/lib/core/net/URLRequest");
var AwayEvent = require("awayjs-core/lib/events/Event");
var IOErrorEvent = require("awayjs-core/lib/events/IOErrorEvent");
var ParserUtils = require("awayjs-core/lib/parsers/ParserUtils");
var ColorUtils = require("awayjs-core/lib/utils/ColorUtils");

var BitmapDataTest = (function () {
    function BitmapDataTest() {
        var _this = this;
        var transparent = true;
        var initcolour = 0xffffffff;

        //---------------------------------------
        // Load a PNG
        this.urlRequest = new URLRequest('assets/256x256.png');
        this.urlLoader = new URLLoader();
        this.urlLoader.dataFormat = URLLoaderDataFormat.BLOB;

        this.urlLoader.load(this.urlRequest);
        this.urlLoader.addEventListener(AwayEvent.COMPLETE, function (event) {
            return _this.imgLoaded(event);
        });
        this.urlLoader.addEventListener(IOErrorEvent.IO_ERROR, function (event) {
            return _this.imgLoadedError(event);
        });

        //---------------------------------------
        // BitmapData Object - 1
        this.bitmapData = new BitmapData(256, 256, transparent, initcolour);
        document.body.appendChild(this.bitmapData.canvas);

        //---------------------------------------
        // BitmapData Object - 2
        this.bitmapDataB = new BitmapData(256, 256, transparent, initcolour);
        this.bitmapDataB.canvas.style.position = 'absolute';
        this.bitmapDataB.canvas.style.left = '540px';
        document.body.appendChild(this.bitmapDataB.canvas);

        //---------------------------------------
        // BitmapData - setPixel test
        console['time']("bitmapdata"); // start setPixel operation benchmark ( TypeScript does not support console.time - so hacking it in ) .

        this.bitmapDataB.lock();

        for (var i = 0; i < 10000; i++) {
            var x = Math.random() * this.bitmapDataB.width | 0;
            var y = Math.random() * this.bitmapDataB.height | 0;
            this.bitmapDataB.setPixel(x, y, Math.random() * 0xffFFFFFF); // 255 opaque
        }

        this.bitmapDataB.unlock();
        console['timeEnd']("bitmapdata"); // benchmark the setPixel operation

        document.onmousedown = function (event) {
            return _this.onMouseDown(event);
        };
    }
    BitmapDataTest.prototype.onMouseDown = function (event) {
        if (this.bitmapData.width === 512) {
            if (this.image.complete) {
                this.bitmapDataB.lock(); // Lock bitmap - speeds up setPixelOperations

                //---------------------------------------
                // Resize BitmapData
                this.bitmapData.width = 256;
                this.bitmapData.height = 256;

                //---------------------------------------
                // copy loaded image to first BitmapData
                var rect = new Rectangle(0, 0, this.image.width, this.image.height);
                this.bitmapData.drawImage(this.image, rect, rect);

                //---------------------------------------
                // copy image into second bitmap data ( and scale it up 2X )
                rect.width = rect.width * 2;
                rect.height = rect.height * 2;

                this.bitmapDataB.copyPixels(this.bitmapData, this.bitmapData.rect, rect);

                for (var d = 0; d < 1000; d++) {
                    var x = Math.random() * this.bitmapDataB.width | 0;
                    var y = Math.random() * this.bitmapDataB.height | 0;
                    this.bitmapDataB.setPixel(x, y, Math.random() * 0xFFFFFFFF); // 255 opaque
                }

                this.bitmapDataB.unlock(); // Unlock bitmapdata
            } else {
                //---------------------------------------
                // image is not loaded - fill bitmapdata with red
                this.bitmapData.width = 256;
                this.bitmapData.height = 256;
                this.bitmapData.fillRect(this.bitmapData.rect, 0xffff0000);
            }
        } else {
            //---------------------------------------
            // resize bitmapdata;
            this.bitmapData.lock();

            this.bitmapData.width = 512;
            this.bitmapData.height = 512;
            this.bitmapData.fillRect(this.bitmapData.rect, 0xffff0000); // fill it RED

            for (var d = 0; d < 1000; d++) {
                var x = Math.random() * this.bitmapData.width | 0;
                var y = Math.random() * this.bitmapData.height | 0;
                this.bitmapData.setPixel(x, y, Math.random() * 0xFFFFFFFF);
            }

            this.bitmapData.unlock();

            //---------------------------------------
            // copy bitmapdata
            var targetRect = this.bitmapDataB.rect.clone();
            targetRect.width = targetRect.width / 2;
            targetRect.height = targetRect.height / 2;

            this.bitmapDataB.copyPixels(this.bitmapData, this.bitmapDataB.rect, targetRect); // copy first bitmapdata object into the second one
        }

        var m = new Matrix(.5, .08, .08, .5, this.image.width / 2, this.image.height / 2);
        this.bitmapData.draw(this.bitmapData, m);

        this.bitmapData.setPixel32(0, 0, 0xccff0000);
        this.bitmapData.setPixel32(1, 0, 0xcc00ff00);
        this.bitmapData.setPixel32(2, 0, 0xcc0000ff);

        this.bitmapDataB.draw(this.bitmapData, m);

        console.log('GetPixel 0,0: ', ColorUtils.ARGBToHexString(ColorUtils.float32ColorToARGB(this.bitmapData.getPixel(0, 0))));
        console.log('GetPixel 1,0: ', ColorUtils.ARGBToHexString(ColorUtils.float32ColorToARGB(this.bitmapData.getPixel(1, 0))));
        console.log('GetPixel 2,0: ', ColorUtils.ARGBToHexString(ColorUtils.float32ColorToARGB(this.bitmapData.getPixel(2, 0))));
    };

    BitmapDataTest.prototype.imgLoadedError = function (event) {
        console.log('error');
    };

    BitmapDataTest.prototype.imgLoaded = function (event) {
        var _this = this;
        var loader = event.target;
        this.image = ParserUtils.blobToImage(loader.data);
        this.image.onload = function (event) {
            return _this.onImageLoad(event);
        };
    };

    BitmapDataTest.prototype.onImageLoad = function (event) {
        this.bitmapData.drawImage(this.image, new Rectangle(0, 0, this.image.width, this.image.height), new Rectangle(0, 0, this.image.width / 2, this.image.height / 2));

        this.bitmapData.draw(this.bitmapData, new Matrix(.5, .08, .08, .5, this.image.width / 2, this.image.height / 2));
    };
    return BitmapDataTest;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UvQml0bWFwRGF0YVRlc3QudHMiXSwibmFtZXMiOlsiQml0bWFwRGF0YVRlc3QiLCJCaXRtYXBEYXRhVGVzdC5jb25zdHJ1Y3RvciIsIkJpdG1hcERhdGFUZXN0Lm9uTW91c2VEb3duIiwiQml0bWFwRGF0YVRlc3QuaW1nTG9hZGVkRXJyb3IiLCJCaXRtYXBEYXRhVGVzdC5pbWdMb2FkZWQiLCJCaXRtYXBEYXRhVGVzdC5vbkltYWdlTG9hZCJdLCJtYXBwaW5ncyI6IkFBQUEsZ0VBQXVFO0FBQ3ZFLHdEQUFnRTtBQUNoRSw4REFBcUU7QUFDckUsNkRBQW9FO0FBQ3BFLGlGQUFzRjtBQUN0RiwrREFBc0U7QUFDdEUsdURBQThEO0FBQzlELGlFQUF3RTtBQUN4RSxnRUFBdUU7QUFDdkUsNERBQW1FOztBQUVuRTtJQVFDQTtRQUFBQyxpQkE0Q0NBO1FBMUNBQSxJQUFJQSxXQUFXQSxHQUFXQSxJQUFJQTtRQUM5QkEsSUFBSUEsVUFBVUEsR0FBVUEsVUFBVUE7O1FBRWxDQSx5Q0FBeUNBO1FBQ3pDQSxhQUFhQTtRQUViQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQSxVQUFVQSxDQUFDQSxvQkFBb0JBLENBQUNBO1FBQ3REQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsVUFBVUEsR0FBR0EsbUJBQW1CQSxDQUFDQSxJQUFJQTs7UUFFcERBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBO1FBQ3BDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFNBQVNBLENBQUNBLFFBQVFBLEVBQUVBLFVBQUNBLEtBQWVBO21CQUFLQSxLQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUFyQkEsQ0FBcUJBLENBQUNBO1FBQy9GQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLEVBQUVBLFVBQUNBLEtBQWtCQTttQkFBS0EsS0FBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFBMUJBLENBQTBCQSxDQUFDQTs7UUFFMUdBLHlDQUF5Q0E7UUFDekNBLHdCQUF3QkE7UUFDeEJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLFVBQVVBLENBQUNBLEdBQUdBLEVBQUdBLEdBQUdBLEVBQUVBLFdBQVdBLEVBQUVBLFVBQVVBLENBQUNBO1FBQ3BFQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxDQUFDQTs7UUFFakRBLHlDQUF5Q0E7UUFDekNBLHdCQUF3QkE7UUFDeEJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLFVBQVVBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLFdBQVdBLEVBQUVBLFVBQVVBLENBQUNBO1FBQ3BFQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxHQUFHQSxVQUFVQTtRQUNuREEsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBR0EsT0FBT0E7UUFDNUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBOztRQUVsREEseUNBQXlDQTtRQUN6Q0EsNkJBQTZCQTtRQUM3QkEsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsRUFBRUEsdUdBQXVHQTs7UUFFdElBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBOztRQUV2QkEsS0FBS0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFB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N0dBLENBQUNBO0lBQ0ZMLHNCQUFDQTtBQUFEQSxDQUFDQSxJQUFBO0FBQUEiLCJmaWxlIjoiYmFzZS9CaXRtYXBEYXRhVGVzdC5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvcm9iYmF0ZW1hbi9XZWJzdG9ybVByb2plY3RzL2F3YXlqcy1jb3JlLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCaXRtYXBEYXRhXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9iYXNlL0JpdG1hcERhdGFcIik7XG5pbXBvcnQgTWF0cml4XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vTWF0cml4XCIpO1xuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9SZWN0YW5nbGVcIik7XG5pbXBvcnQgVVJMTG9hZGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9uZXQvVVJMTG9hZGVyXCIpO1xuaW1wb3J0IFVSTExvYWRlckRhdGFGb3JtYXRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvbmV0L1VSTExvYWRlckRhdGFGb3JtYXRcIik7XG5pbXBvcnQgVVJMUmVxdWVzdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvbmV0L1VSTFJlcXVlc3RcIik7XG5pbXBvcnQgQXdheUV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuaW1wb3J0IElPRXJyb3JFdmVudFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9JT0Vycm9yRXZlbnRcIik7XG5pbXBvcnQgUGFyc2VyVXRpbHNcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL1BhcnNlclV0aWxzXCIpO1xuaW1wb3J0IENvbG9yVXRpbHNcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9Db2xvclV0aWxzXCIpO1xuXG5jbGFzcyBCaXRtYXBEYXRhVGVzdFxue1xuXHRwcml2YXRlIGJpdG1hcERhdGE6Qml0bWFwRGF0YTtcblx0cHJpdmF0ZSBiaXRtYXBEYXRhQjpCaXRtYXBEYXRhO1xuXHRwcml2YXRlIHVybExvYWRlcjpVUkxMb2FkZXI7XG5cdHByaXZhdGUgdXJsUmVxdWVzdDpVUkxSZXF1ZXN0O1xuXHRwcml2YXRlIGltYWdlOkhUTUxJbWFnZUVsZW1lbnQ7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0dmFyIHRyYW5zcGFyZW50OmJvb2xlYW4gPSB0cnVlO1xuXHRcdHZhciBpbml0Y29sb3VyOm51bWJlciA9IDB4ZmZmZmZmZmY7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIExvYWQgYSBQTkdcblxuXHRcdHRoaXMudXJsUmVxdWVzdCA9IG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvMjU2eDI1Ni5wbmcnKTtcblx0XHR0aGlzLnVybExvYWRlciA9IG5ldyBVUkxMb2FkZXIoKTtcblx0XHR0aGlzLnVybExvYWRlci5kYXRhRm9ybWF0ID0gVVJMTG9hZGVyRGF0YUZvcm1hdC5CTE9CO1xuXG5cdFx0dGhpcy51cmxMb2FkZXIubG9hZCh0aGlzLnVybFJlcXVlc3QpO1xuXHRcdHRoaXMudXJsTG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoQXdheUV2ZW50LkNPTVBMRVRFLCAoZXZlbnQ6QXdheUV2ZW50KSA9PiB0aGlzLmltZ0xvYWRlZChldmVudCkpO1xuXHRcdHRoaXMudXJsTG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoSU9FcnJvckV2ZW50LklPX0VSUk9SLCAoZXZlbnQ6SU9FcnJvckV2ZW50KSA9PiB0aGlzLmltZ0xvYWRlZEVycm9yKGV2ZW50KSk7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIEJpdG1hcERhdGEgT2JqZWN0IC0gMVxuXHRcdHRoaXMuYml0bWFwRGF0YSA9IG5ldyBCaXRtYXBEYXRhKDI1NiwgIDI1NiwgdHJhbnNwYXJlbnQsIGluaXRjb2xvdXIpO1xuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5iaXRtYXBEYXRhLmNhbnZhcyk7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIEJpdG1hcERhdGEgT2JqZWN0IC0gMlxuXHRcdHRoaXMuYml0bWFwRGF0YUIgPSBuZXcgQml0bWFwRGF0YSgyNTYsIDI1NiwgdHJhbnNwYXJlbnQsIGluaXRjb2xvdXIpO1xuXHRcdHRoaXMuYml0bWFwRGF0YUIuY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcblx0XHR0aGlzLmJpdG1hcERhdGFCLmNhbnZhcy5zdHlsZS5sZWZ0ID0gJzU0MHB4Jztcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYml0bWFwRGF0YUIuY2FudmFzKTtcblxuXHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0Ly8gQml0bWFwRGF0YSAtIHNldFBpeGVsIHRlc3Rcblx0XHRjb25zb2xlWyd0aW1lJ10oXCJiaXRtYXBkYXRhXCIpOyAvLyBzdGFydCBzZXRQaXhlbCBvcGVyYXRpb24gYmVuY2htYXJrICggVHlwZVNjcmlwdCBkb2VzIG5vdCBzdXBwb3J0IGNvbnNvbGUudGltZSAtIHNvIGhhY2tpbmcgaXQgaW4gKSAuXG5cblx0XHR0aGlzLmJpdG1hcERhdGFCLmxvY2soKTtcblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgMTAwMDA7IGkrKykge1xuXHRcdFx0dmFyIHggPSBNYXRoLnJhbmRvbSgpICogdGhpcy5iaXRtYXBEYXRhQi53aWR0aCB8IDA7IC8vIHwwIHRvIHRydW5jYXRlIHRvIEludDMyXG5cdFx0XHR2YXIgeSA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLmJpdG1hcERhdGFCLmhlaWdodCB8IDA7XG5cdFx0XHR0aGlzLmJpdG1hcERhdGFCLnNldFBpeGVsKHgsIHksIE1hdGgucmFuZG9tKCkgKiAweGZmRkZGRkZGICk7IC8vIDI1NSBvcGFxdWVcblx0XHR9XG5cblx0XHR0aGlzLmJpdG1hcERhdGFCLnVubG9jaygpO1xuXHRcdGNvbnNvbGVbJ3RpbWVFbmQnXShcImJpdG1hcGRhdGFcIik7IC8vIGJlbmNobWFyayB0aGUgc2V0UGl4ZWwgb3BlcmF0aW9uXG5cblx0XHRkb2N1bWVudC5vbm1vdXNlZG93biA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VEb3duKGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZURvd24oZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdGlmICggdGhpcy5iaXRtYXBEYXRhLndpZHRoID09PSA1MTIgKSB7Ly8gVGVzdCB0byB0b2dnbGUgcmVzaXplIG9mIGJpdG1hcERhdGFcblx0XHRcdGlmICggdGhpcy5pbWFnZS5jb21wbGV0ZSApIHsvLyBJZiBpbWFnZSBpcyBsb2FkZWQgY29weSB0aGF0IHRvIHRoZSBCaXRtYXBEYXRhIG9iamVjdFxuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGFCLmxvY2soKTsgLy8gTG9jayBiaXRtYXAgLSBzcGVlZHMgdXAgc2V0UGl4ZWxPcGVyYXRpb25zXG5cdFx0XHRcdFxuXHRcdFx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0XHQvLyBSZXNpemUgQml0bWFwRGF0YVxuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGEud2lkdGggID0gMjU2O1xuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGEuaGVpZ2h0ID0gMjU2O1xuXG5cdFx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHRcdC8vIGNvcHkgbG9hZGVkIGltYWdlIHRvIGZpcnN0IEJpdG1hcERhdGFcblxuXHRcdFx0XHR2YXIgcmVjdDpSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIHRoaXMuaW1hZ2Uud2lkdGgsIHRoaXMuaW1hZ2UuaGVpZ2h0KTtcblx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhLmRyYXdJbWFnZSh0aGlzLmltYWdlLCByZWN0LCAgcmVjdCk7XG5cblx0XHRcdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdFx0Ly8gY29weSBpbWFnZSBpbnRvIHNlY29uZCBiaXRtYXAgZGF0YSAoIGFuZCBzY2FsZSBpdCB1cCAyWCApXG5cdFx0XHRcdHJlY3Qud2lkdGggPSByZWN0LndpZHRoICogMjtcblx0XHRcdFx0cmVjdC5oZWlnaHQgPSByZWN0LmhlaWdodCAqIDI7XG5cblx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhQi5jb3B5UGl4ZWxzKHRoaXMuYml0bWFwRGF0YSwgdGhpcy5iaXRtYXBEYXRhLnJlY3QsIHJlY3QpO1xuXG5cdFx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHRcdC8vIGRyYXcgcmFuZG9tIHBpeGVsc1xuXG5cdFx0XHRcdGZvciAodmFyIGQgPSAwOyBkIDwgMTAwMDsgZCsrKSB7XG5cdFx0XHRcdFx0dmFyIHggPSBNYXRoLnJhbmRvbSgpKnRoaXMuYml0bWFwRGF0YUIud2lkdGggfCAwOyAvLyB8MCB0byB0cnVuY2F0ZSB0byBJbnQzMlxuXHRcdFx0XHRcdHZhciB5ID0gTWF0aC5yYW5kb20oKSp0aGlzLmJpdG1hcERhdGFCLmhlaWdodCB8IDA7XG5cdFx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhQi5zZXRQaXhlbCh4LCB5LCBNYXRoLnJhbmRvbSgpKjB4RkZGRkZGRkYpOyAvLyAyNTUgb3BhcXVlXG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGFCLnVubG9jaygpOyAvLyBVbmxvY2sgYml0bWFwZGF0YVxuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0XHQvLyBpbWFnZSBpcyBub3QgbG9hZGVkIC0gZmlsbCBiaXRtYXBkYXRhIHdpdGggcmVkXG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS53aWR0aCAgPSAyNTY7XG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS5oZWlnaHQgPSAyNTY7XG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS5maWxsUmVjdCh0aGlzLmJpdG1hcERhdGEucmVjdCwgMHhmZmZmMDAwMCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHQvLyByZXNpemUgYml0bWFwZGF0YTtcblxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhLmxvY2soKTtcblxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhLndpZHRoICA9IDUxMjtcblx0XHRcdHRoaXMuYml0bWFwRGF0YS5oZWlnaHQgPSA1MTI7XG5cdFx0XHR0aGlzLmJpdG1hcERhdGEuZmlsbFJlY3QodGhpcy5iaXRtYXBEYXRhLnJlY3QsIDB4ZmZmZjAwMDApOyAvLyBmaWxsIGl0IFJFRFxuXG5cdFx0XHRmb3IgKHZhciBkID0gMDsgZCA8IDEwMDA7IGQrKykge1xuXHRcdFx0XHR2YXIgeCA9IE1hdGgucmFuZG9tKCkqdGhpcy5iaXRtYXBEYXRhLndpZHRoIHwgMDsgLy8gfDAgdG8gdHJ1bmNhdGUgdG8gSW50MzJcblx0XHRcdFx0dmFyIHkgPSBNYXRoLnJhbmRvbSgpKnRoaXMuYml0bWFwRGF0YS5oZWlnaHQgfCAwO1xuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGEuc2V0UGl4ZWwoeCwgeSwgTWF0aC5yYW5kb20oKSoweEZGRkZGRkZGKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhLnVubG9jaygpO1xuXHRcdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdC8vIGNvcHkgYml0bWFwZGF0YVxuXG5cdFx0XHR2YXIgdGFyZ2V0UmVjdCA9IHRoaXMuYml0bWFwRGF0YUIucmVjdC5jbG9uZSgpO1xuXHRcdFx0XHR0YXJnZXRSZWN0LndpZHRoID0gdGFyZ2V0UmVjdC53aWR0aC8yO1xuXHRcdFx0XHR0YXJnZXRSZWN0LmhlaWdodCA9IHRhcmdldFJlY3QuaGVpZ2h0LzI7XG5cblx0XHRcdHRoaXMuYml0bWFwRGF0YUIuY29weVBpeGVscyh0aGlzLmJpdG1hcERhdGEsIHRoaXMuYml0bWFwRGF0YUIucmVjdCwgdGFyZ2V0UmVjdCk7IC8vIGNvcHkgZmlyc3QgYml0bWFwZGF0YSBvYmplY3QgaW50byB0aGUgc2Vjb25kIG9uZVxuXHRcdH1cblxuXHRcdHZhciBtIDogTWF0cml4ID0gbmV3IE1hdHJpeCguNSwgLjA4LCAuMDgsIC41LCB0aGlzLmltYWdlLndpZHRoLzIsIHRoaXMuaW1hZ2UuaGVpZ2h0LzIpO1xuXHRcdHRoaXMuYml0bWFwRGF0YS5kcmF3KHRoaXMuYml0bWFwRGF0YSwgbSk7XG5cblx0XHR0aGlzLmJpdG1hcERhdGEuc2V0UGl4ZWwzMigwLCAwLCAweGNjZmYwMDAwKSA7XG5cdFx0dGhpcy5iaXRtYXBEYXRhLnNldFBpeGVsMzIoMSwgMCwgMHhjYzAwZmYwMCkgO1xuXHRcdHRoaXMuYml0bWFwRGF0YS5zZXRQaXhlbDMyKDIsIDAsIDB4Y2MwMDAwZmYpIDtcblxuXHRcdHRoaXMuYml0bWFwRGF0YUIuZHJhdyh0aGlzLmJpdG1hcERhdGEsIG0pO1xuXG5cdFx0Y29uc29sZS5sb2coJ0dldFBpeGVsIDAsMDogJywgQ29sb3JVdGlscy5BUkdCVG9IZXhTdHJpbmcoQ29sb3JVdGlscy5mbG9hdDMyQ29sb3JUb0FSR0IodGhpcy5iaXRtYXBEYXRhLmdldFBpeGVsKDAsIDApKSkpO1xuXHRcdGNvbnNvbGUubG9nKCdHZXRQaXhlbCAxLDA6ICcsIENvbG9yVXRpbHMuQVJHQlRvSGV4U3RyaW5nKENvbG9yVXRpbHMuZmxvYXQzMkNvbG9yVG9BUkdCKHRoaXMuYml0bWFwRGF0YS5nZXRQaXhlbCgxLCAwKSkpKTtcblx0XHRjb25zb2xlLmxvZygnR2V0UGl4ZWwgMiwwOiAnLCBDb2xvclV0aWxzLkFSR0JUb0hleFN0cmluZyhDb2xvclV0aWxzLmZsb2F0MzJDb2xvclRvQVJHQih0aGlzLmJpdG1hcERhdGEuZ2V0UGl4ZWwoMiwgMCkpKSk7XG5cblxuXG5cdH1cblxuXHRwcml2YXRlIGltZ0xvYWRlZEVycm9yKGV2ZW50OklPRXJyb3JFdmVudClcblx0e1xuXHRcdGNvbnNvbGUubG9nKCdlcnJvcicpO1xuXHR9XG5cblx0cHJpdmF0ZSBpbWdMb2FkZWQoZXZlbnQ6QXdheUV2ZW50KVxuXHR7XG5cdFx0dmFyIGxvYWRlciA6VVJMTG9hZGVyID0gPFVSTExvYWRlcj4gZXZlbnQudGFyZ2V0O1xuXHRcdHRoaXMuaW1hZ2UgPSBQYXJzZXJVdGlscy5ibG9iVG9JbWFnZShsb2FkZXIuZGF0YSk7XG5cdFx0dGhpcy5pbWFnZS5vbmxvYWQgPSAoZXZlbnQ6RXZlbnQpID0+IHRoaXMub25JbWFnZUxvYWQoZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBvbkltYWdlTG9hZChldmVudDpFdmVudClcblx0e1xuXHRcdHRoaXMuYml0bWFwRGF0YS5kcmF3SW1hZ2UodGhpcy5pbWFnZSwgbmV3IFJlY3RhbmdsZSgwLCAwLCB0aGlzLmltYWdlLndpZHRoLCB0aGlzLmltYWdlLmhlaWdodCksIG5ldyBSZWN0YW5nbGUoMCwgMCwgdGhpcy5pbWFnZS53aWR0aC8yLCB0aGlzLmltYWdlLmhlaWdodC8yKSk7XG5cblx0XHR0aGlzLmJpdG1hcERhdGEuZHJhdyh0aGlzLmJpdG1hcERhdGEsIG5ldyBNYXRyaXgoLjUsIC4wOCwgLjA4LCAuNSwgdGhpcy5pbWFnZS53aWR0aC8yLCB0aGlzLmltYWdlLmhlaWdodC8yKSk7XG5cdH1cbn0iXX0=