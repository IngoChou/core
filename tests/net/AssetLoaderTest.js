var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var AssetEvent = require("awayjs-core/lib/events/AssetEvent");

var ParserEvent = require("awayjs-core/lib/events/ParserEvent");
var AssetLoader = require("awayjs-core/lib/core/library/AssetLoader");

var URLRequest = require("awayjs-core/lib/core/net/URLRequest");

var ParserBase = require("awayjs-core/lib/parsers/ParserBase");
var ParserDataFormat = require("awayjs-core/lib/parsers/ParserDataFormat");

var AssetLoaderTest = (function () {
    function AssetLoaderTest() {
        var _this = this;
        //---------------------------------------------------------------------------------------------------------------------
        // Enable Custom Parser ( JSON file format with multiple texture dependencies )
        AssetLoader.enableParser(JSONTextureParser);

        var token;
        var urlRq;

        //---------------------------------------------------------------------------------------------------------------------
        // LOAD A SINGLE IMAGE
        this.alImage = new AssetLoader();
        urlRq = new URLRequest('assets/1024x1024.png');
        token = this.alImage.load(urlRq);

        token.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) {
            return _this.onAssetComplete(event);
        });
        token.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) {
            return _this.onTextureSizeError(event);
        });

        //---------------------------------------------------------------------------------------------------------------------
        // LOAD A SINGLE IMAGE - With wrong dimensions
        this.alErrorImage = new AssetLoader();
        urlRq = new URLRequest('assets/2.png');
        token = this.alErrorImage.load(urlRq);

        token.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) {
            return _this.onAssetComplete(event);
        });
        token.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) {
            return _this.onTextureSizeError(event);
        });

        //---------------------------------------------------------------------------------------------------------------------
        // LOAD WITH A JSON PARSER
        this.alJson = new AssetLoader();
        urlRq = new URLRequest('assets/JSNParserTest.json');
        token = this.alJson.load(urlRq);

        token.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) {
            return _this.onAssetComplete(event);
        });
        token.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) {
            return _this.onTextureSizeError(event);
        });
        token.addEventListener(ParserEvent.PARSE_COMPLETE, function (event) {
            return _this.onParseComplete(event);
        });
    }
    AssetLoaderTest.prototype.onParseComplete = function (event) {
        console.log('--------------------------------------------------------------------------------');
        console.log('AssetLoaderTest.onParseComplete', event);
        console.log('--------------------------------------------------------------------------------');
    };

    AssetLoaderTest.prototype.onTextureSizeError = function (event) {
        var assetLoader = event.target;

        console.log('--------------------------------------------------------------------------------');
        console.log('AssetLoaderTest.onTextureSizeError', assetLoader.baseDependency._iLoader.url, event);
        console.log('--------------------------------------------------------------------------------');
    };

    AssetLoaderTest.prototype.onAssetComplete = function (event) {
        var assetLoader = event.target;

        console.log('--------------------------------------------------------------------------------');
        console.log('AssetLoaderTest.onAssetComplete', assetLoader.baseDependency._iLoader.url, event);
        console.log('--------------------------------------------------------------------------------');
    };
    return AssetLoaderTest;
})();

/**
* ImageParser provides a "parser" for natively supported image types (jpg, png). While it simply loads bytes into
* a loader object, it wraps it in a BitmapDataResource so resource management can happen consistently without
* exception cases.
*/
var JSONTextureParser = (function (_super) {
    __extends(JSONTextureParser, _super);
    /**
    * Creates a new ImageParser object.
    * @param uri The url or id of the data or file to be parsed.
    * @param extra The holder for extra contextual data that the parser might need.
    */
    function JSONTextureParser() {
        _super.call(this, ParserDataFormat.PLAIN_TEXT);
        this.STATE_PARSE_DATA = 0;
        this.STATE_LOAD_IMAGES = 1;
        this.STATE_COMPLETE = 2;
        this._state = -1;
        this._dependencyCount = 0;

        this._loadedTextures = new Array();
        this._state = this.STATE_PARSE_DATA;
    }
    /**
    * Indicates whether or not a given file extension is supported by the parser.
    * @param extension The file extension of a potential file to be parsed.
    * @return Whether or not the given file type is supported.
    */
    JSONTextureParser.supportsType = function (extension) {
        extension = extension.toLowerCase();
        return extension == "json";
    };

    /**
    * Tests whether a data block can be parsed by the parser.
    * @param data The data block to potentially be parsed.
    * @return Whether or not the given data is supported.
    */
    JSONTextureParser.supportsData = function (data) {
        try  {
            var obj = JSON.parse(data);

            if (obj)
                return true;

            return false;
        } catch (e) {
            return false;
        }

        return false;
    };

    /**
    * @inheritDoc
    */
    JSONTextureParser.prototype._iResolveDependency = function (resourceDependency) {
        var resource = resourceDependency.assets[0];

        this._pFinalizeAsset(resource, resourceDependency._iLoader.url);

        this._loadedTextures.push(resource);

        //console.log( 'JSONTextureParser._iResolveDependency' , resourceDependency );
        //console.log( 'JSONTextureParser._iResolveDependency resource: ' , resource );
        this._dependencyCount--;

        if (this._dependencyCount == 0)
            this._state = this.STATE_COMPLETE;
    };

    /**
    * @inheritDoc
    */
    JSONTextureParser.prototype._iResolveDependencyFailure = function (resourceDependency) {
        this._dependencyCount--;

        if (this._dependencyCount == 0)
            this._state = this.STATE_COMPLETE;
    };

    JSONTextureParser.prototype.parseJson = function () {
        if (JSONTextureParser.supportsData(this.data)) {
            try  {
                var json = JSON.parse(this.data);
                var data = json.data;

                var rec;
                var rq;

                for (var c = 0; c < data.length; c++) {
                    rec = data[c];

                    var uri = rec.image;
                    var id = rec.id;

                    rq = new URLRequest(uri);

                    this._pAddDependency('JSON_ID_' + id, rq, false, null, true);
                }

                this._dependencyCount = data.length;
                this._state = this.STATE_LOAD_IMAGES;

                this._pPauseAndRetrieveDependencies();
            } catch (e) {
                this._state = this.STATE_COMPLETE;
            }
        }
    };

    /**
    * @inheritDoc
    */
    JSONTextureParser.prototype._pProceedParsing = function () {
        console.log('JSONTextureParser._pProceedParsing', this._state);

        switch (this._state) {
            case this.STATE_PARSE_DATA:
                this.parseJson();
                return ParserBase.MORE_TO_PARSE;
                break;
            case this.STATE_LOAD_IMAGES:
                break;
            case this.STATE_COMPLETE:
                return ParserBase.PARSING_DONE;
                break;
        }

        return ParserBase.MORE_TO_PARSE;
    };
    return JSONTextureParser;
})(ParserBase);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5ldC9Bc3NldExvYWRlclRlc3QudHMiXSwibmFtZXMiOlsiQXNzZXRMb2FkZXJUZXN0IiwiQXNzZXRMb2FkZXJUZXN0LmNvbnN0cnVjdG9yIiwiQXNzZXRMb2FkZXJUZXN0Lm9uUGFyc2VDb21wbGV0ZSIsIkFzc2V0TG9hZGVyVGVzdC5vblRleHR1cmVTaXplRXJyb3IiLCJBc3NldExvYWRlclRlc3Qub25Bc3NldENvbXBsZXRlIiwiSlNPTlRleHR1cmVQYXJzZXIiLCJKU09OVGV4dHVyZVBhcnNlci5jb25zdHJ1Y3RvciIsIkpTT05UZXh0dXJlUGFyc2VyLnN1cHBvcnRzVHlwZSIsIkpTT05UZXh0dXJlUGFyc2VyLnN1cHBvcnRzRGF0YSIsIkpTT05UZXh0dXJlUGFyc2VyLl9pUmVzb2x2ZURlcGVuZGVuY3kiLCJKU09OVGV4dHVyZVBhcnNlci5faVJlc29sdmVEZXBlbmRlbmN5RmFpbHVyZSIsIkpTT05UZXh0dXJlUGFyc2VyLnBhcnNlSnNvbiIsIkpTT05UZXh0dXJlUGFyc2VyLl9wUHJvY2VlZFBhcnNpbmciXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZEQUFtRTs7QUFFbkUsK0RBQXFFO0FBQ3JFLHFFQUEyRTs7QUFHM0UsK0RBQXFFOztBQUVyRSw4REFBb0U7QUFDcEUsMEVBQStFOztBQUcvRTtJQU1DQTtRQUFBQyxpQkF3Q0NBO1FBdENBQSx1SEFBdUhBO1FBQ3ZIQSwrRUFBK0VBO1FBQy9FQSxXQUFXQSxDQUFDQSxZQUFZQSxDQUFDQSxpQkFBaUJBLENBQUNBOztRQUUzQ0EsSUFBSUEsS0FBS0E7UUFDVEEsSUFBSUEsS0FBS0E7O1FBRVRBLHVIQUF1SEE7UUFDdkhBLHNCQUFzQkE7UUFFdEJBLElBQUlBLENBQUNBLE9BQU9BLEdBQUlBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBO1FBQ2pDQSxLQUFLQSxHQUFHQSxJQUFJQSxVQUFVQSxDQUFDQSxzQkFBc0JBLENBQUNBO1FBQzlDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFD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LE9BQU9BLENBQUNBLEdBQUdBLENBQUVBLG9DQUFvQ0EsRUFBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBRUE7O1FBRWpFQSxRQUFRQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUNuQkEsS0FBS0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQTtnQkFDekJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO2dCQUNoQkEsT0FBT0EsVUFBVUEsQ0FBQ0EsYUFBYUE7Z0JBQy9CQSxLQUFNQTtBQUFBQSxZQUNQQSxLQUFLQSxJQUFJQSxDQUFDQSxpQkFBaUJBO2dCQUMxQkEsS0FBTUE7QUFBQUEsWUFDUEEsS0FBS0EsSUFBSUEsQ0FBQ0EsY0FBY0E7Z0JBQ3ZCQSxPQUFPQSxVQUFVQSxDQUFDQSxZQUFZQTtnQkFDOUJBLEtBQU1BO0FBQUFBLFNBQ1BBOztRQUVEQSxPQUFPQSxVQUFVQSxDQUFDQSxhQUFhQTtJQUNoQ0EsQ0FBQ0E7SUFDRlAseUJBQUNBO0FBQURBLENBQUNBLEVBN0krQixVQUFVLEVBNkl6QztBQUFBIiwiZmlsZSI6Im5ldC9Bc3NldExvYWRlclRlc3QuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtY29yZS8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQXNzZXRFdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvQXNzZXRFdmVudFwiKTtcbmltcG9ydCBMb2FkZXJFdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvTG9hZGVyRXZlbnRcIik7XG5pbXBvcnQgUGFyc2VyRXZlbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1BhcnNlckV2ZW50XCIpO1xuaW1wb3J0IEFzc2V0TG9hZGVyXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvbGlicmFyeS9Bc3NldExvYWRlclwiKTtcbmltcG9ydCBBc3NldExvYWRlclRva2VuXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2xpYnJhcnkvQXNzZXRMb2FkZXJUb2tlblwiKTtcbmltcG9ydCBJQXNzZXRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2xpYnJhcnkvSUFzc2V0XCIpO1xuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9uZXQvVVJMUmVxdWVzdFwiKTtcbmltcG9ydCBUZXh0dXJlMkRCYXNlXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlMkRCYXNlXCIpO1xuaW1wb3J0IFBhcnNlckJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcGFyc2Vycy9QYXJzZXJCYXNlXCIpO1xuaW1wb3J0IFBhcnNlckRhdGFGb3JtYXRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyRGF0YUZvcm1hdFwiKTtcbmltcG9ydCBSZXNvdXJjZURlcGVuZGVuY3lcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL1Jlc291cmNlRGVwZW5kZW5jeVwiKTtcblxuY2xhc3MgQXNzZXRMb2FkZXJUZXN0XG57XG5cdHByaXZhdGUgYWxKc29uOkFzc2V0TG9hZGVyO1xuXHRwcml2YXRlIGFsSW1hZ2U6QXNzZXRMb2FkZXI7XG5cdHByaXZhdGUgYWxFcnJvckltYWdlOkFzc2V0TG9hZGVyO1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0Ly8gRW5hYmxlIEN1c3RvbSBQYXJzZXIgKCBKU09OIGZpbGUgZm9ybWF0IHdpdGggbXVsdGlwbGUgdGV4dHVyZSBkZXBlbmRlbmNpZXMgKVxuXHRcdEFzc2V0TG9hZGVyLmVuYWJsZVBhcnNlcihKU09OVGV4dHVyZVBhcnNlcik7XG5cblx0XHR2YXIgdG9rZW46QXNzZXRMb2FkZXJUb2tlbjtcblx0XHR2YXIgdXJsUnE6VVJMUmVxdWVzdDtcblxuXHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0Ly8gTE9BRCBBIFNJTkdMRSBJTUFHRVxuXG5cdFx0dGhpcy5hbEltYWdlICA9IG5ldyBBc3NldExvYWRlcigpO1xuXHRcdHVybFJxID0gbmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy8xMDI0eDEwMjQucG5nJyk7XG5cdFx0dG9rZW4gPSB0aGlzLmFsSW1hZ2UubG9hZCh1cmxScSk7XG5cblx0XHR0b2tlbi5hZGRFdmVudExpc3RlbmVyKEFzc2V0RXZlbnQuQVNTRVRfQ09NUExFVEUsIChldmVudDpBc3NldEV2ZW50KSA9PiB0aGlzLm9uQXNzZXRDb21wbGV0ZShldmVudCkpO1xuXHRcdHRva2VuLmFkZEV2ZW50TGlzdGVuZXIoQXNzZXRFdmVudC5URVhUVVJFX1NJWkVfRVJST1IsIChldmVudDpBc3NldEV2ZW50KSA9PiB0aGlzLm9uVGV4dHVyZVNpemVFcnJvcihldmVudCkpO1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBMT0FEIEEgU0lOR0xFIElNQUdFIC0gV2l0aCB3cm9uZyBkaW1lbnNpb25zXG5cblx0XHR0aGlzLmFsRXJyb3JJbWFnZSA9IG5ldyBBc3NldExvYWRlcigpO1xuXHRcdHVybFJxID0gbmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy8yLnBuZycpO1xuXHRcdHRva2VuID0gdGhpcy5hbEVycm9ySW1hZ2UubG9hZCh1cmxScSk7XG5cblx0XHR0b2tlbi5hZGRFdmVudExpc3RlbmVyKEFzc2V0RXZlbnQuQVNTRVRfQ09NUExFVEUsIChldmVudDpBc3NldEV2ZW50KSA9PiB0aGlzLm9uQXNzZXRDb21wbGV0ZShldmVudCkpO1xuXHRcdHRva2VuLmFkZEV2ZW50TGlzdGVuZXIoQXNzZXRFdmVudC5URVhUVVJFX1NJWkVfRVJST1IsIChldmVudDpBc3NldEV2ZW50KSA9PiB0aGlzLm9uVGV4dHVyZVNpemVFcnJvcihldmVudCkpO1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBMT0FEIFdJVEggQSBKU09OIFBBUlNFUlxuXG5cdFx0dGhpcy5hbEpzb24gICAgPSBuZXcgQXNzZXRMb2FkZXIoKTtcblx0XHR1cmxScSAgICAgICAgICA9IG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvSlNOUGFyc2VyVGVzdC5qc29uJyk7XG5cdFx0dG9rZW4gICAgICAgICAgPSB0aGlzLmFsSnNvbi5sb2FkKCB1cmxScSApO1xuXG5cdFx0dG9rZW4uYWRkRXZlbnRMaXN0ZW5lciggQXNzZXRFdmVudC5BU1NFVF9DT01QTEVURSwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25Bc3NldENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0dG9rZW4uYWRkRXZlbnRMaXN0ZW5lciggQXNzZXRFdmVudC5URVhUVVJFX1NJWkVfRVJST1IsIChldmVudDpBc3NldEV2ZW50KSA9PiB0aGlzLm9uVGV4dHVyZVNpemVFcnJvcihldmVudCkpO1xuXHRcdHRva2VuLmFkZEV2ZW50TGlzdGVuZXIoIFBhcnNlckV2ZW50LlBBUlNFX0NPTVBMRVRFLCAoZXZlbnQ6UGFyc2VyRXZlbnQpID0+IHRoaXMub25QYXJzZUNvbXBsZXRlKGV2ZW50KSk7XG5cblx0fVxuXG5cdHB1YmxpYyBvblBhcnNlQ29tcGxldGUoZXZlbnQ6UGFyc2VyRXZlbnQpOnZvaWRcblx0e1xuXHRcdGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0XHRjb25zb2xlLmxvZyggJ0Fzc2V0TG9hZGVyVGVzdC5vblBhcnNlQ29tcGxldGUnICwgZXZlbnQgKTtcblx0XHRjb25zb2xlLmxvZyggJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XG5cdH1cblxuXHRwdWJsaWMgb25UZXh0dXJlU2l6ZUVycm9yKGV2ZW50OkFzc2V0RXZlbnQpOnZvaWRcblx0e1xuXHRcdHZhciBhc3NldExvYWRlcjpBc3NldExvYWRlciA9IDxBc3NldExvYWRlcj4gZXZlbnQudGFyZ2V0O1xuXG5cdFx0Y29uc29sZS5sb2coICctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHRcdGNvbnNvbGUubG9nKCAnQXNzZXRMb2FkZXJUZXN0Lm9uVGV4dHVyZVNpemVFcnJvcicgLCBhc3NldExvYWRlci5iYXNlRGVwZW5kZW5jeS5faUxvYWRlci51cmwgLCBldmVudCApO1xuXHRcdGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0fVxuXG5cdHB1YmxpYyBvbkFzc2V0Q29tcGxldGUoZXZlbnQ6QXNzZXRFdmVudCk6dm9pZFxuXHR7XG5cdFx0dmFyIGFzc2V0TG9hZGVyOkFzc2V0TG9hZGVyID0gPEFzc2V0TG9hZGVyPiBldmVudC50YXJnZXQ7XG5cblx0XHRjb25zb2xlLmxvZyggJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XG5cdFx0Y29uc29sZS5sb2coICdBc3NldExvYWRlclRlc3Qub25Bc3NldENvbXBsZXRlJywgYXNzZXRMb2FkZXIuYmFzZURlcGVuZGVuY3kuX2lMb2FkZXIudXJsICwgZXZlbnQgKTtcblx0XHRjb25zb2xlLmxvZyggJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XG5cdH1cbn1cblxuLyoqXG4gKiBJbWFnZVBhcnNlciBwcm92aWRlcyBhIFwicGFyc2VyXCIgZm9yIG5hdGl2ZWx5IHN1cHBvcnRlZCBpbWFnZSB0eXBlcyAoanBnLCBwbmcpLiBXaGlsZSBpdCBzaW1wbHkgbG9hZHMgYnl0ZXMgaW50b1xuICogYSBsb2FkZXIgb2JqZWN0LCBpdCB3cmFwcyBpdCBpbiBhIEJpdG1hcERhdGFSZXNvdXJjZSBzbyByZXNvdXJjZSBtYW5hZ2VtZW50IGNhbiBoYXBwZW4gY29uc2lzdGVudGx5IHdpdGhvdXRcbiAqIGV4Y2VwdGlvbiBjYXNlcy5cbiAqL1xuY2xhc3MgSlNPTlRleHR1cmVQYXJzZXIgZXh0ZW5kcyBQYXJzZXJCYXNlXG57XG5cdHByaXZhdGUgU1RBVEVfUEFSU0VfREFUQTpudW1iZXIgPSAwO1xuXHRwcml2YXRlIFNUQVRFX0xPQURfSU1BR0VTOm51bWJlciA9IDE7XG5cdHByaXZhdGUgU1RBVEVfQ09NUExFVEU6bnVtYmVyID0gMjtcblxuXHRwcml2YXRlIF9zdGF0ZTpudW1iZXIgPSAtMTtcblx0cHJpdmF0ZSBfc3RhcnRlZFBhcnNpbmc6Ym9vbGVhbjtcblx0cHJpdmF0ZSBfZG9uZVBhcnNpbmc6Ym9vbGVhbjtcblx0cHJpdmF0ZSBfZGVwZW5kZW5jeUNvdW50Om51bWJlciA9IDA7XG5cdHByaXZhdGUgX2xvYWRlZFRleHR1cmVzOkFycmF5PFRleHR1cmUyREJhc2U+O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IEltYWdlUGFyc2VyIG9iamVjdC5cblx0ICogQHBhcmFtIHVyaSBUaGUgdXJsIG9yIGlkIG9mIHRoZSBkYXRhIG9yIGZpbGUgdG8gYmUgcGFyc2VkLlxuXHQgKiBAcGFyYW0gZXh0cmEgVGhlIGhvbGRlciBmb3IgZXh0cmEgY29udGV4dHVhbCBkYXRhIHRoYXQgdGhlIHBhcnNlciBtaWdodCBuZWVkLlxuXHQgKi9cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0c3VwZXIoUGFyc2VyRGF0YUZvcm1hdC5QTEFJTl9URVhUKTtcblxuXHRcdHRoaXMuX2xvYWRlZFRleHR1cmVzID0gbmV3IEFycmF5PFRleHR1cmUyREJhc2U+KCk7XG5cdFx0dGhpcy5fc3RhdGUgPSB0aGlzLlNUQVRFX1BBUlNFX0RBVEE7XG5cdH1cblxuXHQvKipcblx0ICogSW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IGEgZ2l2ZW4gZmlsZSBleHRlbnNpb24gaXMgc3VwcG9ydGVkIGJ5IHRoZSBwYXJzZXIuXG5cdCAqIEBwYXJhbSBleHRlbnNpb24gVGhlIGZpbGUgZXh0ZW5zaW9uIG9mIGEgcG90ZW50aWFsIGZpbGUgdG8gYmUgcGFyc2VkLlxuXHQgKiBAcmV0dXJuIFdoZXRoZXIgb3Igbm90IHRoZSBnaXZlbiBmaWxlIHR5cGUgaXMgc3VwcG9ydGVkLlxuXHQgKi9cblxuXHRwdWJsaWMgc3RhdGljIHN1cHBvcnRzVHlwZShleHRlbnNpb24gOiBzdHJpbmcpIDogYm9vbGVhblxuXHR7XG5cdFx0ZXh0ZW5zaW9uID0gZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG5cdFx0cmV0dXJuIGV4dGVuc2lvbiA9PSBcImpzb25cIjtcblx0fVxuXG5cdC8qKlxuXHQgKiBUZXN0cyB3aGV0aGVyIGEgZGF0YSBibG9jayBjYW4gYmUgcGFyc2VkIGJ5IHRoZSBwYXJzZXIuXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSBkYXRhIGJsb2NrIHRvIHBvdGVudGlhbGx5IGJlIHBhcnNlZC5cblx0ICogQHJldHVybiBXaGV0aGVyIG9yIG5vdCB0aGUgZ2l2ZW4gZGF0YSBpcyBzdXBwb3J0ZWQuXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIHN1cHBvcnRzRGF0YShkYXRhIDogYW55KSA6IGJvb2xlYW5cblx0e1xuXHRcdHRyeSB7XG5cdFx0XHR2YXIgb2JqID0gSlNPTi5wYXJzZShkYXRhKTtcblxuXHRcdFx0aWYgKG9iailcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9IGNhdGNoICggZSApIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaVJlc29sdmVEZXBlbmRlbmN5KHJlc291cmNlRGVwZW5kZW5jeTpSZXNvdXJjZURlcGVuZGVuY3kpXG5cdHtcblx0XHR2YXIgcmVzb3VyY2UgOiBUZXh0dXJlMkRCYXNlID0gPFRleHR1cmUyREJhc2U+IHJlc291cmNlRGVwZW5kZW5jeS5hc3NldHNbMF07XG5cblx0XHR0aGlzLl9wRmluYWxpemVBc3NldCg8SUFzc2V0PiByZXNvdXJjZSwgcmVzb3VyY2VEZXBlbmRlbmN5Ll9pTG9hZGVyLnVybCk7XG5cblx0XHR0aGlzLl9sb2FkZWRUZXh0dXJlcy5wdXNoKCByZXNvdXJjZSApO1xuXG5cdFx0Ly9jb25zb2xlLmxvZyggJ0pTT05UZXh0dXJlUGFyc2VyLl9pUmVzb2x2ZURlcGVuZGVuY3knICwgcmVzb3VyY2VEZXBlbmRlbmN5ICk7XG5cdFx0Ly9jb25zb2xlLmxvZyggJ0pTT05UZXh0dXJlUGFyc2VyLl9pUmVzb2x2ZURlcGVuZGVuY3kgcmVzb3VyY2U6ICcgLCByZXNvdXJjZSApO1xuXG5cdFx0dGhpcy5fZGVwZW5kZW5jeUNvdW50LS07XG5cblx0XHRpZiAoIHRoaXMuX2RlcGVuZGVuY3lDb3VudCA9PSAwKVxuXHRcdFx0dGhpcy5fc3RhdGUgPSB0aGlzLlNUQVRFX0NPTVBMRVRFO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lSZXNvbHZlRGVwZW5kZW5jeUZhaWx1cmUocmVzb3VyY2VEZXBlbmRlbmN5OlJlc291cmNlRGVwZW5kZW5jeSlcblx0e1xuXHRcdHRoaXMuX2RlcGVuZGVuY3lDb3VudC0tO1xuXG5cdFx0aWYgKCB0aGlzLl9kZXBlbmRlbmN5Q291bnQgPT0gMClcblx0XHRcdHRoaXMuX3N0YXRlID0gdGhpcy5TVEFURV9DT01QTEVURTtcblx0fVxuXG5cdHByaXZhdGUgcGFyc2VKc29uKCApIDogdm9pZFxuXHR7XG5cdFx0aWYgKEpTT05UZXh0dXJlUGFyc2VyLnN1cHBvcnRzRGF0YSh0aGlzLmRhdGEpKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHR2YXIganNvbjphbnkgPSBKU09OLnBhcnNlKHRoaXMuZGF0YSk7XG5cdFx0XHRcdHZhciBkYXRhOkFycmF5PGFueT4gPSA8QXJyYXk8YW55Pj4ganNvbi5kYXRhO1xuXG5cdFx0XHRcdHZhciByZWM6YW55O1xuXHRcdFx0XHR2YXIgcnE6VVJMUmVxdWVzdDtcblxuXHRcdFx0XHRmb3IgKHZhciBjIDogbnVtYmVyID0gMDsgYyA8IGRhdGEubGVuZ3RoOyBjICsrKSB7XG5cdFx0XHRcdFx0cmVjID0gZGF0YVtjXTtcblxuXHRcdFx0XHRcdHZhciB1cmk6c3RyaW5nID0gPHN0cmluZz4gcmVjLmltYWdlO1xuXHRcdFx0XHRcdHZhciBpZDpzdHJpbmcgPSA8c3RyaW5nPiByZWMuaWQ7XG5cblx0XHRcdFx0XHRycSA9IG5ldyBVUkxSZXF1ZXN0KHVyaSk7XG5cblx0XHRcdFx0XHR0aGlzLl9wQWRkRGVwZW5kZW5jeSgnSlNPTl9JRF8nICsgaWQsIHJxLCBmYWxzZSwgbnVsbCwgdHJ1ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLl9kZXBlbmRlbmN5Q291bnQgPSBkYXRhLmxlbmd0aDtcblx0XHRcdFx0dGhpcy5fc3RhdGUgPSB0aGlzLlNUQVRFX0xPQURfSU1BR0VTO1xuXG5cdFx0XHRcdHRoaXMuX3BQYXVzZUFuZFJldHJpZXZlRGVwZW5kZW5jaWVzKCk7XG5cblx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0dGhpcy5fc3RhdGUgPSB0aGlzLlNUQVRFX0NPTVBMRVRFO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfcFByb2NlZWRQYXJzaW5nKCkgOiBib29sZWFuXG5cdHtcblx0XHRjb25zb2xlLmxvZyggJ0pTT05UZXh0dXJlUGFyc2VyLl9wUHJvY2VlZFBhcnNpbmcnICwgdGhpcy5fc3RhdGUgKTtcblxuXHRcdHN3aXRjaCAodGhpcy5fc3RhdGUpIHtcblx0XHRcdGNhc2UgdGhpcy5TVEFURV9QQVJTRV9EQVRBOlxuXHRcdFx0XHR0aGlzLnBhcnNlSnNvbigpO1xuXHRcdFx0XHRyZXR1cm4gUGFyc2VyQmFzZS5NT1JFX1RPX1BBUlNFO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgdGhpcy5TVEFURV9MT0FEX0lNQUdFUzpcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIHRoaXMuU1RBVEVfQ09NUExFVEU6XG5cdFx0XHRcdHJldHVybiBQYXJzZXJCYXNlLlBBUlNJTkdfRE9ORTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFBhcnNlckJhc2UuTU9SRV9UT19QQVJTRTtcblx0fVxufSJdfQ==