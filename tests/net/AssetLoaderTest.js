var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var AssetEvent = require("awayjs-core/lib/events/AssetEvent");
var ParserEvent = require("awayjs-core/lib/events/ParserEvent");
var AssetLoader = require("awayjs-core/lib/library/AssetLoader");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var ParserBase = require("awayjs-core/lib/parsers/ParserBase");
var ParserDataFormat = require("awayjs-core/lib/parsers/ParserDataFormat");
var AssetLoaderTest = (function () {
    function AssetLoaderTest() {
        var _this = this;
        //---------------------------------------------------------------------------------------------------------------------
        // Enable Custom Parser ( JSON file format with multiple texture dependencies )
        AssetLoader.enableParser(JSONTextureParser);
        var token;
        var urlRq;
        //---------------------------------------------------------------------------------------------------------------------
        // LOAD A SINGLE IMAGE
        this.alImage = new AssetLoader();
        urlRq = new URLRequest('assets/1024x1024.png');
        token = this.alImage.load(urlRq);
        token.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        token.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) { return _this.onTextureSizeError(event); });
        //---------------------------------------------------------------------------------------------------------------------
        // LOAD A SINGLE IMAGE - With wrong dimensions
        this.alErrorImage = new AssetLoader();
        urlRq = new URLRequest('assets/2.png');
        token = this.alErrorImage.load(urlRq);
        token.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        token.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) { return _this.onTextureSizeError(event); });
        //---------------------------------------------------------------------------------------------------------------------
        // LOAD WITH A JSON PARSER
        this.alJson = new AssetLoader();
        urlRq = new URLRequest('assets/JSNParserTest.json');
        token = this.alJson.load(urlRq);
        token.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        token.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) { return _this.onTextureSizeError(event); });
        token.addEventListener(ParserEvent.PARSE_COMPLETE, function (event) { return _this.onParseComplete(event); });
    }
    AssetLoaderTest.prototype.onParseComplete = function (event) {
        console.log('--------------------------------------------------------------------------------');
        console.log('AssetLoaderTest.onParseComplete', event);
        console.log('--------------------------------------------------------------------------------');
    };
    AssetLoaderTest.prototype.onTextureSizeError = function (event) {
        var assetLoader = event.target;
        console.log('--------------------------------------------------------------------------------');
        console.log('AssetLoaderTest.onTextureSizeError', assetLoader.baseDependency._iLoader.url, event);
        console.log('--------------------------------------------------------------------------------');
    };
    AssetLoaderTest.prototype.onAssetComplete = function (event) {
        var assetLoader = event.target;
        console.log('--------------------------------------------------------------------------------');
        console.log('AssetLoaderTest.onAssetComplete', assetLoader.baseDependency._iLoader.url, event);
        console.log('--------------------------------------------------------------------------------');
    };
    return AssetLoaderTest;
})();
/**
 * ImageParser provides a "parser" for natively supported image types (jpg, png). While it simply loads bytes into
 * a loader object, it wraps it in a BitmapImage2DResource so resource management can happen consistently without
 * exception cases.
 */
var JSONTextureParser = (function (_super) {
    __extends(JSONTextureParser, _super);
    /**
     * Creates a new ImageParser object.
     * @param uri The url or id of the data or file to be parsed.
     * @param extra The holder for extra contextual data that the parser might need.
     */
    function JSONTextureParser() {
        _super.call(this, ParserDataFormat.PLAIN_TEXT);
        this.STATE_PARSE_DATA = 0;
        this.STATE_LOAD_IMAGES = 1;
        this.STATE_COMPLETE = 2;
        this._state = -1;
        this._dependencyCount = 0;
        this._loadedTextures = new Array();
        this._state = this.STATE_PARSE_DATA;
    }
    /**
     * Indicates whether or not a given file extension is supported by the parser.
     * @param extension The file extension of a potential file to be parsed.
     * @return Whether or not the given file type is supported.
     */
    JSONTextureParser.supportsType = function (extension) {
        extension = extension.toLowerCase();
        return extension == "json";
    };
    /**
     * Tests whether a data block can be parsed by the parser.
     * @param data The data block to potentially be parsed.
     * @return Whether or not the given data is supported.
     */
    JSONTextureParser.supportsData = function (data) {
        try {
            var obj = JSON.parse(data);
            if (obj)
                return true;
            return false;
        }
        catch (e) {
            return false;
        }
        return false;
    };
    /**
     * @inheritDoc
     */
    JSONTextureParser.prototype._iResolveDependency = function (resourceDependency) {
        var resource = resourceDependency.assets[0];
        this._pFinalizeAsset(resource, resourceDependency._iLoader.url);
        this._loadedTextures.push(resource);
        //console.log( 'JSONTextureParser._iResolveDependency' , resourceDependency );
        //console.log( 'JSONTextureParser._iResolveDependency resource: ' , resource );
        this._dependencyCount--;
        if (this._dependencyCount == 0)
            this._state = this.STATE_COMPLETE;
    };
    /**
     * @inheritDoc
     */
    JSONTextureParser.prototype._iResolveDependencyFailure = function (resourceDependency) {
        this._dependencyCount--;
        if (this._dependencyCount == 0)
            this._state = this.STATE_COMPLETE;
    };
    JSONTextureParser.prototype.parseJson = function () {
        if (JSONTextureParser.supportsData(this.data)) {
            try {
                var json = JSON.parse(this.data);
                var data = json.data;
                var rec;
                var rq;
                for (var c = 0; c < data.length; c++) {
                    rec = data[c];
                    var uri = rec.image;
                    var id = rec.id;
                    rq = new URLRequest(uri);
                    this._pAddDependency('JSON_ID_' + id, rq, false, null, true);
                }
                this._dependencyCount = data.length;
                this._state = this.STATE_LOAD_IMAGES;
                this._pPauseAndRetrieveDependencies();
            }
            catch (e) {
                this._state = this.STATE_COMPLETE;
            }
        }
    };
    /**
     * @inheritDoc
     */
    JSONTextureParser.prototype._pProceedParsing = function () {
        console.log('JSONTextureParser._pProceedParsing', this._state);
        switch (this._state) {
            case this.STATE_PARSE_DATA:
                this.parseJson();
                return ParserBase.MORE_TO_PARSE;
                break;
            case this.STATE_LOAD_IMAGES:
                break;
            case this.STATE_COMPLETE:
                return ParserBase.PARSING_DONE;
                break;
        }
        return ParserBase.MORE_TO_PARSE;
    };
    return JSONTextureParser;
})(ParserBase);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5ldC9Bc3NldExvYWRlclRlc3QudHMiXSwibmFtZXMiOlsiQXNzZXRMb2FkZXJUZXN0IiwiQXNzZXRMb2FkZXJUZXN0LmNvbnN0cnVjdG9yIiwiQXNzZXRMb2FkZXJUZXN0Lm9uUGFyc2VDb21wbGV0ZSIsIkFzc2V0TG9hZGVyVGVzdC5vblRleHR1cmVTaXplRXJyb3IiLCJBc3NldExvYWRlclRlc3Qub25Bc3NldENvbXBsZXRlIiwiSlNPTlRleHR1cmVQYXJzZXIiLCJKU09OVGV4dHVyZVBhcnNlci5jb25zdHJ1Y3RvciIsIkpTT05UZXh0dXJlUGFyc2VyLnN1cHBvcnRzVHlwZSIsIkpTT05UZXh0dXJlUGFyc2VyLnN1cHBvcnRzRGF0YSIsIkpTT05UZXh0dXJlUGFyc2VyLl9pUmVzb2x2ZURlcGVuZGVuY3kiLCJKU09OVGV4dHVyZVBhcnNlci5faVJlc29sdmVEZXBlbmRlbmN5RmFpbHVyZSIsIkpTT05UZXh0dXJlUGFyc2VyLnBhcnNlSnNvbiIsIkpTT05UZXh0dXJlUGFyc2VyLl9wUHJvY2VlZFBhcnNpbmciXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sVUFBVSxXQUFhLG1DQUFtQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxXQUFXLFdBQWEsb0NBQW9DLENBQUMsQ0FBQztBQUNyRSxJQUFPLFdBQVcsV0FBYSxxQ0FBcUMsQ0FBQyxDQUFDO0FBR3RFLElBQU8sVUFBVSxXQUFhLGdDQUFnQyxDQUFDLENBQUM7QUFDaEUsSUFBTyxVQUFVLFdBQWEsb0NBQW9DLENBQUMsQ0FBQztBQUNwRSxJQUFPLGdCQUFnQixXQUFZLDBDQUEwQyxDQUFDLENBQUM7QUFHL0UsSUFBTSxlQUFlO0lBTXBCQSxTQU5LQSxlQUFlQTtRQUFyQkMsaUJBd0VDQTtRQWhFQ0EsQUFFQUEsdUhBRnVIQTtRQUN2SEEsK0VBQStFQTtRQUMvRUEsV0FBV0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtRQUU1Q0EsSUFBSUEsS0FBc0JBLENBQUNBO1FBQzNC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Q0FBQ0EsTUFBTUEsQ0FBRUEsQ0FBQ0E7UUFFbEVBLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ3JCQSxLQUFLQSxJQUFJQSxDQUFDQSxnQkFBZ0JBO2dCQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7Z0JBQ2pCQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQTtnQkFDaENBLEtBQUtBLENBQUNBO1lBQ1BBLEtBQUtBLElBQUlBLENBQUNBLGlCQUFpQkE7Z0JBQzFCQSxLQUFLQSxDQUFDQTtZQUNQQSxLQUFLQSxJQUFJQSxDQUFDQSxjQUFjQTtnQkFDdkJBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLFlBQVlBLENBQUNBO2dCQUMvQkEsS0FBS0EsQ0FBQ0E7UUFDUkEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBQ0ZQLHdCQUFDQTtBQUFEQSxDQTdJQSxBQTZJQ0EsRUE3SStCLFVBQVUsRUE2SXpDIiwiZmlsZSI6Im5ldC9Bc3NldExvYWRlclRlc3QuanMiLCJzb3VyY2VSb290IjoiLi90ZXN0cyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCaXRtYXBJbWFnZTJEXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9kYXRhL0JpdG1hcEltYWdlMkRcIik7XG5pbXBvcnQgQXNzZXRFdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvQXNzZXRFdmVudFwiKTtcbmltcG9ydCBMb2FkZXJFdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvTG9hZGVyRXZlbnRcIik7XG5pbXBvcnQgUGFyc2VyRXZlbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1BhcnNlckV2ZW50XCIpO1xuaW1wb3J0IEFzc2V0TG9hZGVyXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvQXNzZXRMb2FkZXJcIik7XG5pbXBvcnQgQXNzZXRMb2FkZXJUb2tlblx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Bc3NldExvYWRlclRva2VuXCIpO1xuaW1wb3J0IElBc3NldFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvSUFzc2V0XCIpO1xuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIik7XG5pbXBvcnQgUGFyc2VyQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL1BhcnNlckJhc2VcIik7XG5pbXBvcnQgUGFyc2VyRGF0YUZvcm1hdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcGFyc2Vycy9QYXJzZXJEYXRhRm9ybWF0XCIpO1xuaW1wb3J0IFJlc291cmNlRGVwZW5kZW5jeVx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUmVzb3VyY2VEZXBlbmRlbmN5XCIpO1xuXG5jbGFzcyBBc3NldExvYWRlclRlc3Rcbntcblx0cHJpdmF0ZSBhbEpzb246QXNzZXRMb2FkZXI7XG5cdHByaXZhdGUgYWxJbWFnZTpBc3NldExvYWRlcjtcblx0cHJpdmF0ZSBhbEVycm9ySW1hZ2U6QXNzZXRMb2FkZXI7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBFbmFibGUgQ3VzdG9tIFBhcnNlciAoIEpTT04gZmlsZSBmb3JtYXQgd2l0aCBtdWx0aXBsZSB0ZXh0dXJlIGRlcGVuZGVuY2llcyApXG5cdFx0QXNzZXRMb2FkZXIuZW5hYmxlUGFyc2VyKEpTT05UZXh0dXJlUGFyc2VyKTtcblxuXHRcdHZhciB0b2tlbjpBc3NldExvYWRlclRva2VuO1xuXHRcdHZhciB1cmxScTpVUkxSZXF1ZXN0O1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBMT0FEIEEgU0lOR0xFIElNQUdFXG5cblx0XHR0aGlzLmFsSW1hZ2UgID0gbmV3IEFzc2V0TG9hZGVyKCk7XG5cdFx0dXJsUnEgPSBuZXcgVVJMUmVxdWVzdCgnYXNzZXRzLzEwMjR4MTAyNC5wbmcnKTtcblx0XHR0b2tlbiA9IHRoaXMuYWxJbWFnZS5sb2FkKHVybFJxKTtcblxuXHRcdHRva2VuLmFkZEV2ZW50TGlzdGVuZXIoQXNzZXRFdmVudC5BU1NFVF9DT01QTEVURSwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25Bc3NldENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0dG9rZW4uYWRkRXZlbnRMaXN0ZW5lcihBc3NldEV2ZW50LlRFWFRVUkVfU0laRV9FUlJPUiwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25UZXh0dXJlU2l6ZUVycm9yKGV2ZW50KSk7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIExPQUQgQSBTSU5HTEUgSU1BR0UgLSBXaXRoIHdyb25nIGRpbWVuc2lvbnNcblxuXHRcdHRoaXMuYWxFcnJvckltYWdlID0gbmV3IEFzc2V0TG9hZGVyKCk7XG5cdFx0dXJsUnEgPSBuZXcgVVJMUmVxdWVzdCgnYXNzZXRzLzIucG5nJyk7XG5cdFx0dG9rZW4gPSB0aGlzLmFsRXJyb3JJbWFnZS5sb2FkKHVybFJxKTtcblxuXHRcdHRva2VuLmFkZEV2ZW50TGlzdGVuZXIoQXNzZXRFdmVudC5BU1NFVF9DT01QTEVURSwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25Bc3NldENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0dG9rZW4uYWRkRXZlbnRMaXN0ZW5lcihBc3NldEV2ZW50LlRFWFRVUkVfU0laRV9FUlJPUiwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25UZXh0dXJlU2l6ZUVycm9yKGV2ZW50KSk7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIExPQUQgV0lUSCBBIEpTT04gUEFSU0VSXG5cblx0XHR0aGlzLmFsSnNvbiAgICA9IG5ldyBBc3NldExvYWRlcigpO1xuXHRcdHVybFJxICAgICAgICAgID0gbmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy9KU05QYXJzZXJUZXN0Lmpzb24nKTtcblx0XHR0b2tlbiAgICAgICAgICA9IHRoaXMuYWxKc29uLmxvYWQoIHVybFJxICk7XG5cblx0XHR0b2tlbi5hZGRFdmVudExpc3RlbmVyKCBBc3NldEV2ZW50LkFTU0VUX0NPTVBMRVRFLCAoZXZlbnQ6QXNzZXRFdmVudCkgPT4gdGhpcy5vbkFzc2V0Q29tcGxldGUoZXZlbnQpKTtcblx0XHR0b2tlbi5hZGRFdmVudExpc3RlbmVyKCBBc3NldEV2ZW50LlRFWFRVUkVfU0laRV9FUlJPUiwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25UZXh0dXJlU2l6ZUVycm9yKGV2ZW50KSk7XG5cdFx0dG9rZW4uYWRkRXZlbnRMaXN0ZW5lciggUGFyc2VyRXZlbnQuUEFSU0VfQ09NUExFVEUsIChldmVudDpQYXJzZXJFdmVudCkgPT4gdGhpcy5vblBhcnNlQ29tcGxldGUoZXZlbnQpKTtcblxuXHR9XG5cblx0cHVibGljIG9uUGFyc2VDb21wbGV0ZShldmVudDpQYXJzZXJFdmVudCk6dm9pZFxuXHR7XG5cdFx0Y29uc29sZS5sb2coICctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHRcdGNvbnNvbGUubG9nKCAnQXNzZXRMb2FkZXJUZXN0Lm9uUGFyc2VDb21wbGV0ZScgLCBldmVudCApO1xuXHRcdGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0fVxuXG5cdHB1YmxpYyBvblRleHR1cmVTaXplRXJyb3IoZXZlbnQ6QXNzZXRFdmVudCk6dm9pZFxuXHR7XG5cdFx0dmFyIGFzc2V0TG9hZGVyOkFzc2V0TG9hZGVyID0gPEFzc2V0TG9hZGVyPiBldmVudC50YXJnZXQ7XG5cblx0XHRjb25zb2xlLmxvZyggJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XG5cdFx0Y29uc29sZS5sb2coICdBc3NldExvYWRlclRlc3Qub25UZXh0dXJlU2l6ZUVycm9yJyAsIGFzc2V0TG9hZGVyLmJhc2VEZXBlbmRlbmN5Ll9pTG9hZGVyLnVybCAsIGV2ZW50ICk7XG5cdFx0Y29uc29sZS5sb2coICctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHR9XG5cblx0cHVibGljIG9uQXNzZXRDb21wbGV0ZShldmVudDpBc3NldEV2ZW50KTp2b2lkXG5cdHtcblx0XHR2YXIgYXNzZXRMb2FkZXI6QXNzZXRMb2FkZXIgPSA8QXNzZXRMb2FkZXI+IGV2ZW50LnRhcmdldDtcblxuXHRcdGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0XHRjb25zb2xlLmxvZyggJ0Fzc2V0TG9hZGVyVGVzdC5vbkFzc2V0Q29tcGxldGUnLCBhc3NldExvYWRlci5iYXNlRGVwZW5kZW5jeS5faUxvYWRlci51cmwgLCBldmVudCApO1xuXHRcdGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0fVxufVxuXG4vKipcbiAqIEltYWdlUGFyc2VyIHByb3ZpZGVzIGEgXCJwYXJzZXJcIiBmb3IgbmF0aXZlbHkgc3VwcG9ydGVkIGltYWdlIHR5cGVzIChqcGcsIHBuZykuIFdoaWxlIGl0IHNpbXBseSBsb2FkcyBieXRlcyBpbnRvXG4gKiBhIGxvYWRlciBvYmplY3QsIGl0IHdyYXBzIGl0IGluIGEgQml0bWFwSW1hZ2UyRFJlc291cmNlIHNvIHJlc291cmNlIG1hbmFnZW1lbnQgY2FuIGhhcHBlbiBjb25zaXN0ZW50bHkgd2l0aG91dFxuICogZXhjZXB0aW9uIGNhc2VzLlxuICovXG5jbGFzcyBKU09OVGV4dHVyZVBhcnNlciBleHRlbmRzIFBhcnNlckJhc2Vcbntcblx0cHJpdmF0ZSBTVEFURV9QQVJTRV9EQVRBOm51bWJlciA9IDA7XG5cdHByaXZhdGUgU1RBVEVfTE9BRF9JTUFHRVM6bnVtYmVyID0gMTtcblx0cHJpdmF0ZSBTVEFURV9DT01QTEVURTpudW1iZXIgPSAyO1xuXG5cdHByaXZhdGUgX3N0YXRlOm51bWJlciA9IC0xO1xuXHRwcml2YXRlIF9zdGFydGVkUGFyc2luZzpib29sZWFuO1xuXHRwcml2YXRlIF9kb25lUGFyc2luZzpib29sZWFuO1xuXHRwcml2YXRlIF9kZXBlbmRlbmN5Q291bnQ6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfbG9hZGVkVGV4dHVyZXM6QXJyYXk8Qml0bWFwSW1hZ2UyRD47XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgSW1hZ2VQYXJzZXIgb2JqZWN0LlxuXHQgKiBAcGFyYW0gdXJpIFRoZSB1cmwgb3IgaWQgb2YgdGhlIGRhdGEgb3IgZmlsZSB0byBiZSBwYXJzZWQuXG5cdCAqIEBwYXJhbSBleHRyYSBUaGUgaG9sZGVyIGZvciBleHRyYSBjb250ZXh0dWFsIGRhdGEgdGhhdCB0aGUgcGFyc2VyIG1pZ2h0IG5lZWQuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHRzdXBlcihQYXJzZXJEYXRhRm9ybWF0LlBMQUlOX1RFWFQpO1xuXG5cdFx0dGhpcy5fbG9hZGVkVGV4dHVyZXMgPSBuZXcgQXJyYXk8Qml0bWFwSW1hZ2UyRD4oKTtcblx0XHR0aGlzLl9zdGF0ZSA9IHRoaXMuU1RBVEVfUEFSU0VfREFUQTtcblx0fVxuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciBvciBub3QgYSBnaXZlbiBmaWxlIGV4dGVuc2lvbiBpcyBzdXBwb3J0ZWQgYnkgdGhlIHBhcnNlci5cblx0ICogQHBhcmFtIGV4dGVuc2lvbiBUaGUgZmlsZSBleHRlbnNpb24gb2YgYSBwb3RlbnRpYWwgZmlsZSB0byBiZSBwYXJzZWQuXG5cdCAqIEByZXR1cm4gV2hldGhlciBvciBub3QgdGhlIGdpdmVuIGZpbGUgdHlwZSBpcyBzdXBwb3J0ZWQuXG5cdCAqL1xuXG5cdHB1YmxpYyBzdGF0aWMgc3VwcG9ydHNUeXBlKGV4dGVuc2lvbiA6IHN0cmluZykgOiBib29sZWFuXG5cdHtcblx0XHRleHRlbnNpb24gPSBleHRlbnNpb24udG9Mb3dlckNhc2UoKTtcblx0XHRyZXR1cm4gZXh0ZW5zaW9uID09IFwianNvblwiO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRlc3RzIHdoZXRoZXIgYSBkYXRhIGJsb2NrIGNhbiBiZSBwYXJzZWQgYnkgdGhlIHBhcnNlci5cblx0ICogQHBhcmFtIGRhdGEgVGhlIGRhdGEgYmxvY2sgdG8gcG90ZW50aWFsbHkgYmUgcGFyc2VkLlxuXHQgKiBAcmV0dXJuIFdoZXRoZXIgb3Igbm90IHRoZSBnaXZlbiBkYXRhIGlzIHN1cHBvcnRlZC5cblx0ICovXG5cdHB1YmxpYyBzdGF0aWMgc3VwcG9ydHNEYXRhKGRhdGEgOiBhbnkpIDogYm9vbGVhblxuXHR7XG5cdFx0dHJ5IHtcblx0XHRcdHZhciBvYmogPSBKU09OLnBhcnNlKGRhdGEpO1xuXG5cdFx0XHRpZiAob2JqKVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0gY2F0Y2ggKCBlICkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pUmVzb2x2ZURlcGVuZGVuY3kocmVzb3VyY2VEZXBlbmRlbmN5OlJlc291cmNlRGVwZW5kZW5jeSlcblx0e1xuXHRcdHZhciByZXNvdXJjZSA6IEJpdG1hcEltYWdlMkQgPSA8Qml0bWFwSW1hZ2UyRD4gcmVzb3VyY2VEZXBlbmRlbmN5LmFzc2V0c1swXTtcblxuXHRcdHRoaXMuX3BGaW5hbGl6ZUFzc2V0KDxJQXNzZXQ+IHJlc291cmNlLCByZXNvdXJjZURlcGVuZGVuY3kuX2lMb2FkZXIudXJsKTtcblxuXHRcdHRoaXMuX2xvYWRlZFRleHR1cmVzLnB1c2goIHJlc291cmNlICk7XG5cblx0XHQvL2NvbnNvbGUubG9nKCAnSlNPTlRleHR1cmVQYXJzZXIuX2lSZXNvbHZlRGVwZW5kZW5jeScgLCByZXNvdXJjZURlcGVuZGVuY3kgKTtcblx0XHQvL2NvbnNvbGUubG9nKCAnSlNPTlRleHR1cmVQYXJzZXIuX2lSZXNvbHZlRGVwZW5kZW5jeSByZXNvdXJjZTogJyAsIHJlc291cmNlICk7XG5cblx0XHR0aGlzLl9kZXBlbmRlbmN5Q291bnQtLTtcblxuXHRcdGlmICggdGhpcy5fZGVwZW5kZW5jeUNvdW50ID09IDApXG5cdFx0XHR0aGlzLl9zdGF0ZSA9IHRoaXMuU1RBVEVfQ09NUExFVEU7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaVJlc29sdmVEZXBlbmRlbmN5RmFpbHVyZShyZXNvdXJjZURlcGVuZGVuY3k6UmVzb3VyY2VEZXBlbmRlbmN5KVxuXHR7XG5cdFx0dGhpcy5fZGVwZW5kZW5jeUNvdW50LS07XG5cblx0XHRpZiAoIHRoaXMuX2RlcGVuZGVuY3lDb3VudCA9PSAwKVxuXHRcdFx0dGhpcy5fc3RhdGUgPSB0aGlzLlNUQVRFX0NPTVBMRVRFO1xuXHR9XG5cblx0cHJpdmF0ZSBwYXJzZUpzb24oICkgOiB2b2lkXG5cdHtcblx0XHRpZiAoSlNPTlRleHR1cmVQYXJzZXIuc3VwcG9ydHNEYXRhKHRoaXMuZGF0YSkpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHZhciBqc29uOmFueSA9IEpTT04ucGFyc2UodGhpcy5kYXRhKTtcblx0XHRcdFx0dmFyIGRhdGE6QXJyYXk8YW55PiA9IDxBcnJheTxhbnk+PiBqc29uLmRhdGE7XG5cblx0XHRcdFx0dmFyIHJlYzphbnk7XG5cdFx0XHRcdHZhciBycTpVUkxSZXF1ZXN0O1xuXG5cdFx0XHRcdGZvciAodmFyIGMgOiBudW1iZXIgPSAwOyBjIDwgZGF0YS5sZW5ndGg7IGMgKyspIHtcblx0XHRcdFx0XHRyZWMgPSBkYXRhW2NdO1xuXG5cdFx0XHRcdFx0dmFyIHVyaTpzdHJpbmcgPSA8c3RyaW5nPiByZWMuaW1hZ2U7XG5cdFx0XHRcdFx0dmFyIGlkOnN0cmluZyA9IDxzdHJpbmc+IHJlYy5pZDtcblxuXHRcdFx0XHRcdHJxID0gbmV3IFVSTFJlcXVlc3QodXJpKTtcblxuXHRcdFx0XHRcdHRoaXMuX3BBZGREZXBlbmRlbmN5KCdKU09OX0lEXycgKyBpZCwgcnEsIGZhbHNlLCBudWxsLCB0cnVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuX2RlcGVuZGVuY3lDb3VudCA9IGRhdGEubGVuZ3RoO1xuXHRcdFx0XHR0aGlzLl9zdGF0ZSA9IHRoaXMuU1RBVEVfTE9BRF9JTUFHRVM7XG5cblx0XHRcdFx0dGhpcy5fcFBhdXNlQW5kUmV0cmlldmVEZXBlbmRlbmNpZXMoKTtcblxuXHRcdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0XHR0aGlzLl9zdGF0ZSA9IHRoaXMuU1RBVEVfQ09NUExFVEU7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9wUHJvY2VlZFBhcnNpbmcoKSA6IGJvb2xlYW5cblx0e1xuXHRcdGNvbnNvbGUubG9nKCAnSlNPTlRleHR1cmVQYXJzZXIuX3BQcm9jZWVkUGFyc2luZycgLCB0aGlzLl9zdGF0ZSApO1xuXG5cdFx0c3dpdGNoICh0aGlzLl9zdGF0ZSkge1xuXHRcdFx0Y2FzZSB0aGlzLlNUQVRFX1BBUlNFX0RBVEE6XG5cdFx0XHRcdHRoaXMucGFyc2VKc29uKCk7XG5cdFx0XHRcdHJldHVybiBQYXJzZXJCYXNlLk1PUkVfVE9fUEFSU0U7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSB0aGlzLlNUQVRFX0xPQURfSU1BR0VTOlxuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgdGhpcy5TVEFURV9DT01QTEVURTpcblx0XHRcdFx0cmV0dXJuIFBhcnNlckJhc2UuUEFSU0lOR19ET05FO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRyZXR1cm4gUGFyc2VyQmFzZS5NT1JFX1RPX1BBUlNFO1xuXHR9XG59Il19