var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var AssetEvent = require("awayjs-core/lib/events/AssetEvent");
var ParserEvent = require("awayjs-core/lib/events/ParserEvent");
var Loader = require("awayjs-core/lib/library/Loader");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var ParserBase = require("awayjs-core/lib/parsers/ParserBase");
var ParserDataFormat = require("awayjs-core/lib/parsers/ParserDataFormat");
var LoaderTest = (function () {
    function LoaderTest() {
        var _this = this;
        //---------------------------------------------------------------------------------------------------------------------
        // Enable Custom Parser ( JSON file format with multiple texture dependencies )
        Loader.enableParser(JSONTextureParser);
        //---------------------------------------------------------------------------------------------------------------------
        // LOAD A SINGLE IMAGE
        this.alImage = new Loader();
        this.alImage.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        this.alImage.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) { return _this.onTextureSizeError(event); });
        this.alImage.load(new URLRequest('assets/1024x1024.png'));
        //---------------------------------------------------------------------------------------------------------------------
        // LOAD A SINGLE IMAGE - With wrong dimensions
        this.alErrorImage = new Loader();
        this.alErrorImage.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        this.alErrorImage.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) { return _this.onTextureSizeError(event); });
        this.alErrorImage.load(new URLRequest('assets/2.png'));
        //---------------------------------------------------------------------------------------------------------------------
        // LOAD WITH A JSON PARSER
        this.alJson = new Loader();
        this.alJson.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        this.alJson.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, function (event) { return _this.onTextureSizeError(event); });
        this.alJson.addEventListener(ParserEvent.PARSE_COMPLETE, function (event) { return _this.onParseComplete(event); });
        this.alJson.load(new URLRequest('assets/JSNParserTest.json'));
    }
    LoaderTest.prototype.onParseComplete = function (event) {
        console.log('--------------------------------------------------------------------------------');
        console.log('LoaderTest.onParseComplete', event);
        console.log('--------------------------------------------------------------------------------');
    };
    LoaderTest.prototype.onTextureSizeError = function (event) {
        var assetLoader = event.target;
        console.log('--------------------------------------------------------------------------------');
        console.log('LoaderTest.onTextureSizeError', assetLoader.baseDependency._iLoader.url, event);
        console.log('--------------------------------------------------------------------------------');
    };
    LoaderTest.prototype.onAssetComplete = function (event) {
        var assetLoader = event.target;
        console.log('--------------------------------------------------------------------------------');
        console.log('LoaderTest.onAssetComplete', assetLoader.baseDependency._iLoader.url, event);
        console.log('--------------------------------------------------------------------------------');
    };
    return LoaderTest;
})();
/**
 * ImageParser provides a "parser" for natively supported image types (jpg, png). While it simply loads bytes into
 * a loader object, it wraps it in a BitmapImage2DResource so resource management can happen consistently without
 * exception cases.
 */
var JSONTextureParser = (function (_super) {
    __extends(JSONTextureParser, _super);
    /**
     * Creates a new ImageParser object.
     * @param uri The url or id of the data or file to be parsed.
     * @param extra The holder for extra contextual data that the parser might need.
     */
    function JSONTextureParser() {
        _super.call(this, ParserDataFormat.PLAIN_TEXT);
        this.STATE_PARSE_DATA = 0;
        this.STATE_LOAD_IMAGES = 1;
        this.STATE_COMPLETE = 2;
        this._state = -1;
        this._dependencyCount = 0;
        this._loadedTextures = new Array();
        this._state = this.STATE_PARSE_DATA;
    }
    /**
     * Indicates whether or not a given file extension is supported by the parser.
     * @param extension The file extension of a potential file to be parsed.
     * @return Whether or not the given file type is supported.
     */
    JSONTextureParser.supportsType = function (extension) {
        extension = extension.toLowerCase();
        return extension == "json";
    };
    /**
     * Tests whether a data block can be parsed by the parser.
     * @param data The data block to potentially be parsed.
     * @return Whether or not the given data is supported.
     */
    JSONTextureParser.supportsData = function (data) {
        try {
            var obj = JSON.parse(data);
            if (obj)
                return true;
            return false;
        }
        catch (e) {
            return false;
        }
        return false;
    };
    /**
     * @inheritDoc
     */
    JSONTextureParser.prototype._iResolveDependency = function (resourceDependency) {
        var resource = resourceDependency.assets[0];
        this._pFinalizeAsset(resource, resourceDependency._iLoader.url);
        this._loadedTextures.push(resource);
        //console.log( 'JSONTextureParser._iResolveDependency' , resourceDependency );
        //console.log( 'JSONTextureParser._iResolveDependency resource: ' , resource );
        this._dependencyCount--;
        if (this._dependencyCount == 0)
            this._state = this.STATE_COMPLETE;
    };
    /**
     * @inheritDoc
     */
    JSONTextureParser.prototype._iResolveDependencyFailure = function (resourceDependency) {
        this._dependencyCount--;
        if (this._dependencyCount == 0)
            this._state = this.STATE_COMPLETE;
    };
    JSONTextureParser.prototype.parseJson = function () {
        if (JSONTextureParser.supportsData(this.data)) {
            try {
                var json = JSON.parse(this.data);
                var data = json.data;
                var rec;
                var rq;
                for (var c = 0; c < data.length; c++) {
                    rec = data[c];
                    var uri = rec.image;
                    var id = rec.id;
                    rq = new URLRequest(uri);
                    this._pAddDependency('JSON_ID_' + id, rq, false, null, true);
                }
                this._dependencyCount = data.length;
                this._state = this.STATE_LOAD_IMAGES;
                this._pPauseAndRetrieveDependencies();
            }
            catch (e) {
                this._state = this.STATE_COMPLETE;
            }
        }
    };
    /**
     * @inheritDoc
     */
    JSONTextureParser.prototype._pProceedParsing = function () {
        console.log('JSONTextureParser._pProceedParsing', this._state);
        switch (this._state) {
            case this.STATE_PARSE_DATA:
                this.parseJson();
                return ParserBase.MORE_TO_PARSE;
                break;
            case this.STATE_LOAD_IMAGES:
                break;
            case this.STATE_COMPLETE:
                return ParserBase.PARSING_DONE;
                break;
        }
        return ParserBase.MORE_TO_PARSE;
    };
    return JSONTextureParser;
})(ParserBase);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5ldC9Mb2FkZXJUZXN0LnRzIl0sIm5hbWVzIjpbIkxvYWRlclRlc3QiLCJMb2FkZXJUZXN0LmNvbnN0cnVjdG9yIiwiTG9hZGVyVGVzdC5vblBhcnNlQ29tcGxldGUiLCJMb2FkZXJUZXN0Lm9uVGV4dHVyZVNpemVFcnJvciIsIkxvYWRlclRlc3Qub25Bc3NldENvbXBsZXRlIiwiSlNPTlRleHR1cmVQYXJzZXIiLCJKU09OVGV4dHVyZVBhcnNlci5jb25zdHJ1Y3RvciIsIkpTT05UZXh0dXJlUGFyc2VyLnN1cHBvcnRzVHlwZSIsIkpTT05UZXh0dXJlUGFyc2VyLnN1cHBvcnRzRGF0YSIsIkpTT05UZXh0dXJlUGFyc2VyLl9pUmVzb2x2ZURlcGVuZGVuY3kiLCJKU09OVGV4dHVyZVBhcnNlci5faVJlc29sdmVEZXBlbmRlbmN5RmFpbHVyZSIsIkpTT05UZXh0dXJlUGFyc2VyLnBhcnNlSnNvbiIsIkpTT05UZXh0dXJlUGFyc2VyLl9wUHJvY2VlZFBhcnNpbmciXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sVUFBVSxXQUFhLG1DQUFtQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxXQUFXLFdBQWEsb0NBQW9DLENBQUMsQ0FBQztBQUNyRSxJQUFPLE1BQU0sV0FBYyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBRTdELElBQU8sVUFBVSxXQUFhLGdDQUFnQyxDQUFDLENBQUM7QUFDaEUsSUFBTyxVQUFVLFdBQWEsb0NBQW9DLENBQUMsQ0FBQztBQUNwRSxJQUFPLGdCQUFnQixXQUFZLDBDQUEwQyxDQUFDLENBQUM7QUFHL0UsSUFBTSxVQUFVO0lBTWZBLFNBTktBLFVBQVVBO1FBQWhCQyxpQkE4RENBO1FBdERDQSxBQUVBQSx1SEFGdUhBO1FBQ3ZIQSwrRUFBK0VBO1FBQy9FQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBO1FBRXZDQSxBQUdBQSx1SEFIdUhBO1FBQ3ZIQSxzQkFBc0JBO1FBRXRCQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFJQSxJQUFJQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUM3QkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxVQUFVQSxDQUFDQSxjQUFjQSxFQUFFQSxVQUFDQSxLQUFnQkEsSUFBS0EsT0FBQUEsS0FBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBM0JBLENBQTJCQSxDQUFDQSxDQUFDQTtRQUM1R0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxVQUFVQSxDQUFDQSxrQkFBa0JBLEVBQUVBLFVBQUNBLEtBQWdCQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLEtBQUtBLENBQUNBLEVBQTlCQSxDQUE4QkEsQ0FBQ0EsQ0FBQ0E7UUFDbkhBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLFVBQVVBLENBQUNBLHNCQUFzQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFMURBLEFBR0FBLHVIQUh1SEE7UUFDdkhBLDhDQUE4Q0E7UUFFOUNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLE1BQU1BLEVBQUVBLENBQUNBO1FBQ2pDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFVBQVVBLENBQUNBLGNBQWNBLEVBQUVBLFVBQUNBLEtBQWdCQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUEzQkEsQ0FBMkJBLENBQUNBLENBQUNBO1FBQ2pIQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFVBQVVBLENBQUNBLGtCQUFrQkEsRUFBRUEsVUFBQ0EsS0FBZ0JBLElBQUtBLE9BQUFBLEtBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBOUJBLENBQThCQSxDQUFDQSxDQUFDQTtRQUN4SEEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsVUFBVUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFdkRBLEFBR0FBLHVIQUh1SEE7UUFDdkhBLDBCQUEwQkE7UUFFMUJBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLE1BQU1BLEVBQUVBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxnQkFBZ0JBLENBQUVBLFVBQVVBLENBQUNBLGNBQWNBLEVBQUVBLFVBQUNBLEtBQWdCQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUEzQkEsQ0FBMkJBLENBQUNBLENBQUNBO1FBQzVHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxnQkFBZ0JBLENBQUVBLFVBQVVBLENBQUNBLGtCQUFrQkEsRUFBRUEsVUFBQ0EsS0FBZ0JBLElBQUtBLE9BQUFBLEtBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBOUJBLENBQThCQSxDQUFDQSxDQUFDQTtRQUNuSEEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsZ0JBQWdCQSxDQUFFQSxXQUFXQSxDQUFDQSxjQUFjQSxFQUFFQSxVQUFDQSxLQUFpQkEsSUFBS0EsT0FBQUEsS0FBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBM0JBLENBQTJCQSxDQUFDQSxDQUFDQTtRQUM5R0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsVUFBVUEsQ0FBQ0EsMkJBQTJCQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUMvREEsQ0FBQ0E7SUFFTUQsb0NBQWVBLEdBQXRCQSxVQUF1QkEsS0FBaUJBO1FBRXZDRSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSxrRkFBa0ZBLENBQUNBLENBQUNBO1FBQ2pHQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSw0QkFBNEJBLEVBQUdBLEtBQUtBLENBQUVBLENBQUNBO1FBQ3BEQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSxrRkFBa0ZBLENBQUNBLENBQUNBO0lBQ2xHQSxDQUFDQTtJQUVNRix1Q0FBa0JBLEdBQXpCQSxVQUEwQkEsS0FBZ0JBO1FBRXpDRyxJQUFJQSxXQUFXQSxHQUFtQkEsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFL0NBLE9BQU9BLENBQUNBLEdBQUdBLENBQUVBLGtGQUFrRkEsQ0FBQ0EsQ0FBQ0E7UUFDakdBLE9BQU9BLENBQUNBLEdBQUdBLENBQUVBLCtCQUErQkEsRUFBR0EsV0FBV0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsRUFBR0EsS0FBS0EsQ0FBRUEsQ0FBQ0E7UUFDakdBLE9BQU9BLENBQUNBLEdBQUdBLENBQUVBLGtGQUFrRkEsQ0FBQ0EsQ0FBQ0E7SUFDbEdBLENBQUNBO0lBRU1ILG9DQUFlQSxHQUF0QkEsVUFBdUJBLEtBQWdCQTtRQUV0Q0ksSUFBSUEsV0FBV0EsR0FBbUJBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBO1FBRS9DQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSxrRkFBa0ZBLENBQUNBLENBQUNBO1FBQ2pHQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSw0QkFBNEJBLEVBQUVBLFdBQVdBLENBQUNBLGNBQWNBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLEVBQUdBLEtBQUtBLENBQUVBLENBQUNBO1FBQzdGQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSxrRkFBa0ZBLENBQUNBLENBQUNBO0lBQ2xHQSxDQUFDQTtJQUNGSixpQkFBQ0E7QUFBREEsQ0E5REEsQUE4RENBLElBQUE7QUFFRCxBQUtBOzs7O0dBREc7SUFDRyxpQkFBaUI7SUFBU0ssVUFBMUJBLGlCQUFpQkEsVUFBbUJBO0lBWXpDQTs7OztPQUlHQTtJQUNIQSxTQWpCS0EsaUJBQWlCQTtRQW1CckJDLGtCQUFNQSxnQkFBZ0JBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1FBakI1QkEscUJBQWdCQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUM1QkEsc0JBQWlCQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUM3QkEsbUJBQWNBLEdBQVVBLENBQUNBLENBQUNBO1FBRTFCQSxXQUFNQSxHQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUduQkEscUJBQWdCQSxHQUFVQSxDQUFDQSxDQUFDQTtRQVluQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsR0FBR0EsSUFBSUEsS0FBS0EsRUFBaUJBLENBQUNBO1FBQ2xEQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBO0lBQ3JDQSxDQUFDQTtJQUVERDs7OztPQUlHQTtJQUVXQSw4QkFBWUEsR0FBMUJBLFVBQTJCQSxTQUFrQkE7UUFFNUNFLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQ3BDQSxNQUFNQSxDQUFDQSxTQUFTQSxJQUFJQSxNQUFNQSxDQUFDQTtJQUM1QkEsQ0FBQ0E7SUFFREY7Ozs7T0FJR0E7SUFDV0EsOEJBQVlBLEdBQTFCQSxVQUEyQkEsSUFBVUE7UUFFcENHLElBQUFBLENBQUNBO1lBQ0FBLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBRTNCQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQTtnQkFDUEEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFFYkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDZEEsQ0FBRUE7UUFBQUEsS0FBS0EsQ0FBQ0EsQ0FBRUEsQ0FBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDZEEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDZEEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7SUFDZEEsQ0FBQ0E7SUFFREg7O09BRUdBO0lBQ0lBLCtDQUFtQkEsR0FBMUJBLFVBQTJCQSxrQkFBcUNBO1FBRS9ESSxJQUFJQSxRQUFRQSxHQUFtQ0Esa0JBQWtCQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU1RUEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBVUEsUUFBUUEsRUFBRUEsa0JBQWtCQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUV6RUEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsSUFBSUEsQ0FBRUEsUUFBUUEsQ0FBRUEsQ0FBQ0E7UUFFdENBLEFBR0FBLDhFQUg4RUE7UUFDOUVBLCtFQUErRUE7UUFFL0VBLElBQUlBLENBQUNBLGdCQUFnQkEsRUFBRUEsQ0FBQ0E7UUFFeEJBLEVBQUVBLENBQUNBLENBQUVBLElBQUlBLENBQUNBLGdCQUFnQkEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBO0lBQ3BDQSxDQUFDQTtJQUVESjs7T0FFR0E7SUFDSUEsc0RBQTBCQSxHQUFqQ0EsVUFBa0NBLGtCQUFxQ0E7UUFFdEVLLElBQUlBLENBQUNBLGdCQUFnQkEsRUFBRUEsQ0FBQ0E7UUFFeEJBLEVBQUVBLENBQUNBLENBQUVBLElBQUlBLENBQUNBLGdCQUFnQkEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBO0lBQ3BDQSxDQUFDQTtJQUVPTCxxQ0FBU0EsR0FBakJBO1FBRUNNLEVBQUVBLENBQUNBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0NBLElBQUFBLENBQUNBO2dCQUNBQSxJQUFJQSxJQUFJQSxHQUFPQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDckNBLElBQUlBLElBQUlBLEdBQTJCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtnQkFFN0NBLElBQUlBLEdBQU9BLENBQUNBO2dCQUNaQSxJQUFJQSxFQUFhQSxDQUFDQTtnQkFFbEJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQVlBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUdBLEVBQUVBLENBQUNBO29CQUNoREEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBRWRBLElBQUlBLEdBQUdBLEdBQW1CQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQTtvQkFDcENBLElBQUlBLEVBQUVBLEdBQW1CQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtvQkFFaENBLEVBQUVBLEdBQUdBLElBQUlBLFVBQVVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO29CQUV6QkEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsVUFBVUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsS0FBS0EsRUFBRUEsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQzlEQSxDQUFDQTtnQkFFREEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtnQkFDcENBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0E7Z0JBRXJDQSxJQUFJQSxDQUFDQSw4QkFBOEJBLEVBQUVBLENBQUNBO1lBRXZDQSxDQUFFQTtZQUFBQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDWkEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7WUFDbkNBLENBQUNBO1FBQ0ZBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ROOztPQUVHQTtJQUNJQSw0Q0FBZ0JBLEdBQXZCQTtRQUVDTyxPQUFPQSxDQUFDQSxHQUFHQSxDQUFFQSxvQ0FBb0NBLEVBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUVBLENBQUNBO1FBRWxFQSxNQUFNQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQkEsS0FBS0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQTtnQkFDekJBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO2dCQUNqQkEsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7Z0JBQ2hDQSxLQUFLQSxDQUFDQTtZQUNQQSxLQUFLQSxJQUFJQSxDQUFDQSxpQkFBaUJBO2dCQUMxQkEsS0FBS0EsQ0FBQ0E7WUFDUEEsS0FBS0EsSUFBSUEsQ0FBQ0EsY0FBY0E7Z0JBQ3ZCQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxZQUFZQSxDQUFDQTtnQkFDL0JBLEtBQUtBLENBQUNBO1FBQ1JBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLGFBQWFBLENBQUNBO0lBQ2pDQSxDQUFDQTtJQUNGUCx3QkFBQ0E7QUFBREEsQ0E3SUEsQUE2SUNBLEVBN0krQixVQUFVLEVBNkl6QyIsImZpbGUiOiJuZXQvTG9hZGVyVGVzdC5qcyIsInNvdXJjZVJvb3QiOiIuL3Rlc3RzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJpdG1hcEltYWdlMkRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2ltYWdlL0JpdG1hcEltYWdlMkRcIik7XG5pbXBvcnQgQXNzZXRFdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvQXNzZXRFdmVudFwiKTtcbmltcG9ydCBMb2FkZXJFdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvTG9hZGVyRXZlbnRcIik7XG5pbXBvcnQgUGFyc2VyRXZlbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1BhcnNlckV2ZW50XCIpO1xuaW1wb3J0IExvYWRlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvTG9hZGVyXCIpO1xuaW1wb3J0IElBc3NldFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvSUFzc2V0XCIpO1xuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIik7XG5pbXBvcnQgUGFyc2VyQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL1BhcnNlckJhc2VcIik7XG5pbXBvcnQgUGFyc2VyRGF0YUZvcm1hdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcGFyc2Vycy9QYXJzZXJEYXRhRm9ybWF0XCIpO1xuaW1wb3J0IFJlc291cmNlRGVwZW5kZW5jeVx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUmVzb3VyY2VEZXBlbmRlbmN5XCIpO1xuXG5jbGFzcyBMb2FkZXJUZXN0XG57XG5cdHByaXZhdGUgYWxKc29uOkxvYWRlcjtcblx0cHJpdmF0ZSBhbEltYWdlOkxvYWRlcjtcblx0cHJpdmF0ZSBhbEVycm9ySW1hZ2U6TG9hZGVyO1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0Ly8gRW5hYmxlIEN1c3RvbSBQYXJzZXIgKCBKU09OIGZpbGUgZm9ybWF0IHdpdGggbXVsdGlwbGUgdGV4dHVyZSBkZXBlbmRlbmNpZXMgKVxuXHRcdExvYWRlci5lbmFibGVQYXJzZXIoSlNPTlRleHR1cmVQYXJzZXIpO1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBMT0FEIEEgU0lOR0xFIElNQUdFXG5cblx0XHR0aGlzLmFsSW1hZ2UgID0gbmV3IExvYWRlcigpO1xuXHRcdHRoaXMuYWxJbWFnZS5hZGRFdmVudExpc3RlbmVyKEFzc2V0RXZlbnQuQVNTRVRfQ09NUExFVEUsIChldmVudDpBc3NldEV2ZW50KSA9PiB0aGlzLm9uQXNzZXRDb21wbGV0ZShldmVudCkpO1xuXHRcdHRoaXMuYWxJbWFnZS5hZGRFdmVudExpc3RlbmVyKEFzc2V0RXZlbnQuVEVYVFVSRV9TSVpFX0VSUk9SLCAoZXZlbnQ6QXNzZXRFdmVudCkgPT4gdGhpcy5vblRleHR1cmVTaXplRXJyb3IoZXZlbnQpKTtcblx0XHR0aGlzLmFsSW1hZ2UubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzLzEwMjR4MTAyNC5wbmcnKSk7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIExPQUQgQSBTSU5HTEUgSU1BR0UgLSBXaXRoIHdyb25nIGRpbWVuc2lvbnNcblxuXHRcdHRoaXMuYWxFcnJvckltYWdlID0gbmV3IExvYWRlcigpO1xuXHRcdHRoaXMuYWxFcnJvckltYWdlLmFkZEV2ZW50TGlzdGVuZXIoQXNzZXRFdmVudC5BU1NFVF9DT01QTEVURSwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25Bc3NldENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0dGhpcy5hbEVycm9ySW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihBc3NldEV2ZW50LlRFWFRVUkVfU0laRV9FUlJPUiwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25UZXh0dXJlU2l6ZUVycm9yKGV2ZW50KSk7XG5cdFx0dGhpcy5hbEVycm9ySW1hZ2UubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzLzIucG5nJykpO1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBMT0FEIFdJVEggQSBKU09OIFBBUlNFUlxuXG5cdFx0dGhpcy5hbEpzb24gPSBuZXcgTG9hZGVyKCk7XG5cdFx0dGhpcy5hbEpzb24uYWRkRXZlbnRMaXN0ZW5lciggQXNzZXRFdmVudC5BU1NFVF9DT01QTEVURSwgKGV2ZW50OkFzc2V0RXZlbnQpID0+IHRoaXMub25Bc3NldENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0dGhpcy5hbEpzb24uYWRkRXZlbnRMaXN0ZW5lciggQXNzZXRFdmVudC5URVhUVVJFX1NJWkVfRVJST1IsIChldmVudDpBc3NldEV2ZW50KSA9PiB0aGlzLm9uVGV4dHVyZVNpemVFcnJvcihldmVudCkpO1xuXHRcdHRoaXMuYWxKc29uLmFkZEV2ZW50TGlzdGVuZXIoIFBhcnNlckV2ZW50LlBBUlNFX0NPTVBMRVRFLCAoZXZlbnQ6UGFyc2VyRXZlbnQpID0+IHRoaXMub25QYXJzZUNvbXBsZXRlKGV2ZW50KSk7XG5cdFx0dGhpcy5hbEpzb24ubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzL0pTTlBhcnNlclRlc3QuanNvbicpKTtcblx0fVxuXG5cdHB1YmxpYyBvblBhcnNlQ29tcGxldGUoZXZlbnQ6UGFyc2VyRXZlbnQpOnZvaWRcblx0e1xuXHRcdGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0XHRjb25zb2xlLmxvZyggJ0xvYWRlclRlc3Qub25QYXJzZUNvbXBsZXRlJyAsIGV2ZW50ICk7XG5cdFx0Y29uc29sZS5sb2coICctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHR9XG5cblx0cHVibGljIG9uVGV4dHVyZVNpemVFcnJvcihldmVudDpBc3NldEV2ZW50KTp2b2lkXG5cdHtcblx0XHR2YXIgYXNzZXRMb2FkZXI6TG9hZGVyID0gPExvYWRlcj4gZXZlbnQudGFyZ2V0O1xuXG5cdFx0Y29uc29sZS5sb2coICctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHRcdGNvbnNvbGUubG9nKCAnTG9hZGVyVGVzdC5vblRleHR1cmVTaXplRXJyb3InICwgYXNzZXRMb2FkZXIuYmFzZURlcGVuZGVuY3kuX2lMb2FkZXIudXJsICwgZXZlbnQgKTtcblx0XHRjb25zb2xlLmxvZyggJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XG5cdH1cblxuXHRwdWJsaWMgb25Bc3NldENvbXBsZXRlKGV2ZW50OkFzc2V0RXZlbnQpOnZvaWRcblx0e1xuXHRcdHZhciBhc3NldExvYWRlcjpMb2FkZXIgPSA8TG9hZGVyPiBldmVudC50YXJnZXQ7XG5cblx0XHRjb25zb2xlLmxvZyggJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XG5cdFx0Y29uc29sZS5sb2coICdMb2FkZXJUZXN0Lm9uQXNzZXRDb21wbGV0ZScsIGFzc2V0TG9hZGVyLmJhc2VEZXBlbmRlbmN5Ll9pTG9hZGVyLnVybCAsIGV2ZW50ICk7XG5cdFx0Y29uc29sZS5sb2coICctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHR9XG59XG5cbi8qKlxuICogSW1hZ2VQYXJzZXIgcHJvdmlkZXMgYSBcInBhcnNlclwiIGZvciBuYXRpdmVseSBzdXBwb3J0ZWQgaW1hZ2UgdHlwZXMgKGpwZywgcG5nKS4gV2hpbGUgaXQgc2ltcGx5IGxvYWRzIGJ5dGVzIGludG9cbiAqIGEgbG9hZGVyIG9iamVjdCwgaXQgd3JhcHMgaXQgaW4gYSBCaXRtYXBJbWFnZTJEUmVzb3VyY2Ugc28gcmVzb3VyY2UgbWFuYWdlbWVudCBjYW4gaGFwcGVuIGNvbnNpc3RlbnRseSB3aXRob3V0XG4gKiBleGNlcHRpb24gY2FzZXMuXG4gKi9cbmNsYXNzIEpTT05UZXh0dXJlUGFyc2VyIGV4dGVuZHMgUGFyc2VyQmFzZVxue1xuXHRwcml2YXRlIFNUQVRFX1BBUlNFX0RBVEE6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBTVEFURV9MT0FEX0lNQUdFUzpudW1iZXIgPSAxO1xuXHRwcml2YXRlIFNUQVRFX0NPTVBMRVRFOm51bWJlciA9IDI7XG5cblx0cHJpdmF0ZSBfc3RhdGU6bnVtYmVyID0gLTE7XG5cdHByaXZhdGUgX3N0YXJ0ZWRQYXJzaW5nOmJvb2xlYW47XG5cdHByaXZhdGUgX2RvbmVQYXJzaW5nOmJvb2xlYW47XG5cdHByaXZhdGUgX2RlcGVuZGVuY3lDb3VudDpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF9sb2FkZWRUZXh0dXJlczpBcnJheTxCaXRtYXBJbWFnZTJEPjtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBJbWFnZVBhcnNlciBvYmplY3QuXG5cdCAqIEBwYXJhbSB1cmkgVGhlIHVybCBvciBpZCBvZiB0aGUgZGF0YSBvciBmaWxlIHRvIGJlIHBhcnNlZC5cblx0ICogQHBhcmFtIGV4dHJhIFRoZSBob2xkZXIgZm9yIGV4dHJhIGNvbnRleHR1YWwgZGF0YSB0aGF0IHRoZSBwYXJzZXIgbWlnaHQgbmVlZC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHN1cGVyKFBhcnNlckRhdGFGb3JtYXQuUExBSU5fVEVYVCk7XG5cblx0XHR0aGlzLl9sb2FkZWRUZXh0dXJlcyA9IG5ldyBBcnJheTxCaXRtYXBJbWFnZTJEPigpO1xuXHRcdHRoaXMuX3N0YXRlID0gdGhpcy5TVEFURV9QQVJTRV9EQVRBO1xuXHR9XG5cblx0LyoqXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCBhIGdpdmVuIGZpbGUgZXh0ZW5zaW9uIGlzIHN1cHBvcnRlZCBieSB0aGUgcGFyc2VyLlxuXHQgKiBAcGFyYW0gZXh0ZW5zaW9uIFRoZSBmaWxlIGV4dGVuc2lvbiBvZiBhIHBvdGVudGlhbCBmaWxlIHRvIGJlIHBhcnNlZC5cblx0ICogQHJldHVybiBXaGV0aGVyIG9yIG5vdCB0aGUgZ2l2ZW4gZmlsZSB0eXBlIGlzIHN1cHBvcnRlZC5cblx0ICovXG5cblx0cHVibGljIHN0YXRpYyBzdXBwb3J0c1R5cGUoZXh0ZW5zaW9uIDogc3RyaW5nKSA6IGJvb2xlYW5cblx0e1xuXHRcdGV4dGVuc2lvbiA9IGV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuXHRcdHJldHVybiBleHRlbnNpb24gPT0gXCJqc29uXCI7XG5cdH1cblxuXHQvKipcblx0ICogVGVzdHMgd2hldGhlciBhIGRhdGEgYmxvY2sgY2FuIGJlIHBhcnNlZCBieSB0aGUgcGFyc2VyLlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgZGF0YSBibG9jayB0byBwb3RlbnRpYWxseSBiZSBwYXJzZWQuXG5cdCAqIEByZXR1cm4gV2hldGhlciBvciBub3QgdGhlIGdpdmVuIGRhdGEgaXMgc3VwcG9ydGVkLlxuXHQgKi9cblx0cHVibGljIHN0YXRpYyBzdXBwb3J0c0RhdGEoZGF0YSA6IGFueSkgOiBib29sZWFuXG5cdHtcblx0XHR0cnkge1xuXHRcdFx0dmFyIG9iaiA9IEpTT04ucGFyc2UoZGF0YSk7XG5cblx0XHRcdGlmIChvYmopXG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSBjYXRjaCAoIGUgKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lSZXNvbHZlRGVwZW5kZW5jeShyZXNvdXJjZURlcGVuZGVuY3k6UmVzb3VyY2VEZXBlbmRlbmN5KVxuXHR7XG5cdFx0dmFyIHJlc291cmNlIDogQml0bWFwSW1hZ2UyRCA9IDxCaXRtYXBJbWFnZTJEPiByZXNvdXJjZURlcGVuZGVuY3kuYXNzZXRzWzBdO1xuXG5cdFx0dGhpcy5fcEZpbmFsaXplQXNzZXQoPElBc3NldD4gcmVzb3VyY2UsIHJlc291cmNlRGVwZW5kZW5jeS5faUxvYWRlci51cmwpO1xuXG5cdFx0dGhpcy5fbG9hZGVkVGV4dHVyZXMucHVzaCggcmVzb3VyY2UgKTtcblxuXHRcdC8vY29uc29sZS5sb2coICdKU09OVGV4dHVyZVBhcnNlci5faVJlc29sdmVEZXBlbmRlbmN5JyAsIHJlc291cmNlRGVwZW5kZW5jeSApO1xuXHRcdC8vY29uc29sZS5sb2coICdKU09OVGV4dHVyZVBhcnNlci5faVJlc29sdmVEZXBlbmRlbmN5IHJlc291cmNlOiAnICwgcmVzb3VyY2UgKTtcblxuXHRcdHRoaXMuX2RlcGVuZGVuY3lDb3VudC0tO1xuXG5cdFx0aWYgKCB0aGlzLl9kZXBlbmRlbmN5Q291bnQgPT0gMClcblx0XHRcdHRoaXMuX3N0YXRlID0gdGhpcy5TVEFURV9DT01QTEVURTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pUmVzb2x2ZURlcGVuZGVuY3lGYWlsdXJlKHJlc291cmNlRGVwZW5kZW5jeTpSZXNvdXJjZURlcGVuZGVuY3kpXG5cdHtcblx0XHR0aGlzLl9kZXBlbmRlbmN5Q291bnQtLTtcblxuXHRcdGlmICggdGhpcy5fZGVwZW5kZW5jeUNvdW50ID09IDApXG5cdFx0XHR0aGlzLl9zdGF0ZSA9IHRoaXMuU1RBVEVfQ09NUExFVEU7XG5cdH1cblxuXHRwcml2YXRlIHBhcnNlSnNvbiggKSA6IHZvaWRcblx0e1xuXHRcdGlmIChKU09OVGV4dHVyZVBhcnNlci5zdXBwb3J0c0RhdGEodGhpcy5kYXRhKSkge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0dmFyIGpzb246YW55ID0gSlNPTi5wYXJzZSh0aGlzLmRhdGEpO1xuXHRcdFx0XHR2YXIgZGF0YTpBcnJheTxhbnk+ID0gPEFycmF5PGFueT4+IGpzb24uZGF0YTtcblxuXHRcdFx0XHR2YXIgcmVjOmFueTtcblx0XHRcdFx0dmFyIHJxOlVSTFJlcXVlc3Q7XG5cblx0XHRcdFx0Zm9yICh2YXIgYyA6IG51bWJlciA9IDA7IGMgPCBkYXRhLmxlbmd0aDsgYyArKykge1xuXHRcdFx0XHRcdHJlYyA9IGRhdGFbY107XG5cblx0XHRcdFx0XHR2YXIgdXJpOnN0cmluZyA9IDxzdHJpbmc+IHJlYy5pbWFnZTtcblx0XHRcdFx0XHR2YXIgaWQ6c3RyaW5nID0gPHN0cmluZz4gcmVjLmlkO1xuXG5cdFx0XHRcdFx0cnEgPSBuZXcgVVJMUmVxdWVzdCh1cmkpO1xuXG5cdFx0XHRcdFx0dGhpcy5fcEFkZERlcGVuZGVuY3koJ0pTT05fSURfJyArIGlkLCBycSwgZmFsc2UsIG51bGwsIHRydWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fZGVwZW5kZW5jeUNvdW50ID0gZGF0YS5sZW5ndGg7XG5cdFx0XHRcdHRoaXMuX3N0YXRlID0gdGhpcy5TVEFURV9MT0FEX0lNQUdFUztcblxuXHRcdFx0XHR0aGlzLl9wUGF1c2VBbmRSZXRyaWV2ZURlcGVuZGVuY2llcygpO1xuXG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdHRoaXMuX3N0YXRlID0gdGhpcy5TVEFURV9DT01QTEVURTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX3BQcm9jZWVkUGFyc2luZygpIDogYm9vbGVhblxuXHR7XG5cdFx0Y29uc29sZS5sb2coICdKU09OVGV4dHVyZVBhcnNlci5fcFByb2NlZWRQYXJzaW5nJyAsIHRoaXMuX3N0YXRlICk7XG5cblx0XHRzd2l0Y2ggKHRoaXMuX3N0YXRlKSB7XG5cdFx0XHRjYXNlIHRoaXMuU1RBVEVfUEFSU0VfREFUQTpcblx0XHRcdFx0dGhpcy5wYXJzZUpzb24oKTtcblx0XHRcdFx0cmV0dXJuIFBhcnNlckJhc2UuTU9SRV9UT19QQVJTRTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIHRoaXMuU1RBVEVfTE9BRF9JTUFHRVM6XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSB0aGlzLlNUQVRFX0NPTVBMRVRFOlxuXHRcdFx0XHRyZXR1cm4gUGFyc2VyQmFzZS5QQVJTSU5HX0RPTkU7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdHJldHVybiBQYXJzZXJCYXNlLk1PUkVfVE9fUEFSU0U7XG5cdH1cbn0iXX0=