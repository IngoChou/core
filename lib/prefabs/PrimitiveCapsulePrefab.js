var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PrimitivePrefabBase = require("awayjs-core/lib/prefabs/PrimitivePrefabBase");

/**
* A Capsule primitive mesh.
*/
var PrimitiveCapsulePrefab = (function (_super) {
    __extends(PrimitiveCapsulePrefab, _super);
    /**
    * Creates a new Capsule object.
    * @param radius The radius of the capsule.
    * @param height The height of the capsule.
    * @param segmentsW Defines the number of horizontal segments that make up the capsule. Defaults to 16.
    * @param segmentsH Defines the number of vertical segments that make up the capsule. Defaults to 15. Must be uneven value.
    * @param yUp Defines whether the capsule poles should lay on the Y-axis (true) or on the Z-axis (false).
    */
    function PrimitiveCapsulePrefab(radius, height, segmentsW, segmentsH, yUp) {
        if (typeof radius === "undefined") { radius = 50; }
        if (typeof height === "undefined") { height = 100; }
        if (typeof segmentsW === "undefined") { segmentsW = 16; }
        if (typeof segmentsH === "undefined") { segmentsH = 15; }
        if (typeof yUp === "undefined") { yUp = true; }
        _super.call(this);
        this._numVertices = 0;

        this._radius = radius;
        this._height = height;
        this._segmentsW = segmentsW;
        this._segmentsH = (segmentsH % 2 == 0) ? segmentsH + 1 : segmentsH;
        this._yUp = yUp;
    }
    Object.defineProperty(PrimitiveCapsulePrefab.prototype, "radius", {
        /**
        * The radius of the capsule.
        */
        get: function () {
            return this._radius;
        },
        set: function (value) {
            this._radius = value;

            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });


    Object.defineProperty(PrimitiveCapsulePrefab.prototype, "height", {
        /**
        * The height of the capsule.
        */
        get: function () {
            return this._height;
        },
        set: function (value) {
            this._height = value;
            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });


    Object.defineProperty(PrimitiveCapsulePrefab.prototype, "segmentsW", {
        /**
        * Defines the number of horizontal segments that make up the capsule. Defaults to 16.
        */
        get: function () {
            return this._segmentsW;
        },
        set: function (value) {
            this._segmentsW = value;

            this._pInvalidateGeometry();
            this._pInvalidateUVs();
        },
        enumerable: true,
        configurable: true
    });


    Object.defineProperty(PrimitiveCapsulePrefab.prototype, "segmentsH", {
        /**
        * Defines the number of vertical segments that make up the capsule. Defaults to 15. Must be uneven.
        */
        get: function () {
            return this._segmentsH;
        },
        set: function (value) {
            this._segmentsH = (value % 2 == 0) ? value + 1 : value;

            this._pInvalidateGeometry();
            this._pInvalidateUVs();
        },
        enumerable: true,
        configurable: true
    });


    Object.defineProperty(PrimitiveCapsulePrefab.prototype, "yUp", {
        /**
        * Defines whether the capsule poles should lay on the Y-axis (true) or on the Z-axis (false).
        */
        get: function () {
            return this._yUp;
        },
        set: function (value) {
            this._yUp = value;

            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });


    /**
    * @inheritDoc
    */
    PrimitiveCapsulePrefab.prototype._pBuildGeometry = function (target, geometryType) {
        var indices;
        var positions;
        var normals;
        var tangents;

        var i;
        var j;
        var triIndex = 0;
        var index = 0;
        var startIndex;
        var comp1, comp2, t1, t2;
        var numIndices = 0;

        if (geometryType == "triangleSubGeometry") {
            var triangleGeometry = target;

            // evaluate target number of vertices, triangles and indices
            this._numVertices = (this._segmentsH + 1) * (this._segmentsW + 1); // segmentsH + 1 because of closure, segmentsW + 1 because of closure
            numIndices = (this._segmentsH - 1) * this._segmentsW * 6; // each level has segmentH quads, each of 2 triangles

            // need to initialize raw arrays or can be reused?
            if (this._numVertices == triangleGeometry.numVertices) {
                indices = triangleGeometry.indices;
                positions = triangleGeometry.positions;
                normals = triangleGeometry.vertexNormals;
                tangents = triangleGeometry.vertexTangents;
            } else {
                indices = new Array(numIndices);
                positions = new Array(this._numVertices * 3);
                normals = new Array(this._numVertices * 3);
                tangents = new Array(this._numVertices * 3);

                this._pInvalidateUVs();
            }

            for (j = 0; j <= this._segmentsH; ++j) {
                var horangle = Math.PI * j / this._segmentsH;
                var z = -this._radius * Math.cos(horangle);
                var ringradius = this._radius * Math.sin(horangle);

                startIndex = index;

                for (i = 0; i <= this._segmentsW; ++i) {
                    var verangle = 2 * Math.PI * i / this._segmentsW;
                    var x = ringradius * Math.cos(verangle);
                    var offset = j > this._segmentsH / 2 ? this._height / 2 : -this._height / 2;
                    var y = ringradius * Math.sin(verangle);
                    var normLen = 1 / Math.sqrt(x * x + y * y + z * z);
                    var tanLen = Math.sqrt(y * y + x * x);

                    if (this._yUp) {
                        t1 = 0;
                        t2 = tanLen > .007 ? x / tanLen : 0;
                        comp1 = -z;
                        comp2 = y;
                    } else {
                        t1 = tanLen > .007 ? x / tanLen : 0;
                        t2 = 0;
                        comp1 = y;
                        comp2 = z;
                    }

                    if (i == this._segmentsW) {
                        positions[index] = positions[startIndex];
                        positions[index + 1] = positions[startIndex + 1];
                        positions[index + 2] = positions[startIndex + 2];
                        normals[index] = (normals[startIndex] + (x * normLen)) * .5;
                        normals[index + 1] = (normals[startIndex + 1] + (comp1 * normLen)) * .5;
                        normals[index + 2] = (normals[startIndex + 2] + (comp2 * normLen)) * .5;
                        tangents[index] = (tangents[startIndex] + (tanLen > .007 ? -y / tanLen : 1)) * .5;
                        tangents[index + 1] = (tangents[startIndex + 1] + t1) * .5;
                        tangents[index + 2] = (tangents[startIndex + 2] + t2) * .5;
                    } else {
                        // vertex
                        positions[index] = x;
                        positions[index + 1] = (this._yUp) ? comp1 - offset : comp1;
                        positions[index + 2] = (this._yUp) ? comp2 : comp2 + offset;

                        // normal
                        normals[index] = x * normLen;
                        normals[index + 1] = comp1 * normLen;
                        normals[index + 2] = comp2 * normLen;

                        // tangent
                        tangents[index] = tanLen > .007 ? -y / tanLen : 1;
                        tangents[index + 1] = t1;
                        tangents[index + 2] = t2;
                    }

                    if (i > 0 && j > 0) {
                        var a = (this._segmentsW + 1) * j + i;
                        var b = (this._segmentsW + 1) * j + i - 1;
                        var c = (this._segmentsW + 1) * (j - 1) + i - 1;
                        var d = (this._segmentsW + 1) * (j - 1) + i;

                        if (j == this._segmentsH) {
                            positions[index] = positions[startIndex];
                            positions[index + 1] = positions[startIndex + 1];
                            positions[index + 2] = positions[startIndex + 2];

                            indices[triIndex++] = a;
                            indices[triIndex++] = c;
                            indices[triIndex++] = d;
                        } else if (j == 1) {
                            indices[triIndex++] = a;
                            indices[triIndex++] = b;
                            indices[triIndex++] = c;
                        } else {
                            indices[triIndex++] = a;
                            indices[triIndex++] = b;
                            indices[triIndex++] = c;
                            indices[triIndex++] = a;
                            indices[triIndex++] = c;
                            indices[triIndex++] = d;
                        }
                    }

                    index += 3;
                }
            }

            // build real data from raw data
            triangleGeometry.updateIndices(indices);

            triangleGeometry.updatePositions(positions);
            triangleGeometry.updateVertexNormals(normals);
            triangleGeometry.updateVertexTangents(tangents);
        } else if (geometryType == "lineSubGeometry") {
            //TODO
        }
    };

    /**
    * @inheritDoc
    */
    PrimitiveCapsulePrefab.prototype._pBuildUVs = function (target, geometryType) {
        var i, j;
        var uvs;

        if (geometryType == "triangleSubGeometry") {
            var triangleGeometry = target;

            // need to initialize raw array or can be reused?
            if (triangleGeometry.uvs && this._numVertices == triangleGeometry.numVertices) {
                uvs = triangleGeometry.uvs;
            } else {
                uvs = new Array(this._numVertices * 2);
            }

            // current uv component index
            var index = 0;

            for (j = 0; j <= this._segmentsH; ++j) {
                for (i = 0; i <= this._segmentsW; ++i) {
                    // revolution vertex
                    uvs[index++] = (i / this._segmentsW) * triangleGeometry.scaleU;
                    uvs[index++] = (j / this._segmentsH) * triangleGeometry.scaleV;
                }
            }

            // build real data from raw data
            triangleGeometry.updateUVs(uvs);
        } else if (geometryType == "lineSubGeometry") {
            //nothing to do here
        }
    };
    return PrimitiveCapsulePrefab;
})(PrimitivePrefabBase);

module.exports = PrimitiveCapsulePrefab;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByZWZhYnMvUHJpbWl0aXZlQ2Fwc3VsZVByZWZhYi50cyJdLCJuYW1lcyI6WyJQcmltaXRpdmVDYXBzdWxlUHJlZmFiIiwiUHJpbWl0aXZlQ2Fwc3VsZVByZWZhYi5jb25zdHJ1Y3RvciIsIlByaW1pdGl2ZUNhcHN1bGVQcmVmYWIuX3BCdWlsZEdlb21ldHJ5IiwiUHJpbWl0aXZlQ2Fwc3VsZVByZWZhYi5fcEJ1aWxkVVZzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxnRkFJcUY7O0FBRXJGOztFQUVHO0FBQ0g7SUFBcUNBLHlDQUFtQkE7SUE2RnZEQTs7Ozs7OztNQURHQTtJQUNIQSxnQ0FBWUEsTUFBa0JBLEVBQUVBLE1BQW1CQSxFQUFFQSxTQUFxQkEsRUFBRUEsU0FBcUJBLEVBQUVBLEdBQWtCQTtRQUF6R0MscUNBQUFBLE1BQU1BLEdBQVVBLEVBQUVBO0FBQUFBLFFBQUVBLHFDQUFBQSxNQUFNQSxHQUFVQSxHQUFHQTtBQUFBQSxRQUFFQSx3Q0FBQUEsU0FBU0EsR0FBVUEsRUFBRUE7QUFBQUEsUUFBRUEsd0NBQUFBLFNBQVNBLEdBQVVBLEVBQUVBO0FBQUFBLFFBQUVBLGtDQUFBQSxHQUFHQSxHQUFXQSxJQUFJQTtBQUFBQSxRQUVwSEEsV0FBTUEsS0FBQUEsQ0FBQ0E7UUF4RlJBLEtBQVFBLFlBQVlBLEdBQVVBLENBQUNBLENBQUNBOztRQTBGL0JBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE1BQU1BO1FBQ3JCQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxNQUFNQTtRQUNyQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsU0FBU0E7UUFDM0JBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLFNBQVNBLEdBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUVBLFNBQVNBLEdBQUdBLENBQUNBLEdBQUdBLFNBQVNBO1FBQy9EQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxHQUFHQTtJQUNoQkEsQ0FBQ0E7SUExRkREO1FBQUFBOztV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QUNBO3FCQUVUQSxLQUFNQTt3QkFDTkEsRUFBRUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBRUEsQ0FBQ0EsR0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0E7d0JBQ2hDQSxFQUFFQSxHQUFHQSxDQUFDQTt3QkFDTkEsS0FBS0EsR0FBR0EsQ0FBQ0E7d0JBQ1RBLEtBQUtBLEdBQUdBLENBQUNBO3FCQUNUQTs7b0JBRURBLElBQUlBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFVBQVVBLENBQUVBO3dCQUV6QkEsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsU0FBU0EsQ0FBQ0EsVUFBVUEsQ0FBQ0E7d0JBQ3hDQSxTQUFTQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxTQUFTQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQTt3QkFDaERBLFNBQVNBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFNBQVNBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBO3dCQUNoREEsT0FBT0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUE7d0JBQ3ZEQSxPQUFPQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFFQSxLQUFLQSxHQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxHQUFDQSxFQUFFQTt3QkFDcEVBLE9BQU9BLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE9BQU9BLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLEdBQUNBLE9BQU9BLENBQUNBLENBQUNBLEdBQUNBLEVBQUVBO3dCQUNuRUEsUUFBUUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBRUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUE7d0JBQzVFQSxRQUFRQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxRQUFRQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFDQSxFQUFFQTt3QkFDeERBLFFBQVFBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUNBLEVBQUVBO3FCQUV4REEsS0FBTUE7d0JBQ05BLFNBQVNBO3dCQUNUQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQTt3QkFDcEJBLFNBQVNBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEdBQUVBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBO3dCQUMxREEsU0FBU0EsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBRUEsS0FBS0EsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUE7O3dCQUMxREEsU0FBU0E7d0JBQ1RBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE9BQU9BO3dCQUMxQkEsT0FBT0EsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsR0FBQ0EsT0FBT0E7d0JBQ2xDQSxPQUFPQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxHQUFDQSxPQUFPQTs7d0JBQ2xDQSxVQUFVQTt3QkFDVkEsUUFBUUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBRUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0E7d0JBQzlDQSxRQUFRQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQTt3QkFDeEJBLFFBQVFBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBO3FCQUN4QkE7O29CQUVEQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFFQTt3QkFDbkJBLElBQUlBLENBQUNBLEdBQVVBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLENBQUNBO3dCQUMxQ0EsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7d0JBQzlDQSxJQUFJQSxDQUFDQSxHQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQTt3QkFDcERBLElBQUlBLENBQUNBLEdBQVVBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBOzt3QkFFaERBLElBQUlBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFVBQVVBLENBQUVBOzRCQUN6QkEsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsU0FBU0EsQ0FBQ0EsVUFBVUEsQ0FBQ0E7NEJBQ3hDQSxTQUFTQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxTQUFTQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQTs0QkFDaERBLFNBQVNBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFNBQVNBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBOzs0QkFFaERBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBOzRCQUN2QkEsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7NEJBQ3ZCQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQTt5QkFFdkJBLE1BQU1BLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUVBOzRCQUNsQkEsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7NEJBQ3ZCQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQTs0QkFDdkJBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBO3lCQUV2QkEsS0FBTUE7NEJBQ05BLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBOzRCQUN2QkEsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7NEJBQ3ZCQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQTs0QkFDdkJBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBOzRCQUN2QkEsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7NEJBQ3ZCQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQTt5QkFDdkJBO3FCQUNEQTs7b0JBRURBLEtBQUtBLElBQUlBLENBQUNBO2lCQUNWQTthQUNEQTs7WUFFREEsZ0NBQWdDQTtZQUNoQ0EsZ0JBQWdCQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQTs7WUFFdkNBLGdCQUFnQkEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsU0FBU0EsQ0FBQ0E7WUFDM0NBLGdCQUFnQkEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxPQUFPQSxDQUFDQTtZQUM3Q0EsZ0JBQWdCQSxDQUFDQSxvQkFBb0JBLENBQUNBLFFBQVFBLENBQUNBO1NBRS9DQSxNQUFNQSxJQUFJQSxZQUFZQSxJQUFJQSxpQkFBaUJBLENBQUVBO1lBQzdDQSxNQUFNQTtTQUNOQTtJQUNGQSxDQUFDQTs7SUFLREY7O01BREdBO2tEQUNIQSxVQUFrQkEsTUFBc0JBLEVBQUVBLFlBQW1CQTtRQUU1REcsSUFBSUEsQ0FBQ0EsRUFBU0EsQ0FBQ0E7UUFDZkEsSUFBSUEsR0FBR0E7O1FBR1BBLElBQUlBLFlBQVlBLElBQUlBLHFCQUFxQkEsQ0FBRUE7WUFFMUNBLElBQUlBLGdCQUFnQkEsR0FBNkNBLE1BQU1BOztZQUV2RUEsaURBQWlEQTtZQUNqREEsSUFBSUEsZ0JBQWdCQSxDQUFDQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxZQUFZQSxJQUFJQSxnQkFBZ0JBLENBQUNBLFdBQVdBLENBQUVBO2dCQUM5RUEsR0FBR0EsR0FBR0EsZ0JBQWdCQSxDQUFDQSxHQUFHQTthQUMxQkEsS0FBTUE7Z0JBQ05BLEdBQUdBLEdBQUdBLElBQUlBLEtBQUtBLENBQVNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUNBLENBQUNBLENBQUNBO2FBQzVDQTs7WUFFREEsNkJBQTZCQTtZQUM3QkEsSUFBSUEsS0FBS0EsR0FBVUEsQ0FBQ0E7O1lBR3BCQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxVQUFVQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFFQTtnQkFDdENBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUVBO29CQUN0Q0Esb0JBQW9CQTtvQkFDcEJBLEdBQUdBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLEdBQUdBLENBQUVBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUVBLEdBQUNBLGdCQUFnQkEsQ0FBQ0EsTUFBTUE7b0JBQzVEQSxHQUFHQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFFQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFFQSxHQUFDQSxnQkFBZ0JBLENBQUNBLE1BQU1BO2lCQUM1REE7YUFDREE7O1lBRURBLGdDQUFnQ0E7WUFDaENBLGdCQUFnQkEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7U0FFL0JBLE1BQU1BLElBQUlBLFlBQVlBLElBQUlBLGlCQUFpQkEsQ0FBRUE7WUFDN0NBLG9CQUFvQkE7U0FDcEJBO0lBQ0ZBLENBQUNBO0lBQ0ZILDhCQUFDQTtBQUFEQSxDQUFDQSxFQTlSb0MsbUJBQW1CLEVBOFJ2RDs7QUFFRCx1Q0FBZ0MsQ0FBQSIsImZpbGUiOiJwcmVmYWJzL1ByaW1pdGl2ZUNhcHN1bGVQcmVmYWIuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtY29yZS8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTGluZVN1Ykdlb21ldHJ5XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvYmFzZS9MaW5lU3ViR2VvbWV0cnlcIik7XG5pbXBvcnQgU3ViR2VvbWV0cnlCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvYmFzZS9TdWJHZW9tZXRyeUJhc2VcIik7XG5pbXBvcnQgVHJpYW5nbGVTdWJHZW9tZXRyeVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9iYXNlL1RyaWFuZ2xlU3ViR2VvbWV0cnlcIik7XG5pbXBvcnQgSUFzc2V0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2xpYnJhcnkvSUFzc2V0XCIpO1xuaW1wb3J0IFByaW1pdGl2ZVByZWZhYkJhc2VcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3ByZWZhYnMvUHJpbWl0aXZlUHJlZmFiQmFzZVwiKTtcblxuLyoqXG4gKiBBIENhcHN1bGUgcHJpbWl0aXZlIG1lc2guXG4gKi9cbmNsYXNzIFByaW1pdGl2ZUNhcHN1bGVQcmVmYWIgZXh0ZW5kcyBQcmltaXRpdmVQcmVmYWJCYXNlIGltcGxlbWVudHMgSUFzc2V0XG57XG5cdHByaXZhdGUgX3JhZGl1czpudW1iZXI7XG5cdHByaXZhdGUgX2hlaWdodDpudW1iZXI7XG5cdHByaXZhdGUgX3NlZ21lbnRzVzpudW1iZXI7XG5cdHByaXZhdGUgX3NlZ21lbnRzSDpudW1iZXI7XG5cdHByaXZhdGUgX3lVcDpib29sZWFuO1xuXHRwcml2YXRlIF9udW1WZXJ0aWNlczpudW1iZXIgPSAwO1xuXG5cdC8qKlxuXHQgKiBUaGUgcmFkaXVzIG9mIHRoZSBjYXBzdWxlLlxuXHQgKi9cblx0cHVibGljIGdldCByYWRpdXMoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9yYWRpdXM7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHJhZGl1cyh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHR0aGlzLl9yYWRpdXMgPSB2YWx1ZTtcblxuXHRcdHRoaXMuX3BJbnZhbGlkYXRlR2VvbWV0cnkoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBUaGUgaGVpZ2h0IG9mIHRoZSBjYXBzdWxlLlxuXHQgKi9cblx0cHVibGljIGdldCBoZWlnaHQoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9oZWlnaHQ7XG5cdH1cblxuXHRwdWJsaWMgc2V0IGhlaWdodCh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHR0aGlzLl9oZWlnaHQgPSB2YWx1ZTtcblx0XHR0aGlzLl9wSW52YWxpZGF0ZUdlb21ldHJ5KCk7XG5cdH1cblxuXHQvKipcblx0ICogRGVmaW5lcyB0aGUgbnVtYmVyIG9mIGhvcml6b250YWwgc2VnbWVudHMgdGhhdCBtYWtlIHVwIHRoZSBjYXBzdWxlLiBEZWZhdWx0cyB0byAxNi5cblx0ICovXG5cdHB1YmxpYyBnZXQgc2VnbWVudHNXKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fc2VnbWVudHNXO1xuXHR9XG5cblx0cHVibGljIHNldCBzZWdtZW50c1codmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0dGhpcy5fc2VnbWVudHNXID0gdmFsdWU7XG5cblx0XHR0aGlzLl9wSW52YWxpZGF0ZUdlb21ldHJ5KCk7XG5cdFx0dGhpcy5fcEludmFsaWRhdGVVVnMoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEZWZpbmVzIHRoZSBudW1iZXIgb2YgdmVydGljYWwgc2VnbWVudHMgdGhhdCBtYWtlIHVwIHRoZSBjYXBzdWxlLiBEZWZhdWx0cyB0byAxNS4gTXVzdCBiZSB1bmV2ZW4uXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IHNlZ21lbnRzSCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3NlZ21lbnRzSDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgc2VnbWVudHNIKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdHRoaXMuX3NlZ21lbnRzSCA9ICh2YWx1ZSUyID09IDApPyB2YWx1ZSArIDEgOiB2YWx1ZTtcblxuXHRcdHRoaXMuX3BJbnZhbGlkYXRlR2VvbWV0cnkoKTtcblx0XHR0aGlzLl9wSW52YWxpZGF0ZVVWcygpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERlZmluZXMgd2hldGhlciB0aGUgY2Fwc3VsZSBwb2xlcyBzaG91bGQgbGF5IG9uIHRoZSBZLWF4aXMgKHRydWUpIG9yIG9uIHRoZSBaLWF4aXMgKGZhbHNlKS5cblx0ICovXG5cdHB1YmxpYyBnZXQgeVVwKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3lVcDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgeVVwKHZhbHVlOmJvb2xlYW4pXG5cdHtcblx0XHR0aGlzLl95VXAgPSB2YWx1ZTtcblxuXHRcdHRoaXMuX3BJbnZhbGlkYXRlR2VvbWV0cnkoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IENhcHN1bGUgb2JqZWN0LlxuXHQgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIGNhcHN1bGUuXG5cdCAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgY2Fwc3VsZS5cblx0ICogQHBhcmFtIHNlZ21lbnRzVyBEZWZpbmVzIHRoZSBudW1iZXIgb2YgaG9yaXpvbnRhbCBzZWdtZW50cyB0aGF0IG1ha2UgdXAgdGhlIGNhcHN1bGUuIERlZmF1bHRzIHRvIDE2LlxuXHQgKiBAcGFyYW0gc2VnbWVudHNIIERlZmluZXMgdGhlIG51bWJlciBvZiB2ZXJ0aWNhbCBzZWdtZW50cyB0aGF0IG1ha2UgdXAgdGhlIGNhcHN1bGUuIERlZmF1bHRzIHRvIDE1LiBNdXN0IGJlIHVuZXZlbiB2YWx1ZS5cblx0ICogQHBhcmFtIHlVcCBEZWZpbmVzIHdoZXRoZXIgdGhlIGNhcHN1bGUgcG9sZXMgc2hvdWxkIGxheSBvbiB0aGUgWS1heGlzICh0cnVlKSBvciBvbiB0aGUgWi1heGlzIChmYWxzZSkuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcihyYWRpdXM6bnVtYmVyID0gNTAsIGhlaWdodDpudW1iZXIgPSAxMDAsIHNlZ21lbnRzVzpudW1iZXIgPSAxNiwgc2VnbWVudHNIOm51bWJlciA9IDE1LCB5VXA6Ym9vbGVhbiA9IHRydWUpXG5cdHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5fcmFkaXVzID0gcmFkaXVzO1xuXHRcdHRoaXMuX2hlaWdodCA9IGhlaWdodDtcblx0XHR0aGlzLl9zZWdtZW50c1cgPSBzZWdtZW50c1c7XG5cdFx0dGhpcy5fc2VnbWVudHNIID0gKHNlZ21lbnRzSCUyID09IDApPyBzZWdtZW50c0ggKyAxIDogc2VnbWVudHNIO1xuXHRcdHRoaXMuX3lVcCA9IHlVcDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9wQnVpbGRHZW9tZXRyeSh0YXJnZXQ6U3ViR2VvbWV0cnlCYXNlLCBnZW9tZXRyeVR5cGU6c3RyaW5nKVxuXHR7XG5cdFx0dmFyIGluZGljZXM6QXJyYXk8bnVtYmVyPiAvKnVpbnQqLztcblx0XHR2YXIgcG9zaXRpb25zOkFycmF5PG51bWJlcj47XG5cdFx0dmFyIG5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcblx0XHR2YXIgdGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcblxuXHRcdHZhciBpOm51bWJlcjtcblx0XHR2YXIgajpudW1iZXI7XG5cdFx0dmFyIHRyaUluZGV4Om51bWJlciA9IDA7XG5cdFx0dmFyIGluZGV4Om51bWJlciA9IDA7XG5cdFx0dmFyIHN0YXJ0SW5kZXg6bnVtYmVyO1xuXHRcdHZhciBjb21wMTpudW1iZXIsIGNvbXAyOm51bWJlciwgdDE6bnVtYmVyLCB0MjpudW1iZXI7XG5cdFx0dmFyIG51bUluZGljZXM6bnVtYmVyID0gMDtcblxuXHRcdGlmIChnZW9tZXRyeVR5cGUgPT0gXCJ0cmlhbmdsZVN1Ykdlb21ldHJ5XCIpIHtcblxuXHRcdFx0dmFyIHRyaWFuZ2xlR2VvbWV0cnk6VHJpYW5nbGVTdWJHZW9tZXRyeSA9IDxUcmlhbmdsZVN1Ykdlb21ldHJ5PiB0YXJnZXQ7XG5cblx0XHRcdC8vIGV2YWx1YXRlIHRhcmdldCBudW1iZXIgb2YgdmVydGljZXMsIHRyaWFuZ2xlcyBhbmQgaW5kaWNlc1xuXHRcdFx0dGhpcy5fbnVtVmVydGljZXMgPSAodGhpcy5fc2VnbWVudHNIICsgMSkqKHRoaXMuX3NlZ21lbnRzVyArIDEpOyAvLyBzZWdtZW50c0ggKyAxIGJlY2F1c2Ugb2YgY2xvc3VyZSwgc2VnbWVudHNXICsgMSBiZWNhdXNlIG9mIGNsb3N1cmVcblx0XHRcdG51bUluZGljZXMgPSAodGhpcy5fc2VnbWVudHNIIC0gMSkqdGhpcy5fc2VnbWVudHNXKjY7IC8vIGVhY2ggbGV2ZWwgaGFzIHNlZ21lbnRIIHF1YWRzLCBlYWNoIG9mIDIgdHJpYW5nbGVzXG5cblx0XHRcdC8vIG5lZWQgdG8gaW5pdGlhbGl6ZSByYXcgYXJyYXlzIG9yIGNhbiBiZSByZXVzZWQ/XG5cdFx0XHRpZiAodGhpcy5fbnVtVmVydGljZXMgPT0gdHJpYW5nbGVHZW9tZXRyeS5udW1WZXJ0aWNlcykge1xuXHRcdFx0XHRpbmRpY2VzID0gdHJpYW5nbGVHZW9tZXRyeS5pbmRpY2VzO1xuXHRcdFx0XHRwb3NpdGlvbnMgPSB0cmlhbmdsZUdlb21ldHJ5LnBvc2l0aW9ucztcblx0XHRcdFx0bm9ybWFscyA9IHRyaWFuZ2xlR2VvbWV0cnkudmVydGV4Tm9ybWFscztcblx0XHRcdFx0dGFuZ2VudHMgPSB0cmlhbmdsZUdlb21ldHJ5LnZlcnRleFRhbmdlbnRzO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aW5kaWNlcyA9IG5ldyBBcnJheTxudW1iZXI+KG51bUluZGljZXMpXG5cdFx0XHRcdHBvc2l0aW9ucyA9IG5ldyBBcnJheTxudW1iZXI+KHRoaXMuX251bVZlcnRpY2VzKjMpO1xuXHRcdFx0XHRub3JtYWxzID0gbmV3IEFycmF5PG51bWJlcj4odGhpcy5fbnVtVmVydGljZXMqMyk7XG5cdFx0XHRcdHRhbmdlbnRzID0gbmV3IEFycmF5PG51bWJlcj4odGhpcy5fbnVtVmVydGljZXMqMyk7XG5cblx0XHRcdFx0dGhpcy5fcEludmFsaWRhdGVVVnMoKTtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChqID0gMDsgaiA8PSB0aGlzLl9zZWdtZW50c0g7ICsraikge1xuXG5cdFx0XHRcdHZhciBob3JhbmdsZTpudW1iZXIgPSBNYXRoLlBJKmovdGhpcy5fc2VnbWVudHNIO1xuXHRcdFx0XHR2YXIgejpudW1iZXIgPSAtdGhpcy5fcmFkaXVzKk1hdGguY29zKGhvcmFuZ2xlKTtcblx0XHRcdFx0dmFyIHJpbmdyYWRpdXM6bnVtYmVyID0gdGhpcy5fcmFkaXVzKk1hdGguc2luKGhvcmFuZ2xlKTtcblxuXHRcdFx0XHRzdGFydEluZGV4ID0gaW5kZXg7XG5cblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8PSB0aGlzLl9zZWdtZW50c1c7ICsraSkge1xuXHRcdFx0XHRcdHZhciB2ZXJhbmdsZTpudW1iZXIgPSAyKk1hdGguUEkqaS90aGlzLl9zZWdtZW50c1c7XG5cdFx0XHRcdFx0dmFyIHg6bnVtYmVyID0gcmluZ3JhZGl1cypNYXRoLmNvcyh2ZXJhbmdsZSk7XG5cdFx0XHRcdFx0dmFyIG9mZnNldDpudW1iZXIgPSBqID4gdGhpcy5fc2VnbWVudHNILzI/IHRoaXMuX2hlaWdodC8yIDogLXRoaXMuX2hlaWdodC8yO1xuXHRcdFx0XHRcdHZhciB5Om51bWJlciA9IHJpbmdyYWRpdXMqTWF0aC5zaW4odmVyYW5nbGUpO1xuXHRcdFx0XHRcdHZhciBub3JtTGVuOm51bWJlciA9IDEvTWF0aC5zcXJ0KHgqeCArIHkqeSArIHoqeik7XG5cdFx0XHRcdFx0dmFyIHRhbkxlbjpudW1iZXIgPSBNYXRoLnNxcnQoeSp5ICsgeCp4KTtcblxuXHRcdFx0XHRcdGlmICh0aGlzLl95VXApIHtcblx0XHRcdFx0XHRcdHQxID0gMDtcblx0XHRcdFx0XHRcdHQyID0gdGFuTGVuID4gLjAwNz8geC90YW5MZW4gOiAwO1xuXHRcdFx0XHRcdFx0Y29tcDEgPSAtejtcblx0XHRcdFx0XHRcdGNvbXAyID0geTtcblxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0MSA9IHRhbkxlbiA+IC4wMDc/IHgvdGFuTGVuIDogMDtcblx0XHRcdFx0XHRcdHQyID0gMDtcblx0XHRcdFx0XHRcdGNvbXAxID0geTtcblx0XHRcdFx0XHRcdGNvbXAyID0gejtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoaSA9PSB0aGlzLl9zZWdtZW50c1cpIHtcblxuXHRcdFx0XHRcdFx0cG9zaXRpb25zW2luZGV4XSA9IHBvc2l0aW9uc1tzdGFydEluZGV4XTtcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1tpbmRleCArIDFdID0gcG9zaXRpb25zW3N0YXJ0SW5kZXggKyAxXTtcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1tpbmRleCArIDJdID0gcG9zaXRpb25zW3N0YXJ0SW5kZXggKyAyXTtcblx0XHRcdFx0XHRcdG5vcm1hbHNbaW5kZXhdID0gKG5vcm1hbHNbc3RhcnRJbmRleF0gKyAoeCpub3JtTGVuKSkqLjU7XG5cdFx0XHRcdFx0XHRub3JtYWxzW2luZGV4ICsgMV0gPSAobm9ybWFsc1tzdGFydEluZGV4ICsgMV0gKyAoIGNvbXAxKm5vcm1MZW4pKSouNTtcblx0XHRcdFx0XHRcdG5vcm1hbHNbaW5kZXggKyAyXSA9IChub3JtYWxzW3N0YXJ0SW5kZXggKyAyXSArIChjb21wMipub3JtTGVuKSkqLjU7XG5cdFx0XHRcdFx0XHR0YW5nZW50c1tpbmRleF0gPSAodGFuZ2VudHNbc3RhcnRJbmRleF0gKyAodGFuTGVuID4gLjAwNz8gLXkvdGFuTGVuIDogMSkpKi41O1xuXHRcdFx0XHRcdFx0dGFuZ2VudHNbaW5kZXggKyAxXSA9ICh0YW5nZW50c1tzdGFydEluZGV4ICsgMV0gKyB0MSkqLjU7XG5cdFx0XHRcdFx0XHR0YW5nZW50c1tpbmRleCArIDJdID0gKHRhbmdlbnRzW3N0YXJ0SW5kZXggKyAyXSArIHQyKSouNTtcblxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyB2ZXJ0ZXhcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1tpbmRleF0gPSB4O1xuXHRcdFx0XHRcdFx0cG9zaXRpb25zW2luZGV4ICsgMV0gPSAodGhpcy5feVVwKT8gY29tcDEgLSBvZmZzZXQgOiBjb21wMTtcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1tpbmRleCArIDJdID0gKHRoaXMuX3lVcCk/IGNvbXAyIDogY29tcDIgKyBvZmZzZXQ7XG5cdFx0XHRcdFx0XHQvLyBub3JtYWxcblx0XHRcdFx0XHRcdG5vcm1hbHNbaW5kZXhdID0geCpub3JtTGVuO1xuXHRcdFx0XHRcdFx0bm9ybWFsc1tpbmRleCArIDFdID0gY29tcDEqbm9ybUxlbjtcblx0XHRcdFx0XHRcdG5vcm1hbHNbaW5kZXggKyAyXSA9IGNvbXAyKm5vcm1MZW47XG5cdFx0XHRcdFx0XHQvLyB0YW5nZW50XG5cdFx0XHRcdFx0XHR0YW5nZW50c1tpbmRleF0gPSB0YW5MZW4gPiAuMDA3PyAteS90YW5MZW4gOiAxO1xuXHRcdFx0XHRcdFx0dGFuZ2VudHNbaW5kZXggKyAxXSA9IHQxO1xuXHRcdFx0XHRcdFx0dGFuZ2VudHNbaW5kZXggKyAyXSA9IHQyO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChpID4gMCAmJiBqID4gMCkge1xuXHRcdFx0XHRcdFx0dmFyIGE6bnVtYmVyID0gKHRoaXMuX3NlZ21lbnRzVyArIDEpKmogKyBpO1xuXHRcdFx0XHRcdFx0dmFyIGI6bnVtYmVyID0gKHRoaXMuX3NlZ21lbnRzVyArIDEpKmogKyBpIC0gMTtcblx0XHRcdFx0XHRcdHZhciBjOm51bWJlciA9ICh0aGlzLl9zZWdtZW50c1cgKyAxKSooaiAtIDEpICsgaSAtIDE7XG5cdFx0XHRcdFx0XHR2YXIgZDpudW1iZXIgPSAodGhpcy5fc2VnbWVudHNXICsgMSkqKGogLSAxKSArIGk7XG5cblx0XHRcdFx0XHRcdGlmIChqID09IHRoaXMuX3NlZ21lbnRzSCkge1xuXHRcdFx0XHRcdFx0XHRwb3NpdGlvbnNbaW5kZXhdID0gcG9zaXRpb25zW3N0YXJ0SW5kZXhdO1xuXHRcdFx0XHRcdFx0XHRwb3NpdGlvbnNbaW5kZXggKyAxXSA9IHBvc2l0aW9uc1tzdGFydEluZGV4ICsgMV07XG5cdFx0XHRcdFx0XHRcdHBvc2l0aW9uc1tpbmRleCArIDJdID0gcG9zaXRpb25zW3N0YXJ0SW5kZXggKyAyXTtcblxuXHRcdFx0XHRcdFx0XHRpbmRpY2VzW3RyaUluZGV4KytdID0gYTtcblx0XHRcdFx0XHRcdFx0aW5kaWNlc1t0cmlJbmRleCsrXSA9IGM7XG5cdFx0XHRcdFx0XHRcdGluZGljZXNbdHJpSW5kZXgrK10gPSBkO1xuXG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKGogPT0gMSkge1xuXHRcdFx0XHRcdFx0XHRpbmRpY2VzW3RyaUluZGV4KytdID0gYTtcblx0XHRcdFx0XHRcdFx0aW5kaWNlc1t0cmlJbmRleCsrXSA9IGI7XG5cdFx0XHRcdFx0XHRcdGluZGljZXNbdHJpSW5kZXgrK10gPSBjO1xuXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpbmRpY2VzW3RyaUluZGV4KytdID0gYTtcblx0XHRcdFx0XHRcdFx0aW5kaWNlc1t0cmlJbmRleCsrXSA9IGI7XG5cdFx0XHRcdFx0XHRcdGluZGljZXNbdHJpSW5kZXgrK10gPSBjO1xuXHRcdFx0XHRcdFx0XHRpbmRpY2VzW3RyaUluZGV4KytdID0gYTtcblx0XHRcdFx0XHRcdFx0aW5kaWNlc1t0cmlJbmRleCsrXSA9IGM7XG5cdFx0XHRcdFx0XHRcdGluZGljZXNbdHJpSW5kZXgrK10gPSBkO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGluZGV4ICs9IDM7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gYnVpbGQgcmVhbCBkYXRhIGZyb20gcmF3IGRhdGFcblx0XHRcdHRyaWFuZ2xlR2VvbWV0cnkudXBkYXRlSW5kaWNlcyhpbmRpY2VzKTtcblxuXHRcdFx0dHJpYW5nbGVHZW9tZXRyeS51cGRhdGVQb3NpdGlvbnMocG9zaXRpb25zKTtcblx0XHRcdHRyaWFuZ2xlR2VvbWV0cnkudXBkYXRlVmVydGV4Tm9ybWFscyhub3JtYWxzKTtcblx0XHRcdHRyaWFuZ2xlR2VvbWV0cnkudXBkYXRlVmVydGV4VGFuZ2VudHModGFuZ2VudHMpO1xuXG5cdFx0fSBlbHNlIGlmIChnZW9tZXRyeVR5cGUgPT0gXCJsaW5lU3ViR2VvbWV0cnlcIikge1xuXHRcdFx0Ly9UT0RPXG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX3BCdWlsZFVWcyh0YXJnZXQ6U3ViR2VvbWV0cnlCYXNlLCBnZW9tZXRyeVR5cGU6c3RyaW5nKVxuXHR7XG5cdFx0dmFyIGk6bnVtYmVyLCBqOm51bWJlcjtcblx0XHR2YXIgdXZzOkFycmF5PG51bWJlcj47XG5cblxuXHRcdGlmIChnZW9tZXRyeVR5cGUgPT0gXCJ0cmlhbmdsZVN1Ykdlb21ldHJ5XCIpIHtcblxuXHRcdFx0dmFyIHRyaWFuZ2xlR2VvbWV0cnk6VHJpYW5nbGVTdWJHZW9tZXRyeSA9IDxUcmlhbmdsZVN1Ykdlb21ldHJ5PiB0YXJnZXQ7XG5cblx0XHRcdC8vIG5lZWQgdG8gaW5pdGlhbGl6ZSByYXcgYXJyYXkgb3IgY2FuIGJlIHJldXNlZD9cblx0XHRcdGlmICh0cmlhbmdsZUdlb21ldHJ5LnV2cyAmJiB0aGlzLl9udW1WZXJ0aWNlcyA9PSB0cmlhbmdsZUdlb21ldHJ5Lm51bVZlcnRpY2VzKSB7XG5cdFx0XHRcdHV2cyA9IHRyaWFuZ2xlR2VvbWV0cnkudXZzO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dXZzID0gbmV3IEFycmF5PG51bWJlcj4odGhpcy5fbnVtVmVydGljZXMqMik7XG5cdFx0XHR9XG5cblx0XHRcdC8vIGN1cnJlbnQgdXYgY29tcG9uZW50IGluZGV4XG5cdFx0XHR2YXIgaW5kZXg6bnVtYmVyID0gMDtcblxuXHRcdFx0Ly8gc3VyZmFjZVxuXHRcdFx0Zm9yIChqID0gMDsgaiA8PSB0aGlzLl9zZWdtZW50c0g7ICsraikge1xuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDw9IHRoaXMuX3NlZ21lbnRzVzsgKytpKSB7XG5cdFx0XHRcdFx0Ly8gcmV2b2x1dGlvbiB2ZXJ0ZXhcblx0XHRcdFx0XHR1dnNbaW5kZXgrK10gPSAoIGkvdGhpcy5fc2VnbWVudHNXICkqdHJpYW5nbGVHZW9tZXRyeS5zY2FsZVU7XG5cdFx0XHRcdFx0dXZzW2luZGV4KytdID0gKCBqL3RoaXMuX3NlZ21lbnRzSCApKnRyaWFuZ2xlR2VvbWV0cnkuc2NhbGVWO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIGJ1aWxkIHJlYWwgZGF0YSBmcm9tIHJhdyBkYXRhXG5cdFx0XHR0cmlhbmdsZUdlb21ldHJ5LnVwZGF0ZVVWcyh1dnMpO1xuXG5cdFx0fSBlbHNlIGlmIChnZW9tZXRyeVR5cGUgPT0gXCJsaW5lU3ViR2VvbWV0cnlcIikge1xuXHRcdFx0Ly9ub3RoaW5nIHRvIGRvIGhlcmVcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0ID0gUHJpbWl0aXZlQ2Fwc3VsZVByZWZhYjsiXX0=