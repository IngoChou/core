var PlaneClassification = require("awayjs-core/lib/core/geom/PlaneClassification");

var Plane3D = (function () {
    /**
    * Create a Plane3D with ABCD coefficients
    */
    function Plane3D(a, b, c, d) {
        if (typeof a === "undefined") { a = 0; }
        if (typeof b === "undefined") { b = 0; }
        if (typeof c === "undefined") { c = 0; }
        if (typeof d === "undefined") { d = 0; }
        this.a = a;
        this.b = b;
        this.c = c;
        this.d = d;

        if (a == 0 && b == 0) {
            this._iAlignment = Plane3D.ALIGN_XY_AXIS;
        } else if (b == 0 && c == 0) {
            this._iAlignment = Plane3D.ALIGN_YZ_AXIS;
        } else if (a == 0 && c == 0) {
            this._iAlignment = Plane3D.ALIGN_XZ_AXIS;
        } else {
            this._iAlignment = Plane3D.ALIGN_ANY;
        }
    }
    /**
    * Fills this Plane3D with the coefficients from 3 points in 3d space.
    * @param p0 Vector3D
    * @param p1 Vector3D
    * @param p2 Vector3D
    */
    Plane3D.prototype.fromPoints = function (p0, p1, p2) {
        var d1x = p1.x - p0.x;
        var d1y = p1.y - p0.y;
        var d1z = p1.z - p0.z;

        var d2x = p2.x - p0.x;
        var d2y = p2.y - p0.y;
        var d2z = p2.z - p0.z;

        this.a = d1y * d2z - d1z * d2y;
        this.b = d1z * d2x - d1x * d2z;
        this.c = d1x * d2y - d1y * d2x;
        this.d = this.a * p0.x + this.b * p0.y + this.c * p0.z;

        // not using epsilon, since a plane is infinite and a small incorrection can grow very large
        if (this.a == 0 && this.b == 0) {
            this._iAlignment = Plane3D.ALIGN_XY_AXIS;
        } else if (this.b == 0 && this.c == 0) {
            this._iAlignment = Plane3D.ALIGN_YZ_AXIS;
        } else if (this.a == 0 && this.c == 0) {
            this._iAlignment = Plane3D.ALIGN_XZ_AXIS;
        } else {
            this._iAlignment = Plane3D.ALIGN_ANY;
        }
    };

    /**
    * Fills this Plane3D with the coefficients from the plane's normal and a point in 3d space.
    * @param normal Vector3D
    * @param point  Vector3D
    */
    Plane3D.prototype.fromNormalAndPoint = function (normal, point) {
        this.a = normal.x;
        this.b = normal.y;
        this.c = normal.z;
        this.d = this.a * point.x + this.b * point.y + this.c * point.z;
        if (this.a == 0 && this.b == 0) {
            this._iAlignment = Plane3D.ALIGN_XY_AXIS;
        } else if (this.b == 0 && this.c == 0) {
            this._iAlignment = Plane3D.ALIGN_YZ_AXIS;
        } else if (this.a == 0 && this.c == 0) {
            this._iAlignment = Plane3D.ALIGN_XZ_AXIS;
        } else {
            this._iAlignment = Plane3D.ALIGN_ANY;
        }
    };

    /**
    * Normalize this Plane3D
    * @return Plane3D This Plane3D.
    */
    Plane3D.prototype.normalize = function () {
        var len = 1 / Math.sqrt(this.a * this.a + this.b * this.b + this.c * this.c);
        this.a *= len;
        this.b *= len;
        this.c *= len;
        this.d *= len;
        return this;
    };

    /**
    * Returns the signed distance between this Plane3D and the point p.
    * @param p Vector3D
    * @returns Number
    */
    Plane3D.prototype.distance = function (p) {
        if (this._iAlignment == Plane3D.ALIGN_YZ_AXIS) {
            return this.a * p.x - this.d;
        } else if (this._iAlignment == Plane3D.ALIGN_XZ_AXIS) {
            return this.b * p.y - this.d;
        } else if (this._iAlignment == Plane3D.ALIGN_XY_AXIS) {
            return this.c * p.z - this.d;
        } else {
            return this.a * p.x + this.b * p.y + this.c * p.z - this.d;
        }
    };

    /**
    * Classify a point against this Plane3D. (in front, back or intersecting)
    * @param p Vector3D
    * @return int Plane3.FRONT or Plane3D.BACK or Plane3D.INTERSECT
    */
    Plane3D.prototype.classifyPoint = function (p, epsilon) {
        if (typeof epsilon === "undefined") { epsilon = 0.01; }
        // check NaN
        if (this.d != this.d)
            return PlaneClassification.FRONT;

        var len;
        if (this._iAlignment == Plane3D.ALIGN_YZ_AXIS)
            len = this.a * p.x - this.d;
        else if (this._iAlignment == Plane3D.ALIGN_XZ_AXIS)
            len = this.b * p.y - this.d;
        else if (this._iAlignment == Plane3D.ALIGN_XY_AXIS)
            len = this.c * p.z - this.d;
        else
            len = this.a * p.x + this.b * p.y + this.c * p.z - this.d;

        if (len < -epsilon)
            return PlaneClassification.BACK;
        else if (len > epsilon)
            return PlaneClassification.FRONT;
        else
            return PlaneClassification.INTERSECT;
    };

    Plane3D.prototype.toString = function () {
        return "Plane3D [a:" + this.a + ", b:" + this.b + ", c:" + this.c + ", d:" + this.d + "]";
    };
    Plane3D.ALIGN_ANY = 0;
    Plane3D.ALIGN_XY_AXIS = 1;
    Plane3D.ALIGN_YZ_AXIS = 2;
    Plane3D.ALIGN_XZ_AXIS = 3;
    return Plane3D;
})();

module.exports = Plane3D;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvZ2VvbS9QbGFuZTNELnRzIl0sIm5hbWVzIjpbIlBsYW5lM0QiLCJQbGFuZTNELmNvbnN0cnVjdG9yIiwiUGxhbmUzRC5mcm9tUG9pbnRzIiwiUGxhbmUzRC5mcm9tTm9ybWFsQW5kUG9pbnQiLCJQbGFuZTNELm5vcm1hbGl6ZSIsIlBsYW5lM0QuZGlzdGFuY2UiLCJQbGFuZTNELmNsYXNzaWZ5UG9pbnQiLCJQbGFuZTNELnRvU3RyaW5nIl0sIm1hcHBpbmdzIjoiQUFBQSxrRkFBc0Y7O0FBR3RGO0lBaUNDQTs7TUFER0E7SUFDSEEsaUJBQVlBLENBQVlBLEVBQUVBLENBQVlBLEVBQUVBLENBQVlBLEVBQUVBLENBQVlBO1FBQXREQyxnQ0FBQUEsQ0FBQ0EsR0FBVUEsQ0FBQ0E7QUFBQUEsUUFBRUEsZ0NBQUFBLENBQUNBLEdBQVVBLENBQUNBO0FBQUFBLFFBQUVBLGdDQUFBQSxDQUFDQSxHQUFVQSxDQUFDQTtBQUFBQSxRQUFFQSxnQ0FBQUEsQ0FBQ0EsR0FBVUEsQ0FBQ0E7QUFBQUEsUUFFakVBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1ZBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1ZBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1ZBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBOztRQUVWQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFFQTtZQUVyQkEsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsT0FBT0EsQ0FBQ0EsYUFBYUE7U0FFeENBLE1BQU1BLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUVBO1lBRTVCQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxPQUFPQSxDQUFDQSxhQUFhQTtTQUV4Q0EsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBRUE7WUFFNUJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLE9BQU9BLENBQUNBLGFBQWFBO1NBRXhDQSxLQUFNQTtZQUVOQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxPQUFPQSxDQUFDQSxTQUFTQTtTQUVwQ0E7SUFFRkEsQ0FBQ0E7SUFRREQ7Ozs7O01BREdBO21DQUNIQSxVQUFrQkEsRUFBV0EsRUFBRUEsRUFBV0EsRUFBRUEsRUFBV0E7UUFFdERFLElBQUlBLEdBQUdBLEdBQVVBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBO1FBQzVCQSxJQUFJQSxHQUFHQSxHQUFVQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUM1QkEsSUFBSUEsR0FBR0EsR0FBVUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7O1FBRTVCQSxJQUFJQSxHQUFHQSxHQUFVQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUM1QkEsSUFBSUEsR0FBR0EsR0FBVUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLElBQUlBLEdBQUdBLEdBQVVBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBOztRQUU1QkEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBQ0EsR0FBR0E7UUFDMUJBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUNBLEdBQUdBO1FBQzFCQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFDQSxHQUFHQTtRQUMxQkEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0Es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TUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0E7SUFDMUZBLENBQUNBO0lBakxEUCxvQkFBaUNBLENBQUNBO0lBQ2xDQSx3QkFBcUNBLENBQUNBO0lBQ3RDQSx3QkFBcUNBLENBQUNBO0lBQ3RDQSx3QkFBcUNBLENBQUNBO0lBK0t2Q0EsZUFBQ0E7QUFBREEsQ0FBQ0EsSUFBQTs7QUFFRCx3QkFBaUIsQ0FBQSIsImZpbGUiOiJjb3JlL2dlb20vUGxhbmUzRC5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvcm9iYmF0ZW1hbi9XZWJzdG9ybVByb2plY3RzL2F3YXlqcy1jb3JlLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQbGFuZUNsYXNzaWZpY2F0aW9uXHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9nZW9tL1BsYW5lQ2xhc3NpZmljYXRpb25cIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vVmVjdG9yM0RcIik7XG5cbmNsYXNzIFBsYW5lM0Rcbntcblx0LyoqXG5cdCAqIFRoZSBBIGNvZWZmaWNpZW50IG9mIHRoaXMgcGxhbmUuIChBbHNvIHRoZSB4IGRpbWVuc2lvbiBvZiB0aGUgcGxhbmUgbm9ybWFsKVxuXHQgKi9cblx0cHVibGljIGE6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBUaGUgQiBjb2VmZmljaWVudCBvZiB0aGlzIHBsYW5lLiAoQWxzbyB0aGUgeSBkaW1lbnNpb24gb2YgdGhlIHBsYW5lIG5vcm1hbClcblx0ICovXG5cdHB1YmxpYyBiOm51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIEMgY29lZmZpY2llbnQgb2YgdGhpcyBwbGFuZS4gKEFsc28gdGhlIHogZGltZW5zaW9uIG9mIHRoZSBwbGFuZSBub3JtYWwpXG5cdCAqL1xuXHRwdWJsaWMgYzpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBEIGNvZWZmaWNpZW50IG9mIHRoaXMgcGxhbmUuIChBbHNvIHRoZSBpbnZlcnNlIGRvdCBwcm9kdWN0IGJldHdlZW4gbm9ybWFsIGFuZCBwb2ludClcblx0ICovXG5cdHB1YmxpYyBkOm51bWJlcjtcblxuXHRwdWJsaWMgX2lBbGlnbm1lbnQ6bnVtYmVyO1xuXG5cdC8vIGluZGljYXRlcyB0aGUgYWxpZ25tZW50IG9mIHRoZSBwbGFuZVxuXHRwdWJsaWMgc3RhdGljIEFMSUdOX0FOWTpudW1iZXIgPSAwO1xuXHRwdWJsaWMgc3RhdGljIEFMSUdOX1hZX0FYSVM6bnVtYmVyID0gMTtcblx0cHVibGljIHN0YXRpYyBBTElHTl9ZWl9BWElTOm51bWJlciA9IDI7XG5cdHB1YmxpYyBzdGF0aWMgQUxJR05fWFpfQVhJUzpudW1iZXIgPSAzO1xuXG5cdC8qKlxuXHQgKiBDcmVhdGUgYSBQbGFuZTNEIHdpdGggQUJDRCBjb2VmZmljaWVudHNcblx0ICovXG5cdGNvbnN0cnVjdG9yKGE6bnVtYmVyID0gMCwgYjpudW1iZXIgPSAwLCBjOm51bWJlciA9IDAsIGQ6bnVtYmVyID0gMClcblx0e1xuXHRcdHRoaXMuYSA9IGE7XG5cdFx0dGhpcy5iID0gYjtcblx0XHR0aGlzLmMgPSBjO1xuXHRcdHRoaXMuZCA9IGQ7XG5cblx0XHRpZiAoYSA9PSAwICYmIGIgPT0gMCkge1xuXG5cdFx0XHR0aGlzLl9pQWxpZ25tZW50ID0gUGxhbmUzRC5BTElHTl9YWV9BWElTO1xuXG5cdFx0fSBlbHNlIGlmIChiID09IDAgJiYgYyA9PSAwKSB7XG5cblx0XHRcdHRoaXMuX2lBbGlnbm1lbnQgPSBQbGFuZTNELkFMSUdOX1laX0FYSVM7XG5cblx0XHR9IGVsc2UgaWYgKGEgPT0gMCAmJiBjID09IDApIHtcblxuXHRcdFx0dGhpcy5faUFsaWdubWVudCA9IFBsYW5lM0QuQUxJR05fWFpfQVhJUztcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuX2lBbGlnbm1lbnQgPSBQbGFuZTNELkFMSUdOX0FOWTtcblxuXHRcdH1cblxuXHR9XG5cblx0LyoqXG5cdCAqIEZpbGxzIHRoaXMgUGxhbmUzRCB3aXRoIHRoZSBjb2VmZmljaWVudHMgZnJvbSAzIHBvaW50cyBpbiAzZCBzcGFjZS5cblx0ICogQHBhcmFtIHAwIFZlY3RvcjNEXG5cdCAqIEBwYXJhbSBwMSBWZWN0b3IzRFxuXHQgKiBAcGFyYW0gcDIgVmVjdG9yM0Rcblx0ICovXG5cdHB1YmxpYyBmcm9tUG9pbnRzKHAwOlZlY3RvcjNELCBwMTpWZWN0b3IzRCwgcDI6VmVjdG9yM0QpXG5cdHtcblx0XHR2YXIgZDF4Om51bWJlciA9IHAxLnggLSBwMC54O1xuXHRcdHZhciBkMXk6bnVtYmVyID0gcDEueSAtIHAwLnk7XG5cdFx0dmFyIGQxejpudW1iZXIgPSBwMS56IC0gcDAuejtcblxuXHRcdHZhciBkMng6bnVtYmVyID0gcDIueCAtIHAwLng7XG5cdFx0dmFyIGQyeTpudW1iZXIgPSBwMi55IC0gcDAueTtcblx0XHR2YXIgZDJ6Om51bWJlciA9IHAyLnogLSBwMC56O1xuXG5cdFx0dGhpcy5hID0gZDF5KmQyeiAtIGQxeipkMnk7XG5cdFx0dGhpcy5iID0gZDF6KmQyeCAtIGQxeCpkMno7XG5cdFx0dGhpcy5jID0gZDF4KmQyeSAtIGQxeSpkMng7XG5cdFx0dGhpcy5kID0gdGhpcy5hKnAwLnggKyB0aGlzLmIqcDAueSArIHRoaXMuYypwMC56O1xuXG5cdFx0Ly8gbm90IHVzaW5nIGVwc2lsb24sIHNpbmNlIGEgcGxhbmUgaXMgaW5maW5pdGUgYW5kIGEgc21hbGwgaW5jb3JyZWN0aW9uIGNhbiBncm93IHZlcnkgbGFyZ2Vcblx0XHRpZiAodGhpcy5hID09IDAgJiYgdGhpcy5iID09IDApIHtcblxuXHRcdFx0dGhpcy5faUFsaWdubWVudCA9IFBsYW5lM0QuQUxJR05fWFlfQVhJUztcblxuXHRcdH0gZWxzZSBpZiAodGhpcy5iID09IDAgJiYgdGhpcy5jID09IDApIHtcblxuXHRcdFx0dGhpcy5faUFsaWdubWVudCA9IFBsYW5lM0QuQUxJR05fWVpfQVhJUztcblxuXHRcdH0gZWxzZSBpZiAodGhpcy5hID09IDAgJiYgdGhpcy5jID09IDApIHtcblxuXHRcdFx0dGhpcy5faUFsaWdubWVudCA9IFBsYW5lM0QuQUxJR05fWFpfQVhJUztcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuX2lBbGlnbm1lbnQgPSBQbGFuZTNELkFMSUdOX0FOWTtcblxuXHRcdH1cblxuXHR9XG5cblx0LyoqXG5cdCAqIEZpbGxzIHRoaXMgUGxhbmUzRCB3aXRoIHRoZSBjb2VmZmljaWVudHMgZnJvbSB0aGUgcGxhbmUncyBub3JtYWwgYW5kIGEgcG9pbnQgaW4gM2Qgc3BhY2UuXG5cdCAqIEBwYXJhbSBub3JtYWwgVmVjdG9yM0Rcblx0ICogQHBhcmFtIHBvaW50ICBWZWN0b3IzRFxuXHQgKi9cblx0cHVibGljIGZyb21Ob3JtYWxBbmRQb2ludChub3JtYWw6VmVjdG9yM0QsIHBvaW50OlZlY3RvcjNEKVxuXHR7XG5cdFx0dGhpcy5hID0gbm9ybWFsLng7XG5cdFx0dGhpcy5iID0gbm9ybWFsLnk7XG5cdFx0dGhpcy5jID0gbm9ybWFsLno7XG5cdFx0dGhpcy5kID0gdGhpcy5hKnBvaW50LnggKyB0aGlzLmIqcG9pbnQueSArIHRoaXMuYypwb2ludC56O1xuXHRcdGlmICh0aGlzLmEgPT0gMCAmJiB0aGlzLmIgPT0gMCkge1xuXG5cdFx0XHR0aGlzLl9pQWxpZ25tZW50ID0gUGxhbmUzRC5BTElHTl9YWV9BWElTO1xuXG5cdFx0fSBlbHNlIGlmICh0aGlzLmIgPT0gMCAmJiB0aGlzLmMgPT0gMCkge1xuXG5cdFx0XHR0aGlzLl9pQWxpZ25tZW50ID0gUGxhbmUzRC5BTElHTl9ZWl9BWElTO1xuXG5cdFx0fSBlbHNlIGlmICh0aGlzLmEgPT0gMCAmJiB0aGlzLmMgPT0gMCkge1xuXG5cdFx0XHR0aGlzLl9pQWxpZ25tZW50ID0gUGxhbmUzRC5BTElHTl9YWl9BWElTO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5faUFsaWdubWVudCA9IFBsYW5lM0QuQUxJR05fQU5ZO1xuXG5cdFx0fVxuXG5cdH1cblxuXHQvKipcblx0ICogTm9ybWFsaXplIHRoaXMgUGxhbmUzRFxuXHQgKiBAcmV0dXJuIFBsYW5lM0QgVGhpcyBQbGFuZTNELlxuXHQgKi9cblx0cHVibGljIG5vcm1hbGl6ZSgpOlBsYW5lM0Rcblx0e1xuXHRcdHZhciBsZW46bnVtYmVyID0gMS9NYXRoLnNxcnQodGhpcy5hKnRoaXMuYSArIHRoaXMuYip0aGlzLmIgKyB0aGlzLmMqdGhpcy5jKTtcblx0XHR0aGlzLmEgKj0gbGVuO1xuXHRcdHRoaXMuYiAqPSBsZW47XG5cdFx0dGhpcy5jICo9IGxlbjtcblx0XHR0aGlzLmQgKj0gbGVuO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIHNpZ25lZCBkaXN0YW5jZSBiZXR3ZWVuIHRoaXMgUGxhbmUzRCBhbmQgdGhlIHBvaW50IHAuXG5cdCAqIEBwYXJhbSBwIFZlY3RvcjNEXG5cdCAqIEByZXR1cm5zIE51bWJlclxuXHQgKi9cblx0cHVibGljIGRpc3RhbmNlKHA6VmVjdG9yM0QpOm51bWJlclxuXHR7XG5cblx0XHRpZiAodGhpcy5faUFsaWdubWVudCA9PSBQbGFuZTNELkFMSUdOX1laX0FYSVMpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuYSpwLnggLSB0aGlzLmQ7XG5cblx0XHR9IGVsc2UgaWYgKHRoaXMuX2lBbGlnbm1lbnQgPT0gUGxhbmUzRC5BTElHTl9YWl9BWElTKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5iKnAueSAtIHRoaXMuZDtcblx0XHR9XG5cblx0XHRlbHNlIGlmICh0aGlzLl9pQWxpZ25tZW50ID09IFBsYW5lM0QuQUxJR05fWFlfQVhJUykge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5jKnAueiAtIHRoaXMuZDtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiB0aGlzLmEqcC54ICsgdGhpcy5iKnAueSArIHRoaXMuYypwLnogLSB0aGlzLmQ7XG5cblx0XHR9XG5cblx0fVxuXG5cdC8qKlxuXHQgKiBDbGFzc2lmeSBhIHBvaW50IGFnYWluc3QgdGhpcyBQbGFuZTNELiAoaW4gZnJvbnQsIGJhY2sgb3IgaW50ZXJzZWN0aW5nKVxuXHQgKiBAcGFyYW0gcCBWZWN0b3IzRFxuXHQgKiBAcmV0dXJuIGludCBQbGFuZTMuRlJPTlQgb3IgUGxhbmUzRC5CQUNLIG9yIFBsYW5lM0QuSU5URVJTRUNUXG5cdCAqL1xuXHRwdWJsaWMgY2xhc3NpZnlQb2ludChwOlZlY3RvcjNELCBlcHNpbG9uOm51bWJlciA9IDAuMDEpOm51bWJlclxuXHR7XG5cdFx0Ly8gY2hlY2sgTmFOXG5cdFx0aWYgKHRoaXMuZCAhPSB0aGlzLmQpXG5cdFx0XHRyZXR1cm4gUGxhbmVDbGFzc2lmaWNhdGlvbi5GUk9OVDtcblxuXHRcdHZhciBsZW46bnVtYmVyO1xuXHRcdGlmICh0aGlzLl9pQWxpZ25tZW50ID09IFBsYW5lM0QuQUxJR05fWVpfQVhJUylcblx0XHRcdGxlbiA9IHRoaXMuYSpwLnggLSB0aGlzLmQ7IGVsc2UgaWYgKHRoaXMuX2lBbGlnbm1lbnQgPT0gUGxhbmUzRC5BTElHTl9YWl9BWElTKVxuXHRcdFx0bGVuID0gdGhpcy5iKnAueSAtIHRoaXMuZDsgZWxzZSBpZiAodGhpcy5faUFsaWdubWVudCA9PSBQbGFuZTNELkFMSUdOX1hZX0FYSVMpXG5cdFx0XHRsZW4gPSB0aGlzLmMqcC56IC0gdGhpcy5kOyBlbHNlXG5cdFx0XHRsZW4gPSB0aGlzLmEqcC54ICsgdGhpcy5iKnAueSArIHRoaXMuYypwLnogLSB0aGlzLmQ7XG5cblx0XHRpZiAobGVuIDwgLWVwc2lsb24pXG5cdFx0XHRyZXR1cm4gUGxhbmVDbGFzc2lmaWNhdGlvbi5CQUNLOyBlbHNlIGlmIChsZW4gPiBlcHNpbG9uKVxuXHRcdFx0cmV0dXJuIFBsYW5lQ2xhc3NpZmljYXRpb24uRlJPTlQ7IGVsc2Vcblx0XHRcdHJldHVybiBQbGFuZUNsYXNzaWZpY2F0aW9uLklOVEVSU0VDVDtcblx0fVxuXG5cdHB1YmxpYyB0b1N0cmluZygpOnN0cmluZ1xuXHR7XG5cdFx0cmV0dXJuIFwiUGxhbmUzRCBbYTpcIiArIHRoaXMuYSArIFwiLCBiOlwiICsgdGhpcy5iICsgXCIsIGM6XCIgKyB0aGlzLmMgKyBcIiwgZDpcIiArIHRoaXMuZCArIFwiXVwiO1xuXHR9XG59XG5cbmV4cG9ydCA9IFBsYW5lM0Q7Il19