var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var URLLoaderDataFormat = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequestMethod = require("awayjs-core/lib/net/URLRequestMethod");
var URLVariables = require("awayjs-core/lib/net/URLVariables");
var AwayEvent = require("awayjs-core/lib/events/Event");
var EventDispatcher = require("awayjs-core/lib/events/EventDispatcher");
var HTTPStatusEvent = require("awayjs-core/lib/events/HTTPStatusEvent");
var IOErrorEvent = require("awayjs-core/lib/events/IOErrorEvent");
var AwayProgressEvent = require("awayjs-core/lib/events/ProgressEvent");
/**
 * The URLLoader is used to load a single file, as part of a resource.
 *
 * While URLLoader can be used directly, e.g. to create a third-party asset
 * management system, it's recommended to use any of the classes Loader3D, AssetLoader
 * and AssetLibrary instead in most cases.
 *
 * @see AssetLoader
 * @see away.library.AssetLibrary
 */
var URLLoader = (function (_super) {
    __extends(URLLoader, _super);
    /**
     * Creates a new URLLoader object.
     */
    function URLLoader() {
        _super.call(this);
        this._bytesLoaded = 0;
        this._bytesTotal = 0;
        this._dataFormat = URLLoaderDataFormat.TEXT;
        this._loadError = false;
    }
    Object.defineProperty(URLLoader.prototype, "url", {
        /**
         *
         */
        get: function () {
            return this._request ? this._request.url : '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(URLLoader.prototype, "data", {
        /**
         *
         */
        get: function () {
            return this._data;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(URLLoader.prototype, "dataFormat", {
        get: function () {
            return this._dataFormat;
        },
        /**
         *
         * URLLoaderDataFormat.BINARY
         * URLLoaderDataFormat.TEXT
         * URLLoaderDataFormat.VARIABLES
         *
         * @param format
         */
        set: function (format) {
            this._dataFormat = format;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(URLLoader.prototype, "bytesLoaded", {
        /**
         *
         * @returns {number}
         */
        get: function () {
            return this._bytesLoaded;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(URLLoader.prototype, "bytesTotal", {
        /**
         *
         * @returns {number}
         */
        get: function () {
            return this._bytesTotal;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Load a resource from a file.
     *
     * @param request The URLRequest object containing the URL of the object to be loaded.
     */
    URLLoader.prototype.load = function (request) {
        this._request = request;
        this.initXHR();
        if (request.method === URLRequestMethod.POST)
            this.postRequest(request);
        else
            this.getRequest(request);
    };
    /**
     *
     */
    URLLoader.prototype.close = function () {
        this._XHR.abort();
        this.disposeXHR();
    };
    /**
     *
     */
    URLLoader.prototype.dispose = function () {
        if (this._XHR)
            this._XHR.abort();
        this.disposeXHR();
        this._data = null;
        this._dataFormat = null;
        this._bytesLoaded = null;
        this._bytesTotal = null;
    };
    /**
     *
     * @param xhr
     * @param responseType
     */
    URLLoader.prototype.setResponseType = function (xhr, responseType) {
        switch (responseType) {
            case URLLoaderDataFormat.ARRAY_BUFFER:
            case URLLoaderDataFormat.BLOB:
            case URLLoaderDataFormat.TEXT:
                xhr.responseType = responseType;
                break;
            case URLLoaderDataFormat.VARIABLES:
                xhr.responseType = URLLoaderDataFormat.TEXT;
                break;
            case URLLoaderDataFormat.BINARY:
                xhr.responseType = '';
                break;
            default:
        }
    };
    /**
     *
     * @param request {URLRequest}
     */
    URLLoader.prototype.getRequest = function (request) {
        try {
            this._XHR.open(request.method, request.url, request.async);
            this.setResponseType(this._XHR, this._dataFormat);
            this._XHR.send(); // No data to send
        }
        catch (e) {
            this.handleXmlHttpRequestException(e);
        }
    };
    /**
     *
     * @param request {URLRequest}
     */
    URLLoader.prototype.postRequest = function (request) {
        this._loadError = false;
        this._XHR.open(request.method, request.url, request.async);
        if (request.data != null) {
            if (request.data instanceof URLVariables) {
                var urlVars = request.data;
                try {
                    this._XHR.responseType = 'text';
                    this._XHR.send(urlVars.formData);
                }
                catch (e) {
                    this.handleXmlHttpRequestException(e);
                }
            }
            else {
                this.setResponseType(this._XHR, this._dataFormat);
                if (request.data)
                    this._XHR.send(request.data); // TODO: Test
                else
                    this._XHR.send(); // no data to send
            }
        }
        else {
            this._XHR.send(); // No data to send
        }
    };
    /**
     *
     * @param error {XMLHttpRequestException}
     */
    URLLoader.prototype.handleXmlHttpRequestException = function (error /* <XMLHttpRequestException> */) {
        switch (error.code) {
            case 101:
                break;
        }
    };
    /**
     *
     */
    URLLoader.prototype.initXHR = function () {
        var _this = this;
        if (!this._XHR) {
            this._XHR = new XMLHttpRequest();
            this._XHR.onloadstart = function (event) { return _this.onLoadStart(event); }; // loadstart	        - When the request starts.
            this._XHR.onprogress = function (event) { return _this.onProgress(event); }; // progress	            - While loading and sending data.
            this._XHR.onabort = function (event) { return _this.onAbort(event); }; // abort	            - When the request has been aborted, either by invoking the abort() method or navigating away from the page.
            this._XHR.onerror = function (event) { return _this.onLoadError(event); }; // error	            - When the request has failed.
            this._XHR.onload = function (event) { return _this.onLoadComplete(event); }; // load	                - When the request has successfully completed.
            this._XHR.ontimeout = function (event) { return _this.onTimeOut(event); }; // timeout	            - When the author specified timeout has passed before the request could complete.
            this._XHR.onloadend = function (event) { return _this.onLoadEnd(event); }; // loadend	            - When the request has completed, regardless of whether or not it was successful.
            this._XHR.onreadystatechange = function (event) { return _this.onReadyStateChange(event); }; // onreadystatechange   - When XHR state changes
        }
    };
    /**
     *
     */
    URLLoader.prototype.disposeXHR = function () {
        if (this._XHR !== null) {
            this._XHR.onloadstart = null;
            this._XHR.onprogress = null;
            this._XHR.onabort = null;
            this._XHR.onerror = null;
            this._XHR.onload = null;
            this._XHR.ontimeout = null;
            this._XHR.onloadend = null;
            this._XHR = null;
        }
    };
    /**
     *
     * @param source
     */
    URLLoader.prototype.decodeURLVariables = function (source) {
        var result = new Object();
        source = source.split("+").join(" ");
        var tokens, re = /[?&]?([^=]+)=([^&]*)/g;
        while (tokens = re.exec(source))
            result[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
        return result;
    };
    // XMLHttpRequest - Event Handlers
    /**
     * When XHR state changes
     * @param event
     */
    URLLoader.prototype.onReadyStateChange = function (event) {
        if (this._XHR.readyState == 4) {
            if (this._XHR.status == 404) {
                this._loadError = true;
                if (!this._loadErrorEvent)
                    this._loadErrorEvent = new IOErrorEvent(IOErrorEvent.IO_ERROR);
                this.dispatchEvent(this._loadErrorEvent);
            }
            this.dispatchEvent(new HTTPStatusEvent(HTTPStatusEvent.HTTP_STATUS, this._XHR.status));
        }
    };
    /**
     * When the request has completed, regardless of whether or not it was successful.
     * @param event
     */
    URLLoader.prototype.onLoadEnd = function (event) {
        if (this._loadError === true)
            return;
    };
    /**
     * When the author specified timeout has passed before the request could complete.
     * @param event
     */
    URLLoader.prototype.onTimeOut = function (event) {
        //TODO: Timeout not currently implemented ( also not part of AS3 API )
    };
    /**
     * When the request has been aborted, either by invoking the abort() method or navigating away from the page.
     * @param event
     */
    URLLoader.prototype.onAbort = function (event) {
        // TODO: investigate whether this needs to be an IOError
    };
    /**
     * While loading and sending data.
     * @param event
     */
    URLLoader.prototype.onProgress = function (event) {
        if (!this._progressEvent)
            this._progressEvent = new AwayProgressEvent(AwayProgressEvent.PROGRESS);
        this._progressEvent.bytesTotal = event.total;
        this._progressEvent.bytesLoaded = event.loaded;
        this.dispatchEvent(this._progressEvent);
    };
    /**
     * When the request starts.
     * @param event
     */
    URLLoader.prototype.onLoadStart = function (event) {
        if (!this._loadStartEvent)
            this._loadStartEvent = new AwayEvent(AwayEvent.OPEN);
        this.dispatchEvent(this._loadStartEvent);
    };
    /**
     * When the request has successfully completed.
     * @param event
     */
    URLLoader.prototype.onLoadComplete = function (event) {
        if (this._loadError === true)
            return;
        switch (this._dataFormat) {
            case URLLoaderDataFormat.TEXT:
                this._data = this._XHR.responseText;
                break;
            case URLLoaderDataFormat.VARIABLES:
                this._data = this.decodeURLVariables(this._XHR.responseText);
                break;
            case URLLoaderDataFormat.BLOB:
            case URLLoaderDataFormat.ARRAY_BUFFER:
            case URLLoaderDataFormat.BINARY:
                this._data = this._XHR.response;
                break;
            default:
                this._data = this._XHR.responseText;
                break;
        }
        if (!this._loadCompleteEvent)
            this._loadCompleteEvent = new AwayEvent(AwayEvent.COMPLETE);
        this.dispatchEvent(this._loadCompleteEvent);
    };
    /**
     * When the request has failed. ( due to network issues ).
     * @param event
     */
    URLLoader.prototype.onLoadError = function (event) {
        this._loadError = true;
        if (!this._loadErrorEvent)
            this._loadErrorEvent = new IOErrorEvent(IOErrorEvent.IO_ERROR);
        this.dispatchEvent(this._loadErrorEvent);
    };
    return URLLoader;
})(EventDispatcher);
module.exports = URLLoader;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMTG9hZGVyLnRzIl0sIm5hbWVzIjpbIlVSTExvYWRlciIsIlVSTExvYWRlci5jb25zdHJ1Y3RvciIsIlVSTExvYWRlci51cmwiLCJVUkxMb2FkZXIuZGF0YSIsIlVSTExvYWRlci5kYXRhRm9ybWF0IiwiVVJMTG9hZGVyLmJ5dGVzTG9hZGVkIiwiVVJMTG9hZGVyLmJ5dGVzVG90YWwiLCJVUkxMb2FkZXIubG9hZCIsIlVSTExvYWRlci5jbG9zZSIsIlVSTExvYWRlci5kaXNwb3NlIiwiVVJMTG9hZGVyLnNldFJlc3BvbnNlVHlwZSIsIlVSTExvYWRlci5nZXRSZXF1ZXN0IiwiVVJMTG9hZGVyLnBvc3RSZXF1ZXN0IiwiVVJMTG9hZGVyLmhhbmRsZVhtbEh0dHBSZXF1ZXN0RXhjZXB0aW9uIiwiVVJMTG9hZGVyLmluaXRYSFIiLCJVUkxMb2FkZXIuZGlzcG9zZVhIUiIsIlVSTExvYWRlci5kZWNvZGVVUkxWYXJpYWJsZXMiLCJVUkxMb2FkZXIub25SZWFkeVN0YXRlQ2hhbmdlIiwiVVJMTG9hZGVyLm9uTG9hZEVuZCIsIlVSTExvYWRlci5vblRpbWVPdXQiLCJVUkxMb2FkZXIub25BYm9ydCIsIlVSTExvYWRlci5vblByb2dyZXNzIiwiVVJMTG9hZGVyLm9uTG9hZFN0YXJ0IiwiVVJMTG9hZGVyLm9uTG9hZENvbXBsZXRlIiwiVVJMTG9hZGVyLm9uTG9hZEVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLG1CQUFtQixXQUFhLHlDQUF5QyxDQUFDLENBQUM7QUFFbEYsSUFBTyxnQkFBZ0IsV0FBYyxzQ0FBc0MsQ0FBQyxDQUFDO0FBQzdFLElBQU8sWUFBWSxXQUFlLGtDQUFrQyxDQUFDLENBQUM7QUFDdEUsSUFBTyxTQUFTLFdBQWUsOEJBQThCLENBQUMsQ0FBQztBQUMvRCxJQUFPLGVBQWUsV0FBYyx3Q0FBd0MsQ0FBQyxDQUFDO0FBQzlFLElBQU8sZUFBZSxXQUFjLHdDQUF3QyxDQUFDLENBQUM7QUFD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Q0EsSUFBSUEsQ0FBQ0EsVUFBVUEsS0FBS0EsSUFBSUEsQ0FBQ0E7WUFDNUJBLE1BQU1BLENBQUNBO1FBRVJBLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQzFCQSxLQUFLQSxtQkFBbUJBLENBQUNBLElBQUlBO2dCQUM1QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7Z0JBQ3BDQSxLQUFLQSxDQUFDQTtZQUVQQSxLQUFLQSxtQkFBbUJBLENBQUNBLFNBQVNBO2dCQUNqQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtnQkFDN0RBLEtBQUtBLENBQUNBO1lBRVBBLEtBQUtBLG1CQUFtQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDOUJBLEtBQUtBLG1CQUFtQkEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7WUFDdENBLEtBQUtBLG1CQUFtQkEsQ0FBQ0EsTUFBTUE7Z0JBQzlCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQTtnQkFDaENBLEtBQUtBLENBQUNBO1lBRVBBO2dCQUNDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQTtnQkFDcENBLEtBQUtBLENBQUNBO1FBQ1JBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0E7WUFDNUJBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsSUFBSUEsU0FBU0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFFN0RBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsQ0FBQ0E7SUFDN0NBLENBQUNBO0lBRUR2Qjs7O09BR0dBO0lBQ0tBLCtCQUFXQSxHQUFuQkEsVUFBb0JBLEtBQVdBO1FBRTlCd0IsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFdkJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBO1lBQ3pCQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxJQUFJQSxZQUFZQSxDQUFDQSxZQUFZQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtRQUVoRUEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7SUFDMUNBLENBQUNBO0lBQ0Z4QixnQkFBQ0E7QUFBREEsQ0EzWUEsQUEyWUNBLEVBM1l1QixlQUFlLEVBMll0QztBQUVELEFBQW1CLGlCQUFWLFNBQVMsQ0FBQyIsImZpbGUiOiJuZXQvVVJMTG9hZGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBVUkxMb2FkZXJEYXRhRm9ybWF0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxMb2FkZXJEYXRhRm9ybWF0XCIpO1xuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxSZXF1ZXN0XCIpO1xuaW1wb3J0IFVSTFJlcXVlc3RNZXRob2RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdE1ldGhvZFwiKTtcbmltcG9ydCBVUkxWYXJpYWJsZXNcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxWYXJpYWJsZXNcIik7XG5pbXBvcnQgQXdheUV2ZW50XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnRcIik7XG5pbXBvcnQgRXZlbnREaXNwYXRjaGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50RGlzcGF0Y2hlclwiKTtcbmltcG9ydCBIVFRQU3RhdHVzRXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvSFRUUFN0YXR1c0V2ZW50XCIpO1xuaW1wb3J0IElPRXJyb3JFdmVudFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0lPRXJyb3JFdmVudFwiKTtcbmltcG9ydCBBd2F5UHJvZ3Jlc3NFdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvUHJvZ3Jlc3NFdmVudFwiKTtcblxuLyoqXG4gKiBUaGUgVVJMTG9hZGVyIGlzIHVzZWQgdG8gbG9hZCBhIHNpbmdsZSBmaWxlLCBhcyBwYXJ0IG9mIGEgcmVzb3VyY2UuXG4gKlxuICogV2hpbGUgVVJMTG9hZGVyIGNhbiBiZSB1c2VkIGRpcmVjdGx5LCBlLmcuIHRvIGNyZWF0ZSBhIHRoaXJkLXBhcnR5IGFzc2V0XG4gKiBtYW5hZ2VtZW50IHN5c3RlbSwgaXQncyByZWNvbW1lbmRlZCB0byB1c2UgYW55IG9mIHRoZSBjbGFzc2VzIExvYWRlcjNELCBBc3NldExvYWRlclxuICogYW5kIEFzc2V0TGlicmFyeSBpbnN0ZWFkIGluIG1vc3QgY2FzZXMuXG4gKlxuICogQHNlZSBBc3NldExvYWRlclxuICogQHNlZSBhd2F5LmxpYnJhcnkuQXNzZXRMaWJyYXJ5XG4gKi9cbmNsYXNzIFVSTExvYWRlciBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlclxue1xuXHRwcml2YXRlIF9YSFI6WE1MSHR0cFJlcXVlc3Q7XG5cdHByaXZhdGUgX2J5dGVzTG9hZGVkOm51bWJlciA9IDA7XG5cdHByaXZhdGUgX2J5dGVzVG90YWw6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfZGF0YUZvcm1hdDpzdHJpbmcgPSBVUkxMb2FkZXJEYXRhRm9ybWF0LlRFWFQ7XG5cdHByaXZhdGUgX2xvYWRFcnJvcjpib29sZWFuID0gZmFsc2U7XG5cblx0cHJpdmF0ZSBfcmVxdWVzdDpVUkxSZXF1ZXN0O1xuXHRwcml2YXRlIF9kYXRhOmFueTtcblxuXHRwcml2YXRlIF9sb2FkU3RhcnRFdmVudDpBd2F5RXZlbnQ7XG5cdHByaXZhdGUgX2xvYWRFcnJvckV2ZW50OklPRXJyb3JFdmVudDtcblx0cHJpdmF0ZSBfbG9hZENvbXBsZXRlRXZlbnQ6QXdheUV2ZW50O1xuXHRwcml2YXRlIF9wcm9ncmVzc0V2ZW50OkF3YXlQcm9ncmVzc0V2ZW50O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IFVSTExvYWRlciBvYmplY3QuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHRzdXBlcigpO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IHVybCgpOnN0cmluZ1xuXHR7XG5cblx0XHRyZXR1cm4gdGhpcy5fcmVxdWVzdD8gdGhpcy5fcmVxdWVzdC51cmwgOiAnJztcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGdldCBkYXRhKCk6YW55XG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fZGF0YTtcblx0fVxuXG5cblx0LyoqXG5cdCAqXG5cdCAqIFVSTExvYWRlckRhdGFGb3JtYXQuQklOQVJZXG5cdCAqIFVSTExvYWRlckRhdGFGb3JtYXQuVEVYVFxuXHQgKiBVUkxMb2FkZXJEYXRhRm9ybWF0LlZBUklBQkxFU1xuXHQgKlxuXHQgKiBAcGFyYW0gZm9ybWF0XG5cdCAqL1xuXHRwdWJsaWMgc2V0IGRhdGFGb3JtYXQoZm9ybWF0OnN0cmluZylcblx0e1xuXHRcdHRoaXMuX2RhdGFGb3JtYXQgPSBmb3JtYXQ7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IGRhdGFGb3JtYXQoKTpzdHJpbmdcblx0e1xuXHRcdHJldHVybiB0aGlzLl9kYXRhRm9ybWF0O1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XG5cdCAqL1xuXHRwdWJsaWMgZ2V0IGJ5dGVzTG9hZGVkKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fYnl0ZXNMb2FkZWQ7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHJldHVybnMge251bWJlcn1cblx0ICovXG5cdHB1YmxpYyBnZXQgYnl0ZXNUb3RhbCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2J5dGVzVG90YWw7XG5cdH1cblxuXHQvKipcblx0ICogTG9hZCBhIHJlc291cmNlIGZyb20gYSBmaWxlLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmVxdWVzdCBUaGUgVVJMUmVxdWVzdCBvYmplY3QgY29udGFpbmluZyB0aGUgVVJMIG9mIHRoZSBvYmplY3QgdG8gYmUgbG9hZGVkLlxuXHQgKi9cblx0cHVibGljIGxvYWQocmVxdWVzdDpVUkxSZXF1ZXN0KTp2b2lkXG5cdHtcblx0XHR0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcblxuXHRcdHRoaXMuaW5pdFhIUigpO1xuXG5cdFx0aWYgKHJlcXVlc3QubWV0aG9kID09PSBVUkxSZXF1ZXN0TWV0aG9kLlBPU1QpXG5cdFx0XHR0aGlzLnBvc3RSZXF1ZXN0KHJlcXVlc3QpO1xuXHRcdGVsc2Vcblx0XHRcdHRoaXMuZ2V0UmVxdWVzdChyZXF1ZXN0KTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGNsb3NlKCk6dm9pZFxuXHR7XG5cdFx0dGhpcy5fWEhSLmFib3J0KCk7XG5cdFx0dGhpcy5kaXNwb3NlWEhSKCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBkaXNwb3NlKCk6dm9pZFxuXHR7XG5cdFx0aWYgKHRoaXMuX1hIUilcblx0XHRcdHRoaXMuX1hIUi5hYm9ydCgpO1xuXG5cdFx0dGhpcy5kaXNwb3NlWEhSKCk7XG5cblx0XHR0aGlzLl9kYXRhID0gbnVsbDtcblx0XHR0aGlzLl9kYXRhRm9ybWF0ID0gbnVsbDtcblx0XHR0aGlzLl9ieXRlc0xvYWRlZCA9IG51bGw7XG5cdFx0dGhpcy5fYnl0ZXNUb3RhbCA9IG51bGw7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIHhoclxuXHQgKiBAcGFyYW0gcmVzcG9uc2VUeXBlXG5cdCAqL1xuXHRwcml2YXRlIHNldFJlc3BvbnNlVHlwZSh4aHI6WE1MSHR0cFJlcXVlc3QsIHJlc3BvbnNlVHlwZTpzdHJpbmcpOnZvaWRcblx0e1xuXHRcdHN3aXRjaCAocmVzcG9uc2VUeXBlKSB7XG5cdFx0XHRjYXNlIFVSTExvYWRlckRhdGFGb3JtYXQuQVJSQVlfQlVGRkVSOlxuXHRcdFx0Y2FzZSBVUkxMb2FkZXJEYXRhRm9ybWF0LkJMT0I6XG5cdFx0XHRjYXNlIFVSTExvYWRlckRhdGFGb3JtYXQuVEVYVDpcblx0XHRcdFx0eGhyLnJlc3BvbnNlVHlwZSA9IHJlc3BvbnNlVHlwZTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgVVJMTG9hZGVyRGF0YUZvcm1hdC5WQVJJQUJMRVM6XG5cdFx0XHRcdHhoci5yZXNwb25zZVR5cGUgPSBVUkxMb2FkZXJEYXRhRm9ybWF0LlRFWFQ7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFVSTExvYWRlckRhdGFGb3JtYXQuQklOQVJZOlxuXHRcdFx0XHR4aHIucmVzcG9uc2VUeXBlID0gJyc7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRkZWZhdWx0OlxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcGFyYW0gcmVxdWVzdCB7VVJMUmVxdWVzdH1cblx0ICovXG5cdHByaXZhdGUgZ2V0UmVxdWVzdChyZXF1ZXN0OlVSTFJlcXVlc3QpOnZvaWRcblx0e1xuXHRcdHRyeSB7XG5cdFx0XHR0aGlzLl9YSFIub3BlbihyZXF1ZXN0Lm1ldGhvZCwgcmVxdWVzdC51cmwsIHJlcXVlc3QuYXN5bmMpO1xuXHRcdFx0dGhpcy5zZXRSZXNwb25zZVR5cGUodGhpcy5fWEhSLCB0aGlzLl9kYXRhRm9ybWF0KTtcblx0XHRcdHRoaXMuX1hIUi5zZW5kKCk7IC8vIE5vIGRhdGEgdG8gc2VuZFxuXHRcdH0gY2F0Y2ggKGUgLyogPFhNTEh0dHBSZXF1ZXN0RXhjZXB0aW9uPiAqLykge1xuXHRcdFx0dGhpcy5oYW5kbGVYbWxIdHRwUmVxdWVzdEV4Y2VwdGlvbihlKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIHJlcXVlc3Qge1VSTFJlcXVlc3R9XG5cdCAqL1xuXHRwcml2YXRlIHBvc3RSZXF1ZXN0KHJlcXVlc3Q6VVJMUmVxdWVzdCk6dm9pZFxuXHR7XG5cdFx0dGhpcy5fbG9hZEVycm9yID0gZmFsc2U7XG5cblx0XHR0aGlzLl9YSFIub3BlbihyZXF1ZXN0Lm1ldGhvZCwgcmVxdWVzdC51cmwsIHJlcXVlc3QuYXN5bmMpO1xuXG5cdFx0aWYgKHJlcXVlc3QuZGF0YSAhPSBudWxsKSB7XG5cdFx0XHRpZiAocmVxdWVzdC5kYXRhIGluc3RhbmNlb2YgVVJMVmFyaWFibGVzKSB7XG5cdFx0XHRcdHZhciB1cmxWYXJzOlVSTFZhcmlhYmxlcyA9IDxVUkxWYXJpYWJsZXM+IHJlcXVlc3QuZGF0YTtcblxuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHRoaXMuX1hIUi5yZXNwb25zZVR5cGUgPSAndGV4dCc7XG5cdFx0XHRcdFx0dGhpcy5fWEhSLnNlbmQodXJsVmFycy5mb3JtRGF0YSk7XG5cdFx0XHRcdH0gY2F0Y2ggKGUgLyogPFhNTEh0dHBSZXF1ZXN0RXhjZXB0aW9uPiAqLykge1xuXHRcdFx0XHRcdHRoaXMuaGFuZGxlWG1sSHR0cFJlcXVlc3RFeGNlcHRpb24oZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuc2V0UmVzcG9uc2VUeXBlKHRoaXMuX1hIUiwgdGhpcy5fZGF0YUZvcm1hdCk7XG5cblx0XHRcdFx0aWYgKHJlcXVlc3QuZGF0YSlcblx0XHRcdFx0XHR0aGlzLl9YSFIuc2VuZChyZXF1ZXN0LmRhdGEpOyAvLyBUT0RPOiBUZXN0XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHR0aGlzLl9YSFIuc2VuZCgpOyAvLyBubyBkYXRhIHRvIHNlbmRcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5fWEhSLnNlbmQoKTsgLy8gTm8gZGF0YSB0byBzZW5kXG5cdFx0fVxuXG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIGVycm9yIHtYTUxIdHRwUmVxdWVzdEV4Y2VwdGlvbn1cblx0ICovXG5cdHByaXZhdGUgaGFuZGxlWG1sSHR0cFJlcXVlc3RFeGNlcHRpb24oZXJyb3I6YW55IC8qIDxYTUxIdHRwUmVxdWVzdEV4Y2VwdGlvbj4gKi8pOnZvaWRcblx0e1xuXHRcdHN3aXRjaCAoZXJyb3IuY29kZSkge1xuXG5cdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdCAqXG5cdFx0ICogIFhNTEh0dHBSZXF1ZXN0RXhjZXB0aW9uIHsgbWVzc2FnZTogXCJORVRXT1JLX0VSUjogWE1MSHR0cFJlcXVlc3QgRXhjZXB0aW9uIDEwMVwiLCBuYW1lOiBcIk5FVFdPUktfRVJSXCIsIGNvZGU6IDEwMSwgc3RhY2s6IFwiRXJyb3I6IEEgbmV0d29yayBlcnJvciBvY2N1cnJlZCBpbiBzeW5jaHJvbm91cyByZXHigKZcIixORVRXT1JLX0VSUjogMTAx4oCmIH1cblx0XHQgKiAgY29kZTogMTAxICwgbWVzc2FnZTogXCJORVRXT1JLX0VSUjogWE1MSHR0cFJlcXVlc3QgRXhjZXB0aW9uIDEwMVwiICwgIG5hbWU6IFwiTkVUV09SS19FUlJcIlxuXHRcdCAqXG5cdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0Y2FzZSAxMDE6XG5cdFx0XHRcdC8vIE5vdGU6IG9uTG9hZEVycm9yIGV2ZW50IHRocm93cyBJT19FUlJPUiBldmVudCAtIHRoaXMgY2FzZSBpcyBhbHJlYWR5IENvdmVyZWRcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwcml2YXRlIGluaXRYSFIoKVxuXHR7XG5cdFx0aWYgKCF0aGlzLl9YSFIpIHtcblx0XHRcdHRoaXMuX1hIUiA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG5cdFx0XHR0aGlzLl9YSFIub25sb2Fkc3RhcnQgPSAoZXZlbnQ6UHJvZ3Jlc3NFdmVudCkgPT4gdGhpcy5vbkxvYWRTdGFydChldmVudCk7ICAgICAgICAgICAgICAgICAvLyBsb2Fkc3RhcnRcdCAgICAgICAgLSBXaGVuIHRoZSByZXF1ZXN0IHN0YXJ0cy5cblx0XHRcdHRoaXMuX1hIUi5vbnByb2dyZXNzID0gKGV2ZW50OlByb2dyZXNzRXZlbnQpID0+IHRoaXMub25Qcm9ncmVzcyhldmVudCk7XHQgICAgICAgICAgICAgICAgLy8gcHJvZ3Jlc3NcdCAgICAgICAgICAgIC0gV2hpbGUgbG9hZGluZyBhbmQgc2VuZGluZyBkYXRhLlxuXHRcdFx0dGhpcy5fWEhSLm9uYWJvcnQgPSAoZXZlbnQ6VUlFdmVudCkgPT4gdGhpcy5vbkFib3J0KGV2ZW50KTtcdCAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFib3J0XHQgICAgICAgICAgICAtIFdoZW4gdGhlIHJlcXVlc3QgaGFzIGJlZW4gYWJvcnRlZCwgZWl0aGVyIGJ5IGludm9raW5nIHRoZSBhYm9ydCgpIG1ldGhvZCBvciBuYXZpZ2F0aW5nIGF3YXkgZnJvbSB0aGUgcGFnZS5cblx0XHRcdHRoaXMuX1hIUi5vbmVycm9yID0gKGV2ZW50OkVycm9yRXZlbnQpID0+IHRoaXMub25Mb2FkRXJyb3IoZXZlbnQpOyAgICAgICAgICAgICAgICAgICAgIC8vIGVycm9yXHQgICAgICAgICAgICAtIFdoZW4gdGhlIHJlcXVlc3QgaGFzIGZhaWxlZC5cblx0XHRcdHRoaXMuX1hIUi5vbmxvYWQgPSAoZXZlbnQ6RXZlbnQpID0+IHRoaXMub25Mb2FkQ29tcGxldGUoZXZlbnQpOyAgICAgICAgICAgICAgICAgICAvLyBsb2FkXHQgICAgICAgICAgICAgICAgLSBXaGVuIHRoZSByZXF1ZXN0IGhhcyBzdWNjZXNzZnVsbHkgY29tcGxldGVkLlxuXHRcdFx0dGhpcy5fWEhSLm9udGltZW91dCA9IChldmVudDpFdmVudCkgPT4gdGhpcy5vblRpbWVPdXQoZXZlbnQpOyAgICAgICAgICAgICAgICAgICAgIC8vIHRpbWVvdXRcdCAgICAgICAgICAgIC0gV2hlbiB0aGUgYXV0aG9yIHNwZWNpZmllZCB0aW1lb3V0IGhhcyBwYXNzZWQgYmVmb3JlIHRoZSByZXF1ZXN0IGNvdWxkIGNvbXBsZXRlLlxuXHRcdFx0dGhpcy5fWEhSLm9ubG9hZGVuZCA9IChldmVudDpQcm9ncmVzc0V2ZW50KSA9PiB0aGlzLm9uTG9hZEVuZChldmVudCk7ICAgICAgICAgICAgICAgICAgICAgLy8gbG9hZGVuZFx0ICAgICAgICAgICAgLSBXaGVuIHRoZSByZXF1ZXN0IGhhcyBjb21wbGV0ZWQsIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciBvciBub3QgaXQgd2FzIHN1Y2Nlc3NmdWwuXG5cdFx0XHR0aGlzLl9YSFIub25yZWFkeXN0YXRlY2hhbmdlID0gKGV2ZW50OkV2ZW50KSA9PiB0aGlzLm9uUmVhZHlTdGF0ZUNoYW5nZShldmVudCk7ICAgLy8gb25yZWFkeXN0YXRlY2hhbmdlICAgLSBXaGVuIFhIUiBzdGF0ZSBjaGFuZ2VzXG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwcml2YXRlIGRpc3Bvc2VYSFIoKVxuXHR7XG5cdFx0aWYgKHRoaXMuX1hIUiAhPT0gbnVsbCkge1xuXHRcdFx0dGhpcy5fWEhSLm9ubG9hZHN0YXJ0ID0gbnVsbDtcblx0XHRcdHRoaXMuX1hIUi5vbnByb2dyZXNzID0gbnVsbDtcblx0XHRcdHRoaXMuX1hIUi5vbmFib3J0ID0gbnVsbDtcblx0XHRcdHRoaXMuX1hIUi5vbmVycm9yID0gbnVsbDtcblx0XHRcdHRoaXMuX1hIUi5vbmxvYWQgPSBudWxsO1xuXHRcdFx0dGhpcy5fWEhSLm9udGltZW91dCA9IG51bGw7XG5cdFx0XHR0aGlzLl9YSFIub25sb2FkZW5kID0gbnVsbDtcblx0XHRcdHRoaXMuX1hIUiA9IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBzb3VyY2Vcblx0ICovXG5cdHB1YmxpYyBkZWNvZGVVUkxWYXJpYWJsZXMoc291cmNlOnN0cmluZyk6T2JqZWN0XG5cdHtcblx0XHR2YXIgcmVzdWx0Ok9iamVjdCA9IG5ldyBPYmplY3QoKTtcblxuXHRcdHNvdXJjZSA9IHNvdXJjZS5zcGxpdChcIitcIikuam9pbihcIiBcIik7XG5cblx0XHR2YXIgdG9rZW5zLCByZSA9IC9bPyZdPyhbXj1dKyk9KFteJl0qKS9nO1xuXG5cdFx0d2hpbGUgKHRva2VucyA9IHJlLmV4ZWMoc291cmNlKSlcblx0XHRcdHJlc3VsdFtkZWNvZGVVUklDb21wb25lbnQodG9rZW5zWzFdKV0gPSBkZWNvZGVVUklDb21wb25lbnQodG9rZW5zWzJdKTtcblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cblxuXHQvLyBYTUxIdHRwUmVxdWVzdCAtIEV2ZW50IEhhbmRsZXJzXG5cblx0LyoqXG5cdCAqIFdoZW4gWEhSIHN0YXRlIGNoYW5nZXNcblx0ICogQHBhcmFtIGV2ZW50XG5cdCAqL1xuXHRwcml2YXRlIG9uUmVhZHlTdGF0ZUNoYW5nZShldmVudDpFdmVudClcblx0e1xuXHRcdGlmICh0aGlzLl9YSFIucmVhZHlTdGF0ZSA9PSA0KSB7XG5cdFx0XHRpZiAodGhpcy5fWEhSLnN0YXR1cyA9PSA0MDQpIHtcblx0XHRcdFx0dGhpcy5fbG9hZEVycm9yID0gdHJ1ZTtcblxuXHRcdFx0XHRpZiAoIXRoaXMuX2xvYWRFcnJvckV2ZW50KVxuXHRcdFx0XHRcdHRoaXMuX2xvYWRFcnJvckV2ZW50ID0gbmV3IElPRXJyb3JFdmVudChJT0Vycm9yRXZlbnQuSU9fRVJST1IpO1xuXG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFdmVudCh0aGlzLl9sb2FkRXJyb3JFdmVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgSFRUUFN0YXR1c0V2ZW50KEhUVFBTdGF0dXNFdmVudC5IVFRQX1NUQVRVUywgdGhpcy5fWEhSLnN0YXR1cykpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBXaGVuIHRoZSByZXF1ZXN0IGhhcyBjb21wbGV0ZWQsIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciBvciBub3QgaXQgd2FzIHN1Y2Nlc3NmdWwuXG5cdCAqIEBwYXJhbSBldmVudFxuXHQgKi9cblx0cHJpdmF0ZSBvbkxvYWRFbmQoZXZlbnQ6UHJvZ3Jlc3NFdmVudClcblx0e1xuXHRcdGlmICh0aGlzLl9sb2FkRXJyb3IgPT09IHRydWUpXG5cdFx0XHRyZXR1cm47XG5cdH1cblxuXHQvKipcblx0ICogV2hlbiB0aGUgYXV0aG9yIHNwZWNpZmllZCB0aW1lb3V0IGhhcyBwYXNzZWQgYmVmb3JlIHRoZSByZXF1ZXN0IGNvdWxkIGNvbXBsZXRlLlxuXHQgKiBAcGFyYW0gZXZlbnRcblx0ICovXG5cdHByaXZhdGUgb25UaW1lT3V0KGV2ZW50OkV2ZW50KVxuXHR7XG5cdFx0Ly9UT0RPOiBUaW1lb3V0IG5vdCBjdXJyZW50bHkgaW1wbGVtZW50ZWQgKCBhbHNvIG5vdCBwYXJ0IG9mIEFTMyBBUEkgKVxuXHR9XG5cblx0LyoqXG5cdCAqIFdoZW4gdGhlIHJlcXVlc3QgaGFzIGJlZW4gYWJvcnRlZCwgZWl0aGVyIGJ5IGludm9raW5nIHRoZSBhYm9ydCgpIG1ldGhvZCBvciBuYXZpZ2F0aW5nIGF3YXkgZnJvbSB0aGUgcGFnZS5cblx0ICogQHBhcmFtIGV2ZW50XG5cdCAqL1xuXHRwcml2YXRlIG9uQWJvcnQoZXZlbnQ6VUlFdmVudClcblx0e1xuXHRcdC8vIFRPRE86IGludmVzdGlnYXRlIHdoZXRoZXIgdGhpcyBuZWVkcyB0byBiZSBhbiBJT0Vycm9yXG5cdH1cblxuXHQvKipcblx0ICogV2hpbGUgbG9hZGluZyBhbmQgc2VuZGluZyBkYXRhLlxuXHQgKiBAcGFyYW0gZXZlbnRcblx0ICovXG5cdHByaXZhdGUgb25Qcm9ncmVzcyhldmVudDpQcm9ncmVzc0V2ZW50KVxuXHR7XG5cdFx0aWYgKCF0aGlzLl9wcm9ncmVzc0V2ZW50KVxuXHRcdFx0dGhpcy5fcHJvZ3Jlc3NFdmVudCA9IG5ldyBBd2F5UHJvZ3Jlc3NFdmVudChBd2F5UHJvZ3Jlc3NFdmVudC5QUk9HUkVTUyk7XG5cblx0XHR0aGlzLl9wcm9ncmVzc0V2ZW50LmJ5dGVzVG90YWwgPSBldmVudC50b3RhbDtcblx0XHR0aGlzLl9wcm9ncmVzc0V2ZW50LmJ5dGVzTG9hZGVkID0gZXZlbnQubG9hZGVkO1xuXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuX3Byb2dyZXNzRXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFdoZW4gdGhlIHJlcXVlc3Qgc3RhcnRzLlxuXHQgKiBAcGFyYW0gZXZlbnRcblx0ICovXG5cdHByaXZhdGUgb25Mb2FkU3RhcnQoZXZlbnQ6UHJvZ3Jlc3NFdmVudClcblx0e1xuXHRcdGlmICghdGhpcy5fbG9hZFN0YXJ0RXZlbnQpXG5cdFx0XHR0aGlzLl9sb2FkU3RhcnRFdmVudCA9IG5ldyBBd2F5RXZlbnQoQXdheUV2ZW50Lk9QRU4pO1xuXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuX2xvYWRTdGFydEV2ZW50KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBXaGVuIHRoZSByZXF1ZXN0IGhhcyBzdWNjZXNzZnVsbHkgY29tcGxldGVkLlxuXHQgKiBAcGFyYW0gZXZlbnRcblx0ICovXG5cdHByaXZhdGUgb25Mb2FkQ29tcGxldGUoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHRpZiAodGhpcy5fbG9hZEVycm9yID09PSB0cnVlKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0c3dpdGNoICh0aGlzLl9kYXRhRm9ybWF0KSB7XG5cdFx0XHRjYXNlIFVSTExvYWRlckRhdGFGb3JtYXQuVEVYVDpcblx0XHRcdFx0dGhpcy5fZGF0YSA9IHRoaXMuX1hIUi5yZXNwb25zZVRleHQ7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFVSTExvYWRlckRhdGFGb3JtYXQuVkFSSUFCTEVTOlxuXHRcdFx0XHR0aGlzLl9kYXRhID0gdGhpcy5kZWNvZGVVUkxWYXJpYWJsZXModGhpcy5fWEhSLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFVSTExvYWRlckRhdGFGb3JtYXQuQkxPQjpcblx0XHRcdGNhc2UgVVJMTG9hZGVyRGF0YUZvcm1hdC5BUlJBWV9CVUZGRVI6XG5cdFx0XHRjYXNlIFVSTExvYWRlckRhdGFGb3JtYXQuQklOQVJZOlxuXHRcdFx0XHR0aGlzLl9kYXRhID0gdGhpcy5fWEhSLnJlc3BvbnNlO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0dGhpcy5fZGF0YSA9IHRoaXMuX1hIUi5yZXNwb25zZVRleHQ7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fbG9hZENvbXBsZXRlRXZlbnQpXG5cdFx0XHR0aGlzLl9sb2FkQ29tcGxldGVFdmVudCA9IG5ldyBBd2F5RXZlbnQoQXdheUV2ZW50LkNPTVBMRVRFKTtcblxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudCh0aGlzLl9sb2FkQ29tcGxldGVFdmVudCk7XG5cdH1cblxuXHQvKipcblx0ICogV2hlbiB0aGUgcmVxdWVzdCBoYXMgZmFpbGVkLiAoIGR1ZSB0byBuZXR3b3JrIGlzc3VlcyApLlxuXHQgKiBAcGFyYW0gZXZlbnRcblx0ICovXG5cdHByaXZhdGUgb25Mb2FkRXJyb3IoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHR0aGlzLl9sb2FkRXJyb3IgPSB0cnVlO1xuXG5cdFx0aWYgKCF0aGlzLl9sb2FkRXJyb3JFdmVudClcblx0XHRcdHRoaXMuX2xvYWRFcnJvckV2ZW50ID0gbmV3IElPRXJyb3JFdmVudChJT0Vycm9yRXZlbnQuSU9fRVJST1IpO1xuXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuX2xvYWRFcnJvckV2ZW50KTtcblx0fVxufVxuXG5leHBvcnQgPSBVUkxMb2FkZXI7Il19