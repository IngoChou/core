var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var NullBounds = require("awayjs-core/lib/bounds/NullBounds");
var DisplayObjectContainer = require("awayjs-core/lib/containers/DisplayObjectContainer");
var Matrix3D = require("awayjs-core/lib/core/geom/Matrix3D");
var Plane3D = require("awayjs-core/lib/core/geom/Plane3D");

var AssetType = require("awayjs-core/lib/core/library/AssetType");
var CameraNode = require("awayjs-core/lib/core/partition/CameraNode");

var CameraEvent = require("awayjs-core/lib/events/CameraEvent");
var ProjectionEvent = require("awayjs-core/lib/events/ProjectionEvent");

var PerspectiveProjection = require("awayjs-core/lib/projections/PerspectiveProjection");

var Camera = (function (_super) {
    __extends(Camera, _super);
    function Camera(projection) {
        if (typeof projection === "undefined") { projection = null; }
        var _this = this;
        _super.call(this);
        this._viewProjection = new Matrix3D();
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;

        this._pIsEntity = true;

        this._onProjectionMatrixChangedDelegate = function (event) {
            return _this.onProjectionMatrixChanged(event);
        };

        this._projection = projection || new PerspectiveProjection();
        this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);

        this._frustumPlanes = [];

        for (var i = 0; i < 6; ++i)
            this._frustumPlanes[i] = new Plane3D();

        this.z = -1000;
    }
    Camera.prototype.pCreateDefaultBoundingVolume = function () {
        return new NullBounds();
    };

    /**
    * @protected
    */
    Camera.prototype.pCreateEntityPartitionNode = function () {
        return new CameraNode(this);
    };

    Object.defineProperty(Camera.prototype, "assetType", {
        //@override
        get: function () {
            return AssetType.CAMERA;
        },
        enumerable: true,
        configurable: true
    });

    Camera.prototype.onProjectionMatrixChanged = function (event) {
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
        this.dispatchEvent(event);
    };

    Object.defineProperty(Camera.prototype, "frustumPlanes", {
        get: function () {
            if (this._frustumPlanesDirty)
                this.updateFrustum();

            return this._frustumPlanes;
        },
        enumerable: true,
        configurable: true
    });

    Camera.prototype.updateFrustum = function () {
        var a, b, c;

        //var d : Number;
        var c11, c12, c13, c14;
        var c21, c22, c23, c24;
        var c31, c32, c33, c34;
        var c41, c42, c43, c44;
        var p;
        var raw = new Array(16);
        ;
        var invLen;
        this.viewProjection.copyRawDataTo(raw);

        c11 = raw[0];
        c12 = raw[4];
        c13 = raw[8];
        c14 = raw[12];
        c21 = raw[1];
        c22 = raw[5];
        c23 = raw[9];
        c24 = raw[13];
        c31 = raw[2];
        c32 = raw[6];
        c33 = raw[10];
        c34 = raw[14];
        c41 = raw[3];
        c42 = raw[7];
        c43 = raw[11];
        c44 = raw[15];

        // left plane
        p = this._frustumPlanes[0];
        a = c41 + c11;
        b = c42 + c12;
        c = c43 + c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c14) * invLen;

        // right plane
        p = this._frustumPlanes[1];
        a = c41 - c11;
        b = c42 - c12;
        c = c43 - c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c14 - c44) * invLen;

        // bottom
        p = this._frustumPlanes[2];
        a = c41 + c21;
        b = c42 + c22;
        c = c43 + c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c24) * invLen;

        // top
        p = this._frustumPlanes[3];
        a = c41 - c21;
        b = c42 - c22;
        c = c43 - c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c24 - c44) * invLen;

        // near
        p = this._frustumPlanes[4];
        a = c31;
        b = c32;
        c = c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -c34 * invLen;

        // far
        p = this._frustumPlanes[5];
        a = c41 - c31;
        b = c42 - c32;
        c = c43 - c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c34 - c44) * invLen;

        this._frustumPlanesDirty = false;
    };

    /**
    * @protected
    */
    Camera.prototype.pInvalidateSceneTransform = function () {
        _super.prototype.pInvalidateSceneTransform.call(this);

        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
    };

    /**
    * @protected
    */
    Camera.prototype.pUpdateBounds = function () {
        this._pBoundsInvalid = false;
        this._pBounds.nullify();
    };

    Object.defineProperty(Camera.prototype, "projection", {
        /**
        *
        */
        get: function () {
            return this._projection;
        },
        set: function (value) {
            if (this._projection == value)
                return;

            if (!value)
                throw new Error("Projection cannot be null!");

            this._projection.removeEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this._projection = value;
            this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this.dispatchEvent(new CameraEvent(CameraEvent.PROJECTION_CHANGED, this));
        },
        enumerable: true,
        configurable: true
    });


    Object.defineProperty(Camera.prototype, "viewProjection", {
        /**
        *
        */
        get: function () {
            if (this._viewProjectionDirty) {
                this._viewProjection.copyFrom(this.inverseSceneTransform);
                this._viewProjection.append(this._projection.matrix);
                this._viewProjectionDirty = false;
            }

            return this._viewProjection;
        },
        enumerable: true,
        configurable: true
    });

    /**
    * Calculates the ray in scene space from the camera to the given normalized coordinates in screen space.
    *
    * @param nX The normalised x coordinate in screen space, -1 corresponds to the left edge of the viewport, 1 to the right.
    * @param nY The normalised y coordinate in screen space, -1 corresponds to the top edge of the viewport, 1 to the bottom.
    * @param sZ The z coordinate in screen space, representing the distance into the screen.
    * @return The ray from the camera to the scene space position of the given screen coordinates.
    */
    Camera.prototype.getRay = function (nX, nY, sZ) {
        return this.sceneTransform.deltaTransformVector(this._projection.unproject(nX, nY, sZ));
    };

    /**
    * Calculates the normalised position in screen space of the given scene position.
    *
    * @param point3d the position vector of the scene coordinates to be projected.
    * @return The normalised screen position of the given scene coordinates.
    */
    Camera.prototype.project = function (point3d) {
        return this._projection.project(this.inverseSceneTransform.transformVector(point3d));
    };

    /**
    * Calculates the scene position of the given normalized coordinates in screen space.
    *
    * @param nX The normalised x coordinate in screen space, minus the originX offset of the projection property.
    * @param nY The normalised y coordinate in screen space, minus the originY offset of the projection property.
    * @param sZ The z coordinate in screen space, representing the distance into the screen.
    * @return The scene position of the given screen coordinates.
    */
    Camera.prototype.unproject = function (nX, nY, sZ) {
        return this.sceneTransform.transformVector(this._projection.unproject(nX, nY, sZ));
    };

    Camera.prototype._iCollectRenderables = function (renderer) {
        // Since this getter is invoked every iteration of the render loop, and
        // the prefab construct could affect the sub-meshes, the prefab is
        // validated here to give it a chance to rebuild.
        if (this._iSourcePrefab)
            this._iSourcePrefab._iValidate();

        this._iCollectRenderable(renderer);
    };

    Camera.prototype._iCollectRenderable = function (renderer) {
        //nothing to do here
    };
    return Camera;
})(DisplayObjectContainer);

module.exports = Camera;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVudGl0aWVzL0NhbWVyYS50cyJdLCJuYW1lcyI6WyJDYW1lcmEiLCJDYW1lcmEuY29uc3RydWN0b3IiLCJDYW1lcmEucENyZWF0ZURlZmF1bHRCb3VuZGluZ1ZvbHVtZSIsIkNhbWVyYS5wQ3JlYXRlRW50aXR5UGFydGl0aW9uTm9kZSIsIkNhbWVyYS5vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkIiwiQ2FtZXJhLnVwZGF0ZUZydXN0dW0iLCJDYW1lcmEucEludmFsaWRhdGVTY2VuZVRyYW5zZm9ybSIsIkNhbWVyYS5wVXBkYXRlQm91bmRzIiwiQ2FtZXJhLmdldFJheSIsIkNhbWVyYS5wcm9qZWN0IiwiQ2FtZXJhLnVucHJvamVjdCIsIkNhbWVyYS5faUNvbGxlY3RSZW5kZXJhYmxlcyIsIkNhbWVyYS5faUNvbGxlY3RSZW5kZXJhYmxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw2REFDb0U7QUFDcEUseUZBQTZGO0FBQzdGLDREQUFvRTtBQUNwRSwwREFBa0U7O0FBRWxFLGlFQUF3RTtBQUN4RSxxRUFBNEU7O0FBSTVFLCtEQUFzRTtBQUN0RSx1RUFBNkU7O0FBRTdFLHdGQUE0Rjs7QUFFNUY7SUFBcUJBLHlCQUFzQkE7SUFTMUNBLGdCQUFZQSxVQUE2QkE7UUFBN0JDLHlDQUFBQSxVQUFVQSxHQUFlQSxJQUFJQTtBQUFBQSxRQUF6Q0EsaUJBa0JDQTtRQWhCQUEsV0FBTUEsS0FBQUEsQ0FBQ0E7UUFUUkEsS0FBUUEsZUFBZUEsR0FBWUEsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbERBLEtBQVFBLG9CQUFvQkEsR0FBV0EsSUFBSUEsQ0FBQ0E7UUFHNUNBLEtBQVFBLG1CQUFtQkEsR0FBV0EsSUFBSUEsQ0FBQ0E7O1FBTzFDQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQTs7UUFFdEJBLElBQUlBLENBQUNBLGtDQUFrQ0EsR0FBR0EsVUFBQ0EsS0FBcUJBO21CQUFLQSxLQUFJQSxDQUFDQSx5QkFBeUJBLENBQUNBLEtBQUtBLENBQUNBO1FBQXJDQSxDQUFxQ0E7O1FBRTFHQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxVQUFVQSxJQUFJQSxJQUFJQSxxQkFBcUJBLENBQUNBLENBQUNBO1FBQzVEQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxnQkFBZ0JBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLEVBQUVBLElBQUlBLENBQUNBLGtDQUFrQ0EsQ0FBQ0E7O1FBRTFHQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxFQUFFQTs7UUFFeEJBLEtBQUtBLElBQUlBLENBQUNBLEdBQVVBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ2hDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTs7UUFFeENBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBO0lBRWZBLENBQUNBO0lBRURELGdEQUFBQTtRQUVDRSxPQUFPQSxJQUFJQSxVQUFVQSxDQUFDQSxDQUFDQTtJQUN4QkEsQ0FBQ0E7O0lBS0RGOztNQURHQTtrREFDSEE7UUFFQ0csT0FBT0EsSUFBSUEsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDNUJBLENBQUNBOztJQUdESDtRQUFBQSxXQURXQTthQUNYQTtZQUVDQSxPQUFPQSxTQUFTQSxDQUFDQSxNQUFNQTtRQUN4QkEsQ0FBQ0E7Ozs7QUFBQUE7SUFFREEsNkNBQUFBLFVBQWtDQSxLQUFxQkE7UUFFdERJLElBQUlBLENBQUNBLG9CQUFvQkEsR0FBR0EsSUFBSUE7UUFDaENBLElBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0EsSUFBSUE7UUFDL0JBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBO0lBQzFCQSxDQUFDQTs7SUFFREo7UUFBQUEsS0FBQUE7WUFFQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsbUJBQW1CQTtnQkFDM0JBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBOztZQUV0QkEsT0FBT0EsSUFBSUEsQ0FBQ0EsY0FBY0E7UUFDM0JBLENBQUNBOzs7O0FBQUFBO0lBRURBLGlDQUFBQTtRQUVDSyxJQUFJQSxDQUFDQSxFQUFTQSxDQUFDQSxFQUFTQSxDQUFDQTs7UUFDekJBLGlCQUFpQkE7UUFDakJBLElBQUlBLEdBQUdBLEVBQVNBLEdBQUdBLEVBQVNBLEdBQUdBLEVBQVNBLEdBQUdBO1FBQzNDQSxJQUFJQSxHQUFHQSxFQUFTQSxHQUFHQSxFQUFTQSxHQUFHQSxFQUFTQSxHQUFHQTtRQUMzQ0EsSUFBSUEsR0FBR0EsRUFBU0EsR0FBR0EsRUFBU0EsR0FBR0EsRUFBU0EsR0FBR0E7UUFDM0NBLElBQUlBLEdBQUdBLEVBQVNBLEdBQUdBLEVBQVNBLEdBQUdBLEVBQVNBLEdBQUdBO1FBQzNDQSxJQUFJQSxDQUFDQTtRQUNMQSxJQUFJQSxHQUFHQSxHQUFZQSxJQUFJQSxLQUFLQSxDQUFTQSxFQUFFQSxDQUFDQTtRQUN4Q0EsQ0FBQ0E7UUFDREEsSUFBSUEsTUFBTUE7UUFDVkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7O1FBRXRDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTs7UUFFYkEsYUFBYUE7UUFDYkEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDMUJBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQ2JBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQ2JBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQ2JBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTtRQUNkQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTtRQUNkQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTtRQUNkQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTs7UUFFekJBLGNBQWNBO1FBQ2RBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQTtRQUNiQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQTtRQUNiQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQTtRQUNiQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNyQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUE7UUFDZEEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUE7UUFDZEEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUE7UUFDZEEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUE7O1FBRXhCQSxTQUFTQTtRQUNUQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMxQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0E7UUFDYkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0E7UUFDYkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0E7UUFDYkEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BO1FBQ2RBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BO1FBQ2RBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BO1FBQ2RBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BOztRQUV6QkEsTUFBTUE7UUFDTkEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDMUJBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQ2JBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQ2JBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQ2JBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTtRQUNkQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTtRQUNkQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTtRQUNkQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFDQSxNQUFNQTs7UUFFeEJBLE9BQU9BO1FBQ1BBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxDQUFDQSxHQUFHQSxHQUFHQTtRQUNQQSxDQUFDQSxHQUFHQSxHQUFHQTtRQUNQQSxDQUFDQSxHQUFHQSxHQUFHQTtRQUNQQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNyQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUE7UUFDZEEs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b0JBQW9CQTtJQUNyQkEsQ0FBQ0E7SUFDRlosY0FBQ0E7QUFBREEsQ0FBQ0EsRUFoUm9CLHNCQUFzQixFQWdSMUM7O0FBRUQsdUJBQWdCLENBQUEiLCJmaWxlIjoiZW50aXRpZXMvQ2FtZXJhLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9yb2JiYXRlbWFuL1dlYnN0b3JtUHJvamVjdHMvYXdheWpzLWNvcmUvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvdW5kaW5nVm9sdW1lQmFzZVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvYm91bmRzL0JvdW5kaW5nVm9sdW1lQmFzZVwiKTtcbmltcG9ydCBOdWxsQm91bmRzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvYm91bmRzL051bGxCb3VuZHNcIik7XG5pbXBvcnQgRGlzcGxheU9iamVjdENvbnRhaW5lclx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvbnRhaW5lcnMvRGlzcGxheU9iamVjdENvbnRhaW5lclwiKTtcbmltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9nZW9tL01hdHJpeDNEXCIpO1xuaW1wb3J0IFBsYW5lM0RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9QbGFuZTNEXCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vVmVjdG9yM0RcIik7XG5pbXBvcnQgQXNzZXRUeXBlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9saWJyYXJ5L0Fzc2V0VHlwZVwiKTtcbmltcG9ydCBDYW1lcmFOb2RlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9wYXJ0aXRpb24vQ2FtZXJhTm9kZVwiKTtcbmltcG9ydCBFbnRpdHlOb2RlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9wYXJ0aXRpb24vRW50aXR5Tm9kZVwiKTtcbmltcG9ydCBJUmVuZGVyZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL3JlbmRlci9JUmVuZGVyZXJcIik7XG5pbXBvcnQgSUVudGl0eVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZW50aXRpZXMvSUVudGl0eVwiKTtcbmltcG9ydCBDYW1lcmFFdmVudFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9DYW1lcmFFdmVudFwiKTtcbmltcG9ydCBQcm9qZWN0aW9uRXZlbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1Byb2plY3Rpb25FdmVudFwiKTtcbmltcG9ydCBJUHJvamVjdGlvblx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL0lQcm9qZWN0aW9uXCIpO1xuaW1wb3J0IFBlcnNwZWN0aXZlUHJvamVjdGlvblx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL1BlcnNwZWN0aXZlUHJvamVjdGlvblwiKTtcblxuY2xhc3MgQ2FtZXJhIGV4dGVuZHMgRGlzcGxheU9iamVjdENvbnRhaW5lciBpbXBsZW1lbnRzIElFbnRpdHlcbntcblx0cHJpdmF0ZSBfdmlld1Byb2plY3Rpb246TWF0cml4M0QgPSBuZXcgTWF0cml4M0QoKTtcblx0cHJpdmF0ZSBfdmlld1Byb2plY3Rpb25EaXJ0eTpCb29sZWFuID0gdHJ1ZTtcblx0cHJpdmF0ZSBfcHJvamVjdGlvbjpJUHJvamVjdGlvbjtcblx0cHJpdmF0ZSBfZnJ1c3R1bVBsYW5lczpBcnJheTxQbGFuZTNEPjtcblx0cHJpdmF0ZSBfZnJ1c3R1bVBsYW5lc0RpcnR5OkJvb2xlYW4gPSB0cnVlO1xuXHRwcml2YXRlIF9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGU6KGV2ZW50OlByb2plY3Rpb25FdmVudCkgPT4gdm9pZDtcblxuXHRjb25zdHJ1Y3Rvcihwcm9qZWN0aW9uOklQcm9qZWN0aW9uID0gbnVsbClcblx0e1xuXHRcdHN1cGVyKCk7XG5cblx0XHR0aGlzLl9wSXNFbnRpdHkgPSB0cnVlO1xuXG5cdFx0dGhpcy5fb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlID0gKGV2ZW50OlByb2plY3Rpb25FdmVudCkgPT4gdGhpcy5vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkKGV2ZW50KTtcblxuXHRcdHRoaXMuX3Byb2plY3Rpb24gPSBwcm9qZWN0aW9uIHx8IG5ldyBQZXJzcGVjdGl2ZVByb2plY3Rpb24oKTtcblx0XHR0aGlzLl9wcm9qZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xuXG5cdFx0dGhpcy5fZnJ1c3R1bVBsYW5lcyA9IFtdO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgNjsgKytpKVxuXHRcdFx0dGhpcy5fZnJ1c3R1bVBsYW5lc1tpXSA9IG5ldyBQbGFuZTNEKCk7XG5cblx0XHR0aGlzLnogPSAtMTAwMDtcblxuXHR9XG5cblx0cHVibGljIHBDcmVhdGVEZWZhdWx0Qm91bmRpbmdWb2x1bWUoKTpCb3VuZGluZ1ZvbHVtZUJhc2Vcblx0e1xuXHRcdHJldHVybiBuZXcgTnVsbEJvdW5kcygpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBwcm90ZWN0ZWRcblx0ICovXG5cdHB1YmxpYyBwQ3JlYXRlRW50aXR5UGFydGl0aW9uTm9kZSgpOkVudGl0eU5vZGVcblx0e1xuXHRcdHJldHVybiBuZXcgQ2FtZXJhTm9kZSh0aGlzKTtcblx0fVxuXG5cdC8vQG92ZXJyaWRlXG5cdHB1YmxpYyBnZXQgYXNzZXRUeXBlKCk6c3RyaW5nXG5cdHtcblx0XHRyZXR1cm4gQXNzZXRUeXBlLkNBTUVSQTtcblx0fVxuXG5cdHByaXZhdGUgb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZChldmVudDpQcm9qZWN0aW9uRXZlbnQpXG5cdHtcblx0XHR0aGlzLl92aWV3UHJvamVjdGlvbkRpcnR5ID0gdHJ1ZTtcblx0XHR0aGlzLl9mcnVzdHVtUGxhbmVzRGlydHkgPSB0cnVlO1xuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IGZydXN0dW1QbGFuZXMoKTpBcnJheTxQbGFuZTNEPlxuXHR7XG5cdFx0aWYgKHRoaXMuX2ZydXN0dW1QbGFuZXNEaXJ0eSlcblx0XHRcdHRoaXMudXBkYXRlRnJ1c3R1bSgpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX2ZydXN0dW1QbGFuZXM7XG5cdH1cblxuXHRwcml2YXRlIHVwZGF0ZUZydXN0dW0oKVxuXHR7XG5cdFx0dmFyIGE6bnVtYmVyLCBiOm51bWJlciwgYzpudW1iZXI7XG5cdFx0Ly92YXIgZCA6IE51bWJlcjtcblx0XHR2YXIgYzExOm51bWJlciwgYzEyOm51bWJlciwgYzEzOm51bWJlciwgYzE0Om51bWJlcjtcblx0XHR2YXIgYzIxOm51bWJlciwgYzIyOm51bWJlciwgYzIzOm51bWJlciwgYzI0Om51bWJlcjtcblx0XHR2YXIgYzMxOm51bWJlciwgYzMyOm51bWJlciwgYzMzOm51bWJlciwgYzM0Om51bWJlcjtcblx0XHR2YXIgYzQxOm51bWJlciwgYzQyOm51bWJlciwgYzQzOm51bWJlciwgYzQ0Om51bWJlcjtcblx0XHR2YXIgcDpQbGFuZTNEO1xuXHRcdHZhciByYXc6bnVtYmVyW10gPSBuZXcgQXJyYXk8bnVtYmVyPigxNik7XG5cdFx0Oy8vbmV3IEFycmF5KDE2ICk7YXdheS51dGlscy5NYXRyaXgzRFV0aWxzLlJBV19EQVRBX0NPTlRBSU5FUjsvL1tdO1xuXHRcdHZhciBpbnZMZW46bnVtYmVyO1xuXHRcdHRoaXMudmlld1Byb2plY3Rpb24uY29weVJhd0RhdGFUbyhyYXcpO1xuXG5cdFx0YzExID0gcmF3WzBdO1xuXHRcdGMxMiA9IHJhd1s0XTtcblx0XHRjMTMgPSByYXdbOF07XG5cdFx0YzE0ID0gcmF3WzEyXTtcblx0XHRjMjEgPSByYXdbMV07XG5cdFx0YzIyID0gcmF3WzVdO1xuXHRcdGMyMyA9IHJhd1s5XTtcblx0XHRjMjQgPSByYXdbMTNdO1xuXHRcdGMzMSA9IHJhd1syXTtcblx0XHRjMzIgPSByYXdbNl07XG5cdFx0YzMzID0gcmF3WzEwXTtcblx0XHRjMzQgPSByYXdbMTRdO1xuXHRcdGM0MSA9IHJhd1szXTtcblx0XHRjNDIgPSByYXdbN107XG5cdFx0YzQzID0gcmF3WzExXTtcblx0XHRjNDQgPSByYXdbMTVdO1xuXG5cdFx0Ly8gbGVmdCBwbGFuZVxuXHRcdHAgPSB0aGlzLl9mcnVzdHVtUGxhbmVzWzBdO1xuXHRcdGEgPSBjNDEgKyBjMTE7XG5cdFx0YiA9IGM0MiArIGMxMjtcblx0XHRjID0gYzQzICsgYzEzO1xuXHRcdGludkxlbiA9IDEvTWF0aC5zcXJ0KGEqYSArIGIqYiArIGMqYyk7XG5cdFx0cC5hID0gYSppbnZMZW47XG5cdFx0cC5iID0gYippbnZMZW47XG5cdFx0cC5jID0gYyppbnZMZW47XG5cdFx0cC5kID0gLShjNDQgKyBjMTQpKmludkxlbjtcblxuXHRcdC8vIHJpZ2h0IHBsYW5lXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbMV07XG5cdFx0YSA9IGM0MSAtIGMxMTtcblx0XHRiID0gYzQyIC0gYzEyO1xuXHRcdGMgPSBjNDMgLSBjMTM7XG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcblx0XHRwLmEgPSBhKmludkxlbjtcblx0XHRwLmIgPSBiKmludkxlbjtcblx0XHRwLmMgPSBjKmludkxlbjtcblx0XHRwLmQgPSAoYzE0IC0gYzQ0KSppbnZMZW47XG5cblx0XHQvLyBib3R0b21cblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1syXTtcblx0XHRhID0gYzQxICsgYzIxO1xuXHRcdGIgPSBjNDIgKyBjMjI7XG5cdFx0YyA9IGM0MyArIGMyMztcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xuXHRcdHAuYSA9IGEqaW52TGVuO1xuXHRcdHAuYiA9IGIqaW52TGVuO1xuXHRcdHAuYyA9IGMqaW52TGVuO1xuXHRcdHAuZCA9IC0oYzQ0ICsgYzI0KSppbnZMZW47XG5cblx0XHQvLyB0b3Bcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1szXTtcblx0XHRhID0gYzQxIC0gYzIxO1xuXHRcdGIgPSBjNDIgLSBjMjI7XG5cdFx0YyA9IGM0MyAtIGMyMztcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xuXHRcdHAuYSA9IGEqaW52TGVuO1xuXHRcdHAuYiA9IGIqaW52TGVuO1xuXHRcdHAuYyA9IGMqaW52TGVuO1xuXHRcdHAuZCA9IChjMjQgLSBjNDQpKmludkxlbjtcblxuXHRcdC8vIG5lYXJcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1s0XTtcblx0XHRhID0gYzMxO1xuXHRcdGIgPSBjMzI7XG5cdFx0YyA9IGMzMztcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xuXHRcdHAuYSA9IGEqaW52TGVuO1xuXHRcdHAuYiA9IGIqaW52TGVuO1xuXHRcdHAuYyA9IGMqaW52TGVuO1xuXHRcdHAuZCA9IC1jMzQqaW52TGVuO1xuXG5cdFx0Ly8gZmFyXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbNV07XG5cdFx0YSA9IGM0MSAtIGMzMTtcblx0XHRiID0gYzQyIC0gYzMyO1xuXHRcdGMgPSBjNDMgLSBjMzM7XG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcblx0XHRwLmEgPSBhKmludkxlbjtcblx0XHRwLmIgPSBiKmludkxlbjtcblx0XHRwLmMgPSBjKmludkxlbjtcblx0XHRwLmQgPSAoYzM0IC0gYzQ0KSppbnZMZW47XG5cblx0XHR0aGlzLl9mcnVzdHVtUGxhbmVzRGlydHkgPSBmYWxzZTtcblxuXHR9XG5cblx0LyoqXG5cdCAqIEBwcm90ZWN0ZWRcblx0ICovXG5cdHB1YmxpYyBwSW52YWxpZGF0ZVNjZW5lVHJhbnNmb3JtKClcblx0e1xuXHRcdHN1cGVyLnBJbnZhbGlkYXRlU2NlbmVUcmFuc2Zvcm0oKTtcblxuXHRcdHRoaXMuX3ZpZXdQcm9qZWN0aW9uRGlydHkgPSB0cnVlO1xuXHRcdHRoaXMuX2ZydXN0dW1QbGFuZXNEaXJ0eSA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICogQHByb3RlY3RlZFxuXHQgKi9cblx0cHVibGljIHBVcGRhdGVCb3VuZHMoKVxuXHR7XG5cdFx0dGhpcy5fcEJvdW5kc0ludmFsaWQgPSBmYWxzZTtcblx0XHR0aGlzLl9wQm91bmRzLm51bGxpZnkoKTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGdldCBwcm9qZWN0aW9uKCk6SVByb2plY3Rpb25cblx0e1xuXHRcdHJldHVybiB0aGlzLl9wcm9qZWN0aW9uO1xuXHR9XG5cblx0cHVibGljIHNldCBwcm9qZWN0aW9uKHZhbHVlOklQcm9qZWN0aW9uKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3Byb2plY3Rpb24gPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHRpZiAoIXZhbHVlKVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiUHJvamVjdGlvbiBjYW5ub3QgYmUgbnVsbCFcIik7XG5cblx0XHR0aGlzLl9wcm9qZWN0aW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xuXHRcdHRoaXMuX3Byb2plY3Rpb24gPSB2YWx1ZTtcblx0XHR0aGlzLl9wcm9qZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgQ2FtZXJhRXZlbnQoQ2FtZXJhRXZlbnQuUFJPSkVDVElPTl9DSEFOR0VELCB0aGlzKSk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBnZXQgdmlld1Byb2plY3Rpb24oKTpNYXRyaXgzRFxuXHR7XG5cdFx0aWYgKHRoaXMuX3ZpZXdQcm9qZWN0aW9uRGlydHkpIHtcblx0XHRcdHRoaXMuX3ZpZXdQcm9qZWN0aW9uLmNvcHlGcm9tKHRoaXMuaW52ZXJzZVNjZW5lVHJhbnNmb3JtKTtcblx0XHRcdHRoaXMuX3ZpZXdQcm9qZWN0aW9uLmFwcGVuZCh0aGlzLl9wcm9qZWN0aW9uLm1hdHJpeCk7XG5cdFx0XHR0aGlzLl92aWV3UHJvamVjdGlvbkRpcnR5ID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX3ZpZXdQcm9qZWN0aW9uO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGN1bGF0ZXMgdGhlIHJheSBpbiBzY2VuZSBzcGFjZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIGdpdmVuIG5vcm1hbGl6ZWQgY29vcmRpbmF0ZXMgaW4gc2NyZWVuIHNwYWNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gblggVGhlIG5vcm1hbGlzZWQgeCBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgLTEgY29ycmVzcG9uZHMgdG8gdGhlIGxlZnQgZWRnZSBvZiB0aGUgdmlld3BvcnQsIDEgdG8gdGhlIHJpZ2h0LlxuXHQgKiBAcGFyYW0gblkgVGhlIG5vcm1hbGlzZWQgeSBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgLTEgY29ycmVzcG9uZHMgdG8gdGhlIHRvcCBlZGdlIG9mIHRoZSB2aWV3cG9ydCwgMSB0byB0aGUgYm90dG9tLlxuXHQgKiBAcGFyYW0gc1ogVGhlIHogY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIHJlcHJlc2VudGluZyB0aGUgZGlzdGFuY2UgaW50byB0aGUgc2NyZWVuLlxuXHQgKiBAcmV0dXJuIFRoZSByYXkgZnJvbSB0aGUgY2FtZXJhIHRvIHRoZSBzY2VuZSBzcGFjZSBwb3NpdGlvbiBvZiB0aGUgZ2l2ZW4gc2NyZWVuIGNvb3JkaW5hdGVzLlxuXHQgKi9cblx0cHVibGljIGdldFJheShuWDpudW1iZXIsIG5ZOm51bWJlciwgc1o6bnVtYmVyKTpWZWN0b3IzRFxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuc2NlbmVUcmFuc2Zvcm0uZGVsdGFUcmFuc2Zvcm1WZWN0b3IodGhpcy5fcHJvamVjdGlvbi51bnByb2plY3QoblgsIG5ZLCBzWikpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGN1bGF0ZXMgdGhlIG5vcm1hbGlzZWQgcG9zaXRpb24gaW4gc2NyZWVuIHNwYWNlIG9mIHRoZSBnaXZlbiBzY2VuZSBwb3NpdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHBvaW50M2QgdGhlIHBvc2l0aW9uIHZlY3RvciBvZiB0aGUgc2NlbmUgY29vcmRpbmF0ZXMgdG8gYmUgcHJvamVjdGVkLlxuXHQgKiBAcmV0dXJuIFRoZSBub3JtYWxpc2VkIHNjcmVlbiBwb3NpdGlvbiBvZiB0aGUgZ2l2ZW4gc2NlbmUgY29vcmRpbmF0ZXMuXG5cdCAqL1xuXHRwdWJsaWMgcHJvamVjdChwb2ludDNkOlZlY3RvcjNEKTpWZWN0b3IzRFxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Rpb24ucHJvamVjdCh0aGlzLmludmVyc2VTY2VuZVRyYW5zZm9ybS50cmFuc2Zvcm1WZWN0b3IocG9pbnQzZCkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGN1bGF0ZXMgdGhlIHNjZW5lIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBub3JtYWxpemVkIGNvb3JkaW5hdGVzIGluIHNjcmVlbiBzcGFjZS5cblx0ICpcblx0ICogQHBhcmFtIG5YIFRoZSBub3JtYWxpc2VkIHggY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIG1pbnVzIHRoZSBvcmlnaW5YIG9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiBwcm9wZXJ0eS5cblx0ICogQHBhcmFtIG5ZIFRoZSBub3JtYWxpc2VkIHkgY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIG1pbnVzIHRoZSBvcmlnaW5ZIG9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiBwcm9wZXJ0eS5cblx0ICogQHBhcmFtIHNaIFRoZSB6IGNvb3JkaW5hdGUgaW4gc2NyZWVuIHNwYWNlLCByZXByZXNlbnRpbmcgdGhlIGRpc3RhbmNlIGludG8gdGhlIHNjcmVlbi5cblx0ICogQHJldHVybiBUaGUgc2NlbmUgcG9zaXRpb24gb2YgdGhlIGdpdmVuIHNjcmVlbiBjb29yZGluYXRlcy5cblx0ICovXG5cdHB1YmxpYyB1bnByb2plY3Qoblg6bnVtYmVyLCBuWTpudW1iZXIsIHNaOm51bWJlcik6VmVjdG9yM0Rcblx0e1xuXHRcdHJldHVybiB0aGlzLnNjZW5lVHJhbnNmb3JtLnRyYW5zZm9ybVZlY3Rvcih0aGlzLl9wcm9qZWN0aW9uLnVucHJvamVjdChuWCwgblksIHNaKSk7XG5cdH1cblxuXHRwdWJsaWMgX2lDb2xsZWN0UmVuZGVyYWJsZXMocmVuZGVyZXI6SVJlbmRlcmVyKVxuXHR7XG5cdFx0Ly8gU2luY2UgdGhpcyBnZXR0ZXIgaXMgaW52b2tlZCBldmVyeSBpdGVyYXRpb24gb2YgdGhlIHJlbmRlciBsb29wLCBhbmRcblx0XHQvLyB0aGUgcHJlZmFiIGNvbnN0cnVjdCBjb3VsZCBhZmZlY3QgdGhlIHN1Yi1tZXNoZXMsIHRoZSBwcmVmYWIgaXNcblx0XHQvLyB2YWxpZGF0ZWQgaGVyZSB0byBnaXZlIGl0IGEgY2hhbmNlIHRvIHJlYnVpbGQuXG5cdFx0aWYgKHRoaXMuX2lTb3VyY2VQcmVmYWIpXG5cdFx0XHR0aGlzLl9pU291cmNlUHJlZmFiLl9pVmFsaWRhdGUoKTtcblxuXHRcdHRoaXMuX2lDb2xsZWN0UmVuZGVyYWJsZShyZW5kZXJlcik7XG5cdH1cblxuXHRwdWJsaWMgX2lDb2xsZWN0UmVuZGVyYWJsZShyZW5kZXJlcjpJUmVuZGVyZXIpXG5cdHtcblx0XHQvL25vdGhpbmcgdG8gZG8gaGVyZVxuXHR9XG59XG5cbmV4cG9ydCA9IENhbWVyYTsiXX0=