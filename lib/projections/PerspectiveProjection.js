var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var CoordinateSystem = require("awayjs-core/lib/projections/CoordinateSystem");
var ProjectionBase = require("awayjs-core/lib/projections/ProjectionBase");
var PerspectiveProjection = (function (_super) {
    __extends(PerspectiveProjection, _super);
    function PerspectiveProjection(fieldOfView, coordinateSystem) {
        if (fieldOfView === void 0) { fieldOfView = 60; }
        if (coordinateSystem === void 0) { coordinateSystem = "leftHanded"; }
        _super.call(this, coordinateSystem);
        this._fieldOfView = 60;
        this._focalLength = 1000;
        this._hFieldOfView = 60;
        this._hFocalLength = 1000;
        this._preserveAspectRatio = true;
        this._preserveFocalLength = false;
        this.fieldOfView = fieldOfView;
    }
    Object.defineProperty(PerspectiveProjection.prototype, "preserveAspectRatio", {
        /**
         *
         */
        get: function () {
            return this._preserveAspectRatio;
        },
        set: function (value) {
            if (this._preserveAspectRatio == value)
                return;
            this._preserveAspectRatio = value;
            if (this._preserveAspectRatio)
                this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PerspectiveProjection.prototype, "preserveFocalLength", {
        /**
         *
         */
        get: function () {
            return this._preserveFocalLength;
        },
        set: function (value) {
            if (this._preserveFocalLength == value)
                return;
            this._preserveFocalLength = value;
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PerspectiveProjection.prototype, "fieldOfView", {
        /**
         *
         */
        get: function () {
            return this._fieldOfView;
        },
        set: function (value) {
            if (this._fieldOfView == value)
                return;
            this._fieldOfView = value;
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PerspectiveProjection.prototype, "focalLength", {
        /**
         *
         */
        get: function () {
            return this._focalLength;
        },
        set: function (value) {
            if (this._focalLength == value)
                return;
            this._focalLength = value;
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PerspectiveProjection.prototype, "hFieldOfView", {
        /**
         *
         */
        get: function () {
            return this._hFieldOfView;
        },
        set: function (value) {
            if (this._hFieldOfView == value)
                return;
            this._hFieldOfView = value;
            this._hFocalLength = 1 / Math.tan(this._hFieldOfView * Math.PI / 360);
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PerspectiveProjection.prototype, "hFocalLength", {
        /**
         *
         */
        get: function () {
            return this._hFocalLength;
        },
        set: function (value) {
            if (this._hFocalLength == value)
                return;
            this._hFocalLength = value;
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    //@override
    PerspectiveProjection.prototype.unproject = function (nX, nY, sZ) {
        var v = new Vector3D(nX, -nY, sZ, 1.0);
        v.x *= sZ;
        v.y *= sZ;
        v = this.unprojectionMatrix.transformVector(v);
        //z is unaffected by transform
        v.z = sZ;
        return v;
    };
    //@override
    PerspectiveProjection.prototype.clone = function () {
        var clone = new PerspectiveProjection(this._fieldOfView);
        clone._pNear = this._pNear;
        clone._pFar = this._pFar;
        clone._pAspectRatio = this._pAspectRatio;
        clone._pCoordinateSystem = this._pCoordinateSystem;
        return clone;
    };
    //@override
    PerspectiveProjection.prototype.pUpdateMatrix = function () {
        var raw = [];
        if (this._preserveFocalLength) {
            if (this._preserveAspectRatio)
                this._hFocalLength = this._focalLength;
            this._fieldOfView = Math.atan(0.5 * this._pScissorRect.height / this._focalLength) * 360 / Math.PI;
            this._hFieldOfView = Math.atan(0.5 * this._pScissorRect.width / this._hFocalLength) * 360 / Math.PI;
        }
        else {
            this._focalLength = 0.5 * this._pScissorRect.height / Math.tan(this._fieldOfView * Math.PI / 360);
            if (this._preserveAspectRatio)
                this._hFocalLength = this._focalLength;
            else
                this._hFocalLength = 0.5 * this._pScissorRect.width / Math.tan(this._hFieldOfView * Math.PI / 360);
        }
        var tanMinX = -this._pOriginX / this._hFocalLength;
        var tanMaxX = (1 - this._pOriginX) / this._hFocalLength;
        var tanMinY = -this._pOriginY / this._focalLength;
        var tanMaxY = (1 - this._pOriginY) / this._focalLength;
        var left;
        var right;
        var top;
        var bottom;
        // assume scissored frustum
        var center = -((tanMinX - tanMaxX) * this._pScissorRect.x + tanMinX * this._pScissorRect.width);
        var middle = ((tanMinY - tanMaxY) * this._pScissorRect.y + tanMinY * this._pScissorRect.height);
        left = center - (tanMaxX - tanMinX) * this._pViewPort.width;
        right = center;
        top = middle;
        bottom = middle + (tanMaxY - tanMinY) * this._pViewPort.height;
        raw[0] = 2 / (right - left);
        raw[5] = 2 / (bottom - top);
        raw[8] = (right + left) / (right - left);
        raw[9] = (bottom + top) / (bottom - top);
        raw[10] = (this._pFar + this._pNear) / (this._pFar - this._pNear);
        raw[11] = 1;
        raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[12] = raw[13] = raw[15] = 0;
        raw[14] = -2 * this._pFar * this._pNear / (this._pFar - this._pNear);
        if (this._pCoordinateSystem == CoordinateSystem.RIGHT_HANDED)
            raw[5] = -raw[5];
        this._pMatrix.copyRawDataFrom(raw);
        this._pFrustumCorners[0] = this._pFrustumCorners[9] = this._pNear * left;
        this._pFrustumCorners[3] = this._pFrustumCorners[6] = this._pNear * right;
        this._pFrustumCorners[1] = this._pFrustumCorners[4] = this._pNear * top;
        this._pFrustumCorners[7] = this._pFrustumCorners[10] = this._pNear * bottom;
        this._pFrustumCorners[12] = this._pFrustumCorners[21] = this._pFar * left;
        this._pFrustumCorners[15] = this._pFrustumCorners[18] = this._pFar * right;
        this._pFrustumCorners[13] = this._pFrustumCorners[16] = this._pFar * top;
        this._pFrustumCorners[19] = this._pFrustumCorners[22] = this._pFar * bottom;
        this._pFrustumCorners[2] = this._pFrustumCorners[5] = this._pFrustumCorners[8] = this._pFrustumCorners[11] = this._pNear;
        this._pFrustumCorners[14] = this._pFrustumCorners[17] = this._pFrustumCorners[20] = this._pFrustumCorners[23] = this._pFar;
        this._pMatrixInvalid = false;
    };
    return PerspectiveProjection;
})(ProjectionBase);
module.exports = PerspectiveProjection;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9QZXJzcGVjdGl2ZVByb2plY3Rpb24udHMiXSwibmFtZXMiOlsiUGVyc3BlY3RpdmVQcm9qZWN0aW9uIiwiUGVyc3BlY3RpdmVQcm9qZWN0aW9uLmNvbnN0cnVjdG9yIiwiUGVyc3BlY3RpdmVQcm9qZWN0aW9uLnByZXNlcnZlQXNwZWN0UmF0aW8iLCJQZXJzcGVjdGl2ZVByb2plY3Rpb24ucHJlc2VydmVGb2NhbExlbmd0aCIsIlBlcnNwZWN0aXZlUHJvamVjdGlvbi5maWVsZE9mVmlldyIsIlBlcnNwZWN0aXZlUHJvamVjdGlvbi5mb2NhbExlbmd0aCIsIlBlcnNwZWN0aXZlUHJvamVjdGlvbi5oRmllbGRPZlZpZXciLCJQZXJzcGVjdGl2ZVByb2plY3Rpb24uaEZvY2FsTGVuZ3RoIiwiUGVyc3BlY3RpdmVQcm9qZWN0aW9uLnVucHJvamVjdCIsIlBlcnNwZWN0aXZlUHJvamVjdGlvbi5jbG9uZSIsIlBlcnNwZWN0aXZlUHJvamVjdGlvbi5wVXBkYXRlTWF0cml4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBZSwrQkFBK0IsQ0FBQyxDQUFDO0FBQy9ELElBQU8sZ0JBQWdCLFdBQWEsOENBQThDLENBQUMsQ0FBQztBQUNwRixJQUFPLGNBQWMsV0FBYSw0Q0FBNEMsQ0FBQyxDQUFDO0FBRWhGLElBQU0scUJBQXFCO0lBQVNBLFVBQTlCQSxxQkFBcUJBLFVBQXVCQTtJQVNqREEsU0FUS0EscUJBQXFCQSxDQVNkQSxXQUF1QkEsRUFBRUEsZ0JBQXNDQTtRQUEvREMsMkJBQXVCQSxHQUF2QkEsZ0JBQXVCQTtRQUFFQSxnQ0FBc0NBLEdBQXRDQSwrQkFBc0NBO1FBRTFFQSxrQkFBTUEsZ0JBQWdCQSxDQUFDQSxDQUFDQTtRQVRqQkEsaUJBQVlBLEdBQVVBLEVBQUVBLENBQUNBO1FBQ3pCQSxpQkFBWUEsR0FBVUEsSUFBSUEsQ0FBQ0E7UUFDM0JBLGtCQUFhQSxHQUFVQSxFQUFFQSxDQUFDQTtRQUMxQkEsa0JBQWFBLEdBQVVBLElBQUlBLENBQUNBO1FBQzVCQSx5QkFBb0JBLEdBQVdBLElBQUlBLENBQUNBO1FBQ3BDQSx5QkFBb0JBLEdBQVdBLEtBQUtBLENBQUNBO1FBSzVDQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxXQUFXQSxDQUFDQTtJQUNoQ0EsQ0FBQ0E7SUFLREQsc0JBQVdBLHNEQUFtQkE7UUFIOUJBOztXQUVHQTthQUNIQTtZQUVDRSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBO1FBQ2xDQSxDQUFDQTthQUVERixVQUErQkEsS0FBYUE7WUFFM0NFLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLG9CQUFvQkEsSUFBSUEsS0FBS0EsQ0FBQ0E7Z0JBQ3RDQSxNQUFNQSxDQUFDQTtZQUVSQSxJQUFJQSxDQUFDQSxvQkFBb0JBLEdBQUdBLEtBQUtBLENBQUNBO1lBRWxDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBO2dCQUM3QkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7OztPQVhBRjtJQWdCREEsc0JBQVdBLHNEQUFtQkE7UUFIOUJBOztXQUVHQTthQUNIQTtZQUVDRyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBO1FBQ2xDQSxDQUFDQTthQUVESCxVQUErQkEsS0FBYUE7WUFFM0NHLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLG9CQUFvQkEsSUFBSUEsS0FBS0EsQ0FBQ0E7Z0JBQ3RDQSxNQUFNQSxDQUFDQTtZQUVSQSxJQUFJQSxDQUFDQSxvQkFBb0JBLEdBQUdBLEtBQUtBLENBQUNBO1lBRWxDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO1FBQzFCQSxDQUFDQTs7O09BVkFIO0lBZURBLHNCQUFXQSw4Q0FBV0E7UUFIdEJBOztXQUVHQTthQUNIQTtZQUVDSSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7YUFFREosVUFBdUJBLEtBQVlBO1lBRWxDSSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxJQUFJQSxLQUFLQSxDQUFDQTtnQkFDOUJBLE1BQU1BLENBQUNBO1lBRVJBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLEtBQUtBLENBQUNBO1lBRTFCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO1FBQzFCQSxDQUFDQTs7O09BVkFKO0lBZURBLHNCQUFXQSw4Q0FBV0E7UUFIdEJBOztXQUVHQTthQUNIQTtZQUVDSyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7YUFFREwsVUFBdUJBLEtBQVlBO1lBRWxDSyxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxJQUFJQSxLQUFLQSxDQUFDQTtnQkFDOUJBLE1BQU1BLENBQUNBO1lBRVJBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLEtBQUtBLENBQUNBO1lBRTFCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO1FBQzFCQSxDQUFDQTs7O09BVkFMO0lBZURBLHNCQUFXQSwrQ0FBWUE7UUFIdkJBOztXQUVHQTthQUNIQTtZQUVDTSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7YUFFRE4sVUFBd0JBLEtBQVlBO1lBRW5DTSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxJQUFJQSxLQUFLQSxDQUFDQTtnQkFDL0JBLE1BQU1BLENBQUNBO1lBRVJBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLEtBQUtBLENBQUNBO1lBRTNCQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUVoRUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7OztPQVpBTjtJQWlCREEsc0JBQVdBLCtDQUFZQTtRQUh2QkE7O1dBRUdBO2FBQ0hBO1lBRUNPLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBQzNCQSxDQUFDQTthQUVEUCxVQUF3QkEsS0FBWUE7WUFFbkNPLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLElBQUlBLEtBQUtBLENBQUNBO2dCQUMvQkEsTUFBTUEsQ0FBQ0E7WUFFUkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsS0FBS0EsQ0FBQ0E7WUFFM0JBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0E7UUFDMUJBLENBQUNBOzs7T0FWQVA7SUFhREEsV0FBV0E7SUFDSkEseUNBQVNBLEdBQWhCQSxVQUFpQkEsRUFBU0EsRUFBRUEsRUFBU0EsRUFBRUEsRUFBU0E7UUFFL0NRLElBQUlBLENBQUNBLEdBQVlBLElBQUlBLFFBQVFBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO1FBRWhEQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQTtRQUNWQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQTtRQUVWQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRS9DQSxBQUNBQSw4QkFEOEJBO1FBQzlCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUVUQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUNWQSxDQUFDQTtJQUVEUixXQUFXQTtJQUNKQSxxQ0FBS0EsR0FBWkE7UUFFQ1MsSUFBSUEsS0FBS0EsR0FBeUJBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFDL0VBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQzNCQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUN6QkEsS0FBS0EsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFDekNBLEtBQUtBLENBQUNBLGtCQUFrQkEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQTtRQUNuREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7SUFDZEEsQ0FBQ0E7SUFFRFQsV0FBV0E7SUFDSkEsNkNBQWFBLEdBQXBCQTtRQUVDVSxJQUFJQSxHQUFHQSxHQUFZQSxFQUFFQSxDQUFDQTtRQUV0QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMvQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQTtnQkFDN0JBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBO1lBRXhDQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxHQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxHQUFDQSxHQUFHQSxHQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUMzRkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsS0FBS0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsR0FBQ0EsR0FBR0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDN0ZBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLEdBQUdBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLE1BQU1BLEdBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUNBLElBQUlBLENBQUNBLEVBQUVBLEdBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBRTFGQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBO2dCQUM3QkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7WUFDeENBLElBQUlBO2dCQUNIQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxHQUFHQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUM3RkEsQ0FBQ0E7UUFFREEsSUFBSUEsT0FBT0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFDakRBLElBQUlBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBQ3REQSxJQUFJQSxPQUFPQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUNoREEsSUFBSUEsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFFckRBLElBQUlBLElBQVdBLENBQUNBO1FBQ2hCQSxJQUFJQSxLQUFZQSxDQUFDQTtRQUNqQkEsSUFBSUEsR0FBVUEsQ0FBQ0E7UUFDZkEsSUFBSUEsTUFBYUEsQ0FBQ0E7UUFFbEJBLEFBQ0FBLDJCQUQyQkE7WUFDdkJBLE1BQU1BLEdBQVVBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLEdBQUdBLE9BQU9BLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQ25HQSxJQUFJQSxNQUFNQSxHQUFVQSxDQUFDQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUVuR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsT0FBT0EsR0FBR0EsT0FBT0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDMURBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBO1FBQ2ZBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBO1FBQ2JBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLE1BQU1BLENBQUNBO1FBRTdEQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUMxQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDMUJBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLEdBQUNBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBO1FBQ3ZDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN2Q0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDaEVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ1pBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3RGQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUUvREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxJQUFJQSxnQkFBZ0JBLENBQUNBLFlBQVlBLENBQUNBO1lBQzVEQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVsQkEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFbkNBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFDQSxJQUFJQSxDQUFDQTtRQUN2RUEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLEdBQUNBLEtBQUtBLENBQUNBO1FBQ3hFQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDdEVBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFDQSxNQUFNQSxDQUFDQTtRQUUxRUEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLEdBQUNBLElBQUlBLENBQUNBO1FBQ3hFQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDekVBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFDQSxHQUFHQSxDQUFDQTtRQUN2RUEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLEdBQUNBLE1BQU1BLENBQUNBO1FBRTFFQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQ3pIQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBO1FBRTNIQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxLQUFLQSxDQUFDQTtJQUc5QkEsQ0FBQ0E7SUFDRlYsNEJBQUNBO0FBQURBLENBaE9BLEFBZ09DQSxFQWhPbUMsY0FBYyxFQWdPakQ7QUFFRCxBQUErQixpQkFBdEIscUJBQXFCLENBQUMiLCJmaWxlIjoicHJvamVjdGlvbnMvUGVyc3BlY3RpdmVQcm9qZWN0aW9uLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBDb29yZGluYXRlU3lzdGVtXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL0Nvb3JkaW5hdGVTeXN0ZW1cIik7XG5pbXBvcnQgUHJvamVjdGlvbkJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvUHJvamVjdGlvbkJhc2VcIik7XG5cbmNsYXNzIFBlcnNwZWN0aXZlUHJvamVjdGlvbiBleHRlbmRzIFByb2plY3Rpb25CYXNlXG57XG5cdHByaXZhdGUgX2ZpZWxkT2ZWaWV3Om51bWJlciA9IDYwO1xuXHRwcml2YXRlIF9mb2NhbExlbmd0aDpudW1iZXIgPSAxMDAwO1xuXHRwcml2YXRlIF9oRmllbGRPZlZpZXc6bnVtYmVyID0gNjA7XG5cdHByaXZhdGUgX2hGb2NhbExlbmd0aDpudW1iZXIgPSAxMDAwO1xuXHRwcml2YXRlIF9wcmVzZXJ2ZUFzcGVjdFJhdGlvOmJvb2xlYW4gPSB0cnVlO1xuXHRwcml2YXRlIF9wcmVzZXJ2ZUZvY2FsTGVuZ3RoOmJvb2xlYW4gPSBmYWxzZTtcblxuXHRjb25zdHJ1Y3RvcihmaWVsZE9mVmlldzpudW1iZXIgPSA2MCwgY29vcmRpbmF0ZVN5c3RlbTpzdHJpbmcgPSBcImxlZnRIYW5kZWRcIilcblx0e1xuXHRcdHN1cGVyKGNvb3JkaW5hdGVTeXN0ZW0pO1xuXHRcdHRoaXMuZmllbGRPZlZpZXcgPSBmaWVsZE9mVmlldztcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGdldCBwcmVzZXJ2ZUFzcGVjdFJhdGlvKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3ByZXNlcnZlQXNwZWN0UmF0aW87XG5cdH1cblxuXHRwdWJsaWMgc2V0IHByZXNlcnZlQXNwZWN0UmF0aW8odmFsdWU6Ym9vbGVhbilcblx0e1xuXHRcdGlmICh0aGlzLl9wcmVzZXJ2ZUFzcGVjdFJhdGlvID09IHZhbHVlKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fcHJlc2VydmVBc3BlY3RSYXRpbyA9IHZhbHVlO1xuXG5cdFx0aWYgKHRoaXMuX3ByZXNlcnZlQXNwZWN0UmF0aW8pXG5cdFx0XHR0aGlzLnBJbnZhbGlkYXRlTWF0cml4KCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBnZXQgcHJlc2VydmVGb2NhbExlbmd0aCgpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9wcmVzZXJ2ZUZvY2FsTGVuZ3RoO1xuXHR9XG5cblx0cHVibGljIHNldCBwcmVzZXJ2ZUZvY2FsTGVuZ3RoKHZhbHVlOmJvb2xlYW4pXG5cdHtcblx0XHRpZiAodGhpcy5fcHJlc2VydmVGb2NhbExlbmd0aCA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3ByZXNlcnZlRm9jYWxMZW5ndGggPSB2YWx1ZTtcblxuXHRcdHRoaXMucEludmFsaWRhdGVNYXRyaXgoKTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGdldCBmaWVsZE9mVmlldygpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2ZpZWxkT2ZWaWV3O1xuXHR9XG5cblx0cHVibGljIHNldCBmaWVsZE9mVmlldyh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fZmllbGRPZlZpZXcgPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9maWVsZE9mVmlldyA9IHZhbHVlO1xuXG5cdFx0dGhpcy5wSW52YWxpZGF0ZU1hdHJpeCgpO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IGZvY2FsTGVuZ3RoKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fZm9jYWxMZW5ndGg7XG5cdH1cblxuXHRwdWJsaWMgc2V0IGZvY2FsTGVuZ3RoKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl9mb2NhbExlbmd0aCA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX2ZvY2FsTGVuZ3RoID0gdmFsdWU7XG5cblx0XHR0aGlzLnBJbnZhbGlkYXRlTWF0cml4KCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBnZXQgaEZpZWxkT2ZWaWV3KCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5faEZpZWxkT2ZWaWV3O1xuXHR9XG5cblx0cHVibGljIHNldCBoRmllbGRPZlZpZXcodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2hGaWVsZE9mVmlldyA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX2hGaWVsZE9mVmlldyA9IHZhbHVlO1xuXG5cdFx0dGhpcy5faEZvY2FsTGVuZ3RoID0gMS9NYXRoLnRhbih0aGlzLl9oRmllbGRPZlZpZXcqTWF0aC5QSS8zNjApO1xuXG5cdFx0dGhpcy5wSW52YWxpZGF0ZU1hdHJpeCgpO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IGhGb2NhbExlbmd0aCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2hGb2NhbExlbmd0aDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgaEZvY2FsTGVuZ3RoKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl9oRm9jYWxMZW5ndGggPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9oRm9jYWxMZW5ndGggPSB2YWx1ZTtcblxuXHRcdHRoaXMucEludmFsaWRhdGVNYXRyaXgoKTtcblx0fVxuXG5cblx0Ly9Ab3ZlcnJpZGVcblx0cHVibGljIHVucHJvamVjdChuWDpudW1iZXIsIG5ZOm51bWJlciwgc1o6bnVtYmVyKTpWZWN0b3IzRFxuXHR7XG5cdFx0dmFyIHY6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0QoblgsIC1uWSwgc1osIDEuMCk7XG5cblx0XHR2LnggKj0gc1o7XG5cdFx0di55ICo9IHNaO1xuXG5cdFx0diA9IHRoaXMudW5wcm9qZWN0aW9uTWF0cml4LnRyYW5zZm9ybVZlY3Rvcih2KTtcblxuXHRcdC8veiBpcyB1bmFmZmVjdGVkIGJ5IHRyYW5zZm9ybVxuXHRcdHYueiA9IHNaO1xuXG5cdFx0cmV0dXJuIHY7XG5cdH1cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgY2xvbmUoKTpQcm9qZWN0aW9uQmFzZVxuXHR7XG5cdFx0dmFyIGNsb25lOlBlcnNwZWN0aXZlUHJvamVjdGlvbiA9IG5ldyBQZXJzcGVjdGl2ZVByb2plY3Rpb24odGhpcy5fZmllbGRPZlZpZXcpO1xuXHRcdGNsb25lLl9wTmVhciA9IHRoaXMuX3BOZWFyO1xuXHRcdGNsb25lLl9wRmFyID0gdGhpcy5fcEZhcjtcblx0XHRjbG9uZS5fcEFzcGVjdFJhdGlvID0gdGhpcy5fcEFzcGVjdFJhdGlvO1xuXHRcdGNsb25lLl9wQ29vcmRpbmF0ZVN5c3RlbSA9IHRoaXMuX3BDb29yZGluYXRlU3lzdGVtO1xuXHRcdHJldHVybiBjbG9uZTtcblx0fVxuXG5cdC8vQG92ZXJyaWRlXG5cdHB1YmxpYyBwVXBkYXRlTWF0cml4KClcblx0e1xuXHRcdHZhciByYXc6bnVtYmVyW10gPSBbXTtcblxuXHRcdGlmICh0aGlzLl9wcmVzZXJ2ZUZvY2FsTGVuZ3RoKSB7XG5cdFx0XHRpZiAodGhpcy5fcHJlc2VydmVBc3BlY3RSYXRpbylcblx0XHRcdFx0dGhpcy5faEZvY2FsTGVuZ3RoID0gdGhpcy5fZm9jYWxMZW5ndGg7XG5cblx0XHRcdHRoaXMuX2ZpZWxkT2ZWaWV3ID0gTWF0aC5hdGFuKDAuNSp0aGlzLl9wU2Npc3NvclJlY3QuaGVpZ2h0L3RoaXMuX2ZvY2FsTGVuZ3RoKSozNjAvTWF0aC5QSTtcblx0XHRcdHRoaXMuX2hGaWVsZE9mVmlldyA9IE1hdGguYXRhbigwLjUqdGhpcy5fcFNjaXNzb3JSZWN0LndpZHRoL3RoaXMuX2hGb2NhbExlbmd0aCkqMzYwL01hdGguUEk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuX2ZvY2FsTGVuZ3RoID0gMC41KnRoaXMuX3BTY2lzc29yUmVjdC5oZWlnaHQvTWF0aC50YW4odGhpcy5fZmllbGRPZlZpZXcqTWF0aC5QSS8zNjApO1xuXG5cdFx0XHRpZiAodGhpcy5fcHJlc2VydmVBc3BlY3RSYXRpbylcblx0XHRcdFx0dGhpcy5faEZvY2FsTGVuZ3RoID0gdGhpcy5fZm9jYWxMZW5ndGg7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdHRoaXMuX2hGb2NhbExlbmd0aCA9IDAuNSp0aGlzLl9wU2Npc3NvclJlY3Qud2lkdGgvTWF0aC50YW4odGhpcy5faEZpZWxkT2ZWaWV3Kk1hdGguUEkvMzYwKTtcblx0XHR9XG5cblx0XHR2YXIgdGFuTWluWCA9IC10aGlzLl9wT3JpZ2luWC90aGlzLl9oRm9jYWxMZW5ndGg7XG5cdFx0dmFyIHRhbk1heFggPSAoMSAtIHRoaXMuX3BPcmlnaW5YKS90aGlzLl9oRm9jYWxMZW5ndGg7XG5cdFx0dmFyIHRhbk1pblkgPSAtdGhpcy5fcE9yaWdpblkvdGhpcy5fZm9jYWxMZW5ndGg7XG5cdFx0dmFyIHRhbk1heFkgPSAoMSAtIHRoaXMuX3BPcmlnaW5ZKS90aGlzLl9mb2NhbExlbmd0aDtcblxuXHRcdHZhciBsZWZ0Om51bWJlcjtcblx0XHR2YXIgcmlnaHQ6bnVtYmVyO1xuXHRcdHZhciB0b3A6bnVtYmVyO1xuXHRcdHZhciBib3R0b206bnVtYmVyO1xuXG5cdFx0Ly8gYXNzdW1lIHNjaXNzb3JlZCBmcnVzdHVtXG5cdFx0dmFyIGNlbnRlcjpudW1iZXIgPSAtKCh0YW5NaW5YIC0gdGFuTWF4WCkqdGhpcy5fcFNjaXNzb3JSZWN0LnggKyB0YW5NaW5YKnRoaXMuX3BTY2lzc29yUmVjdC53aWR0aCk7XG5cdFx0dmFyIG1pZGRsZTpudW1iZXIgPSAoKHRhbk1pblkgLSB0YW5NYXhZKSp0aGlzLl9wU2Npc3NvclJlY3QueSArIHRhbk1pblkqdGhpcy5fcFNjaXNzb3JSZWN0LmhlaWdodCk7XG5cblx0XHRsZWZ0ID0gY2VudGVyIC0gKHRhbk1heFggLSB0YW5NaW5YKSp0aGlzLl9wVmlld1BvcnQud2lkdGg7XG5cdFx0cmlnaHQgPSBjZW50ZXI7XG5cdFx0dG9wID0gbWlkZGxlO1xuXHRcdGJvdHRvbSA9IG1pZGRsZSArICh0YW5NYXhZIC0gdGFuTWluWSkqdGhpcy5fcFZpZXdQb3J0LmhlaWdodDtcblxuXHRcdHJhd1swXSA9IDIvKHJpZ2h0IC0gbGVmdCk7XG5cdFx0cmF3WzVdID0gMi8oYm90dG9tIC0gdG9wKTtcblx0XHRyYXdbOF0gPSAocmlnaHQgKyBsZWZ0KS8ocmlnaHQgLSBsZWZ0KTtcblx0XHRyYXdbOV0gPSAoYm90dG9tICsgdG9wKS8oYm90dG9tIC0gdG9wKTtcblx0XHRyYXdbMTBdID0gKHRoaXMuX3BGYXIgKyB0aGlzLl9wTmVhcikvKHRoaXMuX3BGYXIgLSB0aGlzLl9wTmVhcik7XG5cdFx0cmF3WzExXSA9IDE7XG5cdFx0cmF3WzFdID0gcmF3WzJdID0gcmF3WzNdID0gcmF3WzRdID0gcmF3WzZdID0gcmF3WzddID0gcmF3WzEyXSA9IHJhd1sxM10gPSByYXdbMTVdID0gMDtcblx0XHRyYXdbMTRdID0gLTIqdGhpcy5fcEZhcip0aGlzLl9wTmVhci8odGhpcy5fcEZhciAtIHRoaXMuX3BOZWFyKTtcblxuXHRcdGlmICh0aGlzLl9wQ29vcmRpbmF0ZVN5c3RlbSA9PSBDb29yZGluYXRlU3lzdGVtLlJJR0hUX0hBTkRFRClcblx0XHRcdHJhd1s1XSA9IC1yYXdbNV07XG5cblx0XHR0aGlzLl9wTWF0cml4LmNvcHlSYXdEYXRhRnJvbShyYXcpO1xuXG5cdFx0dGhpcy5fcEZydXN0dW1Db3JuZXJzWzBdID0gdGhpcy5fcEZydXN0dW1Db3JuZXJzWzldID0gdGhpcy5fcE5lYXIqbGVmdDtcblx0XHR0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbM10gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbNl0gPSB0aGlzLl9wTmVhcipyaWdodDtcblx0XHR0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMV0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbNF0gPSB0aGlzLl9wTmVhcip0b3A7XG5cdFx0dGhpcy5fcEZydXN0dW1Db3JuZXJzWzddID0gdGhpcy5fcEZydXN0dW1Db3JuZXJzWzEwXSA9IHRoaXMuX3BOZWFyKmJvdHRvbTtcblxuXHRcdHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxMl0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMjFdID0gdGhpcy5fcEZhcipsZWZ0O1xuXHRcdHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxNV0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMThdID0gdGhpcy5fcEZhcipyaWdodDtcblx0XHR0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMTNdID0gdGhpcy5fcEZydXN0dW1Db3JuZXJzWzE2XSA9IHRoaXMuX3BGYXIqdG9wO1xuXHRcdHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxOV0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMjJdID0gdGhpcy5fcEZhcipib3R0b207XG5cblx0XHR0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMl0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbNV0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbOF0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMTFdID0gdGhpcy5fcE5lYXI7XG5cdFx0dGhpcy5fcEZydXN0dW1Db3JuZXJzWzE0XSA9IHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxN10gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMjBdID0gdGhpcy5fcEZydXN0dW1Db3JuZXJzWzIzXSA9IHRoaXMuX3BGYXI7XG5cblx0XHR0aGlzLl9wTWF0cml4SW52YWxpZCA9IGZhbHNlO1xuXG5cblx0fVxufVxuXG5leHBvcnQgPSBQZXJzcGVjdGl2ZVByb2plY3Rpb247Il19