var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var ProjectionEvent = require("awayjs-core/lib/events/ProjectionEvent");
var ProjectionBase = require("awayjs-core/lib/projections/ProjectionBase");
var ObliqueNearPlaneProjection = (function (_super) {
    __extends(ObliqueNearPlaneProjection, _super);
    function ObliqueNearPlaneProjection(baseProjection, plane) {
        var _this = this;
        _super.call(this);
        this.baseProjection = baseProjection;
        this.plane = plane;
        this._onProjectionMatrixChangedDelegate = function (event) { return _this.onProjectionMatrixChanged(event); };
    }
    Object.defineProperty(ObliqueNearPlaneProjection.prototype, "frustumCorners", {
        //@override
        get: function () {
            return this._baseProjection.frustumCorners;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ObliqueNearPlaneProjection.prototype, "near", {
        //@override
        get: function () {
            return this._baseProjection.near;
        },
        //@override
        set: function (value) {
            this._baseProjection.near = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ObliqueNearPlaneProjection.prototype, "far", {
        //@override
        get: function () {
            return this._baseProjection.far;
        },
        //@override
        set: function (value) {
            this._baseProjection.far = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ObliqueNearPlaneProjection.prototype, "iAspectRatio", {
        //@override
        get: function () {
            return this._baseProjection._iAspectRatio;
        },
        //@override
        set: function (value) {
            this._baseProjection._iAspectRatio = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ObliqueNearPlaneProjection.prototype, "plane", {
        get: function () {
            return this._plane;
        },
        set: function (value) {
            this._plane = value;
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ObliqueNearPlaneProjection.prototype, "baseProjection", {
        set: function (value) {
            if (this._baseProjection) {
                this._baseProjection.removeEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            }
            this._baseProjection = value;
            if (this._baseProjection) {
                this._baseProjection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            }
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });
    ObliqueNearPlaneProjection.prototype.onProjectionMatrixChanged = function (event) {
        this.pInvalidateMatrix();
    };
    //@override
    ObliqueNearPlaneProjection.prototype.pUpdateMatrix = function () {
        this._pMatrix.copyFrom(this._baseProjection.matrix);
        var cx = this._plane.a;
        var cy = this._plane.b;
        var cz = this._plane.c;
        var cw = -this._plane.d + .05;
        var signX = cx >= 0 ? 1 : -1;
        var signY = cy >= 0 ? 1 : -1;
        var p = new Vector3D(signX, signY, 1, 1);
        var inverse = this._pMatrix.clone();
        inverse.invert();
        var q = inverse.transformVector(p);
        this._pMatrix.copyRowTo(3, p);
        var a = (q.x * p.x + q.y * p.y + q.z * p.z + q.w * p.w) / (cx * q.x + cy * q.y + cz * q.z + cw * q.w);
        this._pMatrix.copyRowFrom(2, new Vector3D(cx * a, cy * a, cz * a, cw * a));
    };
    return ObliqueNearPlaneProjection;
})(ProjectionBase);
module.exports = ObliqueNearPlaneProjection;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9PYmxpcXVlTmVhclBsYW5lUHJvamVjdGlvbi50cyJdLCJuYW1lcyI6WyJPYmxpcXVlTmVhclBsYW5lUHJvamVjdGlvbiIsIk9ibGlxdWVOZWFyUGxhbmVQcm9qZWN0aW9uLmNvbnN0cnVjdG9yIiwiT2JsaXF1ZU5lYXJQbGFuZVByb2plY3Rpb24uZnJ1c3R1bUNvcm5lcnMiLCJPYmxpcXVlTmVhclBsYW5lUHJvamVjdGlvbi5uZWFyIiwiT2JsaXF1ZU5lYXJQbGFuZVByb2plY3Rpb24uZmFyIiwiT2JsaXF1ZU5lYXJQbGFuZVByb2plY3Rpb24uaUFzcGVjdFJhdGlvIiwiT2JsaXF1ZU5lYXJQbGFuZVByb2plY3Rpb24ucGxhbmUiLCJPYmxpcXVlTmVhclBsYW5lUHJvamVjdGlvbi5iYXNlUHJvamVjdGlvbiIsIk9ibGlxdWVOZWFyUGxhbmVQcm9qZWN0aW9uLm9uUHJvamVjdGlvbk1hdHJpeENoYW5nZWQiLCJPYmxpcXVlTmVhclBsYW5lUHJvamVjdGlvbi5wVXBkYXRlTWF0cml4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxJQUFPLFFBQVEsV0FBZSwrQkFBK0IsQ0FBQyxDQUFDO0FBQy9ELElBQU8sZUFBZSxXQUFhLHdDQUF3QyxDQUFDLENBQUM7QUFFN0UsSUFBTyxjQUFjLFdBQWEsNENBQTRDLENBQUMsQ0FBQztBQUVoRixJQUFNLDBCQUEwQjtJQUFTQSxVQUFuQ0EsMEJBQTBCQSxVQUF1QkE7SUFPdERBLFNBUEtBLDBCQUEwQkEsQ0FPbkJBLGNBQTBCQSxFQUFFQSxLQUFhQTtRQVB0REMsaUJBMEdDQTtRQWpHQ0EsaUJBQU9BLENBQUNBO1FBQ1JBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLGNBQWNBLENBQUNBO1FBQ3JDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUVuQkEsSUFBSUEsQ0FBQ0Esa0NBQWtDQSxHQUFHQSxVQUFDQSxLQUFxQkEsSUFBS0EsT0FBQUEsS0FB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QUFVQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM5QkEsSUFBSUEsRUFBRUEsR0FBVUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDOUJBLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBO1FBQ3JDQSxJQUFJQSxLQUFLQSxHQUFVQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNuQ0EsSUFBSUEsS0FBS0EsR0FBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLElBQUlBLENBQUNBLEdBQVlBLElBQUlBLFFBQVFBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ2xEQSxJQUFJQSxPQUFPQSxHQUFZQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUM3Q0EsT0FBT0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDakJBLElBQUlBLENBQUNBLEdBQVlBLE9BQU9BLENBQUNBLGVBQWVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzVDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM5QkEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0ZBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLFFBQVFBLENBQUNBLEVBQUVBLEdBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEdBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEdBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO0lBQ3BFQSxDQUFDQTtJQUNGVCxpQ0FBQ0E7QUFBREEsQ0ExR0EsQUEwR0NBLEVBMUd3QyxjQUFjLEVBMEd0RDtBQUVELEFBQW9DLGlCQUEzQiwwQkFBMEIsQ0FBQyIsImZpbGUiOiJwcm9qZWN0aW9ucy9PYmxpcXVlTmVhclBsYW5lUHJvamVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBQbGFuZTNEXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lM0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuaW1wb3J0IFByb2plY3Rpb25FdmVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvUHJvamVjdGlvbkV2ZW50XCIpO1xyXG5pbXBvcnQgSVByb2plY3Rpb25cdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9JUHJvamVjdGlvblwiKTtcclxuaW1wb3J0IFByb2plY3Rpb25CYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL1Byb2plY3Rpb25CYXNlXCIpO1xyXG5cclxuY2xhc3MgT2JsaXF1ZU5lYXJQbGFuZVByb2plY3Rpb24gZXh0ZW5kcyBQcm9qZWN0aW9uQmFzZVxyXG57XHJcblxyXG5cdHByaXZhdGUgX2Jhc2VQcm9qZWN0aW9uOklQcm9qZWN0aW9uO1xyXG5cdHByaXZhdGUgX3BsYW5lOlBsYW5lM0Q7XHJcblx0cHJpdmF0ZSBfb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlOihldmVudDpQcm9qZWN0aW9uRXZlbnQpID0+IHZvaWQ7XHJcblxyXG5cdGNvbnN0cnVjdG9yKGJhc2VQcm9qZWN0aW9uOklQcm9qZWN0aW9uLCBwbGFuZTpQbGFuZTNEKVxyXG5cdHtcclxuXHRcdHN1cGVyKCk7XHJcblx0XHR0aGlzLmJhc2VQcm9qZWN0aW9uID0gYmFzZVByb2plY3Rpb247XHJcblx0XHR0aGlzLnBsYW5lID0gcGxhbmU7XHJcblxyXG5cdFx0dGhpcy5fb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlID0gKGV2ZW50OlByb2plY3Rpb25FdmVudCkgPT4gdGhpcy5vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkKGV2ZW50KTtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIGdldCBmcnVzdHVtQ29ybmVycygpOm51bWJlcltdXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2Jhc2VQcm9qZWN0aW9uLmZydXN0dW1Db3JuZXJzO1xyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgZ2V0IG5lYXIoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fYmFzZVByb2plY3Rpb24ubmVhcjtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHNldCBuZWFyKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHR0aGlzLl9iYXNlUHJvamVjdGlvbi5uZWFyID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHQvL0BvdmVycmlkZVxyXG5cdHB1YmxpYyBnZXQgZmFyKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2Jhc2VQcm9qZWN0aW9uLmZhcjtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHNldCBmYXIodmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX2Jhc2VQcm9qZWN0aW9uLmZhciA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgZ2V0IGlBc3BlY3RSYXRpbygpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9iYXNlUHJvamVjdGlvbi5faUFzcGVjdFJhdGlvO1xyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgc2V0IGlBc3BlY3RSYXRpbyh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5fYmFzZVByb2plY3Rpb24uX2lBc3BlY3RSYXRpbyA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBwbGFuZSgpOlBsYW5lM0RcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcGxhbmU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHBsYW5lKHZhbHVlOlBsYW5lM0QpXHJcblx0e1xyXG5cdFx0dGhpcy5fcGxhbmUgPSB2YWx1ZTtcclxuXHRcdHRoaXMucEludmFsaWRhdGVNYXRyaXgoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgYmFzZVByb2plY3Rpb24odmFsdWU6SVByb2plY3Rpb24pXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2Jhc2VQcm9qZWN0aW9uKSB7XHJcblx0XHRcdHRoaXMuX2Jhc2VQcm9qZWN0aW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5fYmFzZVByb2plY3Rpb24gPSB2YWx1ZTtcclxuXHJcblx0XHRpZiAodGhpcy5fYmFzZVByb2plY3Rpb24pIHtcclxuXHRcdFx0dGhpcy5fYmFzZVByb2plY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihQcm9qZWN0aW9uRXZlbnQuTUFUUklYX0NIQU5HRUQsIHRoaXMuX29uUHJvamVjdGlvbk1hdHJpeENoYW5nZWREZWxlZ2F0ZSk7XHJcblx0XHR9XHJcblx0XHR0aGlzLnBJbnZhbGlkYXRlTWF0cml4KCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIG9uUHJvamVjdGlvbk1hdHJpeENoYW5nZWQoZXZlbnQ6UHJvamVjdGlvbkV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMucEludmFsaWRhdGVNYXRyaXgoKTtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHBVcGRhdGVNYXRyaXgoKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BNYXRyaXguY29weUZyb20odGhpcy5fYmFzZVByb2plY3Rpb24ubWF0cml4KTtcclxuXHJcblx0XHR2YXIgY3g6bnVtYmVyID0gdGhpcy5fcGxhbmUuYTtcclxuXHRcdHZhciBjeTpudW1iZXIgPSB0aGlzLl9wbGFuZS5iO1xyXG5cdFx0dmFyIGN6Om51bWJlciA9IHRoaXMuX3BsYW5lLmM7XHJcblx0XHR2YXIgY3c6bnVtYmVyID0gLXRoaXMuX3BsYW5lLmQgKyAuMDU7XHJcblx0XHR2YXIgc2lnblg6bnVtYmVyID0gY3ggPj0gMD8gMSA6IC0xO1xyXG5cdFx0dmFyIHNpZ25ZOm51bWJlciA9IGN5ID49IDA/IDEgOiAtMTtcclxuXHRcdHZhciBwOlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEKHNpZ25YLCBzaWduWSwgMSwgMSk7XHJcblx0XHR2YXIgaW52ZXJzZTpNYXRyaXgzRCA9IHRoaXMuX3BNYXRyaXguY2xvbmUoKTtcclxuXHRcdGludmVyc2UuaW52ZXJ0KCk7XHJcblx0XHR2YXIgcTpWZWN0b3IzRCA9IGludmVyc2UudHJhbnNmb3JtVmVjdG9yKHApO1xyXG5cdFx0dGhpcy5fcE1hdHJpeC5jb3B5Um93VG8oMywgcCk7XHJcblx0XHR2YXIgYTpudW1iZXIgPSAocS54KnAueCArIHEueSpwLnkgKyBxLnoqcC56ICsgcS53KnAudykvKGN4KnEueCArIGN5KnEueSArIGN6KnEueiArIGN3KnEudyk7XHJcblx0XHR0aGlzLl9wTWF0cml4LmNvcHlSb3dGcm9tKDIsIG5ldyBWZWN0b3IzRChjeCphLCBjeSphLCBjeiphLCBjdyphKSk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBPYmxpcXVlTmVhclBsYW5lUHJvamVjdGlvbjsiXX0=