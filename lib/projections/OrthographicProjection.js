var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/core/geom/Vector3D");
var ProjectionBase = require("awayjs-core/lib/projections/ProjectionBase");

var OrthographicProjection = (function (_super) {
    __extends(OrthographicProjection, _super);
    function OrthographicProjection(projectionHeight) {
        if (typeof projectionHeight === "undefined") { projectionHeight = 500; }
        _super.call(this);
        this._projectionHeight = projectionHeight;
    }
    Object.defineProperty(OrthographicProjection.prototype, "projectionHeight", {
        get: function () {
            return this._projectionHeight;
        },
        set: function (value) {
            if (value == this._projectionHeight) {
                return;
            }
            this._projectionHeight = value;
            this.pInvalidateMatrix();
        },
        enumerable: true,
        configurable: true
    });


    //@override
    OrthographicProjection.prototype.unproject = function (nX, nY, sZ) {
        var v = new Vector3D(nX + this.matrix.rawData[12], -nY + this.matrix.rawData[13], sZ, 1.0);
        v = this.unprojectionMatrix.transformVector(v);

        //z is unaffected by transform
        v.z = sZ;

        return v;
    };

    //@override
    OrthographicProjection.prototype.clone = function () {
        var clone = new OrthographicProjection();
        clone._pNear = this._pNear;
        clone._pFar = this._pFar;
        clone._pAspectRatio = this._pAspectRatio;
        clone.projectionHeight = this._projectionHeight;
        return clone;
    };

    //@override
    OrthographicProjection.prototype.pUpdateMatrix = function () {
        var raw = [];
        this._yMax = this._projectionHeight * .5;
        this._xMax = this._yMax * this._pAspectRatio;

        var left;
        var right;
        var top;
        var bottom;

        if (this._pScissorRect.x == 0 && this._pScissorRect.y == 0 && this._pScissorRect.width == this._pViewPort.width && this._pScissorRect.height == this._pViewPort.height) {
            // assume symmetric frustum
            left = -this._xMax;
            right = this._xMax;
            top = -this._yMax;
            bottom = this._yMax;

            raw[0] = 2 / (this._projectionHeight * this._pAspectRatio);
            raw[5] = 2 / this._projectionHeight;
            raw[10] = 1 / (this._pFar - this._pNear);
            raw[14] = this._pNear / (this._pNear - this._pFar);
            raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = raw[12] = raw[13] = 0;
            raw[15] = 1;
        } else {
            var xWidth = this._xMax * (this._pViewPort.width / this._pScissorRect.width);
            var yHgt = this._yMax * (this._pViewPort.height / this._pScissorRect.height);
            var center = this._xMax * (this._pScissorRect.x * 2 - this._pViewPort.width) / this._pScissorRect.width + this._xMax;
            var middle = -this._yMax * (this._pScissorRect.y * 2 - this._pViewPort.height) / this._pScissorRect.height - this._yMax;

            left = center - xWidth;
            right = center + xWidth;
            top = middle - yHgt;
            bottom = middle + yHgt;

            raw[0] = 2 * 1 / (right - left);
            raw[5] = -2 * 1 / (top - bottom);
            raw[10] = 1 / (this._pFar - this._pNear);

            raw[12] = (right + left) / (right - left);
            raw[13] = (bottom + top) / (bottom - top);
            raw[14] = this._pNear / (this.near - this.far);

            raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;
            raw[15] = 1;
        }

        this._pFrustumCorners[0] = this._pFrustumCorners[9] = this._pFrustumCorners[12] = this._pFrustumCorners[21] = left;
        this._pFrustumCorners[3] = this._pFrustumCorners[6] = this._pFrustumCorners[15] = this._pFrustumCorners[18] = right;
        this._pFrustumCorners[1] = this._pFrustumCorners[4] = this._pFrustumCorners[13] = this._pFrustumCorners[16] = top;
        this._pFrustumCorners[7] = this._pFrustumCorners[10] = this._pFrustumCorners[19] = this._pFrustumCorners[22] = bottom;
        this._pFrustumCorners[2] = this._pFrustumCorners[5] = this._pFrustumCorners[8] = this._pFrustumCorners[11] = this._pNear;
        this._pFrustumCorners[14] = this._pFrustumCorners[17] = this._pFrustumCorners[20] = this._pFrustumCorners[23] = this._pFar;

        this._pMatrix.copyRawDataFrom(raw);

        this._pMatrixInvalid = false;
    };
    return OrthographicProjection;
})(ProjectionBase);

module.exports = OrthographicProjection;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2plY3Rpb25zL09ydGhvZ3JhcGhpY1Byb2plY3Rpb24udHMiXSwibmFtZXMiOlsiT3J0aG9ncmFwaGljUHJvamVjdGlvbiIsIk9ydGhvZ3JhcGhpY1Byb2plY3Rpb24uY29uc3RydWN0b3IiLCJPcnRob2dyYXBoaWNQcm9qZWN0aW9uLnVucHJvamVjdCIsIk9ydGhvZ3JhcGhpY1Byb2plY3Rpb24uY2xvbmUiLCJPcnRob2dyYXBoaWNQcm9qZWN0aW9uLnBVcGRhdGVNYXRyaXgiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDREQUFvRTtBQUNwRSwwRUFBZ0Y7O0FBRWhGO0lBQXFDQSx5Q0FBY0E7SUFPbERBLGdDQUFZQSxnQkFBNkJBO1FBQTdCQywrQ0FBQUEsZ0JBQWdCQSxHQUFVQSxHQUFHQTtBQUFBQSxRQUV4Q0EsV0FBTUEsS0FBQUEsQ0FBQ0E7UUFDUEEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxnQkFBZ0JBO0lBQzFDQSxDQUFDQTtJQUVERDtRQUFBQSxLQUFBQTtZQUVDQSxPQUFPQSxJQUFJQSxDQUFDQSxpQkFBaUJBO1FBQzlCQSxDQUFDQTtRQUVEQSxLQUFBQSxVQUE0QkEsS0FBWUE7WUFFdkNBLElBQUlBLEtBQUtBLElBQUlBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBRUE7Z0JBQ3BDQSxNQUFPQTthQUNQQTtZQUNEQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLEtBQUtBO1lBQzlCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBO1FBQ3pCQSxDQUFDQTs7OztBQVRBQTs7SUFZREEsV0FEV0E7aURBQ1hBLFVBQWlCQSxFQUFTQSxFQUFFQSxFQUFTQSxFQUFFQSxFQUFTQTtRQUUvQ0UsSUFBSUEsQ0FBQ0EsR0FBWUEsSUFBSUEsUUFBUUEsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsQ0FBQ0E7UUFDbkdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7O1FBRTlDQSw4QkFBOEJBO1FBQzlCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQTs7UUFFUkEsT0FBT0EsQ0FBQ0E7SUFDVEEsQ0FBQ0E7O0lBR0RGLFdBRFdBOzZDQUNYQTtRQUVDRyxJQUFJQSxLQUFLQSxHQUEwQkEsSUFBSUEsc0JBQXNCQSxDQUFDQSxDQUFDQTtRQUMvREEsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUE7UUFDMUJBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBO1FBQ3hCQSxLQUFLQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQTtRQUN4Q0EsS0FBS0EsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBO1FBQy9DQSxPQUFPQSxLQUFLQTtJQUNiQSxDQUFDQTs7SUFHREgsV0FEV0E7cURBQ1hBO1FBRUNJLElBQUlBLEdBQUdBLEdBQVlBLEVBQUVBO1FBQ3JCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUNBLEVBQUVBO1FBQ3RDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQTs7UUFFMUNBLElBQUlBLElBQUlBO1FBQ1JBLElBQUlBLEtBQUtBO1FBQ1RBLElBQUlBLEdBQUdBO1FBQ1BBLElBQUlBLE1BQU1BOztRQUVWQSxJQUFJQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxDQUFFQTtZQUN2S0EsMkJBQTJCQTtZQUUzQkEsSUFBSUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0E7WUFDbEJBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBO1lBQ2xCQSxHQUFHQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQTtZQUNqQkEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0E7O1lBRW5CQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1lBQ3REQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBO1lBQ2pDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN0Q0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDaERBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBO1lBQ3ZHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQTtTQUVYQSxLQUFNQTtZQUVOQSxJQUFJQSxNQUFNQSxHQUFVQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUMvRUEsSUFBSUEsSUFBSUEsR0FBVUEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDL0VBLElBQUlBLE1BQU1BLEdBQVVBLElBQUlBLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBO1lBQ3JIQSxJQUFJQSxNQUFNQSxHQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQTs7WUFFeEhBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BO1lBQ3RCQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxNQUFNQTtZQUN2QkEsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUE7WUFDbkJBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBOztZQUV0QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDM0JBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBO1lBQzVCQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTs7WUFFdENBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLEdBQUNBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3ZDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxHQUFHQSxDQUFDQTtZQUN2Q0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7O1lBRTVDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQTtZQUNuRkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7U0FDWEE7O1FBRURBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUE7UUFDbEhBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsS0FBS0E7UUFDbkhBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0E7UUFDakhBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsTUFBTUE7UUFDckhBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUE7UUFDeEhBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0E7O1FBRTFIQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxlQUFlQSxDQUFDQSxHQUFHQSxDQUFDQTs7UUFFbENBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLEtBQUtBO0lBQzdCQSxDQUFDQTtJQUNGSiw4QkFBQ0E7QUFBREEsQ0FBQ0EsRUFoSG9DLGNBQWMsRUFnSGxEOztBQUVELHVDQUErQixDQUFBIiwiZmlsZSI6InByb2plY3Rpb25zL09ydGhvZ3JhcGhpY1Byb2plY3Rpb24uanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtY29yZS8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBQcm9qZWN0aW9uQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9Qcm9qZWN0aW9uQmFzZVwiKTtcblxuY2xhc3MgT3J0aG9ncmFwaGljUHJvamVjdGlvbiBleHRlbmRzIFByb2plY3Rpb25CYXNlXG57XG5cblx0cHJpdmF0ZSBfcHJvamVjdGlvbkhlaWdodDpudW1iZXI7XG5cdHByaXZhdGUgX3hNYXg6bnVtYmVyO1xuXHRwcml2YXRlIF95TWF4Om51bWJlcjtcblxuXHRjb25zdHJ1Y3Rvcihwcm9qZWN0aW9uSGVpZ2h0Om51bWJlciA9IDUwMClcblx0e1xuXHRcdHN1cGVyKCk7XG5cdFx0dGhpcy5fcHJvamVjdGlvbkhlaWdodCA9IHByb2plY3Rpb25IZWlnaHQ7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHByb2plY3Rpb25IZWlnaHQoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9wcm9qZWN0aW9uSGVpZ2h0O1xuXHR9XG5cblx0cHVibGljIHNldCBwcm9qZWN0aW9uSGVpZ2h0KHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh2YWx1ZSA9PSB0aGlzLl9wcm9qZWN0aW9uSGVpZ2h0KSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHRoaXMuX3Byb2plY3Rpb25IZWlnaHQgPSB2YWx1ZTtcblx0XHR0aGlzLnBJbnZhbGlkYXRlTWF0cml4KCk7XG5cdH1cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgdW5wcm9qZWN0KG5YOm51bWJlciwgblk6bnVtYmVyLCBzWjpudW1iZXIpOlZlY3RvcjNEXG5cdHtcblx0XHR2YXIgdjpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRChuWCArIHRoaXMubWF0cml4LnJhd0RhdGFbMTJdLCAtblkgKyB0aGlzLm1hdHJpeC5yYXdEYXRhWzEzXSwgc1osIDEuMCk7XG5cdFx0diA9IHRoaXMudW5wcm9qZWN0aW9uTWF0cml4LnRyYW5zZm9ybVZlY3Rvcih2KTtcblxuXHRcdC8veiBpcyB1bmFmZmVjdGVkIGJ5IHRyYW5zZm9ybVxuXHRcdHYueiA9IHNaO1xuXG5cdFx0cmV0dXJuIHY7XG5cdH1cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgY2xvbmUoKTpQcm9qZWN0aW9uQmFzZVxuXHR7XG5cdFx0dmFyIGNsb25lOk9ydGhvZ3JhcGhpY1Byb2plY3Rpb24gPSBuZXcgT3J0aG9ncmFwaGljUHJvamVjdGlvbigpO1xuXHRcdGNsb25lLl9wTmVhciA9IHRoaXMuX3BOZWFyO1xuXHRcdGNsb25lLl9wRmFyID0gdGhpcy5fcEZhcjtcblx0XHRjbG9uZS5fcEFzcGVjdFJhdGlvID0gdGhpcy5fcEFzcGVjdFJhdGlvO1xuXHRcdGNsb25lLnByb2plY3Rpb25IZWlnaHQgPSB0aGlzLl9wcm9qZWN0aW9uSGVpZ2h0O1xuXHRcdHJldHVybiBjbG9uZTtcblx0fVxuXG5cdC8vQG92ZXJyaWRlXG5cdHB1YmxpYyBwVXBkYXRlTWF0cml4KClcblx0e1xuXHRcdHZhciByYXc6bnVtYmVyW10gPSBbXTtcblx0XHR0aGlzLl95TWF4ID0gdGhpcy5fcHJvamVjdGlvbkhlaWdodCouNTtcblx0XHR0aGlzLl94TWF4ID0gdGhpcy5feU1heCp0aGlzLl9wQXNwZWN0UmF0aW87XG5cblx0XHR2YXIgbGVmdDpudW1iZXI7XG5cdFx0dmFyIHJpZ2h0Om51bWJlcjtcblx0XHR2YXIgdG9wOm51bWJlcjtcblx0XHR2YXIgYm90dG9tOm51bWJlcjtcblxuXHRcdGlmICh0aGlzLl9wU2Npc3NvclJlY3QueCA9PSAwICYmIHRoaXMuX3BTY2lzc29yUmVjdC55ID09IDAgJiYgdGhpcy5fcFNjaXNzb3JSZWN0LndpZHRoID09IHRoaXMuX3BWaWV3UG9ydC53aWR0aCAmJiB0aGlzLl9wU2Npc3NvclJlY3QuaGVpZ2h0ID09IHRoaXMuX3BWaWV3UG9ydC5oZWlnaHQpIHtcblx0XHRcdC8vIGFzc3VtZSBzeW1tZXRyaWMgZnJ1c3R1bVxuXG5cdFx0XHRsZWZ0ID0gLXRoaXMuX3hNYXg7XG5cdFx0XHRyaWdodCA9IHRoaXMuX3hNYXg7XG5cdFx0XHR0b3AgPSAtdGhpcy5feU1heDtcblx0XHRcdGJvdHRvbSA9IHRoaXMuX3lNYXg7XG5cblx0XHRcdHJhd1swXSA9IDIvKHRoaXMuX3Byb2plY3Rpb25IZWlnaHQqdGhpcy5fcEFzcGVjdFJhdGlvKTtcblx0XHRcdHJhd1s1XSA9IDIvdGhpcy5fcHJvamVjdGlvbkhlaWdodDtcblx0XHRcdHJhd1sxMF0gPSAxLyh0aGlzLl9wRmFyIC0gdGhpcy5fcE5lYXIpO1xuXHRcdFx0cmF3WzE0XSA9IHRoaXMuX3BOZWFyLyh0aGlzLl9wTmVhciAtIHRoaXMuX3BGYXIpO1xuXHRcdFx0cmF3WzFdID0gcmF3WzJdID0gcmF3WzNdID0gcmF3WzRdID0gcmF3WzZdID0gcmF3WzddID0gcmF3WzhdID0gcmF3WzldID0gcmF3WzExXSA9IHJhd1sxMl0gPSByYXdbMTNdID0gMDtcblx0XHRcdHJhd1sxNV0gPSAxO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dmFyIHhXaWR0aDpudW1iZXIgPSB0aGlzLl94TWF4Kih0aGlzLl9wVmlld1BvcnQud2lkdGgvdGhpcy5fcFNjaXNzb3JSZWN0LndpZHRoKTtcblx0XHRcdHZhciB5SGd0Om51bWJlciA9IHRoaXMuX3lNYXgqKHRoaXMuX3BWaWV3UG9ydC5oZWlnaHQvdGhpcy5fcFNjaXNzb3JSZWN0LmhlaWdodCk7XG5cdFx0XHR2YXIgY2VudGVyOm51bWJlciA9IHRoaXMuX3hNYXgqKHRoaXMuX3BTY2lzc29yUmVjdC54KjIgLSB0aGlzLl9wVmlld1BvcnQud2lkdGgpL3RoaXMuX3BTY2lzc29yUmVjdC53aWR0aCArIHRoaXMuX3hNYXg7XG5cdFx0XHR2YXIgbWlkZGxlOm51bWJlciA9IC10aGlzLl95TWF4Kih0aGlzLl9wU2Npc3NvclJlY3QueSoyIC0gdGhpcy5fcFZpZXdQb3J0LmhlaWdodCkvdGhpcy5fcFNjaXNzb3JSZWN0LmhlaWdodCAtIHRoaXMuX3lNYXg7XG5cblx0XHRcdGxlZnQgPSBjZW50ZXIgLSB4V2lkdGg7XG5cdFx0XHRyaWdodCA9IGNlbnRlciArIHhXaWR0aDtcblx0XHRcdHRvcCA9IG1pZGRsZSAtIHlIZ3Q7XG5cdFx0XHRib3R0b20gPSBtaWRkbGUgKyB5SGd0O1xuXG5cdFx0XHRyYXdbMF0gPSAyKjEvKHJpZ2h0IC0gbGVmdCk7XG5cdFx0XHRyYXdbNV0gPSAtMioxLyh0b3AgLSBib3R0b20pO1xuXHRcdFx0cmF3WzEwXSA9IDEvKHRoaXMuX3BGYXIgLSB0aGlzLl9wTmVhcik7XG5cblx0XHRcdHJhd1sxMl0gPSAocmlnaHQgKyBsZWZ0KS8ocmlnaHQgLSBsZWZ0KTtcblx0XHRcdHJhd1sxM10gPSAoYm90dG9tICsgdG9wKS8oYm90dG9tIC0gdG9wKTtcblx0XHRcdHJhd1sxNF0gPSB0aGlzLl9wTmVhci8odGhpcy5uZWFyIC0gdGhpcy5mYXIpO1xuXG5cdFx0XHRyYXdbMV0gPSByYXdbMl0gPSByYXdbM10gPSByYXdbNF0gPSByYXdbNl0gPSByYXdbN10gPSByYXdbOF0gPSByYXdbOV0gPSByYXdbMTFdID0gMDtcblx0XHRcdHJhd1sxNV0gPSAxO1xuXHRcdH1cblxuXHRcdHRoaXMuX3BGcnVzdHVtQ29ybmVyc1swXSA9IHRoaXMuX3BGcnVzdHVtQ29ybmVyc1s5XSA9IHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxMl0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMjFdID0gbGVmdDtcblx0XHR0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbM10gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbNl0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMTVdID0gdGhpcy5fcEZydXN0dW1Db3JuZXJzWzE4XSA9IHJpZ2h0O1xuXHRcdHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxXSA9IHRoaXMuX3BGcnVzdHVtQ29ybmVyc1s0XSA9IHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxM10gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMTZdID0gdG9wO1xuXHRcdHRoaXMuX3BGcnVzdHVtQ29ybmVyc1s3XSA9IHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxMF0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMTldID0gdGhpcy5fcEZydXN0dW1Db3JuZXJzWzIyXSA9IGJvdHRvbTtcblx0XHR0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMl0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbNV0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbOF0gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMTFdID0gdGhpcy5fcE5lYXI7XG5cdFx0dGhpcy5fcEZydXN0dW1Db3JuZXJzWzE0XSA9IHRoaXMuX3BGcnVzdHVtQ29ybmVyc1sxN10gPSB0aGlzLl9wRnJ1c3R1bUNvcm5lcnNbMjBdID0gdGhpcy5fcEZydXN0dW1Db3JuZXJzWzIzXSA9IHRoaXMuX3BGYXI7XG5cblx0XHR0aGlzLl9wTWF0cml4LmNvcHlSYXdEYXRhRnJvbShyYXcpO1xuXG5cdFx0dGhpcy5fcE1hdHJpeEludmFsaWQgPSBmYWxzZTtcblx0fVxufVxuXG5leHBvcnQ9IE9ydGhvZ3JhcGhpY1Byb2plY3Rpb247Il19