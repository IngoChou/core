var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ByteArrayBase = require("awayjs-core/lib/utils/ByteArrayBase");

var ByteArrayBuffer = (function (_super) {
    __extends(ByteArrayBuffer, _super);
    function ByteArrayBuffer() {
        _super.call(this);
        this._bytes = [];
        this._mode = "Array";
    }
    ByteArrayBuffer.prototype.writeByte = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };

    ByteArrayBuffer.prototype.readByte = function () {
        if (this.position >= this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        return this._bytes[this.position++];
    };

    ByteArrayBuffer.prototype.writeUnsignedByte = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi & 0xff;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };

    ByteArrayBuffer.prototype.readUnsignedByte = function () {
        if (this.position >= this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        return this._bytes[this.position++];
    };

    ByteArrayBuffer.prototype.writeUnsignedShort = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi & 0xff;
        this._bytes[this.position++] = (bi >> 8) & 0xff;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };

    ByteArrayBuffer.prototype.readUnsignedShort = function () {
        if (this.position + 2 > this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        var r = this._bytes[this.position] | (this._bytes[this.position + 1] << 8);
        this.position += 2;
        return r;
    };

    ByteArrayBuffer.prototype.writeUnsignedInt = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi & 0xff;
        this._bytes[this.position++] = (bi >>> 8) & 0xff;
        this._bytes[this.position++] = (bi >>> 16) & 0xff;
        this._bytes[this.position++] = (bi >>> 24) & 0xff;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };

    ByteArrayBuffer.prototype.readUnsignedInt = function () {
        if (this.position + 4 > this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        var r = this._bytes[this.position] | (this._bytes[this.position + 1] << 8) | (this._bytes[this.position + 2] << 16) | (this._bytes[this.position + 3] << 24);
        this.position += 4;
        return r >>> 0;
    };

    ByteArrayBuffer.prototype.writeFloat = function (b) {
        // this is crazy slow and silly, but as a fallback...
        this.writeUnsignedInt(this.toFloatBits(Number(b)));
    };

    ByteArrayBuffer.prototype.toFloatBits = function (x) {
        // don't handle inf/nan yet
        // special case zero
        if (x == 0) {
            return 0;
        }

        // remove the sign, after this we only deal with positive numbers
        var sign = 0;
        if (x < 0) {
            x = -x;
            sign = 1;
        } else {
            sign = 0;
        }

        // a float value is now defined as: x = (1+(mantissa*2^-23))*(2^(exponent-127))
        var exponent = Math.log(x) / Math.log(2);
        exponent = Math.floor(exponent);
        x = x * Math.pow(2, 23 - exponent); // normalize to 24 bits
        var mantissa = Math.floor(x) - 0x800000;
        exponent = exponent + 127;
        return ((sign << 31) >>> 0) | (exponent << 23) | mantissa;
    };

    ByteArrayBuffer.prototype.readFloat = function (b) {
        return this.fromFloatBits(this.readUnsignedInt());
    };

    ByteArrayBuffer.prototype.fromFloatBits = function (x) {
        if (x == 0) {
            return 0;
        }
        var exponent = (x >>> 23) & 0xff;
        var mantissa = (x & 0x7fffff) | 0x800000;
        var y = Math.pow(2, (exponent - 127) - 23) * mantissa;
        if (x >>> 31 != 0) {
            y = -y;
        }
        return y;
    };
    return ByteArrayBuffer;
})(ByteArrayBase);

module.exports = ByteArrayBuffer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzL0J5dGVBcnJheUJ1ZmZlci50cyJdLCJuYW1lcyI6WyJCeXRlQXJyYXlCdWZmZXIiLCJCeXRlQXJyYXlCdWZmZXIuY29uc3RydWN0b3IiLCJCeXRlQXJyYXlCdWZmZXIud3JpdGVCeXRlIiwiQnl0ZUFycmF5QnVmZmVyLnJlYWRCeXRlIiwiQnl0ZUFycmF5QnVmZmVyLndyaXRlVW5zaWduZWRCeXRlIiwiQnl0ZUFycmF5QnVmZmVyLnJlYWRVbnNpZ25lZEJ5dGUiLCJCeXRlQXJyYXlCdWZmZXIud3JpdGVVbnNpZ25lZFNob3J0IiwiQnl0ZUFycmF5QnVmZmVyLnJlYWRVbnNpZ25lZFNob3J0IiwiQnl0ZUFycmF5QnVmZmVyLndyaXRlVW5zaWduZWRJbnQiLCJCeXRlQXJyYXlCdWZmZXIucmVhZFVuc2lnbmVkSW50IiwiQnl0ZUFycmF5QnVmZmVyLndyaXRlRmxvYXQiLCJCeXRlQXJyYXlCdWZmZXIudG9GbG9hdEJpdHMiLCJCeXRlQXJyYXlCdWZmZXIucmVhZEZsb2F0IiwiQnl0ZUFycmF5QnVmZmVyLmZyb21GbG9hdEJpdHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGtFQUF3RTs7QUFFeEU7SUFBOEJBLGtDQUFhQTtJQVcxQ0E7UUFFQ0MsV0FBTUEsS0FBQUEsQ0FBQ0E7UUFDUEEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsRUFBRUE7UUFDaEJBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLE9BQU9BO0lBQ3JCQSxDQUFDQTtJQUVERCxzQ0FBQUEsVUFBaUJBLENBQVFBO1FBRXhCRSxJQUFJQSxFQUFFQSxHQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNuQkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBRUEsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBRUEsR0FBR0EsRUFBRUE7UUFDbkNBLElBQUlBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUVBO1lBQ2hDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJ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UUEsRUFBRUEsQ0FBRUEsR0FBR0EsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUE7UUFDbERBLElBQUlBLENBQUNBLE1BQU1BLENBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLENBQUVBLEdBQUdBLENBQUNBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBO1FBQ25EQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFFQSxHQUFHQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQTtRQUNuREEsSUFBSUEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBRUE7WUFDaENBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBO1NBQzNCQTtJQUNGQSxDQUFDQTs7SUFFRFIsNENBQUFBO1FBRUNTLElBQUlBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUVBO1lBQ3BDQSxNQUFNQSx5Q0FBeUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLFdBQVdBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BO1NBQzNGQTtRQUNEQSxJQUFJQSxDQUFDQSxHQUFVQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFFQSxHQUFHQSxDQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFFQSxHQUFHQSxDQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFFQSxHQUFHQSxDQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFFQTtRQUMzS0EsSUFBSUEsQ0FBQ0EsUUFBUUEsSUFBSUEsQ0FBQ0E7UUFDbEJBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBO0lBQ2ZBLENBQUNBOztJQUVEVCx1Q0FBQUEsVUFBa0JBLENBQVFBO1FBRXpCVSxxREFBcURBO1FBRXJEQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO0lBQ25EQSxDQUFDQTs7SUFFRFYsd0NBQUFBLFVBQW1CQSxDQUFRQTtRQUUxQlcsMkJBQTJCQTtRQUMzQkEsb0JBQW9CQTtRQUNwQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBRUE7WUFDWEEsT0FBT0EsQ0FBQ0E7U0FDUkE7O1FBQ0RBLGlFQUFpRUE7UUFDakVBLElBQUlBLElBQUlBLEdBQVVBLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFFQTtZQUNWQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNOQSxJQUFJQSxHQUFHQSxDQUFDQTtTQUNSQSxLQUFNQTtZQUNOQSxJQUFJQSxHQUFHQSxDQUFDQTtTQUNSQTs7UUFDREEsK0VBQStFQTtRQUMvRUEsSUFBSUEsUUFBUUEsR0FBVUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLFFBQVFBLENBQUNBO1FBQy9CQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxHQUFHQSxRQUFRQSxDQUFDQSxFQUFjQSx1QkFBdUJBO1FBQ3JFQSxJQUFJQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxRQUFRQTtRQUN2Q0EsUUFBUUEsR0FBR0EsUUFBUUEsR0FBR0EsR0FBR0E7UUFDekJBLE9BQU1BLENBQUVBLENBQUVBLElBQUlBLElBQUlBLEVBQUVBLENBQUVBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLENBQUVBLFFBQVFBLElBQUlBLEVBQUVBLENBQUVBLEdBQUdBLFFBQVFBO0lBQzlEQSxDQUFDQTs7SUFFRFgsc0NBQUFBLFVBQWlCQSxDQUFRQTtRQUV4QlksT0FBT0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDbERBLENBQUNBOztJQUVEWiwwQ0FBQUEsVUFBcUJBLENBQVFBO1FBRTVCYSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFFQTtZQUNYQSxPQUFPQSxDQUFDQTtTQUNSQTtRQUNEQSxJQUFJQSxRQUFRQSxHQUFVQSxDQUFFQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFFQSxHQUFHQSxJQUFJQTtRQUN6Q0EsSUFBSUEsUUFBUUEsR0FBVUEsQ0FBRUEsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBRUEsR0FBR0EsUUFBUUE7UUFDakRBLElBQUlBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEVBQUVBLENBQUVBLFFBQVFBLEdBQUdBLEdBQUdBLENBQUVBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUNBLFFBQVFBO1FBQ3JEQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFFQTtZQUNsQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7U0FDTkE7UUFDREEsT0FBT0EsQ0FBQ0E7SUFDVEEsQ0FBQ0E7SUFxQkZiLHVCQUFDQTtBQUFEQSxDQUFDQSxFQW5LNkIsYUFBYSxFQW1LMUM7O0FBRUQsZ0NBQXlCLENBQUEiLCJmaWxlIjoidXRpbHMvQnl0ZUFycmF5QnVmZmVyLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9yb2JiYXRlbWFuL1dlYnN0b3JtUHJvamVjdHMvYXdheWpzLWNvcmUvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJ5dGVBcnJheUJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvQnl0ZUFycmF5QmFzZVwiKTtcblxuY2xhc3MgQnl0ZUFycmF5QnVmZmVyIGV4dGVuZHMgQnl0ZUFycmF5QmFzZVxue1xuXG5cdC8qXG5cdCBwdWJsaWMgbWF4bGVuZ3RoOm51bWJlciA9IDA7XG5cdCBwdWJsaWMgYXJyYXlieXRlczsgLy9BcnJheUJ1ZmZlclxuXHQgcHVibGljIHVuYWxpZ25lZGFycmF5Ynl0ZXN0ZW1wOyAvL0FycmF5QnVmZmVyXG5cdCAqL1xuXG5cdHB1YmxpYyBfYnl0ZXM6bnVtYmVyW107XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0c3VwZXIoKTtcblx0XHR0aGlzLl9ieXRlcyA9IFtdO1xuXHRcdHRoaXMuX21vZGUgPSBcIkFycmF5XCI7XG5cdH1cblxuXHRwdWJsaWMgd3JpdGVCeXRlKGI6bnVtYmVyKVxuXHR7XG5cdFx0dmFyIGJpOm51bWJlciA9IH5+Yjtcblx0XHR0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF0gPSBiaTtcblx0XHRpZiAodGhpcy5wb3NpdGlvbiA+IHRoaXMubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLmxlbmd0aCA9IHRoaXMucG9zaXRpb247XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHJlYWRCeXRlKCk6bnVtYmVyXG5cdHtcblx0XHRpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmxlbmd0aCkge1xuXHRcdFx0dGhyb3cgXCJCeXRlQXJyYXkgb3V0IG9mIGJvdW5kcyByZWFkLiBQb3NpdGlvbj1cIiArIHRoaXMucG9zaXRpb24gKyBcIiwgTGVuZ3RoPVwiICsgdGhpcy5sZW5ndGg7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF07XG5cdH1cblxuXHRwdWJsaWMgd3JpdGVVbnNpZ25lZEJ5dGUoYjpudW1iZXIpXG5cdHtcblx0XHR2YXIgYmk6bnVtYmVyID0gfn5iO1xuXHRcdHRoaXMuX2J5dGVzW3RoaXMucG9zaXRpb24rK10gPSBiaSAmIDB4ZmY7XG5cdFx0aWYgKHRoaXMucG9zaXRpb24gPiB0aGlzLmxlbmd0aCkge1xuXHRcdFx0dGhpcy5sZW5ndGggPSB0aGlzLnBvc2l0aW9uO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyByZWFkVW5zaWduZWRCeXRlKCk6bnVtYmVyXG5cdHtcblx0XHRpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmxlbmd0aCkge1xuXHRcdFx0dGhyb3cgXCJCeXRlQXJyYXkgb3V0IG9mIGJvdW5kcyByZWFkLiBQb3NpdGlvbj1cIiArIHRoaXMucG9zaXRpb24gKyBcIiwgTGVuZ3RoPVwiICsgdGhpcy5sZW5ndGg7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF07XG5cdH1cblxuXHRwdWJsaWMgd3JpdGVVbnNpZ25lZFNob3J0KGI6bnVtYmVyKVxuXHR7XG5cdFx0dmFyIGJpOm51bWJlciA9IH5+Yjtcblx0XHR0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF0gPSBiaSAmIDB4ZmY7XG5cdFx0dGhpcy5fYnl0ZXNbIHRoaXMucG9zaXRpb24rKyBdID0gKGJpID4+IDgpICYgMHhmZjtcblx0XHRpZiAodGhpcy5wb3NpdGlvbiA+IHRoaXMubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLmxlbmd0aCA9IHRoaXMucG9zaXRpb247XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHJlYWRVbnNpZ25lZFNob3J0KCk6bnVtYmVyXG5cdHtcblx0XHRpZiAodGhpcy5wb3NpdGlvbiArIDIgPiB0aGlzLmxlbmd0aCkge1xuXHRcdFx0dGhyb3cgXCJCeXRlQXJyYXkgb3V0IG9mIGJvdW5kcyByZWFkLiBQb3NpdGlvbj1cIiArIHRoaXMucG9zaXRpb24gKyBcIiwgTGVuZ3RoPVwiICsgdGhpcy5sZW5ndGg7XG5cdFx0fVxuXHRcdHZhciByOm51bWJlciA9IHRoaXMuX2J5dGVzWyB0aGlzLnBvc2l0aW9uIF0gfCAoIHRoaXMuX2J5dGVzWyB0aGlzLnBvc2l0aW9uICsgMSBdIDw8IDggKTtcblx0XHR0aGlzLnBvc2l0aW9uICs9IDI7XG5cdFx0cmV0dXJuIHI7XG5cdH1cblxuXHRwdWJsaWMgd3JpdGVVbnNpZ25lZEludChiOm51bWJlcilcblx0e1xuXHRcdHZhciBiaTpudW1iZXIgPSB+fmI7XG5cdFx0dGhpcy5fYnl0ZXNbIHRoaXMucG9zaXRpb24rKyBdID0gYmkgJiAweGZmO1xuXHRcdHRoaXMuX2J5dGVzWyB0aGlzLnBvc2l0aW9uKysgXSA9IChiaSA+Pj4gOCkgJiAweGZmO1xuXHRcdHRoaXMuX2J5dGVzWyB0aGlzLnBvc2l0aW9uKysgXSA9IChiaSA+Pj4gMTYpICYgMHhmZjtcblx0XHR0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF0gPSAoYmkgPj4+IDI0KSAmIDB4ZmY7XG5cdFx0aWYgKHRoaXMucG9zaXRpb24gPiB0aGlzLmxlbmd0aCkge1xuXHRcdFx0dGhpcy5sZW5ndGggPSB0aGlzLnBvc2l0aW9uO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyByZWFkVW5zaWduZWRJbnQoKTpudW1iZXJcblx0e1xuXHRcdGlmICh0aGlzLnBvc2l0aW9uICsgNCA+IHRoaXMubGVuZ3RoKSB7XG5cdFx0XHR0aHJvdyBcIkJ5dGVBcnJheSBvdXQgb2YgYm91bmRzIHJlYWQuIFBvc2l0aW9uPVwiICsgdGhpcy5wb3NpdGlvbiArIFwiLCBMZW5ndGg9XCIgKyB0aGlzLmxlbmd0aDtcblx0XHR9XG5cdFx0dmFyIHI6bnVtYmVyID0gdGhpcy5fYnl0ZXNbIHRoaXMucG9zaXRpb24gXSB8ICggdGhpcy5fYnl0ZXNbdGhpcy5wb3NpdGlvbiArIDFdIDw8IDggKSB8ICggdGhpcy5fYnl0ZXNbdGhpcy5wb3NpdGlvbiArIDJdIDw8IDE2ICkgfCAoIHRoaXMuX2J5dGVzW3RoaXMucG9zaXRpb24gKyAzXSA8PCAyNCApO1xuXHRcdHRoaXMucG9zaXRpb24gKz0gNDtcblx0XHRyZXR1cm4gciA+Pj4gMDtcblx0fVxuXG5cdHB1YmxpYyB3cml0ZUZsb2F0KGI6bnVtYmVyKVxuXHR7XG5cdFx0Ly8gdGhpcyBpcyBjcmF6eSBzbG93IGFuZCBzaWxseSwgYnV0IGFzIGEgZmFsbGJhY2suLi5cblxuXHRcdHRoaXMud3JpdGVVbnNpZ25lZEludCh0aGlzLnRvRmxvYXRCaXRzKE51bWJlcihiKSkpO1xuXHR9XG5cblx0cHVibGljIHRvRmxvYXRCaXRzKHg6bnVtYmVyKVxuXHR7XG5cdFx0Ly8gZG9uJ3QgaGFuZGxlIGluZi9uYW4geWV0XG5cdFx0Ly8gc3BlY2lhbCBjYXNlIHplcm9cblx0XHRpZiAoeCA9PSAwKSB7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9XG5cdFx0Ly8gcmVtb3ZlIHRoZSBzaWduLCBhZnRlciB0aGlzIHdlIG9ubHkgZGVhbCB3aXRoIHBvc2l0aXZlIG51bWJlcnNcblx0XHR2YXIgc2lnbjpudW1iZXIgPSAwO1xuXHRcdGlmICh4IDwgMCkge1xuXHRcdFx0eCA9IC14O1xuXHRcdFx0c2lnbiA9IDE7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNpZ24gPSAwO1xuXHRcdH1cblx0XHQvLyBhIGZsb2F0IHZhbHVlIGlzIG5vdyBkZWZpbmVkIGFzOiB4ID0gKDErKG1hbnRpc3NhKjJeLTIzKSkqKDJeKGV4cG9uZW50LTEyNykpXG5cdFx0dmFyIGV4cG9uZW50Om51bWJlciA9IE1hdGgubG9nKHgpL01hdGgubG9nKDIpOyAgLy8gcm91Z2ggZXhwb25lbnRcblx0XHRleHBvbmVudCA9IE1hdGguZmxvb3IoZXhwb25lbnQpO1xuXHRcdHggPSB4Kk1hdGgucG93KDIsIDIzIC0gZXhwb25lbnQpOyAgICAgICAgICAgICAvLyBub3JtYWxpemUgdG8gMjQgYml0c1xuXHRcdHZhciBtYW50aXNzYSA9IE1hdGguZmxvb3IoeCkgLSAweDgwMDAwMDtcblx0XHRleHBvbmVudCA9IGV4cG9uZW50ICsgMTI3O1xuXHRcdHJldHVybiggKCBzaWduIDw8IDMxICkgPj4+IDApIHwgKCBleHBvbmVudCA8PCAyMyApIHwgbWFudGlzc2E7XG5cdH1cblxuXHRwdWJsaWMgcmVhZEZsb2F0KGI6bnVtYmVyKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuZnJvbUZsb2F0Qml0cyh0aGlzLnJlYWRVbnNpZ25lZEludCgpKTtcblx0fVxuXG5cdHB1YmxpYyBmcm9tRmxvYXRCaXRzKHg6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHggPT0gMCkge1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXHRcdHZhciBleHBvbmVudDpudW1iZXIgPSAoIHggPj4+IDIzICkgJiAweGZmO1xuXHRcdHZhciBtYW50aXNzYTpudW1iZXIgPSAoIHggJiAweDdmZmZmZiApIHwgMHg4MDAwMDA7XG5cdFx0dmFyIHkgPSBNYXRoLnBvdygyLCAoIGV4cG9uZW50IC0gMTI3ICkgLSAyMykqbWFudGlzc2E7XG5cdFx0aWYgKHggPj4+IDMxICE9IDApIHtcblx0XHRcdHkgPSAteTtcblx0XHR9XG5cdFx0cmV0dXJuIHk7XG5cdH1cblxuXHQvKlxuXHQgcHVibGljIGVuc3VyZVdyaXRlYWJsZVNwYWNlKCBuOm51bWJlciApXG5cdCB7XG5cdCB0aGlzLmVuc3VyZVNwYWNlKCBuICsgdGhpcy5wb3NpdGlvbiApO1xuXHQgfVxuXG5cdCBwcml2YXRlIGVuc3VyZVNwYWNlKCBuOm51bWJlciApXG5cdCB7XG5cdCBpZiAoIG4gPiB0aGlzLm1heGxlbmd0aCApIHtcblx0IHZhciBuZXdtYXhsZW5ndGg6bnVtYmVyID0gKG4rMjU1KSYofjI1NSk7XG5cdCB2YXIgbmV3YXJyYXlidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIobmV3bWF4bGVuZ3RoKTtcblx0IHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5hcnJheWJ5dGVzLCAwLCB0aGlzLmxlbmd0aCk7XG5cdCB2YXIgbmV3dmlldyA9IG5ldyBVaW50OEFycmF5KG5ld2FycmF5YnVmZmVyLCAwLCB0aGlzLmxlbmd0aCk7XG5cdCBuZXd2aWV3LnNldCh2aWV3KTsgICAgICAvLyBtZW1jcHlcblx0IHRoaXMuYXJyYXlieXRlcyA9IG5ld2FycmF5YnVmZmVyO1xuXHQgdGhpcy5tYXhsZW5ndGggPSBuZXdtYXhsZW5ndGg7XG5cdCB9XG5cdCB9XG5cdCAqL1xufVxuXG5leHBvcnQgPSBCeXRlQXJyYXlCdWZmZXI7Il19