var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ByteArrayBase = require("awayjs-core/lib/utils/ByteArrayBase");
var ByteArrayBuffer = (function (_super) {
    __extends(ByteArrayBuffer, _super);
    function ByteArrayBuffer() {
        _super.call(this);
        this._bytes = [];
        this._mode = "Array";
    }
    ByteArrayBuffer.prototype.writeByte = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };
    ByteArrayBuffer.prototype.readByte = function () {
        if (this.position >= this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        return this._bytes[this.position++];
    };
    ByteArrayBuffer.prototype.writeUnsignedByte = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi & 0xff;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };
    ByteArrayBuffer.prototype.readUnsignedByte = function () {
        if (this.position >= this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        return this._bytes[this.position++];
    };
    ByteArrayBuffer.prototype.writeUnsignedShort = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi & 0xff;
        this._bytes[this.position++] = (bi >> 8) & 0xff;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };
    ByteArrayBuffer.prototype.readUnsignedShort = function () {
        if (this.position + 2 > this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        var r = this._bytes[this.position] | (this._bytes[this.position + 1] << 8);
        this.position += 2;
        return r;
    };
    ByteArrayBuffer.prototype.writeUnsignedInt = function (b) {
        var bi = ~~b;
        this._bytes[this.position++] = bi & 0xff;
        this._bytes[this.position++] = (bi >>> 8) & 0xff;
        this._bytes[this.position++] = (bi >>> 16) & 0xff;
        this._bytes[this.position++] = (bi >>> 24) & 0xff;
        if (this.position > this.length) {
            this.length = this.position;
        }
    };
    ByteArrayBuffer.prototype.readUnsignedInt = function () {
        if (this.position + 4 > this.length) {
            throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
        }
        var r = this._bytes[this.position] | (this._bytes[this.position + 1] << 8) | (this._bytes[this.position + 2] << 16) | (this._bytes[this.position + 3] << 24);
        this.position += 4;
        return r >>> 0;
    };
    ByteArrayBuffer.prototype.writeFloat = function (b) {
        // this is crazy slow and silly, but as a fallback...
        this.writeUnsignedInt(this.toFloatBits(Number(b)));
    };
    ByteArrayBuffer.prototype.toFloatBits = function (x) {
        // don't handle inf/nan yet
        // special case zero
        if (x == 0) {
            return 0;
        }
        // remove the sign, after this we only deal with positive numbers
        var sign = 0;
        if (x < 0) {
            x = -x;
            sign = 1;
        }
        else {
            sign = 0;
        }
        // a float value is now defined as: x = (1+(mantissa*2^-23))*(2^(exponent-127))
        var exponent = Math.log(x) / Math.log(2); // rough exponent
        exponent = Math.floor(exponent);
        x = x * Math.pow(2, 23 - exponent); // normalize to 24 bits
        var mantissa = Math.floor(x) - 0x800000;
        exponent = exponent + 127;
        return ((sign << 31) >>> 0) | (exponent << 23) | mantissa;
    };
    ByteArrayBuffer.prototype.readFloat = function (b) {
        return this.fromFloatBits(this.readUnsignedInt());
    };
    ByteArrayBuffer.prototype.fromFloatBits = function (x) {
        if (x == 0) {
            return 0;
        }
        var exponent = (x >>> 23) & 0xff;
        var mantissa = (x & 0x7fffff) | 0x800000;
        var y = Math.pow(2, (exponent - 127) - 23) * mantissa;
        if (x >>> 31 != 0) {
            y = -y;
        }
        return y;
    };
    return ByteArrayBuffer;
})(ByteArrayBase);
module.exports = ByteArrayBuffer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi91dGlscy9CeXRlQXJyYXlCdWZmZXIudHMiXSwibmFtZXMiOlsiQnl0ZUFycmF5QnVmZmVyIiwiQnl0ZUFycmF5QnVmZmVyLmNvbnN0cnVjdG9yIiwiQnl0ZUFycmF5QnVmZmVyLndyaXRlQnl0ZSIsIkJ5dGVBcnJheUJ1ZmZlci5yZWFkQnl0ZSIsIkJ5dGVBcnJheUJ1ZmZlci53cml0ZVVuc2lnbmVkQnl0ZSIsIkJ5dGVBcnJheUJ1ZmZlci5yZWFkVW5zaWduZWRCeXRlIiwiQnl0ZUFycmF5QnVmZmVyLndyaXRlVW5zaWduZWRTaG9ydCIsIkJ5dGVBcnJheUJ1ZmZlci5yZWFkVW5zaWduZWRTaG9ydCIsIkJ5dGVBcnJheUJ1ZmZlci53cml0ZVVuc2lnbmVkSW50IiwiQnl0ZUFycmF5QnVmZmVyLnJlYWRVbnNpZ25lZEludCIsIkJ5dGVBcnJheUJ1ZmZlci53cml0ZUZsb2F0IiwiQnl0ZUFycmF5QnVmZmVyLnRvRmxvYXRCaXRzIiwiQnl0ZUFycmF5QnVmZmVyLnJlYWRGbG9hdCIsIkJ5dGVBcnJheUJ1ZmZlci5mcm9tRmxvYXRCaXRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLGFBQWEsV0FBYSxxQ0FBcUMsQ0FBQyxDQUFDO0FBRXhFLElBQU0sZUFBZTtJQUFTQSxVQUF4QkEsZUFBZUEsVUFBc0JBO0lBVzFDQSxTQVhLQSxlQUFlQTtRQWFuQkMsaUJBQU9BLENBQUNBO1FBQ1JBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLEVBQUVBLENBQUNBO1FBQ2pCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxPQUFPQSxDQUFDQTtJQUN0QkEsQ0FBQ0E7SUFFTUQsbUNBQVNBLEdBQWhCQSxVQUFpQkEsQ0FBUUE7UUFFeEJFLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFFQSxHQUFHQSxFQUFF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SUEsQ0FBQ0EsTUFBTUEsQ0FBRUEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBRUEsR0FBR0EsQ0FBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBRUEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBRUEsSUFBSUEsQ0FBQ0EsQ0FBRUEsQ0FBQ0E7UUFDeEZBLElBQUlBLENBQUNBLFFBQVFBLElBQUlBLENBQUNBLENBQUNBO1FBQ25CQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUNWQSxDQUFDQTtJQUVNUCwwQ0FBZ0JBLEdBQXZCQSxVQUF3QkEsQ0FBUUE7UUFFL0JRLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMzQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBRUEsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBRUEsR0FBR0EsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDbkRBLElBQUlBLENBQUNBLE1BQU1BLENBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLENBQUVBLEdBQUdBLENBQUNBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQ3BEQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFFQSxHQUFHQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUNwREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakNBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBO1FBQzdCQSxDQUFDQTtJ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QSxDQUFDQTtJQUMvREEsQ0FBQ0E7SUFFTVgsbUNBQVNBLEdBQWhCQSxVQUFpQkEsQ0FBUUE7UUFFeEJZLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLGVBQWVBLEVBQUVBLENBQUNBLENBQUNBO0lBQ25EQSxDQUFDQTtJQUVNWix1Q0FBYUEsR0FBcEJBLFVBQXFCQSxDQUFRQTtRQUU1QmEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDWkEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDVkEsQ0FBQ0E7UUFDREEsSUFBSUEsUUFBUUEsR0FBVUEsQ0FBRUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDMUNBLElBQUlBLFFBQVFBLEdBQVVBLENBQUVBLENBQUNBLEdBQUdBLFFBQVFBLENBQUVBLEdBQUdBLFFBQVFBLENBQUNBO1FBQ2xEQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFFQSxRQUFRQSxHQUFHQSxHQUFHQSxDQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFDQSxRQUFRQSxDQUFDQTtRQUN0REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbkJBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQ1JBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO0lBQ1ZBLENBQUNBO0lBcUJGYixzQkFBQ0E7QUFBREEsQ0FuS0EsQUFtS0NBLEVBbks2QixhQUFhLEVBbUsxQztBQUVELEFBQXlCLGlCQUFoQixlQUFlLENBQUMiLCJmaWxlIjoidXRpbHMvQnl0ZUFycmF5QnVmZmVyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCeXRlQXJyYXlCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL0J5dGVBcnJheUJhc2VcIik7XHJcblxyXG5jbGFzcyBCeXRlQXJyYXlCdWZmZXIgZXh0ZW5kcyBCeXRlQXJyYXlCYXNlXHJcbntcclxuXHJcblx0LypcclxuXHQgcHVibGljIG1heGxlbmd0aDpudW1iZXIgPSAwO1xyXG5cdCBwdWJsaWMgYXJyYXlieXRlczsgLy9BcnJheUJ1ZmZlclxyXG5cdCBwdWJsaWMgdW5hbGlnbmVkYXJyYXlieXRlc3RlbXA7IC8vQXJyYXlCdWZmZXJcclxuXHQgKi9cclxuXHJcblx0cHVibGljIF9ieXRlczpudW1iZXJbXTtcclxuXHJcblx0Y29uc3RydWN0b3IoKVxyXG5cdHtcclxuXHRcdHN1cGVyKCk7XHJcblx0XHR0aGlzLl9ieXRlcyA9IFtdO1xyXG5cdFx0dGhpcy5fbW9kZSA9IFwiQXJyYXlcIjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB3cml0ZUJ5dGUoYjpudW1iZXIpXHJcblx0e1xyXG5cdFx0dmFyIGJpOm51bWJlciA9IH5+YjtcclxuXHRcdHRoaXMuX2J5dGVzWyB0aGlzLnBvc2l0aW9uKysgXSA9IGJpO1xyXG5cdFx0aWYgKHRoaXMucG9zaXRpb24gPiB0aGlzLmxlbmd0aCkge1xyXG5cdFx0XHR0aGlzLmxlbmd0aCA9IHRoaXMucG9zaXRpb247XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVhZEJ5dGUoKTpudW1iZXJcclxuXHR7XHJcblx0XHRpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmxlbmd0aCkge1xyXG5cdFx0XHR0aHJvdyBcIkJ5dGVBcnJheSBvdXQgb2YgYm91bmRzIHJlYWQuIFBvc2l0aW9uPVwiICsgdGhpcy5wb3NpdGlvbiArIFwiLCBMZW5ndGg9XCIgKyB0aGlzLmxlbmd0aDtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF07XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgd3JpdGVVbnNpZ25lZEJ5dGUoYjpudW1iZXIpXHJcblx0e1xyXG5cdFx0dmFyIGJpOm51bWJlciA9IH5+YjtcclxuXHRcdHRoaXMuX2J5dGVzW3RoaXMucG9zaXRpb24rK10gPSBiaSAmIDB4ZmY7XHJcblx0XHRpZiAodGhpcy5wb3NpdGlvbiA+IHRoaXMubGVuZ3RoKSB7XHJcblx0XHRcdHRoaXMubGVuZ3RoID0gdGhpcy5wb3NpdGlvbjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyByZWFkVW5zaWduZWRCeXRlKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMucG9zaXRpb24gPj0gdGhpcy5sZW5ndGgpIHtcclxuXHRcdFx0dGhyb3cgXCJCeXRlQXJyYXkgb3V0IG9mIGJvdW5kcyByZWFkLiBQb3NpdGlvbj1cIiArIHRoaXMucG9zaXRpb24gKyBcIiwgTGVuZ3RoPVwiICsgdGhpcy5sZW5ndGg7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcy5fYnl0ZXNbIHRoaXMucG9zaXRpb24rKyBdO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHdyaXRlVW5zaWduZWRTaG9ydChiOm51bWJlcilcclxuXHR7XHJcblx0XHR2YXIgYmk6bnVtYmVyID0gfn5iO1xyXG5cdFx0dGhpcy5fYnl0ZXNbIHRoaXMucG9zaXRpb24rKyBdID0gYmkgJiAweGZmO1xyXG5cdFx0dGhpcy5fYnl0ZXNbIHRoaXMucG9zaXRpb24rKyBdID0gKGJpID4+IDgpICYgMHhmZjtcclxuXHRcdGlmICh0aGlzLnBvc2l0aW9uID4gdGhpcy5sZW5ndGgpIHtcclxuXHRcdFx0dGhpcy5sZW5ndGggPSB0aGlzLnBvc2l0aW9uO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHVibGljIHJlYWRVbnNpZ25lZFNob3J0KCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMucG9zaXRpb24gKyAyID4gdGhpcy5sZW5ndGgpIHtcclxuXHRcdFx0dGhyb3cgXCJCeXRlQXJyYXkgb3V0IG9mIGJvdW5kcyByZWFkLiBQb3NpdGlvbj1cIiArIHRoaXMucG9zaXRpb24gKyBcIiwgTGVuZ3RoPVwiICsgdGhpcy5sZW5ndGg7XHJcblx0XHR9XHJcblx0XHR2YXIgcjpudW1iZXIgPSB0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbiBdIHwgKCB0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbiArIDEgXSA8PCA4ICk7XHJcblx0XHR0aGlzLnBvc2l0aW9uICs9IDI7XHJcblx0XHRyZXR1cm4gcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB3cml0ZVVuc2lnbmVkSW50KGI6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHZhciBiaTpudW1iZXIgPSB+fmI7XHJcblx0XHR0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF0gPSBiaSAmIDB4ZmY7XHJcblx0XHR0aGlzLl9ieXRlc1sgdGhpcy5wb3NpdGlvbisrIF0gPSAoYmkgPj4+IDgpICYgMHhmZjtcclxuXHRcdHRoaXMuX2J5dGVzWyB0aGlzLnBvc2l0aW9uKysgXSA9IChiaSA+Pj4gMTYpICYgMHhmZjtcclxuXHRcdHRoaXMuX2J5dGVzWyB0aGlzLnBvc2l0aW9uKysgXSA9IChiaSA+Pj4gMjQpICYgMHhmZjtcclxuXHRcdGlmICh0aGlzLnBvc2l0aW9uID4gdGhpcy5sZW5ndGgpIHtcclxuXHRcdFx0dGhpcy5sZW5ndGggPSB0aGlzLnBvc2l0aW9uO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHVibGljIHJlYWRVbnNpZ25lZEludCgpOm51bWJlclxyXG5cdHtcclxuXHRcdGlmICh0aGlzLnBvc2l0aW9uICsgNCA+IHRoaXMubGVuZ3RoKSB7XHJcblx0XHRcdHRocm93IFwiQnl0ZUFycmF5IG91dCBvZiBib3VuZHMgcmVhZC4gUG9zaXRpb249XCIgKyB0aGlzLnBvc2l0aW9uICsgXCIsIExlbmd0aD1cIiArIHRoaXMubGVuZ3RoO1xyXG5cdFx0fVxyXG5cdFx0dmFyIHI6bnVtYmVyID0gdGhpcy5fYnl0ZXNbIHRoaXMucG9zaXRpb24gXSB8ICggdGhpcy5fYnl0ZXNbdGhpcy5wb3NpdGlvbiArIDFdIDw8IDggKSB8ICggdGhpcy5fYnl0ZXNbdGhpcy5wb3NpdGlvbiArIDJdIDw8IDE2ICkgfCAoIHRoaXMuX2J5dGVzW3RoaXMucG9zaXRpb24gKyAzXSA8PCAyNCApO1xyXG5cdFx0dGhpcy5wb3NpdGlvbiArPSA0O1xyXG5cdFx0cmV0dXJuIHIgPj4+IDA7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgd3JpdGVGbG9hdChiOm51bWJlcilcclxuXHR7XHJcblx0XHQvLyB0aGlzIGlzIGNyYXp5IHNsb3cgYW5kIHNpbGx5LCBidXQgYXMgYSBmYWxsYmFjay4uLlxyXG5cclxuXHRcdHRoaXMud3JpdGVVbnNpZ25lZEludCh0aGlzLnRvRmxvYXRCaXRzKE51bWJlcihiKSkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHRvRmxvYXRCaXRzKHg6bnVtYmVyKVxyXG5cdHtcclxuXHRcdC8vIGRvbid0IGhhbmRsZSBpbmYvbmFuIHlldFxyXG5cdFx0Ly8gc3BlY2lhbCBjYXNlIHplcm9cclxuXHRcdGlmICh4ID09IDApIHtcclxuXHRcdFx0cmV0dXJuIDA7XHJcblx0XHR9XHJcblx0XHQvLyByZW1vdmUgdGhlIHNpZ24sIGFmdGVyIHRoaXMgd2Ugb25seSBkZWFsIHdpdGggcG9zaXRpdmUgbnVtYmVyc1xyXG5cdFx0dmFyIHNpZ246bnVtYmVyID0gMDtcclxuXHRcdGlmICh4IDwgMCkge1xyXG5cdFx0XHR4ID0gLXg7XHJcblx0XHRcdHNpZ24gPSAxO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0c2lnbiA9IDA7XHJcblx0XHR9XHJcblx0XHQvLyBhIGZsb2F0IHZhbHVlIGlzIG5vdyBkZWZpbmVkIGFzOiB4ID0gKDErKG1hbnRpc3NhKjJeLTIzKSkqKDJeKGV4cG9uZW50LTEyNykpXHJcblx0XHR2YXIgZXhwb25lbnQ6bnVtYmVyID0gTWF0aC5sb2coeCkvTWF0aC5sb2coMik7ICAvLyByb3VnaCBleHBvbmVudFxyXG5cdFx0ZXhwb25lbnQgPSBNYXRoLmZsb29yKGV4cG9uZW50KTtcclxuXHRcdHggPSB4Kk1hdGgucG93KDIsIDIzIC0gZXhwb25lbnQpOyAgICAgICAgICAgICAvLyBub3JtYWxpemUgdG8gMjQgYml0c1xyXG5cdFx0dmFyIG1hbnRpc3NhID0gTWF0aC5mbG9vcih4KSAtIDB4ODAwMDAwO1xyXG5cdFx0ZXhwb25lbnQgPSBleHBvbmVudCArIDEyNztcclxuXHRcdHJldHVybiggKCBzaWduIDw8IDMxICkgPj4+IDApIHwgKCBleHBvbmVudCA8PCAyMyApIHwgbWFudGlzc2E7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVhZEZsb2F0KGI6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLmZyb21GbG9hdEJpdHModGhpcy5yZWFkVW5zaWduZWRJbnQoKSk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZnJvbUZsb2F0Qml0cyh4Om51bWJlcilcclxuXHR7XHJcblx0XHRpZiAoeCA9PSAwKSB7XHJcblx0XHRcdHJldHVybiAwO1xyXG5cdFx0fVxyXG5cdFx0dmFyIGV4cG9uZW50Om51bWJlciA9ICggeCA+Pj4gMjMgKSAmIDB4ZmY7XHJcblx0XHR2YXIgbWFudGlzc2E6bnVtYmVyID0gKCB4ICYgMHg3ZmZmZmYgKSB8IDB4ODAwMDAwO1xyXG5cdFx0dmFyIHkgPSBNYXRoLnBvdygyLCAoIGV4cG9uZW50IC0gMTI3ICkgLSAyMykqbWFudGlzc2E7XHJcblx0XHRpZiAoeCA+Pj4gMzEgIT0gMCkge1xyXG5cdFx0XHR5ID0gLXk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4geTtcclxuXHR9XHJcblxyXG5cdC8qXHJcblx0IHB1YmxpYyBlbnN1cmVXcml0ZWFibGVTcGFjZSggbjpudW1iZXIgKVxyXG5cdCB7XHJcblx0IHRoaXMuZW5zdXJlU3BhY2UoIG4gKyB0aGlzLnBvc2l0aW9uICk7XHJcblx0IH1cclxuXHJcblx0IHByaXZhdGUgZW5zdXJlU3BhY2UoIG46bnVtYmVyIClcclxuXHQge1xyXG5cdCBpZiAoIG4gPiB0aGlzLm1heGxlbmd0aCApIHtcclxuXHQgdmFyIG5ld21heGxlbmd0aDpudW1iZXIgPSAobisyNTUpJih+MjU1KTtcclxuXHQgdmFyIG5ld2FycmF5YnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKG5ld21heGxlbmd0aCk7XHJcblx0IHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5hcnJheWJ5dGVzLCAwLCB0aGlzLmxlbmd0aCk7XHJcblx0IHZhciBuZXd2aWV3ID0gbmV3IFVpbnQ4QXJyYXkobmV3YXJyYXlidWZmZXIsIDAsIHRoaXMubGVuZ3RoKTtcclxuXHQgbmV3dmlldy5zZXQodmlldyk7ICAgICAgLy8gbWVtY3B5XHJcblx0IHRoaXMuYXJyYXlieXRlcyA9IG5ld2FycmF5YnVmZmVyO1xyXG5cdCB0aGlzLm1heGxlbmd0aCA9IG5ld21heGxlbmd0aDtcclxuXHQgfVxyXG5cdCB9XHJcblx0ICovXHJcbn1cclxuXHJcbmV4cG9ydCA9IEJ5dGVBcnJheUJ1ZmZlcjsiXX0=