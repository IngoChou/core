var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Camera = require("awayjs-core/lib/entities/Camera");

var PartialImplementationError = require("awayjs-core/lib/errors/PartialImplementationError");
var ShadowMapperBase = require("awayjs-core/lib/materials/shadowmappers/ShadowMapperBase");

var CubeMapShadowMapper = (function (_super) {
    __extends(CubeMapShadowMapper, _super);
    function CubeMapShadowMapper() {
        _super.call(this);

        this._pDepthMapSize = 512;
        this._needsRender = new Array();
        this.initCameras();
    }
    CubeMapShadowMapper.prototype.initCameras = function () {
        this._depthCameras = new Array();
        this._projections = new Array();

        // posX, negX, posY, negY, posZ, negZ
        this.addCamera(0, 90, 0);
        this.addCamera(0, -90, 0);
        this.addCamera(-90, 0, 0);
        this.addCamera(90, 0, 0);
        this.addCamera(0, 0, 0);
        this.addCamera(0, 180, 0);
    };

    CubeMapShadowMapper.prototype.addCamera = function (rotationX, rotationY, rotationZ) {
        var cam = new Camera();
        cam.rotationX = rotationX;
        cam.rotationY = rotationY;
        cam.rotationZ = rotationZ;
        cam.projection.near = .01;

        var projection = cam.projection;
        projection.fieldOfView = 90;
        this._projections.push(projection);
        cam.projection._iAspectRatio = 1;
        this._depthCameras.push(cam);
    };

    //@override
    CubeMapShadowMapper.prototype.pCreateDepthTexture = function () {
        throw new PartialImplementationError();
        /*
        return new RenderCubeTexture( this._depthMapSize );
        */
    };

    //@override
    CubeMapShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        var light = (this._pLight);
        var maxDistance = light._pFallOff;
        var pos = this._pLight.scenePosition;

        for (var i = 0; i < 6; ++i) {
            this._projections[i].far = maxDistance;
            this._depthCameras[i].transform.position = pos;
            this._needsRender[i] = true;
        }
    };

    //@override
    CubeMapShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        for (var i = 0; i < 6; ++i) {
            if (this._needsRender[i]) {
                this._pCasterCollector.camera = this._depthCameras[i];
                this._pCasterCollector.clear();
                scene.traversePartitions(this._pCasterCollector);
                renderer._iRender(this._pCasterCollector, target, null, i);
            }
        }
    };
    return CubeMapShadowMapper;
})(ShadowMapperBase);

module.exports = CubeMapShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hdGVyaWFscy9zaGFkb3dtYXBwZXJzL0N1YmVNYXBTaGFkb3dNYXBwZXIudHMiXSwibmFtZXMiOlsiQ3ViZU1hcFNoYWRvd01hcHBlciIsIkN1YmVNYXBTaGFkb3dNYXBwZXIuY29uc3RydWN0b3IiLCJDdWJlTWFwU2hhZG93TWFwcGVyLmluaXRDYW1lcmFzIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5hZGRDYW1lcmEiLCJDdWJlTWFwU2hhZG93TWFwcGVyLnBDcmVhdGVEZXB0aFRleHR1cmUiLCJDdWJlTWFwU2hhZG93TWFwcGVyLnBVcGRhdGVEZXB0aFByb2plY3Rpb24iLCJDdWJlTWFwU2hhZG93TWFwcGVyLnBEcmF3RGVwdGhNYXAiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHVEQUdnRTs7QUFFaEUsNkZBQWlHO0FBQ2pHLDBGQUFpRzs7QUFLakc7SUFBa0NBLHNDQUFnQkE7SUFNakRBO1FBRUNDLFdBQU1BLEtBQUFBLENBQUNBOztRQUVQQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxHQUFHQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDL0JBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO0lBQ25CQSxDQUFDQTtJQUVERCw0Q0FBQUE7UUFFQ0UsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLEtBQUtBLENBQUNBLENBQUNBOztRQUUvQkEscUNBQXFDQTtRQUNyQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1FBQ3pCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFF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QUVBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBO2FBQzFEQTtTQUNEQTtJQUNGQSxDQUFDQTtJQUNGTiwyQkFBQ0E7QUFBREEsQ0FBQ0EsRUFoRmlDLGdCQUFnQixFQWdGakQ7O0FBRUQsb0NBQTZCLENBQUEiLCJmaWxlIjoibWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ3ViZU1hcFNoYWRvd01hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvcm9iYmF0ZW1hbi9XZWJzdG9ybVByb2plY3RzL2F3YXlqcy1jb3JlLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTY2VuZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb250YWluZXJzL1NjZW5lXCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBJUmVuZGVyZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvcmVuZGVyL0lSZW5kZXJlclwiKTtcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xuaW1wb3J0IFBvaW50TGlnaHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2VudGl0aWVzL1BvaW50TGlnaHRcIik7XG5pbXBvcnQgUGFydGlhbEltcGxlbWVudGF0aW9uRXJyb3JcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lcnJvcnMvUGFydGlhbEltcGxlbWVudGF0aW9uRXJyb3JcIik7XG5pbXBvcnQgU2hhZG93TWFwcGVyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL1NoYWRvd01hcHBlckJhc2VcIik7XG5pbXBvcnQgUGVyc3BlY3RpdmVQcm9qZWN0aW9uXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9QZXJzcGVjdGl2ZVByb2plY3Rpb25cIik7XG5pbXBvcnQgUmVuZGVyVGV4dHVyZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1JlbmRlclRleHR1cmVcIik7XG5pbXBvcnQgVGV4dHVyZVByb3h5QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1RleHR1cmVQcm94eUJhc2VcIik7XG5cbmNsYXNzIEN1YmVNYXBTaGFkb3dNYXBwZXIgZXh0ZW5kcyBTaGFkb3dNYXBwZXJCYXNlXG57XG5cdHByaXZhdGUgX2RlcHRoQ2FtZXJhczpBcnJheTxDYW1lcmE+O1xuXHRwcml2YXRlIF9wcm9qZWN0aW9uczpBcnJheTxQZXJzcGVjdGl2ZVByb2plY3Rpb24+O1xuXHRwcml2YXRlIF9uZWVkc1JlbmRlcjpBcnJheTxib29sZWFuPjtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5fcERlcHRoTWFwU2l6ZSA9IDUxMjtcblx0XHR0aGlzLl9uZWVkc1JlbmRlciA9IG5ldyBBcnJheSgpO1xuXHRcdHRoaXMuaW5pdENhbWVyYXMoKTtcblx0fVxuXG5cdHByaXZhdGUgaW5pdENhbWVyYXMoKVxuXHR7XG5cdFx0dGhpcy5fZGVwdGhDYW1lcmFzID0gbmV3IEFycmF5KCk7XG5cdFx0dGhpcy5fcHJvamVjdGlvbnMgPSBuZXcgQXJyYXkoKTtcblxuXHRcdC8vIHBvc1gsIG5lZ1gsIHBvc1ksIG5lZ1ksIHBvc1osIG5lZ1pcblx0XHR0aGlzLmFkZENhbWVyYSgwLCA5MCwgMCk7XG5cdFx0dGhpcy5hZGRDYW1lcmEoMCwgLTkwLCAwKTtcblx0XHR0aGlzLmFkZENhbWVyYSgtOTAsIDAsIDApO1xuXHRcdHRoaXMuYWRkQ2FtZXJhKDkwLCAwLCAwKTtcblx0XHR0aGlzLmFkZENhbWVyYSgwLCAwLCAwKTtcblx0XHR0aGlzLmFkZENhbWVyYSgwLCAxODAsIDApO1xuXHR9XG5cblx0cHJpdmF0ZSBhZGRDYW1lcmEocm90YXRpb25YOm51bWJlciwgcm90YXRpb25ZOm51bWJlciwgcm90YXRpb25aOm51bWJlcilcblx0e1xuXHRcdHZhciBjYW06Q2FtZXJhID0gbmV3IENhbWVyYSgpO1xuXHRcdGNhbS5yb3RhdGlvblggPSByb3RhdGlvblg7XG5cdFx0Y2FtLnJvdGF0aW9uWSA9IHJvdGF0aW9uWTtcblx0XHRjYW0ucm90YXRpb25aID0gcm90YXRpb25aO1xuXHRcdGNhbS5wcm9qZWN0aW9uLm5lYXIgPSAuMDE7XG5cblx0XHR2YXIgcHJvamVjdGlvbjpQZXJzcGVjdGl2ZVByb2plY3Rpb24gPSA8UGVyc3BlY3RpdmVQcm9qZWN0aW9uPiBjYW0ucHJvamVjdGlvbjtcblx0XHRwcm9qZWN0aW9uLmZpZWxkT2ZWaWV3ID0gOTA7XG5cdFx0dGhpcy5fcHJvamVjdGlvbnMucHVzaChwcm9qZWN0aW9uKTtcblx0XHRjYW0ucHJvamVjdGlvbi5faUFzcGVjdFJhdGlvID0gMTtcblx0XHR0aGlzLl9kZXB0aENhbWVyYXMucHVzaChjYW0pO1xuXHR9XG5cblx0Ly9Ab3ZlcnJpZGVcblx0cHVibGljIHBDcmVhdGVEZXB0aFRleHR1cmUoKTpUZXh0dXJlUHJveHlCYXNlXG5cdHtcblx0XHR0aHJvdyBuZXcgUGFydGlhbEltcGxlbWVudGF0aW9uRXJyb3IoKTtcblx0XHQvKlxuXHRcdCByZXR1cm4gbmV3IFJlbmRlckN1YmVUZXh0dXJlKCB0aGlzLl9kZXB0aE1hcFNpemUgKTtcblx0XHQgKi9cblx0fVxuXG5cdC8vQG92ZXJyaWRlXG5cdHB1YmxpYyBwVXBkYXRlRGVwdGhQcm9qZWN0aW9uKHZpZXdDYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0dmFyIGxpZ2h0OlBvaW50TGlnaHQgPSA8UG9pbnRMaWdodD4odGhpcy5fcExpZ2h0KTtcblx0XHR2YXIgbWF4RGlzdGFuY2U6bnVtYmVyID0gbGlnaHQuX3BGYWxsT2ZmO1xuXHRcdHZhciBwb3M6VmVjdG9yM0QgPSB0aGlzLl9wTGlnaHQuc2NlbmVQb3NpdGlvbjtcblxuXHRcdC8vIHRvZG86IGZhY2VzIG91dHNpZGUgZnJ1c3R1bSB3aGljaCBhcmUgcG9pbnRpbmcgYXdheSBmcm9tIGNhbWVyYSBuZWVkIG5vdCBiZSByZW5kZXJlZCFcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA2OyArK2kpIHtcblx0XHRcdHRoaXMuX3Byb2plY3Rpb25zW2ldLmZhciA9IG1heERpc3RhbmNlO1xuXHRcdFx0dGhpcy5fZGVwdGhDYW1lcmFzW2ldLnRyYW5zZm9ybS5wb3NpdGlvbiA9IHBvcztcblx0XHRcdHRoaXMuX25lZWRzUmVuZGVyW2ldID0gdHJ1ZTtcblx0XHR9XG5cdH1cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgcERyYXdEZXB0aE1hcCh0YXJnZXQ6UmVuZGVyVGV4dHVyZSwgc2NlbmU6U2NlbmUsIHJlbmRlcmVyOklSZW5kZXJlcilcblx0e1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDY7ICsraSkge1xuXHRcdFx0aWYgKHRoaXMuX25lZWRzUmVuZGVyW2ldKSB7XG5cdFx0XHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY2FtZXJhID0gdGhpcy5fZGVwdGhDYW1lcmFzW2ldO1xuXHRcdFx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLmNsZWFyKCk7XG5cdFx0XHRcdHNjZW5lLnRyYXZlcnNlUGFydGl0aW9ucyh0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yKTtcblx0XHRcdFx0cmVuZGVyZXIuX2lSZW5kZXIodGhpcy5fcENhc3RlckNvbGxlY3RvciwgdGFyZ2V0LCBudWxsLCBpKVxuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgPSBDdWJlTWFwU2hhZG93TWFwcGVyOyJdfQ==