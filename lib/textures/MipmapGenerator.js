var BitmapData = require("awayjs-core/lib/base/BitmapData");
var Matrix = require("awayjs-core/lib/geom/Matrix");
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
/**
 * MipmapGenerator is a helper class that uploads BitmapData to a Texture including mipmap levels.
 */
var MipmapGenerator = (function () {
    function MipmapGenerator() {
    }
    MipmapGenerator.generateMipMaps = function (source, output, alpha) {
        if (alpha === void 0) { alpha = false; }
        var w = source.width;
        var h = source.height;
        var i = 0;
        var mipmap;
        MipmapGenerator._rect.width = w;
        MipmapGenerator._rect.height = h;
        while (w >= 1 || h >= 1) {
            mipmap = output[i] = MipmapGenerator._getMipmapHolder(output[i], MipmapGenerator._rect.width, MipmapGenerator._rect.height);
            if (alpha)
                mipmap.fillRect(MipmapGenerator._rect, 0);
            MipmapGenerator._matrix.a = MipmapGenerator._rect.width / source.width;
            MipmapGenerator._matrix.d = MipmapGenerator._rect.height / source.height;
            mipmap.draw(source, MipmapGenerator._matrix); //TODO: smoothing?
            w >>= 1;
            h >>= 1;
            MipmapGenerator._rect.width = w > 1 ? w : 1;
            MipmapGenerator._rect.height = h > 1 ? h : 1;
            i++;
        }
    };
    MipmapGenerator._getMipmapHolder = function (mipMapHolder, newW, newH) {
        if (mipMapHolder) {
            if (mipMapHolder.width == newW && mipMapHolder.height == newH)
                return mipMapHolder;
            MipmapGenerator.freeMipMapHolder(mipMapHolder);
        }
        if (!MipmapGenerator._mipMaps[newW]) {
            MipmapGenerator._mipMaps[newW] = [];
            MipmapGenerator._mipMapUses[newW] = [];
        }
        if (!MipmapGenerator._mipMaps[newW][newH]) {
            mipMapHolder = MipmapGenerator._mipMaps[newW][newH] = new BitmapData(newW, newH, true);
            MipmapGenerator._mipMapUses[newW][newH] = 1;
        }
        else {
            MipmapGenerator._mipMapUses[newW][newH] = MipmapGenerator._mipMapUses[newW][newH] + 1;
            mipMapHolder = MipmapGenerator._mipMaps[newW][newH];
        }
        return mipMapHolder;
    };
    MipmapGenerator.freeMipMapHolder = function (mipMapHolder) {
        var holderWidth = mipMapHolder.width;
        var holderHeight = mipMapHolder.height;
        if (--MipmapGenerator._mipMapUses[holderWidth][holderHeight] == 0) {
            MipmapGenerator._mipMaps[holderWidth][holderHeight].dispose();
            MipmapGenerator._mipMaps[holderWidth][holderHeight] = null;
        }
    };
    MipmapGenerator._mipMaps = [];
    MipmapGenerator._mipMapUses = [];
    MipmapGenerator._matrix = new Matrix();
    MipmapGenerator._rect = new Rectangle();
    return MipmapGenerator;
})();
module.exports = MipmapGenerator;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9NaXBtYXBHZW5lcmF0b3IudHMiXSwibmFtZXMiOlsiTWlwbWFwR2VuZXJhdG9yIiwiTWlwbWFwR2VuZXJhdG9yLmNvbnN0cnVjdG9yIiwiTWlwbWFwR2VuZXJhdG9yLmdlbmVyYXRlTWlwTWFwcyIsIk1pcG1hcEdlbmVyYXRvci5fZ2V0TWlwbWFwSG9sZGVyIiwiTWlwbWFwR2VuZXJhdG9yLmZyZWVNaXBNYXBIb2xkZXIiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sVUFBVSxXQUFjLGlDQUFpQyxDQUFDLENBQUM7QUFDbEUsSUFBTyxNQUFNLFdBQWUsNkJBQTZCLENBQUMsQ0FBQztBQUMzRCxJQUFPLFNBQVMsV0FBYyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBRWhFLEFBR0E7O0dBREc7SUFDRyxlQUFlO0lBQXJCQSxTQUFNQSxlQUFlQTtJQXVGckJDLENBQUNBO0lBckVjRCwrQkFBZUEsR0FBN0JBLFVBQThCQSxNQUFVQSxFQUFFQSxNQUF5QkEsRUFBRUEsS0FBcUJBO1FBQXJCRSxxQkFBcUJBLEdBQXJCQSxhQUFxQkE7UUFFekZBLElBQUlBLENBQUNBLEdBQVVBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxHQUFVQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUM3QkEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFFakJBLElBQUlBLE1BQWlCQSxDQUFDQTtRQUV0QkEsZUFBZUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLGVBQWVBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO1FBR2pDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUV6QkEsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsZUFBZUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxlQUFlQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxlQUFlQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUU1SEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7Z0JBQ1RBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLGVBQWVBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBRTNDQSxlQUFlQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxHQUFHQSxlQUFlQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUNyRUEsZUFBZUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsZUFBZUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFFdkVBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLGVBQWVBLENBQUNBLE9BQU9BLENBQUNBLEVBQUVBLGtCQUFrQkE7WUFFaEVBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ1JBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBRVJBLGVBQWVBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQzNDQSxlQUFlQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUU1Q0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFFY0YsZ0NBQWdCQSxHQUEvQkEsVUFBZ0NBLFlBQXVCQSxFQUFFQSxJQUFXQSxFQUFFQSxJQUFXQTtRQUVoRkcsRUFBRUEsQ0FBQ0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLENBQUNBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLElBQUlBLElBQUlBLElBQUlBLFlBQVlBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBO2dCQUM3REEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7WUFFckJBLGVBQWVBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFDaERBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLGVBQWVBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JDQSxlQUFlQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNwQ0EsZUFBZUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDeENBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLGVBQWVBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNDQSxZQUFZQSxHQUFHQSxlQUFlQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxVQUFVQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUN2RkEsZUFBZUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLGVBQWVBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLGVBQWVBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ3RGQSxZQUFZQSxHQUFHQSxlQUFlQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNyREEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7SUFDckJBLENBQUNBO0lBRWFILGdDQUFnQkEsR0FBOUJBLFVBQStCQSxZQUF1QkE7UUFFckRJLElBQUlBLFdBQVdBLEdBQVVBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBO1FBQzVDQSxJQUFJQSxZQUFZQSxHQUFVQSxZQUFZQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUU5Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsZUFBZUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbkVBLGVBQWVBLENBQUNBLFFBQVFBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1lBQzlEQSxlQUFlQSxDQUFDQSxRQUFRQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxZQUFZQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUM1REEsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFwRmNKLHdCQUFRQSxHQUFHQSxFQUFFQSxDQUFDQTtJQUNkQSwyQkFBV0EsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFFakJBLHVCQUFPQSxHQUFVQSxJQUFJQSxNQUFNQSxFQUFFQSxDQUFDQTtJQUM5QkEscUJBQUtBLEdBQWFBLElBQUlBLFNBQVNBLEVBQUVBLENBQUNBO0lBaUZsREEsc0JBQUNBO0FBQURBLENBdkZBLEFBdUZDQSxJQUFBO0FBRUQsQUFBeUIsaUJBQWhCLGVBQWUsQ0FBQyIsImZpbGUiOiJ0ZXh0dXJlcy9NaXBtYXBHZW5lcmF0b3IuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJpdG1hcERhdGFcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9iYXNlL0JpdG1hcERhdGFcIik7XHJcbmltcG9ydCBNYXRyaXhcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4XCIpO1xyXG5pbXBvcnQgUmVjdGFuZ2xlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XHJcblxyXG4vKipcclxuICogTWlwbWFwR2VuZXJhdG9yIGlzIGEgaGVscGVyIGNsYXNzIHRoYXQgdXBsb2FkcyBCaXRtYXBEYXRhIHRvIGEgVGV4dHVyZSBpbmNsdWRpbmcgbWlwbWFwIGxldmVscy5cclxuICovXHJcbmNsYXNzIE1pcG1hcEdlbmVyYXRvclxyXG57XHJcblx0cHJpdmF0ZSBzdGF0aWMgX21pcE1hcHMgPSBbXTtcclxuXHRwcml2YXRlIHN0YXRpYyBfbWlwTWFwVXNlcyA9IFtdO1xyXG5cclxuXHRwcml2YXRlIHN0YXRpYyBfbWF0cml4Ok1hdHJpeCA9IG5ldyBNYXRyaXgoKTtcclxuXHRwcml2YXRlIHN0YXRpYyBfcmVjdDpSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcblx0cHJpdmF0ZSBzdGF0aWMgX3NvdXJjZTpCaXRtYXBEYXRhO1xyXG5cclxuXHQvKipcclxuXHQgKiBVcGxvYWRzIGEgQml0bWFwRGF0YSB3aXRoIG1pcCBtYXBzIHRvIGEgdGFyZ2V0IFRleHR1cmUgb2JqZWN0LlxyXG5cdCAqIEBwYXJhbSBzb3VyY2UgVGhlIHNvdXJjZSB0byB1cGxvYWQuXHJcblx0ICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IFRleHR1cmUgdG8gdXBsb2FkIHRvLlxyXG5cdCAqIEBwYXJhbSBtaXBtYXAgQW4gb3B0aW9uYWwgbWlwIG1hcCBob2xkZXIgdG8gYXZvaWRzIGNyZWF0aW5nIG5ldyBpbnN0YW5jZXMgZm9yIGZlIGFuaW1hdGVkIG1hdGVyaWFscy5cclxuXHQgKiBAcGFyYW0gYWxwaGEgSW5kaWNhdGUgd2hldGhlciBvciBub3QgdGhlIHVwbG9hZGVkIGJpdG1hcERhdGEgaXMgdHJhbnNwYXJlbnQuXHJcblx0ICovXHJcblx0cHVibGljIHN0YXRpYyBnZW5lcmF0ZU1pcE1hcHMoc291cmNlOkhUTUxJbWFnZUVsZW1lbnQsIG91dHB1dD86QXJyYXk8Qml0bWFwRGF0YT4sIGFscGhhPzpib29sZWFuKTtcclxuXHRwdWJsaWMgc3RhdGljIGdlbmVyYXRlTWlwTWFwcyhzb3VyY2U6Qml0bWFwRGF0YSwgb3V0cHV0PzpBcnJheTxCaXRtYXBEYXRhPiwgYWxwaGE/OmJvb2xlYW4pO1xyXG5cdHB1YmxpYyBzdGF0aWMgZ2VuZXJhdGVNaXBNYXBzKHNvdXJjZTphbnksIG91dHB1dD86QXJyYXk8Qml0bWFwRGF0YT4sIGFscGhhOmJvb2xlYW4gPSBmYWxzZSlcclxuXHR7XHJcblx0XHR2YXIgdzpudW1iZXIgPSBzb3VyY2Uud2lkdGg7XHJcblx0XHR2YXIgaDpudW1iZXIgPSBzb3VyY2UuaGVpZ2h0O1xyXG5cdFx0dmFyIGk6bnVtYmVyID0gMDtcclxuXHJcblx0XHR2YXIgbWlwbWFwOkJpdG1hcERhdGE7XHJcblxyXG5cdFx0TWlwbWFwR2VuZXJhdG9yLl9yZWN0LndpZHRoID0gdztcclxuXHRcdE1pcG1hcEdlbmVyYXRvci5fcmVjdC5oZWlnaHQgPSBoO1xyXG5cclxuXHRcdC8vdXNlIChPUikgdG8gY3JlYXRlIG5vbi1zcXVhcmUgdGV4dHVyZSBtaXBtYXBzXHJcblx0XHR3aGlsZSAodyA+PSAxIHx8IGggPj0gMSkge1xyXG5cclxuXHRcdFx0bWlwbWFwID0gb3V0cHV0W2ldID0gTWlwbWFwR2VuZXJhdG9yLl9nZXRNaXBtYXBIb2xkZXIob3V0cHV0W2ldLCBNaXBtYXBHZW5lcmF0b3IuX3JlY3Qud2lkdGgsIE1pcG1hcEdlbmVyYXRvci5fcmVjdC5oZWlnaHQpO1xyXG5cclxuXHRcdFx0aWYgKGFscGhhKVxyXG5cdFx0XHRcdG1pcG1hcC5maWxsUmVjdChNaXBtYXBHZW5lcmF0b3IuX3JlY3QsIDApO1xyXG5cclxuXHRcdFx0TWlwbWFwR2VuZXJhdG9yLl9tYXRyaXguYSA9IE1pcG1hcEdlbmVyYXRvci5fcmVjdC53aWR0aC9zb3VyY2Uud2lkdGg7XHJcblx0XHRcdE1pcG1hcEdlbmVyYXRvci5fbWF0cml4LmQgPSBNaXBtYXBHZW5lcmF0b3IuX3JlY3QuaGVpZ2h0L3NvdXJjZS5oZWlnaHQ7XHJcblxyXG5cdFx0XHRtaXBtYXAuZHJhdyhzb3VyY2UsIE1pcG1hcEdlbmVyYXRvci5fbWF0cml4KTsgLy9UT0RPOiBzbW9vdGhpbmc/XHJcblxyXG5cdFx0XHR3ID4+PSAxO1xyXG5cdFx0XHRoID4+PSAxO1xyXG5cclxuXHRcdFx0TWlwbWFwR2VuZXJhdG9yLl9yZWN0LndpZHRoID0gdyA+IDE/IHcgOiAxO1xyXG5cdFx0XHRNaXBtYXBHZW5lcmF0b3IuX3JlY3QuaGVpZ2h0ID0gaCA+IDE/IGggOiAxO1xyXG5cclxuXHRcdFx0aSsrO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBzdGF0aWMgX2dldE1pcG1hcEhvbGRlcihtaXBNYXBIb2xkZXI6Qml0bWFwRGF0YSwgbmV3VzpudW1iZXIsIG5ld0g6bnVtYmVyKTpCaXRtYXBEYXRhXHJcblx0e1xyXG5cdFx0aWYgKG1pcE1hcEhvbGRlcikge1xyXG5cdFx0XHRpZiAobWlwTWFwSG9sZGVyLndpZHRoID09IG5ld1cgJiYgbWlwTWFwSG9sZGVyLmhlaWdodCA9PSBuZXdIKVxyXG5cdFx0XHRcdHJldHVybiBtaXBNYXBIb2xkZXI7XHJcblxyXG5cdFx0XHRNaXBtYXBHZW5lcmF0b3IuZnJlZU1pcE1hcEhvbGRlcihtaXBNYXBIb2xkZXIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghTWlwbWFwR2VuZXJhdG9yLl9taXBNYXBzW25ld1ddKSB7XHJcblx0XHRcdE1pcG1hcEdlbmVyYXRvci5fbWlwTWFwc1tuZXdXXSA9IFtdO1xyXG5cdFx0XHRNaXBtYXBHZW5lcmF0b3IuX21pcE1hcFVzZXNbbmV3V10gPSBbXTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIU1pcG1hcEdlbmVyYXRvci5fbWlwTWFwc1tuZXdXXVtuZXdIXSkge1xyXG5cdFx0XHRtaXBNYXBIb2xkZXIgPSBNaXBtYXBHZW5lcmF0b3IuX21pcE1hcHNbbmV3V11bbmV3SF0gPSBuZXcgQml0bWFwRGF0YShuZXdXLCBuZXdILCB0cnVlKTtcclxuXHRcdFx0TWlwbWFwR2VuZXJhdG9yLl9taXBNYXBVc2VzW25ld1ddW25ld0hdID0gMTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdE1pcG1hcEdlbmVyYXRvci5fbWlwTWFwVXNlc1tuZXdXXVtuZXdIXSA9IE1pcG1hcEdlbmVyYXRvci5fbWlwTWFwVXNlc1tuZXdXXVtuZXdIXSArIDE7XHJcblx0XHRcdG1pcE1hcEhvbGRlciA9IE1pcG1hcEdlbmVyYXRvci5fbWlwTWFwc1tuZXdXXVtuZXdIXTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gbWlwTWFwSG9sZGVyO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyBmcmVlTWlwTWFwSG9sZGVyKG1pcE1hcEhvbGRlcjpCaXRtYXBEYXRhKVxyXG5cdHtcclxuXHRcdHZhciBob2xkZXJXaWR0aDpudW1iZXIgPSBtaXBNYXBIb2xkZXIud2lkdGg7XHJcblx0XHR2YXIgaG9sZGVySGVpZ2h0Om51bWJlciA9IG1pcE1hcEhvbGRlci5oZWlnaHQ7XHJcblxyXG5cdFx0aWYgKC0tTWlwbWFwR2VuZXJhdG9yLl9taXBNYXBVc2VzW2hvbGRlcldpZHRoXVtob2xkZXJIZWlnaHRdID09IDApIHtcclxuXHRcdFx0TWlwbWFwR2VuZXJhdG9yLl9taXBNYXBzW2hvbGRlcldpZHRoXVtob2xkZXJIZWlnaHRdLmRpc3Bvc2UoKTtcclxuXHRcdFx0TWlwbWFwR2VuZXJhdG9yLl9taXBNYXBzW2hvbGRlcldpZHRoXVtob2xkZXJIZWlnaHRdID0gbnVsbDtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IE1pcG1hcEdlbmVyYXRvcjsiXX0=