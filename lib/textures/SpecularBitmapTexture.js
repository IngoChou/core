var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var BitmapData = require("awayjs-core/lib/base/BitmapData");
var BitmapDataChannel = require("awayjs-core/lib/base/BitmapDataChannel");
var Point = require("awayjs-core/lib/geom/Point");
var BitmapTexture = require("awayjs-core/lib/textures/BitmapTexture");
/**
 * A convenience texture that encodes a specular map in the red channel, and the gloss map in the green channel, as expected by BasicSpecularMapMethod
 */
var SpecularBitmapTexture = (function (_super) {
    __extends(SpecularBitmapTexture, _super);
    function SpecularBitmapTexture(specularMap, glossMap) {
        if (specularMap === void 0) { specularMap = null; }
        if (glossMap === void 0) { glossMap = null; }
        var bmd = specularMap ? specularMap : glossMap;
        bmd = bmd ? new BitmapData(bmd.width, bmd.height, false, 0xffffff) : new BitmapData(1, 1, false, 0xffffff);
        _super.call(this, bmd);
        this.specularMap = specularMap;
        this.glossMap = glossMap;
    }
    Object.defineProperty(SpecularBitmapTexture.prototype, "specularMap", {
        get: function () {
            return this._specularMap;
        },
        set: function (value) {
            this._specularMap = value;
            this.invalidateContent();
            this._testSize();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SpecularBitmapTexture.prototype, "glossMap", {
        get: function () {
            return this._glossMap;
        },
        set: function (value) {
            this._glossMap = value;
            this.invalidateContent();
            this._testSize();
        },
        enumerable: true,
        configurable: true
    });
    SpecularBitmapTexture.prototype._testSize = function () {
        var w, h;
        if (this._specularMap) {
            w = this._specularMap.width;
            h = this._specularMap.height;
        }
        else if (this._glossMap) {
            w = this._glossMap.width;
            h = this._glossMap.height;
        }
        else {
            w = 1;
            h = 1;
        }
        if (w != this._bitmapData.width && h != this._bitmapData.height) {
            var oldBitmap = this._bitmapData;
            this.bitmapData = new BitmapData(this._specularMap.width, this._specularMap.height, false, 0xffffff);
            oldBitmap.dispose();
        }
    };
    SpecularBitmapTexture.prototype._iGetTextureData = function () {
        var rect = this._specularMap.rect;
        var origin = new Point();
        this._bitmapData.fillRect(rect, 0xffffff);
        if (this._glossMap)
            this._bitmapData.copyChannel(this._glossMap, rect, origin, BitmapDataChannel.GREEN, BitmapDataChannel.GREEN);
        if (this._specularMap)
            this._bitmapData.copyChannel(this._specularMap, rect, origin, BitmapDataChannel.RED, BitmapDataChannel.RED);
        return this._bitmapData;
    };
    return SpecularBitmapTexture;
})(BitmapTexture);
module.exports = SpecularBitmapTexture;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9TcGVjdWxhckJpdG1hcFRleHR1cmUudHMiXSwibmFtZXMiOlsiU3BlY3VsYXJCaXRtYXBUZXh0dXJlIiwiU3BlY3VsYXJCaXRtYXBUZXh0dXJlLmNvbnN0cnVjdG9yIiwiU3BlY3VsYXJCaXRtYXBUZXh0dXJlLnNwZWN1bGFyTWFwIiwiU3BlY3VsYXJCaXRtYXBUZXh0dXJlLmdsb3NzTWFwIiwiU3BlY3VsYXJCaXRtYXBUZXh0dXJlLl90ZXN0U2l6ZSIsIlNwZWN1bGFyQml0bWFwVGV4dHVyZS5faUdldFRleHR1cmVEYXRhIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFVBQVUsV0FBYyxpQ0FBaUMsQ0FBQyxDQUFDO0FBQ2xFLElBQU8saUJBQWlCLFdBQVksd0NBQXdDLENBQUMsQ0FBQztBQUM5RSxJQUFPLEtBQUssV0FBZSw0QkFBNEIsQ0FBQyxDQUFDO0FBRXpELElBQU8sYUFBYSxXQUFhLHdDQUF3QyxDQUFDLENBQUM7QUFFM0UsQUFHQTs7R0FERztJQUNHLHFCQUFxQjtJQUFTQSxVQUE5QkEscUJBQXFCQSxVQUFzQkE7SUFLaERBLFNBTEtBLHFCQUFxQkEsQ0FLZEEsV0FBNkJBLEVBQUVBLFFBQTBCQTtRQUF6REMsMkJBQTZCQSxHQUE3QkEsa0JBQTZCQTtRQUFFQSx3QkFBMEJBLEdBQTFCQSxlQUEwQkE7UUFFcEVBLElBQUlBLEdBQUdBLEdBQWNBLFdBQVdBLEdBQUVBLFdBQVdBLEdBQUdBLFFBQVFBLENBQUNBO1FBRXpEQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFFQSxJQUFJQSxVQUFVQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxFQUFFQSxHQUFHQSxDQUFDQSxNQUFNQSxFQUFFQSxLQUFLQSxFQUFFQSxRQUFRQSxDQUFDQSxHQUFHQSxJQUFJQSxVQUFVQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtRQUUxR0Esa0JBQU1BLEdB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Q0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsSUFBSUEsRUFBRUEsTUFBTUEsRUFBRUEsaUJBQWlCQSxDQUFDQSxLQUFLQSxFQUFFQSxpQkFBaUJBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBRTlHQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQTtZQUNyQkEsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsSUFBSUEsRUFBRUEsTUFBTUEsRUFBRUEsaUJBQWlCQSxDQUFDQSxHQUFHQSxFQUFFQSxpQkFBaUJBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBRTdHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQTtJQUN6QkEsQ0FBQ0E7SUFDRkwsNEJBQUNBO0FBQURBLENBakZBLEFBaUZDQSxFQWpGbUMsYUFBYSxFQWlGaEQ7QUFFRCxBQUErQixpQkFBdEIscUJBQXFCLENBQUMiLCJmaWxlIjoidGV4dHVyZXMvU3BlY3VsYXJCaXRtYXBUZXh0dXJlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCaXRtYXBEYXRhXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvYmFzZS9CaXRtYXBEYXRhXCIpO1xyXG5pbXBvcnQgQml0bWFwRGF0YUNoYW5uZWxcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Jhc2UvQml0bWFwRGF0YUNoYW5uZWxcIik7XHJcbmltcG9ydCBQb2ludFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9Qb2ludFwiKTtcclxuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vUmVjdGFuZ2xlXCIpO1xyXG5pbXBvcnQgQml0bWFwVGV4dHVyZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9CaXRtYXBUZXh0dXJlXCIpO1xyXG5cclxuLyoqXHJcbiAqIEEgY29udmVuaWVuY2UgdGV4dHVyZSB0aGF0IGVuY29kZXMgYSBzcGVjdWxhciBtYXAgaW4gdGhlIHJlZCBjaGFubmVsLCBhbmQgdGhlIGdsb3NzIG1hcCBpbiB0aGUgZ3JlZW4gY2hhbm5lbCwgYXMgZXhwZWN0ZWQgYnkgQmFzaWNTcGVjdWxhck1hcE1ldGhvZFxyXG4gKi9cclxuY2xhc3MgU3BlY3VsYXJCaXRtYXBUZXh0dXJlIGV4dGVuZHMgQml0bWFwVGV4dHVyZVxyXG57XHJcblx0cHJpdmF0ZSBfc3BlY3VsYXJNYXA6Qml0bWFwRGF0YTtcclxuXHRwcml2YXRlIF9nbG9zc01hcDpCaXRtYXBEYXRhO1xyXG5cdFxyXG5cdGNvbnN0cnVjdG9yKHNwZWN1bGFyTWFwOkJpdG1hcERhdGEgPSBudWxsLCBnbG9zc01hcDpCaXRtYXBEYXRhID0gbnVsbClcclxuXHR7XHJcblx0XHR2YXIgYm1kOkJpdG1hcERhdGEgPSBzcGVjdWxhck1hcD8gc3BlY3VsYXJNYXAgOiBnbG9zc01hcDtcclxuXHJcblx0XHRibWQgPSBibWQ/IG5ldyBCaXRtYXBEYXRhKGJtZC53aWR0aCwgYm1kLmhlaWdodCwgZmFsc2UsIDB4ZmZmZmZmKSA6IG5ldyBCaXRtYXBEYXRhKDEsIDEsIGZhbHNlLCAweGZmZmZmZik7XHJcblx0XHRcclxuXHRcdHN1cGVyKGJtZCk7XHJcblx0XHRcclxuXHRcdHRoaXMuc3BlY3VsYXJNYXAgPSBzcGVjdWxhck1hcDtcclxuXHRcdHRoaXMuZ2xvc3NNYXAgPSBnbG9zc01hcDtcclxuXHR9XHJcblx0XHJcblx0cHVibGljIGdldCBzcGVjdWxhck1hcCgpOkJpdG1hcERhdGFcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fc3BlY3VsYXJNYXA7XHJcblx0fVxyXG5cdFxyXG5cdHB1YmxpYyBzZXQgc3BlY3VsYXJNYXAodmFsdWU6Qml0bWFwRGF0YSlcclxuXHR7XHJcblx0XHR0aGlzLl9zcGVjdWxhck1hcCA9IHZhbHVlO1xyXG5cclxuXHRcdHRoaXMuaW52YWxpZGF0ZUNvbnRlbnQoKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5fdGVzdFNpemUoKTtcclxuXHR9XHJcblx0XHJcblx0cHVibGljIGdldCBnbG9zc01hcCgpOkJpdG1hcERhdGFcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fZ2xvc3NNYXA7XHJcblx0fVxyXG5cdFxyXG5cdHB1YmxpYyBzZXQgZ2xvc3NNYXAodmFsdWU6Qml0bWFwRGF0YSlcclxuXHR7XHJcblx0XHR0aGlzLl9nbG9zc01hcCA9IHZhbHVlO1xyXG5cdFx0dGhpcy5pbnZhbGlkYXRlQ29udGVudCgpO1xyXG5cdFx0XHJcblx0XHR0aGlzLl90ZXN0U2l6ZSgpO1xyXG5cdH1cclxuXHRcclxuXHRwcml2YXRlIF90ZXN0U2l6ZSgpXHJcblx0e1xyXG5cdFx0dmFyIHc6TnVtYmVyLCBoOk51bWJlcjtcclxuXHRcdFxyXG5cdFx0aWYgKHRoaXMuX3NwZWN1bGFyTWFwKSB7XHJcblx0XHRcdHcgPSB0aGlzLl9zcGVjdWxhck1hcC53aWR0aDtcclxuXHRcdFx0aCA9IHRoaXMuX3NwZWN1bGFyTWFwLmhlaWdodDtcclxuXHRcdH0gZWxzZSBpZiAodGhpcy5fZ2xvc3NNYXApIHtcclxuXHRcdFx0dyA9IHRoaXMuX2dsb3NzTWFwLndpZHRoO1xyXG5cdFx0XHRoID0gdGhpcy5fZ2xvc3NNYXAuaGVpZ2h0O1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dyA9IDE7XHJcblx0XHRcdGggPSAxO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRpZiAodyAhPSB0aGlzLl9iaXRtYXBEYXRhLndpZHRoICYmIGggIT0gdGhpcy5fYml0bWFwRGF0YS5oZWlnaHQpIHtcclxuXHRcdFx0dmFyIG9sZEJpdG1hcDpCaXRtYXBEYXRhID0gdGhpcy5fYml0bWFwRGF0YTtcclxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhID0gbmV3IEJpdG1hcERhdGEodGhpcy5fc3BlY3VsYXJNYXAud2lkdGgsIHRoaXMuX3NwZWN1bGFyTWFwLmhlaWdodCwgZmFsc2UsIDB4ZmZmZmZmKTtcclxuXHRcdFx0b2xkQml0bWFwLmRpc3Bvc2UoKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfaUdldFRleHR1cmVEYXRhKCk6Qml0bWFwRGF0YVxyXG5cdHtcclxuXHRcdHZhciByZWN0OlJlY3RhbmdsZSA9IHRoaXMuX3NwZWN1bGFyTWFwLnJlY3Q7XHJcblx0XHR2YXIgb3JpZ2luOlBvaW50ID0gbmV3IFBvaW50KCk7XHJcblxyXG5cdFx0dGhpcy5fYml0bWFwRGF0YS5maWxsUmVjdChyZWN0LCAweGZmZmZmZik7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2dsb3NzTWFwKVxyXG5cdFx0XHR0aGlzLl9iaXRtYXBEYXRhLmNvcHlDaGFubmVsKHRoaXMuX2dsb3NzTWFwLCByZWN0LCBvcmlnaW4sIEJpdG1hcERhdGFDaGFubmVsLkdSRUVOLCBCaXRtYXBEYXRhQ2hhbm5lbC5HUkVFTik7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3NwZWN1bGFyTWFwKVxyXG5cdFx0XHR0aGlzLl9iaXRtYXBEYXRhLmNvcHlDaGFubmVsKHRoaXMuX3NwZWN1bGFyTWFwLCByZWN0LCBvcmlnaW4sIEJpdG1hcERhdGFDaGFubmVsLlJFRCwgQml0bWFwRGF0YUNoYW5uZWwuUkVEKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fYml0bWFwRGF0YTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IFNwZWN1bGFyQml0bWFwVGV4dHVyZTsiXX0=