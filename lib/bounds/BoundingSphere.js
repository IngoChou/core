var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var BoundingVolumeBase = require("awayjs-core/lib/bounds/BoundingVolumeBase");

var PlaneClassification = require("awayjs-core/lib/core/geom/PlaneClassification");

var Vector3D = require("awayjs-core/lib/core/geom/Vector3D");

var BoundingSphere = (function (_super) {
    __extends(BoundingSphere, _super);
    function BoundingSphere() {
        _super.call(this);
        this._radius = 0;
        this._centerX = 0;
        this._centerY = 0;
        this._centerZ = 0;
    }
    Object.defineProperty(BoundingSphere.prototype, "radius", {
        get: function () {
            return this._radius;
        },
        enumerable: true,
        configurable: true
    });

    BoundingSphere.prototype.nullify = function () {
        _super.prototype.nullify.call(this);
        this._centerX = this._centerY = this._centerZ = 0;
        this._radius = 0;
    };

    BoundingSphere.prototype.isInFrustum = function (planes, numPlanes) {
        for (var i = 0; i < numPlanes; ++i) {
            var plane = planes[i];
            var flippedExtentX = plane.a < 0 ? -this._radius : this._radius;
            var flippedExtentY = plane.b < 0 ? -this._radius : this._radius;
            var flippedExtentZ = plane.c < 0 ? -this._radius : this._radius;
            var projDist = plane.a * (this._centerX + flippedExtentX) + plane.b * (this._centerY + flippedExtentY) + plane.c * (this._centerZ + flippedExtentZ) - plane.d;
            if (projDist < 0) {
                return false;
            }
        }
        return true;
    };

    BoundingSphere.prototype.fromSphere = function (center, radius) {
        this._centerX = center.x;
        this._centerY = center.y;
        this._centerZ = center.z;
        this._radius = radius;
        this._aabb.width = this._aabb.height = this._aabb.depth = radius * 2;
        this._aabb.x = this._centerX - radius;
        this._aabb.y = this._centerY + radius;
        this._aabb.z = this._centerZ - radius;
        this._pAabbPointsDirty = true;

        if (this._pBoundingEntity)
            this.pUpdateBoundingEntity();
    };

    BoundingSphere.prototype.fromExtremes = function (minX, minY, minZ, maxX, maxY, maxZ) {
        this._centerX = (maxX + minX) * .5;
        this._centerY = (maxY + minY) * .5;
        this._centerZ = (maxZ + minZ) * .5;

        var d = maxX - minX;
        var y = maxY - minY;
        var z = maxZ - minZ;

        if (y > d)
            d = y;

        if (z > d)
            d = z;

        this._radius = d * Math.sqrt(.5);
        _super.prototype.fromExtremes.call(this, minX, minY, minZ, maxX, maxY, maxZ);
    };

    BoundingSphere.prototype.clone = function () {
        var clone = new BoundingSphere();
        clone.fromSphere(new Vector3D(this._centerX, this._centerY, this._centerZ), this._radius);
        return clone;
    };

    BoundingSphere.prototype.rayIntersection = function (position, direction, targetNormal) {
        if (this.containsPoint(position)) {
            return 0;
        }

        var px = position.x - this._centerX, py = position.y - this._centerY, pz = position.z - this._centerZ;
        var vx = direction.x, vy = direction.y, vz = direction.z;
        var rayEntryDistance;

        var a = vx * vx + vy * vy + vz * vz;
        var b = 2 * (px * vx + py * vy + pz * vz);
        var c = px * px + py * py + pz * pz - this._radius * this._radius;
        var det = b * b - 4 * a * c;

        if (det >= 0) {
            var sqrtDet = Math.sqrt(det);
            rayEntryDistance = (-b - sqrtDet) / (2 * a);
            if (rayEntryDistance >= 0) {
                targetNormal.x = px + rayEntryDistance * vx;
                targetNormal.y = py + rayEntryDistance * vy;
                targetNormal.z = pz + rayEntryDistance * vz;
                targetNormal.normalize();

                return rayEntryDistance;
            }
        }

        // ray misses sphere
        return -1;
    };

    BoundingSphere.prototype.containsPoint = function (position) {
        var px = position.x - this._centerX;
        var py = position.y - this._centerY;
        var pz = position.z - this._centerZ;
        var distance = Math.sqrt(px * px + py * py + pz * pz);
        return distance <= this._radius;
    };

    BoundingSphere.prototype.pUpdateBoundingEntity = function () {
        var sc = this._radius;
        if (sc == 0)
            sc = 0.001;

        var transform = this._pBoundingEntity.transform;
        transform.scale = new Vector3D(sc, sc, sc);
        transform.position = new Vector3D(this._centerX, this._centerY, this._centerZ);
    };

    // TODO pCreateBoundingRenderable():WireframePrimitiveBase
    BoundingSphere.prototype.pCreateBoundingEntity = function () {
        return null;
    };

    //@override
    BoundingSphere.prototype.classifyToPlane = function (plane) {
        var a = plane.a;
        var b = plane.b;
        var c = plane.c;
        var dd = a * this._centerX + b * this._centerY + c * this._centerZ - plane.d;

        if (a < 0)
            a = -a;

        if (b < 0)
            b = -b;

        if (c < 0)
            c = -c;

        var rr = (a + b + c) * this._radius;

        return dd > rr ? PlaneClassification.FRONT : dd < -rr ? PlaneClassification.BACK : PlaneClassification.INTERSECT;
    };

    BoundingSphere.prototype.transformFrom = function (bounds, matrix) {
        var sphere = bounds;
        var cx = sphere._centerX;
        var cy = sphere._centerY;
        var cz = sphere._centerZ;
        var raw = new Array(16);

        matrix.copyRawDataTo(raw);

        var m11 = raw[0], m12 = raw[4], m13 = raw[8], m14 = raw[12];
        var m21 = raw[1], m22 = raw[5], m23 = raw[9], m24 = raw[13];
        var m31 = raw[2], m32 = raw[6], m33 = raw[10], m34 = raw[14];

        this._centerX = cx * m11 + cy * m12 + cz * m13 + m14;
        this._centerY = cx * m21 + cy * m22 + cz * m23 + m24;
        this._centerZ = cx * m31 + cy * m32 + cz * m33 + m34;

        if (m11 < 0)
            m11 = -m11;
        if (m12 < 0)
            m12 = -m12;
        if (m13 < 0)
            m13 = -m13;
        if (m21 < 0)
            m21 = -m21;
        if (m22 < 0)
            m22 = -m22;
        if (m23 < 0)
            m23 = -m23;
        if (m31 < 0)
            m31 = -m31;
        if (m32 < 0)
            m32 = -m32;
        if (m33 < 0)
            m33 = -m33;

        var r = sphere._radius;
        var rx = m11 + m12 + m13;
        var ry = m21 + m22 + m23;
        var rz = m31 + m32 + m33;
        this._radius = r * Math.sqrt(rx * rx + ry * ry + rz * rz);

        this._aabb.width = this._aabb.height = this._aabb.depth = this._radius * 2;
        this._aabb.x = this._centerX - this._radius;
        this._aabb.y = this._centerY + this._radius;
        this._aabb.z = this._centerZ - this._radius;
    };
    return BoundingSphere;
})(BoundingVolumeBase);

module.exports = BoundingSphere;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvdW5kcy9Cb3VuZGluZ1NwaGVyZS50cyJdLCJuYW1lcyI6WyJCb3VuZGluZ1NwaGVyZSIsIkJvdW5kaW5nU3BoZXJlLmNvbnN0cnVjdG9yIiwiQm91bmRpbmdTcGhlcmUubnVsbGlmeSIsIkJvdW5kaW5nU3BoZXJlLmlzSW5GcnVzdHVtIiwiQm91bmRpbmdTcGhlcmUuZnJvbVNwaGVyZSIsIkJvdW5kaW5nU3BoZXJlLmZyb21FeHRyZW1lcyIsIkJvdW5kaW5nU3BoZXJlLmNsb25lIiwiQm91bmRpbmdTcGhlcmUucmF5SW50ZXJzZWN0aW9uIiwiQm91bmRpbmdTcGhlcmUuY29udGFpbnNQb2ludCIsIkJvdW5kaW5nU3BoZXJlLnBVcGRhdGVCb3VuZGluZ0VudGl0eSIsIkJvdW5kaW5nU3BoZXJlLnBDcmVhdGVCb3VuZGluZ0VudGl0eSIsIkJvdW5kaW5nU3BoZXJlLmNsYXNzaWZ5VG9QbGFuZSIsIkJvdW5kaW5nU3BoZXJlLnRyYW5zZm9ybUZyb20iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZFQUFtRjs7QUFHbkYsa0ZBQXdGOztBQUd4Riw0REFBcUU7O0FBR3JFO0lBQTZCQSxpQ0FBa0JBO0lBUTlDQTtRQUVDQyxXQUFNQSxLQUFBQSxDQUFDQTtRQVBSQSxLQUFRQSxPQUFPQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUMzQkEsS0FBUUEsUUFBUUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLEtBQVFBLFFBQVFBLEdBQVVBLENBQUNBLENBQUNBO1FBQzVCQSxLQUFRQSxRQUFRQSxHQUFVQSxDQUFDQSxDQUFDQTtJQUs1QkEsQ0FBQ0E7SUFFREQ7UUFBQUEsS0FBQUE7WUFFQ0EsT0FBT0EsSUFBSUEsQ0FBQ0EsT0FBT0E7UUFDcEJBLENBQUNBOzs7O0FBQUFBO0lBRURBLG1DQUFBQTtRQUVDRSxnQkFBS0EsQ0FBQ0EsT0FBT0EsS0FBQ0EsS0FBQUEsQ0FBQ0E7UUFDZkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0Es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Q0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDdkZBLElBQUlBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBOztRQUV4RkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0E7UUFDOUNBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQzlDQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxHQUFHQTs7UUFFOUNBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ1pBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ1ZBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBOztRQUVaQSxJQUFJQSxDQUFDQSxHQUFVQSxNQUFNQSxDQUFDQSxPQUFPQTtRQUM3QkEsSUFBSUEsRUFBRUEsR0FBVUEsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0E7UUFDL0JBLElBQUlBLEVBQUVBLEdBQVVBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBO1FBQy9CQSxJQUFJQSxFQUFFQSxHQUFVQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQTtRQUMvQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBQ0EsRUFBRUEsQ0FBQ0E7O1FBRWpEQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFDQSxDQUFDQTtRQUN4RUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0E7UUFDM0NBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BO1FBQzNDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQTtJQUM1Q0EsQ0FBQ0E7SUFDRlosc0JBQUNBO0FBQURBLENBQUNBLEVBck40QixrQkFBa0IsRUFxTjlDOztBQUVELCtCQUF3QixDQUFBIiwiZmlsZSI6ImJvdW5kcy9Cb3VuZGluZ1NwaGVyZS5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvcm9iYmF0ZW1hbi9XZWJzdG9ybVByb2plY3RzL2F3YXlqcy1jb3JlLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3VuZGluZ1ZvbHVtZUJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvYm91bmRzL0JvdW5kaW5nVm9sdW1lQmFzZVwiKTtcbmltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vTWF0cml4M0RcIik7XG5pbXBvcnQgTWF0cml4M0RVdGlsc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xuaW1wb3J0IFBsYW5lQ2xhc3NpZmljYXRpb25cdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9nZW9tL1BsYW5lQ2xhc3NpZmljYXRpb25cIik7XG5pbXBvcnQgUGxhbmUzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vUGxhbmUzRFwiKTtcbmltcG9ydCBUcmFuc2Zvcm1cdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9UcmFuc2Zvcm1cIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9nZW9tL1ZlY3RvcjNEXCIpO1xuaW1wb3J0IElFbnRpdHlcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZW50aXRpZXMvSUVudGl0eVwiKTtcblxuY2xhc3MgQm91bmRpbmdTcGhlcmUgZXh0ZW5kcyBCb3VuZGluZ1ZvbHVtZUJhc2VcbntcblxuXHRwcml2YXRlIF9yYWRpdXM6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfY2VudGVyWDpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF9jZW50ZXJZOm51bWJlciA9IDA7XG5cdHByaXZhdGUgX2NlbnRlclo6bnVtYmVyID0gMDtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHRzdXBlcigpO1xuXHR9XG5cblx0cHVibGljIGdldCByYWRpdXMoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9yYWRpdXM7XG5cdH1cblxuXHRwdWJsaWMgbnVsbGlmeSgpXG5cdHtcblx0XHRzdXBlci5udWxsaWZ5KCk7XG5cdFx0dGhpcy5fY2VudGVyWCA9IHRoaXMuX2NlbnRlclkgPSB0aGlzLl9jZW50ZXJaID0gMDtcblx0XHR0aGlzLl9yYWRpdXMgPSAwO1xuXHR9XG5cblx0cHVibGljIGlzSW5GcnVzdHVtKHBsYW5lczpBcnJheTxQbGFuZTNEPiwgbnVtUGxhbmVzOm51bWJlcik6Ym9vbGVhblxuXHR7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbnVtUGxhbmVzOyArK2kpIHtcblx0XHRcdHZhciBwbGFuZTpQbGFuZTNEID0gcGxhbmVzW2ldO1xuXHRcdFx0dmFyIGZsaXBwZWRFeHRlbnRYOm51bWJlciA9IHBsYW5lLmEgPCAwPyAtdGhpcy5fcmFkaXVzIDogdGhpcy5fcmFkaXVzO1xuXHRcdFx0dmFyIGZsaXBwZWRFeHRlbnRZOm51bWJlciA9IHBsYW5lLmIgPCAwPyAtdGhpcy5fcmFkaXVzIDogdGhpcy5fcmFkaXVzO1xuXHRcdFx0dmFyIGZsaXBwZWRFeHRlbnRaOm51bWJlciA9IHBsYW5lLmMgPCAwPyAtdGhpcy5fcmFkaXVzIDogdGhpcy5fcmFkaXVzO1xuXHRcdFx0dmFyIHByb2pEaXN0Om51bWJlciA9IHBsYW5lLmEqKCB0aGlzLl9jZW50ZXJYICsgZmxpcHBlZEV4dGVudFggKSArIHBsYW5lLmIqKCB0aGlzLl9jZW50ZXJZICsgZmxpcHBlZEV4dGVudFkpICsgcGxhbmUuYyooIHRoaXMuX2NlbnRlclogKyBmbGlwcGVkRXh0ZW50WiApIC0gcGxhbmUuZDtcblx0XHRcdGlmIChwcm9qRGlzdCA8IDApIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBmcm9tU3BoZXJlKGNlbnRlcjpWZWN0b3IzRCwgcmFkaXVzOm51bWJlcilcblx0e1xuXHRcdHRoaXMuX2NlbnRlclggPSBjZW50ZXIueDtcblx0XHR0aGlzLl9jZW50ZXJZID0gY2VudGVyLnk7XG5cdFx0dGhpcy5fY2VudGVyWiA9IGNlbnRlci56O1xuXHRcdHRoaXMuX3JhZGl1cyA9IHJhZGl1cztcblx0XHR0aGlzLl9hYWJiLndpZHRoID0gdGhpcy5fYWFiYi5oZWlnaHQgPSB0aGlzLl9hYWJiLmRlcHRoID0gcmFkaXVzKjI7XG5cdFx0dGhpcy5fYWFiYi54ID0gdGhpcy5fY2VudGVyWCAtIHJhZGl1cztcblx0XHR0aGlzLl9hYWJiLnkgPSB0aGlzLl9jZW50ZXJZICsgcmFkaXVzO1xuXHRcdHRoaXMuX2FhYmIueiA9IHRoaXMuX2NlbnRlclogLSByYWRpdXM7XG5cdFx0dGhpcy5fcEFhYmJQb2ludHNEaXJ0eSA9IHRydWU7XG5cblx0XHRpZiAodGhpcy5fcEJvdW5kaW5nRW50aXR5KVxuXHRcdFx0dGhpcy5wVXBkYXRlQm91bmRpbmdFbnRpdHkoKTtcblx0fVxuXG5cdHB1YmxpYyBmcm9tRXh0cmVtZXMobWluWDpudW1iZXIsIG1pblk6bnVtYmVyLCBtaW5aOm51bWJlciwgbWF4WDpudW1iZXIsIG1heFk6bnVtYmVyLCBtYXhaOm51bWJlcilcblx0e1xuXHRcdHRoaXMuX2NlbnRlclggPSAobWF4WCArIG1pblgpKi41O1xuXHRcdHRoaXMuX2NlbnRlclkgPSAobWF4WSArIG1pblkpKi41O1xuXHRcdHRoaXMuX2NlbnRlclogPSAobWF4WiArIG1pblopKi41O1xuXG5cdFx0dmFyIGQ6bnVtYmVyID0gbWF4WCAtIG1pblg7XG5cdFx0dmFyIHk6bnVtYmVyID0gbWF4WSAtIG1pblk7XG5cdFx0dmFyIHo6bnVtYmVyID0gbWF4WiAtIG1pblo7XG5cblx0XHRpZiAoeSA+IGQpXG5cdFx0XHRkID0geTtcblxuXHRcdGlmICh6ID4gZClcblx0XHRcdGQgPSB6O1xuXG5cdFx0dGhpcy5fcmFkaXVzID0gZCpNYXRoLnNxcnQoLjUpO1xuXHRcdHN1cGVyLmZyb21FeHRyZW1lcyhtaW5YLCBtaW5ZLCBtaW5aLCBtYXhYLCBtYXhZLCBtYXhaKTtcblx0fVxuXG5cdHB1YmxpYyBjbG9uZSgpOkJvdW5kaW5nVm9sdW1lQmFzZVxuXHR7XG5cdFx0dmFyIGNsb25lOkJvdW5kaW5nU3BoZXJlID0gbmV3IEJvdW5kaW5nU3BoZXJlKCk7XG5cdFx0Y2xvbmUuZnJvbVNwaGVyZShuZXcgVmVjdG9yM0QodGhpcy5fY2VudGVyWCwgdGhpcy5fY2VudGVyWSwgdGhpcy5fY2VudGVyWiksIHRoaXMuX3JhZGl1cyk7XG5cdFx0cmV0dXJuIGNsb25lO1xuXHR9XG5cblx0cHVibGljIHJheUludGVyc2VjdGlvbihwb3NpdGlvbjpWZWN0b3IzRCwgZGlyZWN0aW9uOlZlY3RvcjNELCB0YXJnZXROb3JtYWw6VmVjdG9yM0QpOm51bWJlclxuXHR7XG5cdFx0aWYgKHRoaXMuY29udGFpbnNQb2ludChwb3NpdGlvbikpIHtcblx0XHRcdHJldHVybiAwO1xuXHRcdH1cblxuXHRcdHZhciBweDpudW1iZXIgPSBwb3NpdGlvbi54IC0gdGhpcy5fY2VudGVyWCwgcHk6bnVtYmVyID0gcG9zaXRpb24ueSAtIHRoaXMuX2NlbnRlclksIHB6Om51bWJlciA9IHBvc2l0aW9uLnogLSB0aGlzLl9jZW50ZXJaO1xuXHRcdHZhciB2eDpudW1iZXIgPSBkaXJlY3Rpb24ueCwgdnk6bnVtYmVyID0gZGlyZWN0aW9uLnksIHZ6Om51bWJlciA9IGRpcmVjdGlvbi56O1xuXHRcdHZhciByYXlFbnRyeURpc3RhbmNlOm51bWJlcjtcblxuXHRcdHZhciBhOm51bWJlciA9IHZ4KnZ4ICsgdnkqdnkgKyB2eip2ejtcblx0XHR2YXIgYjpudW1iZXIgPSAyKiggcHgqdnggKyBweSp2eSArIHB6KnZ6ICk7XG5cdFx0dmFyIGM6bnVtYmVyID0gcHgqcHggKyBweSpweSArIHB6KnB6IC0gdGhpcy5fcmFkaXVzKnRoaXMuX3JhZGl1cztcblx0XHR2YXIgZGV0Om51bWJlciA9IGIqYiAtIDQqYSpjO1xuXG5cdFx0aWYgKGRldCA+PSAwKSB7IC8vIHJheSBnb2VzIHRocm91Z2ggc3BoZXJlXG5cdFx0XHR2YXIgc3FydERldDpudW1iZXIgPSBNYXRoLnNxcnQoZGV0KTtcblx0XHRcdHJheUVudHJ5RGlzdGFuY2UgPSAoIC1iIC0gc3FydERldCApLyggMiphICk7XG5cdFx0XHRpZiAocmF5RW50cnlEaXN0YW5jZSA+PSAwKSB7XG5cdFx0XHRcdHRhcmdldE5vcm1hbC54ID0gcHggKyByYXlFbnRyeURpc3RhbmNlKnZ4O1xuXHRcdFx0XHR0YXJnZXROb3JtYWwueSA9IHB5ICsgcmF5RW50cnlEaXN0YW5jZSp2eTtcblx0XHRcdFx0dGFyZ2V0Tm9ybWFsLnogPSBweiArIHJheUVudHJ5RGlzdGFuY2Uqdno7XG5cdFx0XHRcdHRhcmdldE5vcm1hbC5ub3JtYWxpemUoKTtcblxuXHRcdFx0XHRyZXR1cm4gcmF5RW50cnlEaXN0YW5jZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyByYXkgbWlzc2VzIHNwaGVyZVxuXHRcdHJldHVybiAtMTtcblx0fVxuXG5cdHB1YmxpYyBjb250YWluc1BvaW50KHBvc2l0aW9uOlZlY3RvcjNEKTpib29sZWFuXG5cdHtcblx0XHR2YXIgcHg6bnVtYmVyID0gcG9zaXRpb24ueCAtIHRoaXMuX2NlbnRlclg7XG5cdFx0dmFyIHB5Om51bWJlciA9IHBvc2l0aW9uLnkgLSB0aGlzLl9jZW50ZXJZO1xuXHRcdHZhciBwejpudW1iZXIgPSBwb3NpdGlvbi56IC0gdGhpcy5fY2VudGVyWjtcblx0XHR2YXIgZGlzdGFuY2U6bnVtYmVyID0gTWF0aC5zcXJ0KHB4KnB4ICsgcHkqcHkgKyBweipweik7XG5cdFx0cmV0dXJuIGRpc3RhbmNlIDw9IHRoaXMuX3JhZGl1cztcblx0fVxuXG5cdHB1YmxpYyBwVXBkYXRlQm91bmRpbmdFbnRpdHkoKVxuXHR7XG5cdFx0dmFyIHNjOm51bWJlciA9IHRoaXMuX3JhZGl1cztcblx0XHRpZiAoc2MgPT0gMClcblx0XHRcdHNjID0gMC4wMDE7XG5cblx0XHR2YXIgdHJhbnNmb3JtOlRyYW5zZm9ybSA9IHRoaXMuX3BCb3VuZGluZ0VudGl0eS50cmFuc2Zvcm07XG5cdFx0dHJhbnNmb3JtLnNjYWxlID0gbmV3IFZlY3RvcjNEKHNjLCBzYywgc2MpO1xuXHRcdHRyYW5zZm9ybS5wb3NpdGlvbiA9IG5ldyBWZWN0b3IzRCh0aGlzLl9jZW50ZXJYLCB0aGlzLl9jZW50ZXJZLCB0aGlzLl9jZW50ZXJaKTtcblx0fVxuXG5cdC8vIFRPRE8gcENyZWF0ZUJvdW5kaW5nUmVuZGVyYWJsZSgpOldpcmVmcmFtZVByaW1pdGl2ZUJhc2VcblxuXHRwdWJsaWMgcENyZWF0ZUJvdW5kaW5nRW50aXR5KCk6SUVudGl0eVxuXHR7XG5cdFx0cmV0dXJuIG51bGw7Ly9uZXcgYXdheS5wcmltaXRpdmVzLldpcmVmcmFtZVNwaGVyZSgxLCAxNiwgMTIsIDB4ZmZmZmZmLCAwLjUpO1xuXHR9XG5cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgY2xhc3NpZnlUb1BsYW5lKHBsYW5lOlBsYW5lM0QpOm51bWJlclxuXHR7XG5cdFx0dmFyIGE6bnVtYmVyID0gcGxhbmUuYTtcblx0XHR2YXIgYjpudW1iZXIgPSBwbGFuZS5iO1xuXHRcdHZhciBjOm51bWJlciA9IHBsYW5lLmM7XG5cdFx0dmFyIGRkOm51bWJlciA9IGEqdGhpcy5fY2VudGVyWCArIGIqdGhpcy5fY2VudGVyWSArIGMqdGhpcy5fY2VudGVyWiAtIHBsYW5lLmQ7XG5cblx0XHRpZiAoYSA8IDApXG5cdFx0XHRhID0gLWE7XG5cblx0XHRpZiAoYiA8IDApXG5cdFx0XHRiID0gLWI7XG5cblx0XHRpZiAoYyA8IDApXG5cdFx0XHRjID0gLWM7XG5cblx0XHR2YXIgcnI6TnVtYmVyID0gKGEgKyBiICsgYykqdGhpcy5fcmFkaXVzO1xuXG5cdFx0cmV0dXJuIGRkID4gcnI/IFBsYW5lQ2xhc3NpZmljYXRpb24uRlJPTlQgOiBkZCA8IC1ycj8gUGxhbmVDbGFzc2lmaWNhdGlvbi5CQUNLIDogUGxhbmVDbGFzc2lmaWNhdGlvbi5JTlRFUlNFQ1Q7XG5cdH1cblxuXHRwdWJsaWMgdHJhbnNmb3JtRnJvbShib3VuZHM6Qm91bmRpbmdWb2x1bWVCYXNlLCBtYXRyaXg6TWF0cml4M0QpXG5cdHtcblx0XHR2YXIgc3BoZXJlOkJvdW5kaW5nU3BoZXJlID0gPEJvdW5kaW5nU3BoZXJlPiBib3VuZHM7XG5cdFx0dmFyIGN4Om51bWJlciA9IHNwaGVyZS5fY2VudGVyWDtcblx0XHR2YXIgY3k6bnVtYmVyID0gc3BoZXJlLl9jZW50ZXJZO1xuXHRcdHZhciBjejpudW1iZXIgPSBzcGhlcmUuX2NlbnRlclo7XG5cdFx0dmFyIHJhdzpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oMTYpO1xuXG5cdFx0bWF0cml4LmNvcHlSYXdEYXRhVG8ocmF3KTtcblxuXHRcdHZhciBtMTE6bnVtYmVyID0gcmF3WzBdLCBtMTI6bnVtYmVyID0gcmF3WzRdLCBtMTM6bnVtYmVyID0gcmF3WzhdLCBtMTQ6bnVtYmVyID0gcmF3WzEyXTtcblx0XHR2YXIgbTIxOm51bWJlciA9IHJhd1sxXSwgbTIyOm51bWJlciA9IHJhd1s1XSwgbTIzOm51bWJlciA9IHJhd1s5XSwgbTI0Om51bWJlciA9IHJhd1sxM107XG5cdFx0dmFyIG0zMTpudW1iZXIgPSByYXdbMl0sIG0zMjpudW1iZXIgPSByYXdbNl0sIG0zMzpudW1iZXIgPSByYXdbMTBdLCBtMzQ6bnVtYmVyID0gcmF3WzE0XTtcblxuXHRcdHRoaXMuX2NlbnRlclggPSBjeCptMTEgKyBjeSptMTIgKyBjeiptMTMgKyBtMTQ7XG5cdFx0dGhpcy5fY2VudGVyWSA9IGN4Km0yMSArIGN5Km0yMiArIGN6Km0yMyArIG0yNDtcblx0XHR0aGlzLl9jZW50ZXJaID0gY3gqbTMxICsgY3kqbTMyICsgY3oqbTMzICsgbTM0O1xuXG5cdFx0aWYgKG0xMSA8IDApXG5cdFx0XHRtMTEgPSAtbTExO1xuXHRcdGlmIChtMTIgPCAwKVxuXHRcdFx0bTEyID0gLW0xMjtcblx0XHRpZiAobTEzIDwgMClcblx0XHRcdG0xMyA9IC1tMTM7XG5cdFx0aWYgKG0yMSA8IDApXG5cdFx0XHRtMjEgPSAtbTIxO1xuXHRcdGlmIChtMjIgPCAwKVxuXHRcdFx0bTIyID0gLW0yMjtcblx0XHRpZiAobTIzIDwgMClcblx0XHRcdG0yMyA9IC1tMjM7XG5cdFx0aWYgKG0zMSA8IDApXG5cdFx0XHRtMzEgPSAtbTMxO1xuXHRcdGlmIChtMzIgPCAwKVxuXHRcdFx0bTMyID0gLW0zMjtcblx0XHRpZiAobTMzIDwgMClcblx0XHRcdG0zMyA9IC1tMzM7XG5cblx0XHR2YXIgcjpudW1iZXIgPSBzcGhlcmUuX3JhZGl1cztcblx0XHR2YXIgcng6bnVtYmVyID0gbTExICsgbTEyICsgbTEzO1xuXHRcdHZhciByeTpudW1iZXIgPSBtMjEgKyBtMjIgKyBtMjM7XG5cdFx0dmFyIHJ6Om51bWJlciA9IG0zMSArIG0zMiArIG0zMztcblx0XHR0aGlzLl9yYWRpdXMgPSByKk1hdGguc3FydChyeCpyeCArIHJ5KnJ5ICsgcnoqcnopO1xuXG5cdFx0dGhpcy5fYWFiYi53aWR0aCA9IHRoaXMuX2FhYmIuaGVpZ2h0ID0gdGhpcy5fYWFiYi5kZXB0aCA9IHRoaXMuX3JhZGl1cyoyO1xuXHRcdHRoaXMuX2FhYmIueCA9IHRoaXMuX2NlbnRlclggLSB0aGlzLl9yYWRpdXM7XG5cdFx0dGhpcy5fYWFiYi55ID0gdGhpcy5fY2VudGVyWSArIHRoaXMuX3JhZGl1cztcblx0XHR0aGlzLl9hYWJiLnogPSB0aGlzLl9jZW50ZXJaIC0gdGhpcy5fcmFkaXVzO1xuXHR9XG59XG5cbmV4cG9ydCA9IEJvdW5kaW5nU3BoZXJlOyJdfQ==