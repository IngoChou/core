var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var URLLoaderDataFormat = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var ParserBase = require("awayjs-core/lib/parsers/ParserBase");
var ImageCubeTexture = require("awayjs-core/lib/textures/ImageCubeTexture");
/**
 * CubeTextureParser provides a "parser" for natively supported image types (jpg, png). While it simply loads bytes into
 * a loader object, it wraps it in a BitmapDataResource so resource management can happen consistently without
 * exception cases.
 */
var CubeTextureParser = (function (_super) {
    __extends(CubeTextureParser, _super);
    /**
     * Creates a new CubeTextureParser object.
     * @param uri The url or id of the data or file to be parsed.
     * @param extra The holder for extra contextual data that the parser might need.
     */
    function CubeTextureParser() {
        _super.call(this, URLLoaderDataFormat.TEXT);
    }
    /**
     * Indicates whether or not a given file extension is supported by the parser.
     * @param extension The file extension of a potential file to be parsed.
     * @return Whether or not the given file type is supported.
     */
    CubeTextureParser.supportsType = function (extension) {
        extension = extension.toLowerCase();
        return extension == "cube";
    };
    /**
     * Tests whether a data block can be parsed by the parser.
     * @param data The data block to potentially be parsed.
     * @return Whether or not the given data is supported.
     */
    CubeTextureParser.supportsData = function (data) {
        try {
            var obj = JSON.parse(data);
            if (obj) {
                return true;
            }
            return false;
        }
        catch (e) {
            return false;
        }
        return false;
    };
    /**
     * @inheritDoc
     */
    CubeTextureParser.prototype._iResolveDependency = function (resourceDependency) {
    };
    /**
     * @inheritDoc
     */
    CubeTextureParser.prototype._iResolveDependencyFailure = function (resourceDependency) {
    };
    /**
     * @inheritDoc
     */
    CubeTextureParser.prototype._pProceedParsing = function () {
        if (this._imgDependencyDictionary != null) {
            var asset = new ImageCubeTexture(this._getHTMLImageElement(CubeTextureParser.posX), this._getHTMLImageElement(CubeTextureParser.negX), this._getHTMLImageElement(CubeTextureParser.posY), this._getHTMLImageElement(CubeTextureParser.negY), this._getHTMLImageElement(CubeTextureParser.posZ), this._getHTMLImageElement(CubeTextureParser.negZ));
            //clear dictionary
            this._imgDependencyDictionary = null;
            asset.name = this._iFileName;
            this._pFinalizeAsset(asset, this._iFileName);
            return ParserBase.PARSING_DONE;
        }
        try {
            var json = JSON.parse(this.data);
            var data = json.data;
            var rec;
            if (data.length != 6)
                this._pDieWithError('CubeTextureParser: Error - cube texture should have exactly 6 images');
            if (json) {
                this._imgDependencyDictionary = new Object();
                for (var c = 0; c < data.length; c++) {
                    rec = data[c];
                    this._imgDependencyDictionary[rec.id] = this._pAddDependency(rec.id, new URLRequest(rec.image.toString()));
                }
                if (!this._validateCubeData()) {
                    this._pDieWithError("CubeTextureParser: JSON data error - cubes require id of:   \n" + CubeTextureParser.posX + ', ' + CubeTextureParser.negX + ',  \n' + CubeTextureParser.posY + ', ' + CubeTextureParser.negY + ',  \n' + CubeTextureParser.posZ + ', ' + CubeTextureParser.negZ);
                    return ParserBase.PARSING_DONE;
                }
                this._pPauseAndRetrieveDependencies();
                return ParserBase.MORE_TO_PARSE;
            }
        }
        catch (e) {
            this._pDieWithError('CubeTexturePaser Error parsing JSON');
        }
        return ParserBase.PARSING_DONE;
    };
    CubeTextureParser.prototype._validateCubeData = function () {
        return (this._imgDependencyDictionary[CubeTextureParser.posX] != null && this._imgDependencyDictionary[CubeTextureParser.negX] != null && this._imgDependencyDictionary[CubeTextureParser.posY] != null && this._imgDependencyDictionary[CubeTextureParser.negY] != null && this._imgDependencyDictionary[CubeTextureParser.posZ] != null && this._imgDependencyDictionary[CubeTextureParser.negZ] != null);
    };
    CubeTextureParser.prototype._getHTMLImageElement = function (name) {
        var dependency = this._imgDependencyDictionary[name];
        if (dependency) {
            return dependency.assets[0].htmlImageElement;
        }
        return null;
    };
    CubeTextureParser.posX = 'posX';
    CubeTextureParser.negX = 'negX';
    CubeTextureParser.posY = 'posY';
    CubeTextureParser.negY = 'negY';
    CubeTextureParser.posZ = 'posZ';
    CubeTextureParser.negZ = 'negZ';
    return CubeTextureParser;
})(ParserBase);
module.exports = CubeTextureParser;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL0N1YmVUZXh0dXJlUGFyc2VyLnRzIl0sIm5hbWVzIjpbIkN1YmVUZXh0dXJlUGFyc2VyIiwiQ3ViZVRleHR1cmVQYXJzZXIuY29uc3RydWN0b3IiLCJDdWJlVGV4dHVyZVBhcnNlci5zdXBwb3J0c1R5cGUiLCJDdWJlVGV4dHVyZVBhcnNlci5zdXBwb3J0c0RhdGEiLCJDdWJlVGV4dHVyZVBhcnNlci5faVJlc29sdmVEZXBlbmRlbmN5IiwiQ3ViZVRleHR1cmVQYXJzZXIuX2lSZXNvbHZlRGVwZW5kZW5jeUZhaWx1cmUiLCJDdWJlVGV4dHVyZVBhcnNlci5fcFByb2NlZWRQYXJzaW5nIiwiQ3ViZVRleHR1cmVQYXJzZXIuX3ZhbGlkYXRlQ3ViZURhdGEiLCJDdWJlVGV4dHVyZVBhcnNlci5fZ2V0SFRNTEltYWdlRWxlbWVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBTyxtQkFBbUIsV0FBWSx5Q0FBeUMsQ0FBQyxDQUFDO0FBQ2pGLElBQU8sVUFBVSxXQUFjLGdDQUFnQyxDQUFDLENBQUM7QUFDakUsSUFBTyxVQUFVLFdBQWMsb0NBQW9DLENBQUMsQ0FBQztBQUVyRSxJQUFPLGdCQUFnQixXQUFhLDJDQUEyQyxDQUFDLENBQUM7QUFHakYsQUFLQTs7OztHQURHO0lBQ0csaUJBQWlCO0lBQVNBLFVBQTFCQSxpQkFBaUJBLFVBQW1CQTtJQVd6Q0E7Ozs7T0FJR0E7SUFDSEEsU0FoQktBLGlCQUFpQkE7UUFrQnJCQyxrQkFBTUEsbUJBQW1CQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFFREQ7Ozs7T0FJR0E7SUFFV0EsOEJBQVlBLEdBQTFCQSxVQUEyQkEsU0FBZ0JBO1FBRTFDRSxTQUFTQSxHQUFHQSxTQUFTQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUNwQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsSUFBSUEsTUFBTUEsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBRURGOzs7O09BSUdBO0lBQ1dBLDhCQUFZQSxHQUExQkEsVUFBMkJBLElBQVFBO1FBRWxDRyxJQUFBQSxDQUFDQTtZQUNBQSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUUzQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1lBQ2JBLENBQUNBO1lBQ0RBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO1FBQ2RBLENBQUVBO1FBQUFBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ1pBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO1FBQ2RBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO0lBQ2RBLENBQUNBO0lBRURIOztPQUVHQTtJQUNJQSwrQ0FBbUJBLEdBQTFCQSxVQUEyQkEsa0JBQXFDQTtJQUdoRUksQ0FBQ0E7SUFFREo7O09BRUdBO0lBQ0lBLHNEQUEwQkEsR0FBakNBLFVBQWtDQSxrQkFBcUNBO0lBR3ZFSyxDQUFDQTtJQUVETDs7T0FFR0E7SUFDSUEsNENBQWdCQSxHQUF2QkE7UUFFQ00sRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esd0JBQXdCQSxJQUFJQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMzQ0EsSUFBSUEsS0FBS0EsR0FBb0JBLElBQUlBLGdCQUFnQkEsQ0FFaERBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxpQkFBaUJBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxpQkFBaUJBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBRW5UQSxBQUNBQSxrQkFEa0JBO1lBQ2xCQSxJQUFJQSxDQUFDQSx3QkFBd0JBLEdBQUdBLElBQUlBLENBQUNBO1lBRXJDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQTtZQUU3QkEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBVUEsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0E7WUFFdERBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLFlBQVlBLENBQUNBO1FBQ2hDQSxDQUFDQTtRQUVEQSxJQUFBQSxDQUFDQTtZQUNBQSxJQUFJQSxJQUFJQSxHQUFPQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNyQ0EsSUFBSUEsSUFBSUEsR0FBaUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1lBQ25EQSxJQUFJQSxHQUFPQSxDQUFDQTtZQUVaQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDcEJBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLHNFQUFzRUEsQ0FBQ0EsQ0FBQ0E7WUFFN0ZBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO2dCQUNWQSxJQUFJQSxDQUFDQSx3QkFBd0JBLEdBQUdBLElBQUlBLE1BQU1BLEVBQUVBLENBQUNBO2dCQUU3Q0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7b0JBQzdDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDZEEsSUFBSUEsQ0FBQ0Esd0JBQXdCQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxJQUFJQSxVQUFVQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDNUdBLENBQUNBO2dCQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO29CQUUvQkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsZ0VBQWdFQSxHQUFHQSxpQkFBaUJBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsR0FBR0EsT0FBT0EsR0FBR0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxpQkFBaUJBLENBQUNBLElBQUlBLEdBQUdBLE9BQU9BLEdBQUdBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtvQkFFclJBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLFlBQVlBLENBQUNBO2dCQUVoQ0EsQ0FBQ0E7Z0JBRURBLElBQUlBLENBQUNBLDhCQUE4QkEsRUFBRUEsQ0FBQ0E7Z0JBRXRDQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQTtZQUNqQ0EsQ0FBQ0E7UUFDRkEsQ0FBRUE7UUFBQUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDWkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EscUNBQXFDQSxDQUFDQSxDQUFDQTtRQUM1REEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7SUFFaENBLENBQUNBO0lBRU9OLDZDQUFpQkEsR0FBekJBO1FBRUNPLE1BQU1BLENBQUVBLENBQUVBLElBQUlBLENBQUNBLHdCQUF3QkEsQ0FBRUEsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFFQSxJQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxDQUFDQSx3QkFBd0JBLENBQUVBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBRUEsSUFBSUEsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0Esd0JBQXdCQSxDQUFFQSxpQkFBaUJBLENBQUNBLElBQUlBLENBQUVBLElBQUlBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLHdCQUF3QkEsQ0FBRUEsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFFQSxJQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxDQUFDQSx3QkFBd0JBLENBQUVBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBRUEsSUFBSUEsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0Esd0JBQXdCQSxDQUFFQSxpQkFBaUJBLENBQUNBLElBQUlBLENBQUVBLElBQUlBLElBQUlBLENBQUVBLENBQUNBO0lBQzVaQSxDQUFDQTtJQUVPUCxnREFBb0JBLEdBQTVCQSxVQUE2QkEsSUFBV0E7UUFFdkNRLElBQUlBLFVBQVVBLEdBQTJDQSxJQUFJQSxDQUFDQSx3QkFBd0JBLENBQUVBLElBQUlBLENBQUVBLENBQUNBO1FBRS9GQSxFQUFFQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQkEsTUFBTUEsQ0FBb0NBLFVBQVVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUVBLENBQUNBLGdCQUFnQkEsQ0FBQ0E7UUFDbEZBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO0lBQ2JBLENBQUNBO0lBMUljUixzQkFBSUEsR0FBVUEsTUFBTUEsQ0FBQ0E7SUFDckJBLHNCQUFJQSxHQUFVQSxNQUFNQSxDQUFDQTtJQUNyQkEsc0JBQUlBLEdBQVVBLE1BQU1BLENBQUNBO0lBQ3JCQSxzQkFBSUEsR0FBVUEsTUFBTUEsQ0FBQ0E7SUFDckJBLHNCQUFJQSxHQUFVQSxNQUFNQSxDQUFDQTtJQUNyQkEsc0JBQUlBLEdBQVVBLE1BQU1BLENBQUNBO0lBdUlyQ0Esd0JBQUNBO0FBQURBLENBOUlBLEFBOElDQSxFQTlJK0IsVUFBVSxFQThJekM7QUFFRCxBQUEyQixpQkFBbEIsaUJBQWlCLENBQUMiLCJmaWxlIjoicGFyc2Vycy9DdWJlVGV4dHVyZVBhcnNlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSUFzc2V0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0lBc3NldFwiKTtcbmltcG9ydCBVUkxMb2FkZXJEYXRhRm9ybWF0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMTG9hZGVyRGF0YUZvcm1hdFwiKTtcbmltcG9ydCBVUkxSZXF1ZXN0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIik7XG5pbXBvcnQgUGFyc2VyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyQmFzZVwiKTtcbmltcG9ydCBSZXNvdXJjZURlcGVuZGVuY3lcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUmVzb3VyY2VEZXBlbmRlbmN5XCIpO1xuaW1wb3J0IEltYWdlQ3ViZVRleHR1cmVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvSW1hZ2VDdWJlVGV4dHVyZVwiKTtcbmltcG9ydCBJbWFnZVRleHR1cmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9JbWFnZVRleHR1cmVcIik7XG5cbi8qKlxuICogQ3ViZVRleHR1cmVQYXJzZXIgcHJvdmlkZXMgYSBcInBhcnNlclwiIGZvciBuYXRpdmVseSBzdXBwb3J0ZWQgaW1hZ2UgdHlwZXMgKGpwZywgcG5nKS4gV2hpbGUgaXQgc2ltcGx5IGxvYWRzIGJ5dGVzIGludG9cbiAqIGEgbG9hZGVyIG9iamVjdCwgaXQgd3JhcHMgaXQgaW4gYSBCaXRtYXBEYXRhUmVzb3VyY2Ugc28gcmVzb3VyY2UgbWFuYWdlbWVudCBjYW4gaGFwcGVuIGNvbnNpc3RlbnRseSB3aXRob3V0XG4gKiBleGNlcHRpb24gY2FzZXMuXG4gKi9cbmNsYXNzIEN1YmVUZXh0dXJlUGFyc2VyIGV4dGVuZHMgUGFyc2VyQmFzZVxue1xuXHRwcml2YXRlIHN0YXRpYyBwb3NYOnN0cmluZyA9ICdwb3NYJztcblx0cHJpdmF0ZSBzdGF0aWMgbmVnWDpzdHJpbmcgPSAnbmVnWCc7XG5cdHByaXZhdGUgc3RhdGljIHBvc1k6c3RyaW5nID0gJ3Bvc1knO1xuXHRwcml2YXRlIHN0YXRpYyBuZWdZOnN0cmluZyA9ICduZWdZJztcblx0cHJpdmF0ZSBzdGF0aWMgcG9zWjpzdHJpbmcgPSAncG9zWic7XG5cdHByaXZhdGUgc3RhdGljIG5lZ1o6c3RyaW5nID0gJ25lZ1onO1xuXG5cdHByaXZhdGUgX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5Ok9iamVjdDtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBDdWJlVGV4dHVyZVBhcnNlciBvYmplY3QuXG5cdCAqIEBwYXJhbSB1cmkgVGhlIHVybCBvciBpZCBvZiB0aGUgZGF0YSBvciBmaWxlIHRvIGJlIHBhcnNlZC5cblx0ICogQHBhcmFtIGV4dHJhIFRoZSBob2xkZXIgZm9yIGV4dHJhIGNvbnRleHR1YWwgZGF0YSB0aGF0IHRoZSBwYXJzZXIgbWlnaHQgbmVlZC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHN1cGVyKFVSTExvYWRlckRhdGFGb3JtYXQuVEVYVCk7XG5cdH1cblxuXHQvKipcblx0ICogSW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IGEgZ2l2ZW4gZmlsZSBleHRlbnNpb24gaXMgc3VwcG9ydGVkIGJ5IHRoZSBwYXJzZXIuXG5cdCAqIEBwYXJhbSBleHRlbnNpb24gVGhlIGZpbGUgZXh0ZW5zaW9uIG9mIGEgcG90ZW50aWFsIGZpbGUgdG8gYmUgcGFyc2VkLlxuXHQgKiBAcmV0dXJuIFdoZXRoZXIgb3Igbm90IHRoZSBnaXZlbiBmaWxlIHR5cGUgaXMgc3VwcG9ydGVkLlxuXHQgKi9cblxuXHRwdWJsaWMgc3RhdGljIHN1cHBvcnRzVHlwZShleHRlbnNpb246c3RyaW5nKTpib29sZWFuXG5cdHtcblx0XHRleHRlbnNpb24gPSBleHRlbnNpb24udG9Mb3dlckNhc2UoKTtcblx0XHRyZXR1cm4gZXh0ZW5zaW9uID09IFwiY3ViZVwiO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRlc3RzIHdoZXRoZXIgYSBkYXRhIGJsb2NrIGNhbiBiZSBwYXJzZWQgYnkgdGhlIHBhcnNlci5cblx0ICogQHBhcmFtIGRhdGEgVGhlIGRhdGEgYmxvY2sgdG8gcG90ZW50aWFsbHkgYmUgcGFyc2VkLlxuXHQgKiBAcmV0dXJuIFdoZXRoZXIgb3Igbm90IHRoZSBnaXZlbiBkYXRhIGlzIHN1cHBvcnRlZC5cblx0ICovXG5cdHB1YmxpYyBzdGF0aWMgc3VwcG9ydHNEYXRhKGRhdGE6YW55KTpib29sZWFuXG5cdHtcblx0XHR0cnkge1xuXHRcdFx0dmFyIG9iaiA9IEpTT04ucGFyc2UoZGF0YSk7XG5cblx0XHRcdGlmIChvYmopIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pUmVzb2x2ZURlcGVuZGVuY3kocmVzb3VyY2VEZXBlbmRlbmN5OlJlc291cmNlRGVwZW5kZW5jeSlcblx0e1xuXG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaVJlc29sdmVEZXBlbmRlbmN5RmFpbHVyZShyZXNvdXJjZURlcGVuZGVuY3k6UmVzb3VyY2VEZXBlbmRlbmN5KVxuXHR7XG5cblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9wUHJvY2VlZFBhcnNpbmcoKTpib29sZWFuXG5cdHtcblx0XHRpZiAodGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnkgIT0gbnVsbCkgeyAvL2FsbCBpbWFnZXMgbG9hZGVkXG5cdFx0XHR2YXIgYXNzZXQ6SW1hZ2VDdWJlVGV4dHVyZSA9IG5ldyBJbWFnZUN1YmVUZXh0dXJlKFxuXG5cdFx0XHRcdHRoaXMuX2dldEhUTUxJbWFnZUVsZW1lbnQoQ3ViZVRleHR1cmVQYXJzZXIucG9zWCksIHRoaXMuX2dldEhUTUxJbWFnZUVsZW1lbnQoQ3ViZVRleHR1cmVQYXJzZXIubmVnWCksIHRoaXMuX2dldEhUTUxJbWFnZUVsZW1lbnQoQ3ViZVRleHR1cmVQYXJzZXIucG9zWSksIHRoaXMuX2dldEhUTUxJbWFnZUVsZW1lbnQoQ3ViZVRleHR1cmVQYXJzZXIubmVnWSksIHRoaXMuX2dldEhUTUxJbWFnZUVsZW1lbnQoQ3ViZVRleHR1cmVQYXJzZXIucG9zWiksIHRoaXMuX2dldEhUTUxJbWFnZUVsZW1lbnQoQ3ViZVRleHR1cmVQYXJzZXIubmVnWikpO1xuXG5cdFx0XHQvL2NsZWFyIGRpY3Rpb25hcnlcblx0XHRcdHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5ID0gbnVsbDtcblxuXHRcdFx0YXNzZXQubmFtZSA9IHRoaXMuX2lGaWxlTmFtZTtcblxuXHRcdFx0dGhpcy5fcEZpbmFsaXplQXNzZXQoPElBc3NldD4gYXNzZXQsIHRoaXMuX2lGaWxlTmFtZSk7XG5cblx0XHRcdHJldHVybiBQYXJzZXJCYXNlLlBBUlNJTkdfRE9ORTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0dmFyIGpzb246YW55ID0gSlNPTi5wYXJzZSh0aGlzLmRhdGEpO1xuXHRcdFx0dmFyIGRhdGE6QXJyYXk8T2JqZWN0PiA9IDxBcnJheTxPYmplY3Q+PiBqc29uLmRhdGE7XG5cdFx0XHR2YXIgcmVjOmFueTtcblxuXHRcdFx0aWYgKGRhdGEubGVuZ3RoICE9IDYpXG5cdFx0XHRcdHRoaXMuX3BEaWVXaXRoRXJyb3IoJ0N1YmVUZXh0dXJlUGFyc2VyOiBFcnJvciAtIGN1YmUgdGV4dHVyZSBzaG91bGQgaGF2ZSBleGFjdGx5IDYgaW1hZ2VzJyk7XG5cblx0XHRcdGlmIChqc29uKSB7XG5cdFx0XHRcdHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5ID0gbmV3IE9iamVjdCgpO1xuXG5cdFx0XHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IGRhdGEubGVuZ3RoOyBjKyspIHtcblx0XHRcdFx0XHRyZWMgPSBkYXRhW2NdO1xuXHRcdFx0XHRcdHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5W3JlYy5pZF0gPSB0aGlzLl9wQWRkRGVwZW5kZW5jeShyZWMuaWQsIG5ldyBVUkxSZXF1ZXN0KHJlYy5pbWFnZS50b1N0cmluZygpKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIXRoaXMuX3ZhbGlkYXRlQ3ViZURhdGEoKSkge1xuXG5cdFx0XHRcdFx0dGhpcy5fcERpZVdpdGhFcnJvcihcIkN1YmVUZXh0dXJlUGFyc2VyOiBKU09OIGRhdGEgZXJyb3IgLSBjdWJlcyByZXF1aXJlIGlkIG9mOiAgIFxcblwiICsgQ3ViZVRleHR1cmVQYXJzZXIucG9zWCArICcsICcgKyBDdWJlVGV4dHVyZVBhcnNlci5uZWdYICsgJywgIFxcbicgKyBDdWJlVGV4dHVyZVBhcnNlci5wb3NZICsgJywgJyArIEN1YmVUZXh0dXJlUGFyc2VyLm5lZ1kgKyAnLCAgXFxuJyArIEN1YmVUZXh0dXJlUGFyc2VyLnBvc1ogKyAnLCAnICsgQ3ViZVRleHR1cmVQYXJzZXIubmVnWik7XG5cblx0XHRcdFx0XHRyZXR1cm4gUGFyc2VyQmFzZS5QQVJTSU5HX0RPTkU7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuX3BQYXVzZUFuZFJldHJpZXZlRGVwZW5kZW5jaWVzKCk7XG5cblx0XHRcdFx0cmV0dXJuIFBhcnNlckJhc2UuTU9SRV9UT19QQVJTRTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHR0aGlzLl9wRGllV2l0aEVycm9yKCdDdWJlVGV4dHVyZVBhc2VyIEVycm9yIHBhcnNpbmcgSlNPTicpO1xuXHRcdH1cblxuXHRcdHJldHVybiBQYXJzZXJCYXNlLlBBUlNJTkdfRE9ORTtcblxuXHR9XG5cblx0cHJpdmF0ZSBfdmFsaWRhdGVDdWJlRGF0YSgpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiAgKCB0aGlzLl9pbWdEZXBlbmRlbmN5RGljdGlvbmFyeVsgQ3ViZVRleHR1cmVQYXJzZXIucG9zWCBdICE9IG51bGwgJiYgdGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnlbIEN1YmVUZXh0dXJlUGFyc2VyLm5lZ1ggXSAhPSBudWxsICYmIHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5WyBDdWJlVGV4dHVyZVBhcnNlci5wb3NZIF0gIT0gbnVsbCAmJiB0aGlzLl9pbWdEZXBlbmRlbmN5RGljdGlvbmFyeVsgQ3ViZVRleHR1cmVQYXJzZXIubmVnWSBdICE9IG51bGwgJiYgdGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnlbIEN1YmVUZXh0dXJlUGFyc2VyLnBvc1ogXSAhPSBudWxsICYmIHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5WyBDdWJlVGV4dHVyZVBhcnNlci5uZWdaIF0gIT0gbnVsbCApO1xuXHR9XG5cblx0cHJpdmF0ZSBfZ2V0SFRNTEltYWdlRWxlbWVudChuYW1lOnN0cmluZyk6SFRNTEltYWdlRWxlbWVudFxuXHR7XG5cdFx0dmFyIGRlcGVuZGVuY3k6UmVzb3VyY2VEZXBlbmRlbmN5ID0gPFJlc291cmNlRGVwZW5kZW5jeT4gdGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnlbIG5hbWUgXTtcblxuXHRcdGlmIChkZXBlbmRlbmN5KSB7XG5cdFx0XHRyZXR1cm4gPEhUTUxJbWFnZUVsZW1lbnQ+ICg8SW1hZ2VUZXh0dXJlPiBkZXBlbmRlbmN5LmFzc2V0c1swXSkuaHRtbEltYWdlRWxlbWVudDtcblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG59XG5cbmV4cG9ydCA9IEN1YmVUZXh0dXJlUGFyc2VyOyJdfQ==