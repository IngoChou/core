var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var URLLoaderDataFormat = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var ParserBase = require("awayjs-core/lib/parsers/ParserBase");
var ImageCubeTexture = require("awayjs-core/lib/textures/ImageCubeTexture");
/**
 * CubeTextureParser provides a "parser" for natively supported image types (jpg, png). While it simply loads bytes into
 * a loader object, it wraps it in a BitmapDataResource so resource management can happen consistently without
 * exception cases.
 */
var CubeTextureParser = (function (_super) {
    __extends(CubeTextureParser, _super);
    /**
     * Creates a new CubeTextureParser object.
     * @param uri The url or id of the data or file to be parsed.
     * @param extra The holder for extra contextual data that the parser might need.
     */
    function CubeTextureParser() {
        _super.call(this, URLLoaderDataFormat.TEXT);
    }
    /**
     * Indicates whether or not a given file extension is supported by the parser.
     * @param extension The file extension of a potential file to be parsed.
     * @return Whether or not the given file type is supported.
     */
    CubeTextureParser.supportsType = function (extension) {
        extension = extension.toLowerCase();
        return extension == "cube";
    };
    /**
     * Tests whether a data block can be parsed by the parser.
     * @param data The data block to potentially be parsed.
     * @return Whether or not the given data is supported.
     */
    CubeTextureParser.supportsData = function (data) {
        try {
            var obj = JSON.parse(data);
            if (obj) {
                return true;
            }
            return false;
        }
        catch (e) {
            return false;
        }
        return false;
    };
    /**
     * @inheritDoc
     */
    CubeTextureParser.prototype._iResolveDependency = function (resourceDependency) {
    };
    /**
     * @inheritDoc
     */
    CubeTextureParser.prototype._iResolveDependencyFailure = function (resourceDependency) {
    };
    /**
     * @inheritDoc
     */
    CubeTextureParser.prototype._pProceedParsing = function () {
        if (this._imgDependencyDictionary != null) {
            var asset = new ImageCubeTexture(this._getHTMLImageElement(CubeTextureParser.posX), this._getHTMLImageElement(CubeTextureParser.negX), this._getHTMLImageElement(CubeTextureParser.posY), this._getHTMLImageElement(CubeTextureParser.negY), this._getHTMLImageElement(CubeTextureParser.posZ), this._getHTMLImageElement(CubeTextureParser.negZ));
            //clear dictionary
            this._imgDependencyDictionary = null;
            asset.name = this._iFileName;
            this._pFinalizeAsset(asset, this._iFileName);
            return ParserBase.PARSING_DONE;
        }
        try {
            var json = JSON.parse(this.data);
            var data = json.data;
            var rec;
            if (data.length != 6)
                this._pDieWithError('CubeTextureParser: Error - cube texture should have exactly 6 images');
            if (json) {
                this._imgDependencyDictionary = new Object();
                for (var c = 0; c < data.length; c++) {
                    rec = data[c];
                    this._imgDependencyDictionary[rec.id] = this._pAddDependency(rec.id, new URLRequest(rec.image.toString()));
                }
                if (!this._validateCubeData()) {
                    this._pDieWithError("CubeTextureParser: JSON data error - cubes require id of:   \n" + CubeTextureParser.posX + ', ' + CubeTextureParser.negX + ',  \n' + CubeTextureParser.posY + ', ' + CubeTextureParser.negY + ',  \n' + CubeTextureParser.posZ + ', ' + CubeTextureParser.negZ);
                    return ParserBase.PARSING_DONE;
                }
                this._pPauseAndRetrieveDependencies();
                return ParserBase.MORE_TO_PARSE;
            }
        }
        catch (e) {
            this._pDieWithError('CubeTexturePaser Error parsing JSON');
        }
        return ParserBase.PARSING_DONE;
    };
    CubeTextureParser.prototype._validateCubeData = function () {
        return (this._imgDependencyDictionary[CubeTextureParser.posX] != null && this._imgDependencyDictionary[CubeTextureParser.negX] != null && this._imgDependencyDictionary[CubeTextureParser.posY] != null && this._imgDependencyDictionary[CubeTextureParser.negY] != null && this._imgDependencyDictionary[CubeTextureParser.posZ] != null && this._imgDependencyDictionary[CubeTextureParser.negZ] != null);
    };
    CubeTextureParser.prototype._getHTMLImageElement = function (name) {
        var dependency = this._imgDependencyDictionary[name];
        if (dependency) {
            return dependency.assets[0].htmlImageElement;
        }
        return null;
    };
    CubeTextureParser.posX = 'posX';
    CubeTextureParser.negX = 'negX';
    CubeTextureParser.posY = 'posY';
    CubeTextureParser.negY = 'negY';
    CubeTextureParser.posZ = 'posZ';
    CubeTextureParser.negZ = 'negZ';
    return CubeTextureParser;
})(ParserBase);
module.exports = CubeTextureParser;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL0N1YmVUZXh0dXJlUGFyc2VyLnRzIl0sIm5hbWVzIjpbIkN1YmVUZXh0dXJlUGFyc2VyIiwiQ3ViZVRleHR1cmVQYXJzZXIuY29uc3RydWN0b3IiLCJDdWJlVGV4dHVyZVBhcnNlci5zdXBwb3J0c1R5cGUiLCJDdWJlVGV4dHVyZVBhcnNlci5zdXBwb3J0c0RhdGEiLCJDdWJlVGV4dHVyZVBhcnNlci5faVJlc29sdmVEZXBlbmRlbmN5IiwiQ3ViZVRleHR1cmVQYXJzZXIuX2lSZXNvbHZlRGVwZW5kZW5jeUZhaWx1cmUiLCJDdWJlVGV4dHVyZVBhcnNlci5fcFByb2NlZWRQYXJzaW5nIiwiQ3ViZVRleHR1cmVQYXJzZXIuX3ZhbGlkYXRlQ3ViZURhdGEiLCJDdWJlVGV4dHVyZVBhcnNlci5fZ2V0SFRNTEltYWdlRWxlbWVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBTyxtQkFBbUIsV0FBWSx5Q0FBeUMsQ0FBQyxDQUFDO0FBQ2pGLElBQU8sVUFBVSxXQUFjLGdDQUFnQyxDQUFDLENBQUM7QUFDakUsSUFBTyxVQUFVLFdBQWMsb0NBQW9DLENBQUMsQ0FBQztBQUVyRSxJQUFPLGdCQUFnQixXQUFhLDJDQUEyQyxDQUFDLENBQUM7QUFHakYsQUFLQTs7OztHQURHO0lBQ0csaUJBQWlCO0lBQVNBLFVBQTFCQSxpQkFBaUJBLFVBQW1CQTtJQVd6Q0E7Ozs7T0FJR0E7SUFDSEEsU0FoQktBLGlCQUFpQkE7UUFrQnJCQyxrQkFBTUEsbUJBQW1CQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFFREQ7Ozs7T0FJR0E7SUFFV0EsOEJBQVlBLEdBQTFCQSxVQUEyQkEsU0FBZ0JBO1FBRTFDRSxTQUFTQSxHQUFHQSxTQUFTQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUNwQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsSUFBSUEsTUFBTUEsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBRURGOzs7O09BSUdB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ckJBLHNCQUFJQSxHQUFVQSxNQUFNQSxDQUFDQTtJQUNyQkEsc0JBQUlBLEdBQVVBLE1BQU1BLENBQUNBO0lBdUlyQ0Esd0JBQUNBO0FBQURBLENBOUlBLEFBOElDQSxFQTlJK0IsVUFBVSxFQThJekM7QUFFRCxBQUEyQixpQkFBbEIsaUJBQWlCLENBQUMiLCJmaWxlIjoicGFyc2Vycy9DdWJlVGV4dHVyZVBhcnNlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSUFzc2V0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0lBc3NldFwiKTtcclxuaW1wb3J0IFVSTExvYWRlckRhdGFGb3JtYXRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxMb2FkZXJEYXRhRm9ybWF0XCIpO1xyXG5pbXBvcnQgVVJMUmVxdWVzdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxSZXF1ZXN0XCIpO1xyXG5pbXBvcnQgUGFyc2VyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyQmFzZVwiKTtcclxuaW1wb3J0IFJlc291cmNlRGVwZW5kZW5jeVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcGFyc2Vycy9SZXNvdXJjZURlcGVuZGVuY3lcIik7XHJcbmltcG9ydCBJbWFnZUN1YmVUZXh0dXJlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL0ltYWdlQ3ViZVRleHR1cmVcIik7XHJcbmltcG9ydCBJbWFnZVRleHR1cmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9JbWFnZVRleHR1cmVcIik7XHJcblxyXG4vKipcclxuICogQ3ViZVRleHR1cmVQYXJzZXIgcHJvdmlkZXMgYSBcInBhcnNlclwiIGZvciBuYXRpdmVseSBzdXBwb3J0ZWQgaW1hZ2UgdHlwZXMgKGpwZywgcG5nKS4gV2hpbGUgaXQgc2ltcGx5IGxvYWRzIGJ5dGVzIGludG9cclxuICogYSBsb2FkZXIgb2JqZWN0LCBpdCB3cmFwcyBpdCBpbiBhIEJpdG1hcERhdGFSZXNvdXJjZSBzbyByZXNvdXJjZSBtYW5hZ2VtZW50IGNhbiBoYXBwZW4gY29uc2lzdGVudGx5IHdpdGhvdXRcclxuICogZXhjZXB0aW9uIGNhc2VzLlxyXG4gKi9cclxuY2xhc3MgQ3ViZVRleHR1cmVQYXJzZXIgZXh0ZW5kcyBQYXJzZXJCYXNlXHJcbntcclxuXHRwcml2YXRlIHN0YXRpYyBwb3NYOnN0cmluZyA9ICdwb3NYJztcclxuXHRwcml2YXRlIHN0YXRpYyBuZWdYOnN0cmluZyA9ICduZWdYJztcclxuXHRwcml2YXRlIHN0YXRpYyBwb3NZOnN0cmluZyA9ICdwb3NZJztcclxuXHRwcml2YXRlIHN0YXRpYyBuZWdZOnN0cmluZyA9ICduZWdZJztcclxuXHRwcml2YXRlIHN0YXRpYyBwb3NaOnN0cmluZyA9ICdwb3NaJztcclxuXHRwcml2YXRlIHN0YXRpYyBuZWdaOnN0cmluZyA9ICduZWdaJztcclxuXHJcblx0cHJpdmF0ZSBfaW1nRGVwZW5kZW5jeURpY3Rpb25hcnk6T2JqZWN0O1xyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGVzIGEgbmV3IEN1YmVUZXh0dXJlUGFyc2VyIG9iamVjdC5cclxuXHQgKiBAcGFyYW0gdXJpIFRoZSB1cmwgb3IgaWQgb2YgdGhlIGRhdGEgb3IgZmlsZSB0byBiZSBwYXJzZWQuXHJcblx0ICogQHBhcmFtIGV4dHJhIFRoZSBob2xkZXIgZm9yIGV4dHJhIGNvbnRleHR1YWwgZGF0YSB0aGF0IHRoZSBwYXJzZXIgbWlnaHQgbmVlZC5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcigpXHJcblx0e1xyXG5cdFx0c3VwZXIoVVJMTG9hZGVyRGF0YUZvcm1hdC5URVhUKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCBhIGdpdmVuIGZpbGUgZXh0ZW5zaW9uIGlzIHN1cHBvcnRlZCBieSB0aGUgcGFyc2VyLlxyXG5cdCAqIEBwYXJhbSBleHRlbnNpb24gVGhlIGZpbGUgZXh0ZW5zaW9uIG9mIGEgcG90ZW50aWFsIGZpbGUgdG8gYmUgcGFyc2VkLlxyXG5cdCAqIEByZXR1cm4gV2hldGhlciBvciBub3QgdGhlIGdpdmVuIGZpbGUgdHlwZSBpcyBzdXBwb3J0ZWQuXHJcblx0ICovXHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgc3VwcG9ydHNUeXBlKGV4dGVuc2lvbjpzdHJpbmcpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRleHRlbnNpb24gPSBleHRlbnNpb24udG9Mb3dlckNhc2UoKTtcclxuXHRcdHJldHVybiBleHRlbnNpb24gPT0gXCJjdWJlXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBUZXN0cyB3aGV0aGVyIGEgZGF0YSBibG9jayBjYW4gYmUgcGFyc2VkIGJ5IHRoZSBwYXJzZXIuXHJcblx0ICogQHBhcmFtIGRhdGEgVGhlIGRhdGEgYmxvY2sgdG8gcG90ZW50aWFsbHkgYmUgcGFyc2VkLlxyXG5cdCAqIEByZXR1cm4gV2hldGhlciBvciBub3QgdGhlIGdpdmVuIGRhdGEgaXMgc3VwcG9ydGVkLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBzdGF0aWMgc3VwcG9ydHNEYXRhKGRhdGE6YW55KTpib29sZWFuXHJcblx0e1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0dmFyIG9iaiA9IEpTT04ucGFyc2UoZGF0YSk7XHJcblxyXG5cdFx0XHRpZiAob2JqKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgX2lSZXNvbHZlRGVwZW5kZW5jeShyZXNvdXJjZURlcGVuZGVuY3k6UmVzb3VyY2VEZXBlbmRlbmN5KVxyXG5cdHtcclxuXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfaVJlc29sdmVEZXBlbmRlbmN5RmFpbHVyZShyZXNvdXJjZURlcGVuZGVuY3k6UmVzb3VyY2VEZXBlbmRlbmN5KVxyXG5cdHtcclxuXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfcFByb2NlZWRQYXJzaW5nKCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9pbWdEZXBlbmRlbmN5RGljdGlvbmFyeSAhPSBudWxsKSB7IC8vYWxsIGltYWdlcyBsb2FkZWRcclxuXHRcdFx0dmFyIGFzc2V0OkltYWdlQ3ViZVRleHR1cmUgPSBuZXcgSW1hZ2VDdWJlVGV4dHVyZShcclxuXHJcblx0XHRcdFx0dGhpcy5fZ2V0SFRNTEltYWdlRWxlbWVudChDdWJlVGV4dHVyZVBhcnNlci5wb3NYKSwgdGhpcy5fZ2V0SFRNTEltYWdlRWxlbWVudChDdWJlVGV4dHVyZVBhcnNlci5uZWdYKSwgdGhpcy5fZ2V0SFRNTEltYWdlRWxlbWVudChDdWJlVGV4dHVyZVBhcnNlci5wb3NZKSwgdGhpcy5fZ2V0SFRNTEltYWdlRWxlbWVudChDdWJlVGV4dHVyZVBhcnNlci5uZWdZKSwgdGhpcy5fZ2V0SFRNTEltYWdlRWxlbWVudChDdWJlVGV4dHVyZVBhcnNlci5wb3NaKSwgdGhpcy5fZ2V0SFRNTEltYWdlRWxlbWVudChDdWJlVGV4dHVyZVBhcnNlci5uZWdaKSk7XHJcblxyXG5cdFx0XHQvL2NsZWFyIGRpY3Rpb25hcnlcclxuXHRcdFx0dGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnkgPSBudWxsO1xyXG5cclxuXHRcdFx0YXNzZXQubmFtZSA9IHRoaXMuX2lGaWxlTmFtZTtcclxuXHJcblx0XHRcdHRoaXMuX3BGaW5hbGl6ZUFzc2V0KDxJQXNzZXQ+IGFzc2V0LCB0aGlzLl9pRmlsZU5hbWUpO1xyXG5cclxuXHRcdFx0cmV0dXJuIFBhcnNlckJhc2UuUEFSU0lOR19ET05FO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdHZhciBqc29uOmFueSA9IEpTT04ucGFyc2UodGhpcy5kYXRhKTtcclxuXHRcdFx0dmFyIGRhdGE6QXJyYXk8T2JqZWN0PiA9IDxBcnJheTxPYmplY3Q+PiBqc29uLmRhdGE7XHJcblx0XHRcdHZhciByZWM6YW55O1xyXG5cclxuXHRcdFx0aWYgKGRhdGEubGVuZ3RoICE9IDYpXHJcblx0XHRcdFx0dGhpcy5fcERpZVdpdGhFcnJvcignQ3ViZVRleHR1cmVQYXJzZXI6IEVycm9yIC0gY3ViZSB0ZXh0dXJlIHNob3VsZCBoYXZlIGV4YWN0bHkgNiBpbWFnZXMnKTtcclxuXHJcblx0XHRcdGlmIChqc29uKSB7XHJcblx0XHRcdFx0dGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnkgPSBuZXcgT2JqZWN0KCk7XHJcblxyXG5cdFx0XHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IGRhdGEubGVuZ3RoOyBjKyspIHtcclxuXHRcdFx0XHRcdHJlYyA9IGRhdGFbY107XHJcblx0XHRcdFx0XHR0aGlzLl9pbWdEZXBlbmRlbmN5RGljdGlvbmFyeVtyZWMuaWRdID0gdGhpcy5fcEFkZERlcGVuZGVuY3kocmVjLmlkLCBuZXcgVVJMUmVxdWVzdChyZWMuaW1hZ2UudG9TdHJpbmcoKSkpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKCF0aGlzLl92YWxpZGF0ZUN1YmVEYXRhKCkpIHtcclxuXHJcblx0XHRcdFx0XHR0aGlzLl9wRGllV2l0aEVycm9yKFwiQ3ViZVRleHR1cmVQYXJzZXI6IEpTT04gZGF0YSBlcnJvciAtIGN1YmVzIHJlcXVpcmUgaWQgb2Y6ICAgXFxuXCIgKyBDdWJlVGV4dHVyZVBhcnNlci5wb3NYICsgJywgJyArIEN1YmVUZXh0dXJlUGFyc2VyLm5lZ1ggKyAnLCAgXFxuJyArIEN1YmVUZXh0dXJlUGFyc2VyLnBvc1kgKyAnLCAnICsgQ3ViZVRleHR1cmVQYXJzZXIubmVnWSArICcsICBcXG4nICsgQ3ViZVRleHR1cmVQYXJzZXIucG9zWiArICcsICcgKyBDdWJlVGV4dHVyZVBhcnNlci5uZWdaKTtcclxuXHJcblx0XHRcdFx0XHRyZXR1cm4gUGFyc2VyQmFzZS5QQVJTSU5HX0RPTkU7XHJcblxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dGhpcy5fcFBhdXNlQW5kUmV0cmlldmVEZXBlbmRlbmNpZXMoKTtcclxuXHJcblx0XHRcdFx0cmV0dXJuIFBhcnNlckJhc2UuTU9SRV9UT19QQVJTRTtcclxuXHRcdFx0fVxyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHR0aGlzLl9wRGllV2l0aEVycm9yKCdDdWJlVGV4dHVyZVBhc2VyIEVycm9yIHBhcnNpbmcgSlNPTicpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBQYXJzZXJCYXNlLlBBUlNJTkdfRE9ORTtcclxuXHJcblx0fVxyXG5cclxuXHRwcml2YXRlIF92YWxpZGF0ZUN1YmVEYXRhKCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdHJldHVybiAgKCB0aGlzLl9pbWdEZXBlbmRlbmN5RGljdGlvbmFyeVsgQ3ViZVRleHR1cmVQYXJzZXIucG9zWCBdICE9IG51bGwgJiYgdGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnlbIEN1YmVUZXh0dXJlUGFyc2VyLm5lZ1ggXSAhPSBudWxsICYmIHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5WyBDdWJlVGV4dHVyZVBhcnNlci5wb3NZIF0gIT0gbnVsbCAmJiB0aGlzLl9pbWdEZXBlbmRlbmN5RGljdGlvbmFyeVsgQ3ViZVRleHR1cmVQYXJzZXIubmVnWSBdICE9IG51bGwgJiYgdGhpcy5faW1nRGVwZW5kZW5jeURpY3Rpb25hcnlbIEN1YmVUZXh0dXJlUGFyc2VyLnBvc1ogXSAhPSBudWxsICYmIHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5WyBDdWJlVGV4dHVyZVBhcnNlci5uZWdaIF0gIT0gbnVsbCApO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBfZ2V0SFRNTEltYWdlRWxlbWVudChuYW1lOnN0cmluZyk6SFRNTEltYWdlRWxlbWVudFxyXG5cdHtcclxuXHRcdHZhciBkZXBlbmRlbmN5OlJlc291cmNlRGVwZW5kZW5jeSA9IDxSZXNvdXJjZURlcGVuZGVuY3k+IHRoaXMuX2ltZ0RlcGVuZGVuY3lEaWN0aW9uYXJ5WyBuYW1lIF07XHJcblxyXG5cdFx0aWYgKGRlcGVuZGVuY3kpIHtcclxuXHRcdFx0cmV0dXJuIDxIVE1MSW1hZ2VFbGVtZW50PiAoPEltYWdlVGV4dHVyZT4gZGVwZW5kZW5jeS5hc3NldHNbMF0pLmh0bWxJbWFnZUVsZW1lbnQ7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cclxufVxyXG5cclxuZXhwb3J0ID0gQ3ViZVRleHR1cmVQYXJzZXI7Il19